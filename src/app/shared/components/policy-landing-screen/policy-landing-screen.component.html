<!-- <p-tabView>
    <p-tabPanel header="Life IND" [selected]="true">
      <div>
        <div>
          <div>
            <div class="row">
              <div class="col-7">
                <div>
                  <div class="row">
                    <div class="col-8">
                      <div class="input-group mb-3" style="font-size: 15px">
                        <span class="input-group-text" id="basic-addon1">
                          <i class="fa-solid fa-magnifying-glass"></i>
                        </span>
                        <input
                          style="font-size: 12px !important"
                          type="text"
                          class="form-control"
                          placeholder="Search by client's name or quotation no"
                          aria-label="Username"
                          aria-describedby="basic-addon1"
                        />
                      </div>
                    </div>
                    <div class="col-4">
                      <div class="input-group mb-3">
                        <label
                          class="input-group-text"
                          for="inputGroupSelect01"
                          style="font-size: 11px !important"
                          >Sort by:</label
                        >
                        <select class="form-select" id="inputGroupSelect01">
                          <option selected style="font-size: 11px !important">
                            Status
                          </option>
                          <option></option>
                          <option value="1">One</option>
                          <option value="2">Two</option>
                          <option value="3">Three</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
  
              <div class="col-5">
                <div class="d-flex justify-content-end">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Quotation No.</th>
                  <th>Client Name</th>
                  <th>Sum Assured</th>
                  <th>Premium</th>
                  <th>Intermediary</th>
                  <th>Date Created</th>
                  <th>Cover From</th>
                  <th>Cover To</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody *ngIf="LMS_IND.length > 0">
                <tr *ngFor="let lms of LMS_IND">
                  <td>{{ lms?.quote_no || "" }}</td>
                  <td>{{ lms?.quote_no || "" }}</td>
                  <td>{{ lms?.sum_insured || "" | number }}</td>
                  <td>{{ lms?.premium || 0 | number }}</td>
                  <td>{{ lms?.quote_no || "" }}</td>
                  <td>{{ lms?.created_at || "" }}</td>
                  <td>{{ lms?.quote_no || "" }}</td>
                  <td>{{ lms?.quote_no || "" }}</td>
                  <td>{{ lms?.quote_status || "" }}</td>
                  <td (click)="selectLmsIndRow(lms)">{{ "Process" }}</td>
                </tr>
              </tbody>
            </table>
  
            <div
              *ngIf="LMS_IND.length === 0"
              class="text-danger d-flex justify-content-center"
            >
              No List of Policy Available
            </div>
          </div>
        </div>
      </div>
    </p-tabPanel>
    <p-tabPanel header="Life Group">
      <div>
        <app-policy-listing></app-policy-listing>
      </div>
    </p-tabPanel>
    <p-tabPanel header="General">
      <button class="btn btn-primary" [routerLink]="'/home/gis/policy/underwriting'">{{'gis.policy.underwriting' | translate}}</button>
    </p-tabPanel>
    <p-tabPanel header="Pension">
      <p>Pension</p>
    </p-tabPanel>
  </p-tabView> -->

<p-tabView (onChange)="onTabChange($event)">
  <p-tabPanel *ngFor="let tab of visibleTabs" [header]="tab.header">
    <ng-container [ngSwitch]="tab.content">

      <!-- life insurance -->
      <ng-container *ngSwitchCase="'lifeInd'">
        <div>
          <div>
            <div>
              <div class="row">
                <div class="col-7">
                  <div>
                    <div class="row">
                      <div class="col-8">
                        <div class="input-group mb-3" style="font-size: 15px">
                          <span class="input-group-text" id="basic-addon1">
                            <i class="fa-solid fa-magnifying-glass"></i>
                          </span>
                          <input style="font-size: 12px !important" type="text" class="form-control"
                            placeholder="Search by client's name or quotation no" aria-label="Username"
                            aria-describedby="basic-addon1" />
                        </div>
                      </div>
                      <div class="col-4">
                        <div class="input-group mb-3">
                          <label class="input-group-text" for="inputGroupSelect01"
                            style="font-size: 11px !important">Sort by:</label>
                          <select class="form-select" id="inputGroupSelect01">
                            <option selected style="font-size: 11px !important">
                              Status
                            </option>
                            <option></option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-5">
                  <div class="d-flex justify-content-end">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div>
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Quotation No.</th>
                    <th>Client Name</th>
                    <th>Sum Assured</th>
                    <th>Premium</th>
                    <th>Intermediary</th>
                    <th>Date Created</th>
                    <th>Cover From</th>
                    <th>Cover To</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody *ngIf="LMS_IND.length > 0">
                  <tr *ngFor="let lms of LMS_IND">
                    <td>{{ lms?.quote_no || "" }}</td>
                    <td>{{ lms?.quote_no || "" }}</td>
                    <td>{{ lms?.sum_insured || "" | number }}</td>
                    <td>{{ lms?.premium || 0 | number }}</td>
                    <td>{{ lms?.quote_no || "" }}</td>
                    <td>{{ lms?.created_at || "" }}</td>
                    <td>{{ lms?.quote_no || "" }}</td>
                    <td>{{ lms?.quote_no || "" }}</td>
                    <td>{{ lms?.quote_status || "" }}</td>
                    <td (click)="selectLmsIndRow(lms)">{{ "Process" }}</td>
                  </tr>
                </tbody>
              </table>

              <div *ngIf="LMS_IND.length === 0" class="text-danger d-flex justify-content-center">
                No List of Policy Available
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- general insurance -->
      <ng-container *ngSwitchCase="'general'">


        <!-- GIS policy table -->
        <div class="position-relative">
          <!-- Column Selector Toggle -->
          <div class="d-flex justify-content-end align-items-center gap-2 mb-2"
            *ngIf="policiesLoaded && policies?.length > 0">
            <div class="mb-0">
              <button class="btn btn-primary btn-sm" (click)="goToNewPolicy()">{{'gis.policy.new_policy' |
                translate}}</button>
            </div>
            <button #policyColumnIcon type="button" class="btn btn-outline-secondary btn-sm"
              (click)="togglePolicyColumns(policyColumnIcon)" aria-label="Select columns" title="Select Columns">
              <i class="pi"
                [ngClass]="{ 'pi-caret-down': showPolicyColumnModal, 'pi-caret-up': !showPolicyColumnModal }"
                style="font-size: 0.9rem;"></i>
            </button>
          </div>

          <!-- Floating Column Selector Modal -->
          <div *ngIf="showPolicyColumnModal" class="card shadow rounded p-2 position-absolute bg-white border"
            [ngStyle]="{ top: policyColumnModalPosition.top, left: policyColumnModalPosition.left, zIndex: 1000 }">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <strong class="text-primary">Select Columns</strong>
              <button class="btn-close btn-sm" (click)="showPolicyColumnModal = false"></button>
            </div>

            <div style="max-height: 250px; overflow-y: auto;">
              <div *ngFor="let col of policyColumns">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" [(ngModel)]="col.visible"
                    (change)="togglePolicyColumnVisibility(col.field)" [id]="'policy_' + col.field">
                  <label class="form-check-label" [for]="'policy_' + col.field">
                    {{ col.header }}
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Dynamic Policy Table -->
          <div *ngIf="policiesLoaded && policies?.length > 0" class="table-responsive">
            <p-table #policyTable [value]="policies" [paginator]="true" [lazy]="true"
              [rowsPerPageOptions]="rowsPerPageOptions" [rows]="pageSize" [totalRecords]="totalRecords" [first]="first"
              (onPage)="onPageChange($event)" [scrollable]="true" scrollHeight="500px"
              [tableStyle]="{'min-width': '50rem'}" [showCurrentPageReport]="true"
              currentPageReportTemplate="Showing {first} to {last} of {totalRecords} records">
              <!-- Table Header -->
              <ng-template pTemplate="header">
                <tr>
                  <th *ngFor="let col of policyColumns" [hidden]="!col.visible"
                    [pSortableColumn]="col.sortable ? col.field : null"
                    [ngStyle]="{'text-align': col.field === 'actions' ? 'center' : 'left'}">
                    {{ col.header }}
                    <p-sortIcon *ngIf="col.sortable" [field]="col.field"></p-sortIcon>
                  </th>
                </tr>
                <tr class="filter-row">
                  <td *ngFor="let col of policyColumns" [hidden]="!col.visible">
                    <ng-container *ngIf="col.field === 'clientName'; else defaultFilter">
                      <div class="position-relative">
                        <input type="text" class="form-control form-control-sm" [value]="selectedClientName" readonly
                          style="background-color: white; cursor: pointer; padding-right: 2rem;"
                          (click)="openClientSearchModal()">

                        <!-- Clear button with X icon - only shows when there's a value -->
                        <button *ngIf="selectedClientName" class="btn btn-sm position-absolute"
                          style="right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; z-index: 5;"
                          (click)="clearClientFilter()">
                          <i class="pi pi-times"></i>
                        </button>
                      </div>
                    </ng-container>
                    <ng-template #defaultFilter>
                      <input *ngIf="col.filterable" class="form-control form-control-sm" pInputText type="text"
                        (input)="onSearchInput($any($event.target).value, col.field)" />
                    </ng-template>
                  </td>
                </tr>
              </ng-template>

              <!-- Table Body -->
              <ng-template pTemplate="body" let-policy>
                <tr>
                  <td *ngFor="let col of policyColumns" [hidden]="!col.visible">
                    <ng-container [ngSwitch]="col.field">
                      <!-- Actions column -->
                      <ng-container *ngSwitchCase="'actions'">
                        <div class="d-flex justify-content-center gap-3">
                          <span style="color: var(--primary-color); cursor: pointer; font-weight: 500;">
                            {{ 'gis.policy.view' | translate }}
                          </span>
                          <span style="color: var(--primary-color); cursor: pointer; font-weight: 500;">
                            {{ 'gis.policy.edit' | translate }}
                          </span>
                        </div>
                      </ng-container>

                      <!-- Premium column -->
                      <ng-container *ngSwitchCase="'premium'">
                        <div class="text-end">
                          {{ (policy[col.field] || 0) | currency: currencyObj?.prefix : 'symbol' : '1.2-2' }}
                        </div>
                      </ng-container>

                      <!-- Default columns -->
                      <ng-container *ngSwitchDefault>
                        <ng-container *ngIf="isDateField(col.field); else notDateField">
                          {{ formatDateDisplay(policy[col.field]) }}
                        </ng-container>
                        <ng-template #notDateField>
                          {{ policy[col.field] ?? '-' }}
                        </ng-template>
                      </ng-container>
                    </ng-container>
                  </td>
                </tr>
              </ng-template>

              <!-- Empty Message -->
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td [attr.colspan]="policyColumns.length" class="text-center text-muted">
                    No records found for the selected filter or search criteria.
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>

          <div *ngIf="policiesLoaded && (!policies || policies.length === 0)" class="text-muted">
            No records found for the selected filter or search criteria.
          </div>

          <div *ngIf="!policiesLoaded" class="d-flex justify-content-center align-items-center"
            style="min-height: 300px;">
            <ngx-spinner type="ball-clip-rotate-multiple" [fullScreen]="false" color="#00529B" size="medium"
              bdColor="rgba(255, 255, 255, 0.966)"></ngx-spinner>
          </div>

          <app-client-search-modal *ngIf="isClientSearchModalVisible" (onClickSaveClient)="onClientSelected($event)"
            (modalClosed)="isClientSearchModalVisible = false">
          </app-client-search-modal>

        </div>
      </ng-container>
    </ng-container>
  </p-tabPanel>
</p-tabView>