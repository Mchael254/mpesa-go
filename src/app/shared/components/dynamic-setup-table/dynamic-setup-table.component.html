<div class="row mb-3 mx-md-5">
  <div class="col-sm-12 col-md-6">
    <h5 class="my-3 text-dark">{{tableTitle | titlecase}}</h5>
  </div>
  <div class="col-sm-12 col-md-6 d-flex justify-content-end align-items-end gap-2">
    <button class="btn btn-primary" (click)="openModal()">
      {{addButtonText | titlecase }}
    </button>

    <!-- Caret Dropdown-style Button -->
    <button class="btn btn-outline-secondary d-flex align-items-center justify-content-center p-2 columnDialogBtn"
            (click)="columnDialogVisible = true">
      <i class="fa-solid fa-caret-down fs-5 text-dark"></i>
    </button>

    <p-dialog header="Columns" [(visible)]="columnDialogVisible" [modal]="true" [style]="{width: '330px'}">
      <div *ngFor="let col of columns">
        <div class="form-check form-check-inline float-start">
          <input class="form-check-input" type="checkbox" value="" id="checkChecked" [checked]="col.visible" [(ngModel)]="col.visible">
          <label class="form-check-label" for="checkChecked">
            {{ col.header[language] | titlecase }}
          </label>
        </div>
      </div>
    </p-dialog>

  </div>
  <div class="mt-3">
    <p-table
      [value]="tableData"
      [paginator]="true"
      [rows]="pageSize || 10"
      [totalRecords]="tableData?.length"
      [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
      responsiveLayout="stack"
      scrollHeight="400px"
      [scrollable]="true"
      [resizableColumns]="true"
    >

      <ng-template pTemplate="header">
        <tr>
          <ng-container *ngFor="let col of columns">
            <th *ngIf="col.visible"
                [pSortableColumn]="col.field">
              {{ col.header[language] | titlecase }}
              <p-sortIcon [field]="col.field"></p-sortIcon>
            </th>
          </ng-container>
          <th class="text-center" style="width: 2%">Action</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-rowData>
        <tr [pSelectableRow]="rowData">
          <ng-container *ngFor="let col of columns">
            <!--<td *ngIf="col.visible">
              {{ rowData[col.field] | titlecase }}
            </td>-->
            <td *ngIf="col.visible">
              <ng-container *ngIf="rowData[col.field] && rowData[col.field].label; else rawVal">
                {{ rowData[col.field].label | titlecase }}
              </ng-container>
              <ng-template #rawVal>{{ rowData[col.field] | titlecase }}</ng-template>
            </td>
          </ng-container>

          <td *ngIf="tableData?.length > 0" class="text-center">
            <div>
              <a role="button" class="text-primary me-4" (click)="editSelectedRecord(rowData)">Edit</a>
              <a role="button" class="text-primary" (click)="deleteSelectedRecord(rowData)">Delete</a>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="columns?.length + 1" class="text-center">
            {{ emptyTableMessage | titlecase }}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!--Modal -->
<ng-container *ngIf="modalVisible">
  <div
    class="modal fade"
    #dynamicDetailsModal
    id="dynamicDetailsModal"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
  >
    <div class="modal-dialog modal-lg align-items-center" style="width: 530px">
      <div class="modal-content">
        <div class="modal-header border-bottom-0">
          <h5 class="modal-title text-primary" id="exampleModalLabel"> {{ tableTitle | titlecase }}</h5>
          <button
            type="button"
            class="btn-close"
            (click)="closeModal()"
          ></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="dynamicModalForm">
            <div class="row">
              <ng-container *ngFor="let field of formFields; let j = index">
                <div *ngIf="dynamicModalForm.get(field.fieldId)" class="col-md-6">
                  <div class="mb-3">
                    <!-- Text -->
                    <ng-container *ngIf="field.type === 'text' || field.type === 'email'">
                      <ng-container *ngIf="!['idNumber', 'smsNumber'].includes(field.fieldId)">
                        <label class="form-label" [for]="field.fieldId">
                          {{ field.label?.[language] | titlecase }}
                          <span *ngIf="field.mandatory" class="text-danger">*</span>
                        </label>
                        <input
                          [type]="field.type"
                          [formControlName]="field.fieldId"
                          [placeholder]="field?.placeholder[language] || ''"
                          [id]="field.fieldId"
                          class="form-control"
                          (keyup)="validateRegex(field, field.formGroupingId)"
                          [class.is-invalid]="dynamicModalForm.get(field.fieldId)?.invalid && dynamicModalForm.get(field.fieldId)?.touched"

                        />
                      </ng-container>

                      <span class="text-danger" *ngIf="regexErrorMessages[field.fieldId]?.showErrorMessage">
                        {{ regexErrorMessages[field.fieldId]?.errorMessage }}
                      </span>
                    </ng-container>

                    <!-- Tel -->
                    <ng-container *ngIf="field.type === 'tel'">
                      <label class="form-label" [for]="field.fieldId">
                        {{ field.label?.[language] | titlecase }}
                        <span *ngIf="field.mandatory" class="text-danger">*</span>
                      </label>

                      <ngx-intl-tel-input
                        [cssClass]="'form-control'"
                        [id]="field.fieldId"
                        [preferredCountries]="preferredCountries"
                        [enableAutoCountrySelect]="true"
                        [enablePlaceholder]="true"
                        [customPlaceholder]="field.placeholder[language] || ''"
                        [searchCountryFlag]="true"
                        [selectFirstCountry]="true"
                        [selectedCountryISO]="countryISO"
                        [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]"
                        [phoneValidation]="true"
                        [separateDialCode]="true"
                        [numberFormat]="PhoneNumberFormat.National"
                        [formControlName]="field.fieldId"
                        [class.is-invalid]="dynamicModalForm.get(field.fieldId)?.invalid && dynamicModalForm.get(field.fieldId)?.touched"
                      >
                      </ngx-intl-tel-input>
                      <span class="text-danger" *ngIf="regexErrorMessages[field.fieldId]?.showErrorMessage">
                        {{ regexErrorMessages[field.fieldId]?.errorMessage }}
                      </span>
                    </ng-container>

                    <!-- Textarea -->
                    <ng-container *ngIf="field.type === 'textarea'">
                      <label class="form-label" [for]="field.fieldId">
                        {{ field.label?.[language] | titlecase }}
                        <span *ngIf="field.mandatory" class="text-danger">*</span>
                      </label>
                      <textarea
                        [formControlName]="field.fieldId"
                        [placeholder]="field.placeholder[language] || ''"
                        [id]="field.fieldId"
                        class="form-control"
                        [class.is-invalid]="dynamicModalForm.get(field.fieldId)?.invalid && dynamicModalForm.get(field.fieldId)?.touched"
                      ></textarea>
                      <span class="text-danger" *ngIf="regexErrorMessages[field.fieldId]?.showErrorMessage">
                        {{ regexErrorMessages[field.fieldId]?.errorMessage }}
                      </span>
                    </ng-container>

                    <!--Date-->
                    <ng-container *ngIf="field.type === 'date'">
                      <label class="form-label" [for]="field.fieldId">
                        {{ field.label?.[language] | titlecase }}
                        <span *ngIf="field.mandatory" class="text-danger">*</span>
                      </label>
                      <input
                        type="date"
                        [formControlName]="field.fieldId"
                        [placeholder]="field.placeholder[language] || ''"
                        [id]="field.fieldId"
                        class="form-control"
                        [class.is-invalid]="dynamicModalForm.get(field.fieldId)?.invalid && dynamicModalForm.get(field.fieldId)?.touched"
                      />
                      <span class="text-danger" *ngIf="regexErrorMessages[field.fieldId]?.showErrorMessage">
                        {{ regexErrorMessages[field.fieldId]?.errorMessage }}
                      </span>
                    </ng-container>

                    <!-- Number -->
                    <ng-container *ngIf="field.type === 'number'">
                      <label class="form-label" [for]="field.fieldId">
                        {{ field.label?.[language] | titlecase }}
                        <span *ngIf="field.mandatory" class="text-danger">*</span>
                      </label>
                      <input
                        type="number"
                        [formControlName]="field.fieldId"
                        [placeholder]="field?.placeholder[language] || ''"
                        [id]="field.fieldId"
                        class="form-control"
                        [class.is-invalid]="dynamicModalForm.get(field.fieldId)?.invalid && dynamicModalForm.get(field.fieldId)?.touched"
                      />
                      <span class="text-danger" *ngIf="regexErrorMessages[field.fieldId]?.showErrorMessage">
                        {{ regexErrorMessages[field.fieldId]?.errorMessage }}
                      </span>
                    </ng-container>

                    <!-- Select -->
                    <ng-container *ngIf="field.type === 'select'">
                      <label class="form-label" [for]="field.fieldId">
                        {{ field.label?.[language] | titlecase }}
                        <span *ngIf="field.mandatory" class="text-danger">*</span>
                      </label>
                      <select
                        [formControlName]="field.fieldId"
                        [id]="field.fieldId"
                        class="form-select"
                        aria-label="Default select example"
                        (change)="processSelectOption($event, field.fieldId)"
                        (focus)="fetchSelectOptions(field.fieldId)"
                        [class.is-invalid]="dynamicModalForm.get(field.fieldId)?.invalid && dynamicModalForm.get(field.fieldId)?.touched"
                      >
                        <option [ngValue]="null"></option>
                        <option *ngFor="let option of (!isPreviewMode ? field.options : [])" [ngValue]="option">
                          {{ option.label ? option.label : option | titlecase }}
                        </option>
                      </select>
                      <span class="text-danger" *ngIf="regexErrorMessages[field.fieldId]?.showErrorMessage">
                        {{ regexErrorMessages[field.fieldId]?.errorMessage }}
                      </span>
                    </ng-container>

                    <!-- radio -->
                    <ng-container *ngIf="field.type === 'radio'">
                      <label class="form-label" [for]="field.fieldId">
                        {{ field.label?.[language] | titlecase }}
                        <span *ngIf="field.mandatory" class="text-danger">*</span>
                      </label>
                      <div class="form-check" [id]="field.fieldId">
                        <div *ngFor="let option of (!isPreviewMode ? field.options : [])">
                          <input
                            class="form-check-input"
                            type="radio"
                            [value]="option"
                            [formControlName]="field.fieldId"
                            [class.is-invalid]="dynamicModalForm.get(field.fieldId)?.invalid && dynamicModalForm.get(field.fieldId)?.touched">
                          <label class="form-check-label" for="field.fieldId">
                            {{ option }}
                          </label>
                        </div>
                        <span class="text-danger" *ngIf="regexErrorMessages[field.fieldId]?.showErrorMessage">
                          {{ regexErrorMessages[field.fieldId]?.errorMessage }}
                        </span>
                      </div>
                    </ng-container>

                    <!-- checkbox -->
                    <ng-container *ngIf="field.type === 'checkbox'">
                      <label class="form-label" [for]="field.fieldId">
                        {{ field.label?.[language] | titlecase }}
                        <span *ngIf="field.mandatory" class="text-danger">*</span>
                      </label>
                      <div class="form-check">
                        <div *ngFor="let option of (!isPreviewMode ? field.options : [])">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="checkDefault"
                            [formControlName]="field.fieldId"
                            [id]="field.fieldId"
                            [class.is-invalid]="dynamicModalForm.get(field.fieldId)?.invalid && dynamicModalForm.get(field.fieldId)?.touched">
                          <label class="form-check-label" for="checkDefault">
                            {{ option }}
                          </label>
                        </div>
                        <span class="text-danger" *ngIf="regexErrorMessages[field.fieldId]?.showErrorMessage">
                          {{ regexErrorMessages[field.fieldId]?.errorMessage }}
                        </span>
                      </div>
                    </ng-container>

                    <!--show validation errors-->
                    <ng-container *ngIf="field.mandatory">
                      <div *ngIf="
                          dynamicModalForm.get(field.fieldId)?.touched &&
                          dynamicModalForm.get(field.fieldId)?.hasError(field.mandatory ? 'required' : '')"
                      >
                        <span class="text-danger">
                          {{ field.label?.[language] | sentenceCase }} {{ 'base.isRequired' | translate }}.
                        </span>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </ng-container>
            </div>
          </form>
        </div>
        <div class="modal-footer border-top-0">
          <button type="button" class="btn btn-primary" [disabled]="isPreviewMode"
                  (click)="saveDetails()">{{ 'serviceDesk.saveDetails' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-container>


<!--<ng-container *ngIf="rowToDelete">-->
  <app-reusable-input
    [modalId]="uniqueId"
    [title]="'Delete Confirmation'"
    [message]="'Are you sure you want to delete this record?'"
    (confirmed)="confirmRecordDelete()"
    #recordDeleteConfirmationModal
  ></app-reusable-input>
<!--</ng-container>-->

