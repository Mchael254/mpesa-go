
<ng-container *ngIf="subGroups?.length > 0">
  <ng-container *ngFor="let subGroup of subGroups">
    <div class="mt-4">
      <ng-container *ngIf="!(subGroup.subGroupId.includes(cr12SearchSubString))">
        <app-overview-table
          [subGroup]="subGroup"
          [table]="subGroup.table"
          [language]="language"
          [category]="clientDetails.category"
          (rowClicked)="handleCr12Display($event)"
          (deleteBtnClicked)="handleWealthAmlDelete($event, subGroup)"
          (editBtnClicked)="prepareEditAmlForm($event, subGroup)"
        >
        </app-overview-table>
      </ng-container>
      <ng-container *ngIf="(subGroup.subGroupId.includes(cr12SearchSubString)) && shouldShowCr12Details">
        <app-overview-table
          [subGroup]="subGroup"
          [table]="subGroup.table"
          [language]="language"
          (deleteBtnClicked)="handleCr12Delete($event, subGroup)"
          (editBtnClicked)="prepareEditAmlForm($event, subGroup)"
        >
        </app-overview-table>
      </ng-container>
  </div>
    <!--<button class="btn btn-danger" (click)="addWealthAml()">Add AML</button>-->
  </ng-container>



<!--edit prime details modal-->
<button #editButton type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editWealthAmlModal" hidden>
  Open Edit Wealth AML Modal
</button>

<!-- Modal -->
<div class="modal fade" id="editWealthAmlModal" tabindex="-1" aria-labelledby="editWealthAmlModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-4 text-primary" id="editWealthAmlModalLabel">
          {{ selectedSubgroup?.label[language] | titlecase }}
        </h1>
        <button #closeButton type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <ng-container *ngIf="shouldShowEditForm; else showMessage">
        <div class="modal-body">
          <ng-container *ngIf=" editForm; else loadingForm">
            <form [formGroup]="editForm">
              <div class="row g-3">
                <ng-container *ngFor="let field of formFields">
                  <div
                    *ngIf="!(excludedKeys.includes(field.fieldId))"
                    class="col-md-6"
                  >
                    <label [for]="field.fieldId" class="form-label">
                      {{ field?.label[language] }}
                    </label>
                    <!-- Text input -->
                    <input
                      *ngIf="field.type === 'text' || field.type === 'email'"
                      [formControlName]="field.fieldId"
                      [placeholder]="field?.placeholder[language] || ''"
                      [id]="field.fieldId"
                      type="text"
                      class="form-control"
                    />

                    <!--Date-->
                    <input
                      *ngIf="field.type === 'date'"
                      type="date"
                      [formControlName]="field.fieldId"
                      [placeholder]="field.placeholder"
                      [id]="field.fieldId"
                      class="form-control"
                    />

                    <!--tel number-->
                    <span *ngIf="checkTelNumber(field.fieldId)">
                    <ngx-intl-tel-input
                      [cssClass]="'form-control mb-1'"
                      [id]="field.fieldId"
                      [preferredCountries]=""
                      [enableAutoCountrySelect]="true"
                      [enablePlaceholder]="true"
                      [searchCountryFlag]="true"
                      [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]"
                      [selectFirstCountry]="false"
                      [selectedCountryISO]="countryISO"
                      [phoneValidation]="true"
                      [separateDialCode]="true"
                      [numberFormat]="PhoneNumberFormat.National"
                      [formControlName]="field.fieldId"
                      [style]="{ width: '100%' }"
                    >
                    </ngx-intl-tel-input>
                  </span>

                    <!--select input-->
                    <select
                      *ngIf="field.type === 'select'"
                      [formControlName]="field.fieldId"
                      [id]="field.fieldId"
                      class="form-select"
                    >
                      <option value=""> -- </option>
                      <option *ngFor="let opt of field.options" [value]="(opt.id ? opt.id : opt.value) || opt.code">
                        {{ opt.name || opt.description || opt.label | titlecase }}
                      </option>
                    </select>
                  </div>
                </ng-container>
              </div>
            </form>
          </ng-container>
          <ng-template #loadingForm>
            <div class="text-center">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </ng-template>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">
<!--            {{ formGroupsAndFieldConfig?.buttons?.cancel?.label[language] || '-&#45;&#45;' | titlecase }}-->
          </button>
          <button type="button" class="btn btn-primary" (click)="saveDetails()">
            {{ 'Save' }}
          </button>
        </div>
      </ng-container>
      <ng-template #showMessage>
        <p class="lead text-center text-danger my-5">Select a record to edit.</p>
      </ng-template>
    </div>
  </div>
</div>

<!-- Delete wealth/aml modal-->
<button style="display: none" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#deleteWealthAmlModal">
  Launch delete modal
</button>

<!-- Modal -->
<div class="modal fade" id="deleteWealthAmlModal" tabindex="-1" aria-labelledby="deleteWealthAmlModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h1 class="modal-title fs-5" id="deleteWealthAmlModalLabel">Delete Wealth/AML Record</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="text-center lead">Are you sure you want to delete?</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" #closeDeleteDialogButton>Close</button>
        <button type="button" class="btn btn-danger" (click)="deleteAmlRecord()">Confirm</button>
      </div>
    </div>
  </div>
</div>
