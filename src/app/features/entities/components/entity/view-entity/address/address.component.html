<!--{{ clientDetails.address | json }}-->


<ng-container *ngIf="group.subGroup?.length === 0">
  <div class="row">
    <ng-container *ngFor="let field of fields">
      <div class="col-sm-4">
        <div class="row my-2">
          <div class="col-sm-4 text-dark">
            {{ field.label[language] }}
          </div>
          <div class="col-sm-8 text-dark fw-bold">
            {{ field.dataValue }}
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</ng-container>


<ng-container *ngIf="group.subGroup?.length > 0">
  <ng-container *ngFor="let subGroup of group.subGroup">

    <ng-container *ngIf="subGroup.presentationType===PRESENTATION_TYPE.fields">
      <div class="row my-3">
        <div class="col-sm-8">
          <span class="text-primary fw-bold">
            {{ subGroup.label[language] | titlecase }}
          </span>
          <span
            id="edit-tab-btn"
            class="m-2 text-primary"
            (click)="openEditAddressDialog(subGroup, Save_Action.EDIT_ADDRESS_DETAILS)"
          >
            <i class="fa fa-pencil"></i>
          </span>
        </div>
      </div>
      <div class="row mb-3">
        <ng-container *ngFor="let field of subGroup.fields">
          <div
            class="col-sm-4"
            *ngIf="!(field.fieldId.toLowerCase().includes('id')) && field.formSubGroupingId === subGroup.subGroupId"
          >
            <div class="row my-2">
              <div class="col-sm-4 text-dark">
                {{ field.label[language] }}
              </div>
              <div class="col-sm-8 text-dark fw-bold">
                {{ field.dataValue }}
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </ng-container>

    <ng-container *ngIf="subGroup.presentationType === PRESENTATION_TYPE.fields_and_table_columns">
      <app-overview-table
        [subGroup]="subGroup"
        [table]="table"
        [language]="language"
        (deleteBtnClicked)="handleBranchDelete($event)"
        (editBtnClicked)="prepareEditBranchForm($event)"
      >
      </app-overview-table>
    </ng-container>

  </ng-container>
</ng-container>

  <!--edit prime details modal-->
  <button #editButton type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editAddressModal" hidden>
    Open Edit Address Modal
  </button>

  <!-- Modal -->
  <div class="modal fade" id="editAddressModal" tabindex="-1" aria-labelledby="editAddressModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h1 class="modal-title fs-4 text-primary" id="editAddressModalLabel">
            {{ (selectedSubgroup?.label[language] || group?.label[language]) | titlecase }}
          </h1>
          <button #closeButton type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ng-container
            *ngIf="
              editForm;
              else loadingForm
            "
          > <!--todo: fix condition-->
            <form [formGroup]="editForm">
              <div class="row g-3">
                <ng-container *ngFor="let field of formFields">
                  <div
                    class="col-md-6"
                    *ngIf="!(field.fieldId.toLowerCase().includes('id')) && field.formSubGroupingId === selectedSubgroup?.subGroupId"
                  >
                    <label [for]="field.fieldId" class="form-label">
                      {{ field.label[language] | titlecase }}
                    </label>
                    <!-- Text input -->
                    <input
                      *ngIf="field.type === 'text' || field.type === 'email'"
                      [formControlName]="field.fieldId"
                      [placeholder]="field.placeholder[language] || ''"
                      [id]="field.fieldId"
                      type="text"
                      class="form-control"
                    />

                    <!--select input-->
                    <select
                      *ngIf="field.type === 'select'"
                      [formControlName]="field.fieldId"
                      [id]="field.fieldId"
                      class="form-select"
                      (change)="processSelectOption($event, field.fieldId)"
                    >
                      <option value=""> -- </option>
                      <option *ngFor="let opt of field.options" [value]="opt.id ? opt.id : opt.value">
                        {{ opt.name || opt.description || opt.label | titlecase }}
                      </option>
                    </select>

                    <!--tel number-->
                    <span *ngIf="checkTelNumber(field.fieldId)">
                    <ngx-intl-tel-input
                      [cssClass]="'form-control mb-1'"
                      [id]="field.fieldId"
                      [preferredCountries]=""
                      [enableAutoCountrySelect]="true"
                      [enablePlaceholder]="true"
                      [searchCountryFlag]="true"
                      [searchCountryField]="[SearchCountryField?.Iso2, SearchCountryField?.Name]"
                      [selectFirstCountry]="false"
                      [selectedCountryISO]="countryISO"
                      [phoneValidation]="true"
                      [separateDialCode]="true"
                      [numberFormat]="PhoneNumberFormat.National"
                      [formControlName]="field.fieldId"
                      [style]="{ width: '100%' }"
                    >
                    </ngx-intl-tel-input>
                  </span>

                  </div>
                </ng-container>
              </div>
            </form>
          </ng-container>
          <ng-template #loadingForm>
            <div class="text-center">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </ng-template>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">
<!--            {{ formFieldsConfig.buttons.cancel.label[language] | titlecase }}-->
          </button>
          <button type="button" class="btn btn-primary" (click)="saveDetails()">
            {{ 'save' | titlecase }}
          </button>
        </div>
      </div>
    </div>
  </div>

<!--</ng-container>-->

<!--<ng-template #loadingContent>
  <div class="row">
    <div class="col-sm-12">
      <p class="lead">Loading content...</p>
    </div>
  </div>
</ng-template>-->
