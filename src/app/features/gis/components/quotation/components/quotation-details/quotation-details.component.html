<div class="mx-4 mt-3">
    <p class="title">Quotations:Quotation Details </p>
    <app-stepper [currentStep]="2" [stepperData]="steps"></app-stepper>
    <form [formGroup]="quotationForm">
        <div class="card mb-4">
            <div class="card-body">
                <h6>Quotation details </h6>
                <p *ngIf="quickQuotationDetails">Quotation number :<strong> {{quickQuotationNum}}</strong></p>
                <div class="row mb-4 mt-3">
                    <div class="col-xl-4">
                        <label for="" class="quote-label">Source<span class="required"></span></label>
                        <p-dropdown id="quote-input-pdropdown" formControlName="source" [options]="quotationSources" optionLabel="description" optionValue="code" placeholder=" "
                        [filterBy]="'description'" [filter]="true"></p-dropdown>


                        <div *ngIf="quotationForm.get('source').hasError('required') && quotationForm.get('source').touched"
                            class="form-text text-danger">
                            Source is required.
                        </div>

                    </div>
                    <div class="col-xl-4">
                        <label for="" class="quote-label">Quotation type</label>
                        <select class="form-select form-control-sm mb-1" id="quote-input" placement="right"
                            #quotationTypeSelect (change)="onQuotationTypeChange(quotationTypeSelect.value)">
                            <option selected="true" disabled="disabled"></option>
                            <option value="D">Direct</option>
                            <option value="I">Intermediary</option>

                        </select>

                    </div>
                    <div class="col-xl-4" *ngIf="showIntermediaryField">
                        <label for="" class="quote-label">Intermediary<span class="required"></span></label>
                        <!-- <p-dropdown formControlName="agentCode" [options]="agents" optionLabel="name" [filterBy]="'name'" (onChange)="agentShortDesc()" [filter]="true" ></p-dropdown> -->
                        <input type="text" id="quote-input" class="form-control form-control-sm mb-1"
                            formControlName="agentCode" data-bs-toggle="modal" data-bs-target="#selectIntermediary"
                            autocomplete="off">
                        <div *ngIf="quotationForm.get('agentCode').hasError('required') && quotationForm.get('agentCode').touched"
                            class="form-text text-danger">
                            Intermediary is required.
                        </div>
                    </div>
                    <!--INTERMEDIARY MODAL -->
                    <div class="modal fade" id="selectIntermediary" tabindex="-1"
                        aria-labelledby="selectIntermediaryLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">

                                <div class="modal-body">
                                    <div class="float-start"></div>
                                    <button type="button" class="btn-close float-end" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                    <h5 class="text-start mt-2 mb-4">Select intermediary</h5>
                                    <div class="input-group mb-4" id="search-input">

                                        <span class="input-group-append" style="background-color: #F5F6F8;">
                                            <button class="btn border-end-0 " type="button">
                                                <i class="fa fa-search"></i>
                                            </button>
                                        </span>
                                        <!-- <input class="form-control py-2 border-start-0" pInputText  (input)="applyFilterGlobal($event, 'contains')"  style="background-color: #F5F6F8;border: 0px;" type="search" placeholder="search...">             -->
                                    </div>


                                    <p-table #dt1 [value]="agents" [tableStyle]="{ 'max-width': '100rem' }"
                                        [resizableColumns]="true" styleClass="p-datatable-sm" class='ui-datatable'
                                        [globalFilterFields]="['shortDesc', 'name', 'accountType']" [paginator]="true"
                                        [rows]="5" [showCurrentPageReport]="true"
                                        currentPageReportTemplate="{first} to {last} of {totalRecords} entries"
                                        selectionMode="single" [(selection)]="selectedAgent" dataKey="shortDesc">
                                        <ng-template pTemplate="header">
                                            <tr>
                                                <th field="shortDesc">Code</th>
                                                <th field="name">Name</th>
                                                <th field="accountType">Intermediary type </th>

                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="body" let-data>
                                            <tr [pSelectableRow]="data" style="cursor:pointer"
                                                (click)="getAgentById(data.id)">
                                                <td>{{ data.shortDesc }}</td>
                                                <td>{{ data.name | sentenceCase}}</td>
                                                <td>{{ data.accountType | sentenceCase }}</td>
                                            </tr>
                                        </ng-template>
                                    </p-table>

                                    <div class="float-start"></div>
                                    <button class="btn btn-primary float-end mt-4" data-bs-dismiss="modal">OK</button>
                                </div>

                            </div>
                        </div>
                    </div>



                    <div class="col-xl-4">
                        <label for="" class="quote-label">Branch<span class="required"></span></label>
                        <p-dropdown id="quote-input-pdropdown" formControlName="branchCode" [options]="branch" optionLabel="name" placeholder=" "
                            [filterBy]="'name'" [filter]="true"></p-dropdown>
                        <div *ngIf="quotationForm.get('branchCode').hasError('required') && quotationForm.get('branchCode').touched"
                            class="form-text text-danger">
                            Branch is required.
                        </div>
                    </div>

                </div>
                <div class="row mb-4">
                    <div class="col-xl-4">
                        <label for="" class="quote-label">Currency<span class="required"></span></label><br>
                        <p-dropdown id="quote-input-pdropdown" formControlName="currencyCode" [options]="currency" optionLabel="name" value="id"
                            [filterBy]="'name'" [placeholder]="defaultCurrencyName " [filter]="true"
                            (onChange)="fetchUserOrgId()"></p-dropdown>
                        <div *ngIf="quotationForm.get('currencyCode').hasError('required') && quotationForm.get('currencyCode').touched"
                            class="form-text text-danger">
                            Currency is required.
                        </div>
                    </div>
                    <div class="col-xl-4">
                        <label for="rfqDate" class="quote-label">Request for quote date</label>
                        <p-calendar id="rfqDate" inputId="rfqDate" [showIcon]="true" [dateFormat]="dateFormat"
                            formControlName="RFQDate" [minDate]="minDate"
                            (onSelect)="updateQuotationExpiryDate($event)">
                        </p-calendar>

                        <div *ngIf="quotationForm.get('RFQDate').hasError('required') && quotationForm.get('RFQDate').touched"
                            class="form-text text-danger">
                            Request for quote date is required.
                        </div>
                    </div>
                    <div class="col-xl-4">
                        <label for="expiryDate" class="quote-label">Quotation expiry date</label>
                        <p-calendar id="expiryDate" inputId="expiryDate" [showIcon]="true" [dateFormat]="dateFormat"
                            formControlName="expiryDate" [(ngModel)]="expiryDate" [readonlyInput]="true" [minDate]="minDate">
                        </p-calendar>
                        <div *ngIf="quotationForm.get('expiryDate').hasError('required') && quotationForm.get('expiryDate').touched"
                            class="form-text text-danger">
                            Quotation expiry date is required.
                        </div>
                    </div>
                </div>


                <div class="collapse" [ngClass]="{'show': show}" id="collapseExample">
                    <div class="row mb-4">
                        <div class="col-xl-4">
                            <label for="" class="quote-label">Introducer</label>

                            <p-dropdown id="quote-input-pdropdown" formControlName="introducerCode" [options]="introducers" optionValue="code" optionLabel="surName" placeholder=" "
                        [filterBy]="'surName'" [filter]="true"></p-dropdown>
                            <!-- <select class="form-select form-control-sm mb-1" id="quote-input"
                                formControlName="introducerCode" placement="right">
                                <option selected="true" disabled="disabled"></option>
                                <option *ngFor="let data of introducers" [value]="data.code">{{data.surName}}</option>
                            </select> -->
                        </div>
                        <div class="col-xl-4">
                            <label for="" class="quote-label">Results from campaign?</label>

                            <select class="form-select form-control-sm mb-1" id="quote-input" placement="right"
                                #resultFromCampaignSelect
                                (change)="onResultCampaignTypeChange(resultFromCampaignSelect.value)">
                                <option selected="true" disabled="disabled"></option>
                                <option value="O">Others</option>
                                <option value="C">Campaign</option>
                            </select>
                        </div>
                        <div class="col-xl-4" *ngIf="showCampaignField">
                            <label for="" class="quote-label">Campaign</label>
                            <p-dropdown id="quote-input-pdropdown" [options]="campaignList" optionLabel="campaignName" placeholder=" "
                            [filterBy]="'campaignName'" [filter]="true"></p-dropdown>
                            <!-- <select class="form-select form-control-sm mb-1" id="quote-input" placement="right">
                                <option selected="true" disabled="disabled"></option>
                                <option *ngFor="let data of campaignList" [value]="data.code">{{data.campaignName}}
                                </option>
                            </select> -->
                        </div>
                        <!-- <div class="col-xl-4">
                    <label for=""class="quote-label">Likelihood</label>
                    <select  class="form-select form-control-sm mb-1" id="quote-input"  placement="right"  >
                        <option selected="true" disabled="disabled"></option>
                        <option value="likely">Likely</option>
                        <option value="unlikely">Unlikely</option>


                      </select >
                  </div> -->
                    </div>

                    <div class="row mb-4">
                        <div class="col-xl-4">
                            <label for="" class="quote-label">Multi-user entry?</label>
                            <br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="multiUser"
                                    formControlName="multiUser" id="inlineRadio1" value="Y">
                                <label class="form-check-label" for="inlineRadio1">Yes</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="multiUser"
                                    formControlName="multiUser" id="inlineRadio2" value="N">
                                <label class="form-check-label" for="inlineRadio2">No</label>
                            </div>
                        </div>
                        <div class="col-xl-4">
                            <label for="" class="quote-label">Internal comments </label>
                            <input type="text" id="quote-input" class="form-control form-control-sm mb-1"
                                formControlName="internalComments">
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-xl-4">
                            <label for="" class="quote-label">External comments </label>
                            <input type="text" id="quote-input" class="form-control form-control-sm mb-1"
                                formControlName="comments">

                        </div>
                    </div>
                </div>
                <p class="more" (click)="toggleDetails()" style="cursor: pointer">
                    More Details
                    <span class="ml-1">
                        <i class="pi" [ngClass]="{'pi-angle-double-up': show, 'pi-angle-double-down': !show}"
                            style="font-size: 13px"></i>
                    </span>
                </p>
            </div>
        </div>
    </form>
    <div class="card mb-2">
        <div class="card-body">
            <h6>Product Details </h6>
            <div class="spinner" style="position: relative">
                <ngx-spinner type="ball-clip-rotate-multiple" [fullScreen]="true" color="#00529B" size="large"
                    bdColor="rgba(255, 255, 255, 0.966)"></ngx-spinner>
            </div>
            <form [formGroup]="quotationForm">
                <div class="row mt-3 ">
                    <div class="col-xl-4">

                        <label for="" class="quote-label">Product</label>
                        <p-dropdown id="quote-input-pdropdown" formControlName="productCode" [options]="ProductDescriptionArray"
                            optionLabel="description" [filterBy]="'description'" (onChange)="getProductClause()"
                            placeholder=" " [filter]="true"></p-dropdown>

                        <div *ngIf="quotationForm.get('productCode').hasError('required') && quotationForm.get('productCode').touched"
                            class="form-text text-danger">
                            Product is required.
                        </div>
                    </div>

                    <div class="col-xl-4">
                        <label for="coverFromDate" class="quote-label">Cover From</label><br>
                        <!-- <p-calendar
                    [dateFormat]="dateFormat"
                        id="coverFromDate"
                        inputId="coverFromDate"
                        [showIcon]="true"
                        dateFormat="yy-mm-dd"
                        formControlName="withEffectiveFromDate"
                        [placeholder]="today | date:'yyyy-MM-dd'"
                        (onSelect)="updateCoverToDate($event)">
                    </p-calendar> -->
                        <p-calendar formControlName="wefDate" name="wefDate" id="coverFromDate" inputId="coverFromDate"
                            [dateFormat]="dateFormat" inputStyleClass='form-control' [showIcon]="true"
                            (onSelect)="updateCoverToDate($event)" [ngModel]="todaysDate" [minDate]="minDate">
                        </p-calendar>
                        <div *ngIf="quotationForm.get('wefDate').hasError('required') && quotationForm.get('wefDate').touched"
                            class="form-text text-danger">
                            Cover From is required.
                        </div>
                    </div>
                    <div class="col-xl-4">
                        <label for="coverToDate" class="quote-label">Cover to</label><br>
                        <p-calendar formControlName="wetDate" name="wetDate" id="coverToDate" inputId="coverToDate"
                            [dateFormat]="dateFormat" inputStyleClass='form-control' [showIcon]="true"
                            [ngModel]="coverToDate" [minDate]="minDate">
                        </p-calendar>

                        <div *ngIf="quotationForm.get('wetDate').hasError('required') && quotationForm.get('wetDate').touched"
                            class="form-text text-danger">
                            Cover to is required.
                        </div>
                    </div>
                </div>

            </form>
        </div>
        <div class="card-body">
            <p class="mb-4 import_risks" >Import risks <input type="checkbox" (change)="isChecked = !isChecked" id="importRisks"
                    class="ml-3"></p>
            <p class="more" (click)="toggleProduct()" style="cursor: pointer">
                Product Clauses
                <span class="ml-1">
                    <i class="pi" [ngClass]="{'pi-angle-double-up': showProduct, 'pi-angle-double-down': !showProduct}"
                        style="font-size: 13px"></i>
                </span>
            </p>
            <div class="collapse" [ngClass]="{'show': showProduct}" id="collapseProductClauses">
                <!-- <p-table [value]="clauses" dataKey="code" editMode="row" [tableStyle]="{'min-width': '50rem'}"
            styleClass="p-datatable-sm" responsiveLayout="scroll" [(selection)]="selectedClause"
            class='ui-datatable' selectionMode="multiple" [autoLayout]="true" [paginator]="true" [rows]="5"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="{first} to {last} of {totalRecords} entries"> -->
                <p-table [value]="clauses" dataKey="code" editMode="row" [tableStyle]="{'min-width': '50rem'}"
                    styleClass="p-datatable-sm" responsiveLayout="scroll" [(selection)]="selectedClause"
                    class='ui-datatable' selectionMode="multiple" [autoLayout]="true" [paginator]="true" [rows]="5"
                    [showCurrentPageReport]="true"
                    currentPageReportTemplate="{first} to {last} of {totalRecords} entries">
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 5%;padding-right: 50px;">
                                select
                            </th>
                            <th style="width: 25%;padding-right: 50px;">Heading</th>
                            <th style="width: 40%;">Wording</th>
                            <th style="width: 5%;"></th>
                            <th style="width: 5%;">Editable</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-selectedClauseList let-editing="editing" let-ri="rowIndex">
                        <tr [pEditableRow]="selectedClauseList">
                            <td>
                                <!-- <p-tableCheckbox [value]="selectedClauseList"
                      (onChange)="selectedProductClauses($event)"
                      [(ngModel)]="selectedClauseList.checked"
                      [binary]="true">
                      ></p-tableCheckbox> -->
                                <p-checkbox [(ngModel)]="selectedClauseList.checked" [binary]="true"
                                    [disabled]="selectedClauseList.isMandatory === 'Y'"
                                    (onChange)="onClauseSelectionChange(selectedClauseList)">
                                </p-checkbox>
                            </td>

                            <td style=" white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    overflow-y: auto;
                    max-width: 250px;" pTooltip="{{selectedClauseList.heading }}" tooltipPosition="top">
                                <p-cellEditor>
                                    <ng-template pTemplate="input" *ngIf="selectedClauseList.isEditable  === 'Y'">
                                        <input pInputText type="text" [(ngModel)]="selectedClauseList.heading"
                                            class="form-control form-control-sm" [ngModelOptions]="{standalone: true}">
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{selectedClauseList.heading}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td
                                style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width:300px; overflow-y: auto;">
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input pInputText type="text" [(ngModel)]="selectedClauseList.wording"
                                            class="form-control form-control-sm" [ngModelOptions]="{standalone: true}">
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{selectedClauseList.wording}}
                                    </ng-template>
                                    <!-- Helper icon added next to the wording column -->
                                </p-cellEditor>
                            </td>
                            <td>
                                <button pButton pRipple type="button" (click)="openHelperModal(selectedClauseList)"
                                    icon="pi pi-info-circle" class="p-button-rounded p-button-text"></button>
                            </td>
                            <td *ngIf="selectedClauseList.isEditable  !== 'Y'" style="padding-left: 24px;"> -- </td>
                            <td *ngIf="selectedClauseList.isEditable  === 'Y'">
                                <div class="flex align-items-center justify-content-center gap-2">
                                    <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow
                                        icon="pi pi-pencil" class="p-button-rounded p-button-text"></button>
                                    <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow
                                        icon="pi pi-check"
                                        class="p-button-rounded p-button-text p-button-success mr-2"></button>
                                    <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow
                                        icon="pi pi-times"
                                        class="p-button-rounded p-button-text p-button-danger"></button>
                                </div>
                            </td>
                        </tr>
                        <!-- Modal for each row -->
                        <p-dialog [(visible)]="selectedClauseList.showHelperModal" [modal]="false"
                            [style]="{ 'width': '700px'}">
                            <ng-container *ngIf="selectedClauseList">
                                <div pResizable [ngStyle]="{'min-width.px': 200, 'min-height.px': 150}"
                                    (onResize)="onResize($event)">
                                    <p>{{ selectedClauseList.wording }}</p>
                                </div>
                            </ng-container>
                        </p-dialog>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>



    <div class="float-end mb-4">
        <button class="btn btn-primary" #openModal data-bs-toggle="modal" data-bs-target="#exampleModal"
            hidden></button>

        <button class="btn btn-primary" (click)="getExistingQuotations()">Next</button>
    </div>


    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="min-width:700px">
                <div class="modal-body">
                    <p class="title1 mb-4">Client's already existing quotations</p>
                    <p-table [value]="clientExistingQuotations" [resizableColumns]="true" styleClass="p-datatable-sm"
                        styleClass="p-datatable-striped" class='ui-datatable' [tableStyle]="{ 'min-width': '50rem' }"
                        [scrollable]="true" scrollHeight="400px">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Quotation number</th>
                                <th>Status</th>
                                <th>Cover from</th>
                                <th>Cover to</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-data>
                            <tr>
                                <td>{{data.quotationNo}}</td>
                                <td>{{data.status}}</td>
                                <td>{{data.coverFrom}}</td>
                                <td>{{data.coverTo}}</td>
                            </tr>
                        </ng-template>
                    </p-table>

                    <p class="title1 mt-4 float-start">Do you wish to continue creating the quotation?</p>
                    <div class="mt-3 float-end">
                        <button class="btn btn-outline-primary" data-bs-dismiss="modal">No,I don't</button>
                        <button class="btn btn-primary" style="margin-left: 10px;" data-bs-dismiss="modal"
                            (click)="saveQuotationDetails()">Yes, continue</button>
                    </div>
                </div>
            </div>
        </div>
    </div>







</div>
<!-- apps-fileview.texmex_20250213.01_p1
quotation-details.component.html
Displaying quotation-details.component.html. -->
