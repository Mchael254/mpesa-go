<div class="mx-4  mt-4">
  <div class="row" *ngIf="isExpanded" [class.error-border]="!selectedCoverTypeCode"
    pTooltip="Select cover type to continue" tooltipPosition="top" [tooltipDisabled]="!!selectedCoverTypeCode">
    <!-- Cover Section -->
    <div class="col-5">
      <div class="row">
        <div class="col-12 scrollable-container">

          <div class="card mb-3" *ngFor="let coverType of riskLevelPremium.coverTypeDetails; let i = index"
            [class.selected]="selectedCoverTypeCode === coverType.coverTypeCode"
            (click)="onCoverTypeSelected(coverType);" style="cursor: pointer;">
            <div class="card-body cover-types-body">
              <input type="radio" name="{{ riskLevelPremium.code + coverType.coverTypeCode }}"
                [value]="coverType.coverTypeCode" [(ngModel)]="selectedCoverTypeCode" class="radio-btn"
                style="pointer-events: none;" />
              <span class="cover-name">
                {{ coverType.coverTypeDescription || coverType.coverTypeShortDescription | sentenceCase }}
              </span><br />
              <small class="cover-premium">
                {{ 'gis.quotation.basic_premium' | translate }}:
                <span style="font-weight: bold;">{{ coverType.computedPremium | number: '1.2-2' }}</span>
              </small>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Benefits Section -->
    <div class="col-7">
      <div class="card mb-3">
        <div class="card-body">
          <!-- CLAUSES CARD -->
          <div class="mt-2 mb-2">
            <div class="card-body" (click)="togglePolicy('clauses'); ">
              <div class="row">
                <div>
                  <div>
                    <div class="row">
                      <div class="col-sm-5">
                        <p class="subheading"> {{ 'gis.quotation.clauses' | translate }}</p>
                      </div>
                      <div class="col-sm-7 d-flex justify-content-end">
                        <div class="row mb-2">
                          <div class="col-3">
                            <button type="button" id="icon" class="btn btn-primary">
                              <i class="fa-solid"
                                [ngClass]="openPolicy === 'clauses' ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="collapse" id="clauseDetails" [class.show]="openPolicy === 'clauses'">

                    <p-table [value]="clauseList" dataKey="code" selectionMode="single"
                      [tableStyle]="{'min-width': '50rem'}" [(selection)]="selectedClause" responsiveLayout="scroll"
                      [autoLayout]="true" [paginator]="clauseList?.length > 5" [rows]="5"
                      [showCurrentPageReport]="clauseList?.length > 5"
                      currentPageReportTemplate="{first} - {last} of {totalRecords}" class="ui-datatable">

                      <ng-template pTemplate="header">
                        <tr>
                          <th></th>
                          <th class="flexible-header"> {{ 'gis.quotation.heading' | translate }}</th>
                          <th class="flexible-header"> {{ 'gis.quotation.description' | translate }}</th>
                          <th class="flexible-header"></th>
                          <th class="flexible-header"> {{ 'gis.quotation.mandatory' | translate }}</th>
                        </tr>
                      </ng-template>

                      <ng-template pTemplate="body" let-clauseList let-ri="rowIndex">
                        <tr [pSelectableRow]="clauseList" [class.p-highlight]="clauseList === selectedClause"
                          class="custom-row">
                          <td>{{ ri + 1 }} .</td>
                          <td class="flexible-header"
                            style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 250px;"
                            pTooltip="{{clauseList.heading }}" tooltipPosition="top">
                            {{ clauseList.heading | sentenceCase }}
                          </td>
                          <td class="flexible-header"
                            style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width:300px;">
                            {{ clauseList.wording | sentenceCase }}
                          </td>
                          <td class="flexible-header">
                            <button pButton pRipple type="button" (click)="openHelperModal(clauseList)"
                              icon="pi pi-info-circle" class="p-button-rounded p-button-text"></button>
                          </td>
                          <td class="flexible-header">{{ clauseList.isMandatory }}</td>
                        </tr>

                        <!-- Modal for each row -->
                        <p-dialog [(visible)]="clauseList.showHelperModal" [modal]="false" [style]="{ 'width': '700px'}"
                          (onHide)="togglePolicy('clauses')">
                          <ng-container *ngIf="clauseList">
                            <div pResizable [ngStyle]="{'min-width.px': 200, 'min-height.px': 150}"
                              (onResize)="onResize($event)">
                              <p>{{ clauseList.wording }}</p>
                            </div>
                          </ng-container>
                        </p-dialog>
                      </ng-template>
                    </p-table>

                  </div>
                </div>
              </div>
            </div>
          </div>
          <hr class="divider" />

          <!-- LIMITS OF LIABILITY -->
          <div class="mt-2 mb-2">
            <div class="card-body" (click)="togglePolicy('limits');">
              <div class="row">
                <div>
                  <div>
                    <div class="row">
                      <div class="col-sm-5">
                        <p class="subheading"> {{ 'gis.quotation.limits_of_liability' | translate }}</p>
                      </div>
                      <div class="col-sm-7 d-flex justify-content-end">
                        <div class="row mb-2">
                          <div class="col-3">
                            <button type="button" id="icon" class="btn btn-primary">
                              <i class="fa-solid"
                                [ngClass]="openPolicy === 'limits' ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="collapse" id="limitsOfLiabilityDetails" [class.show]="openPolicy === 'limits'">
                    <p-table #dt1 [value]="limitsOfLiabilityList" dataKey="code" selectionMode="single"
                      [tableStyle]="{ 'min-width': '50rem' }" responsiveLayout="scroll"
                      [paginator]="limitsOfLiabilityList?.length > 5" [rows]="5"
                      [showCurrentPageReport]="limitsOfLiabilityList?.length > 5"
                      currentPageReportTemplate=" {first} - {last} of {totalRecords}" [autoLayout]="true"
                      class='ui-datatable'>
                      <ng-template pTemplate="header">
                        <tr>
                          <th></th>
                          <th class="flexible-header"> {{ 'gis.quotation.narration' | translate }}</th>
                          <th class="flexible-header"> {{ 'gis.quotation.value' | translate }}</th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-limits let-ri="rowIndex">
                        <tr>
                          <td>{{ ri + 1 }}.</td>
                          <td style=" white-space: nowrap;
                                  overflow: hidden;
                                  text-overflow: ellipsis;
                                  overflow-y: auto;
                                  max-width: 250px;" pTooltip="{{limits.narration }}" tooltipPosition="top">
                            {{ limits.narration|sentenceCase }}
                          </td>
                          <td>{{ limits.value }}</td>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="emptymessage">
                        <tr>
                          <td colspan="1"></td>

                          <td colspan="10" style="padding:20px;padding-left: 30px;" id="empty">
                            {{ 'gis.quotation.no_data_to_display' | translate }}
                          </td>
                        </tr>

                      </ng-template>
                    </p-table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <hr class="divider" />

          <!-- EXCESS APPLICABLE -->
          <div class="mt-2 mb-2">
            <div class="card-body" (click)="togglePolicy('excess')">
              <div class="row">
                <div>
                  <div>
                    <div class="row">
                      <div class="col-sm-5">
                        <p class="subheading">{{ 'gis.quotation.excesses_applicable' | translate }}</p>
                      </div>
                      <div class="col-sm-7 d-flex justify-content-end">
                        <div class="row mb-2">
                          <div class="col-3">
                            <button type="button" id="icon" class="btn btn-primary">
                              <i class="fa-solid"
                                [ngClass]="openPolicy === 'excess' ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="collapse" id="excessDetails" [class.show]="openPolicy === 'excess'">

                    <p-table #dt1 [value]="excessesList" dataKey="code" selectionMode="single"
                      [tableStyle]="{ 'min-width': '50rem' }" responsiveLayout="scroll"
                      [paginator]="excessesList?.length > 5" [rows]="5"
                      [showCurrentPageReport]="excessesList?.length > 5"
                      currentPageReportTemplate=" {first} - {last} of {totalRecords}" [autoLayout]="true"
                      class='ui-datatable'>
                      <ng-template pTemplate="header">
                        <tr>
                          <th class="flexible-header"></th>
                          <th class="flexible-header"> {{ 'gis.quotation.narration' | translate }}</th>
                          <th class="flexible-header"> {{ 'gis.quotation.value' | translate }}</th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-limits let-ri="rowIndex">
                        <tr>
                          <td>{{ ri + 1 }}.</td>
                          <td style=" white-space: nowrap;
                                overflow: hidden;
                                text-overflow: ellipsis;
                                overflow-y: auto;
                                max-width: 250px;" pTooltip="{{limits.narration }}" tooltipPosition="top">
                            {{ limits.narration|sentenceCase }}
                          </td>
                          <td>{{ limits.value }}</td>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="emptymessage">
                        <tr>
                          <td colspan="1"></td>

                          <td colspan="10" style="padding:20px;padding-left: 30px;" id="empty">
                            {{ 'gis.quotation.no_data_to_display' | translate }}
                          </td>
                        </tr>

                      </ng-template>
                    </p-table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <hr class="divider" />
          <!-- ADDITIONAL BENEFITS -->
          <div class="mt-2 mb-2">
            <div class="card-body">
              <div class="row">
                <div>
                  <div>
                    <div class="row" (click)="togglePolicy('additionalBenefits')">
                      <div class="col-sm-5">
                        <p class="subheading"> {{ 'gis.quotation.additional_benefits' | translate }}</p>
                      </div>
                      <div class="col-sm-7 d-flex justify-content-end">
                        <div class="row mb-2">
                          <div class="col-3">
                            <button type="button" id="icon" class="btn btn-primary">
                              <i class="fa-solid"
                                [ngClass]="openPolicy === 'additionalBenefits' ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="collapse" id="additionalBenefitDetails"
                    [class.show]="openPolicy === 'additionalBenefits'">
                    <button *ngIf="selectedCover?.additionalBenefits.length > 0" #openModalButton type="button"
                      class="btn btn-outline-primary me-2 mb-3" id="btnCoverTypes"
                      (click)="openAdditionalBenefitsModal()">
                      Add/edit benefits
                    </button>
                    <button type="button" id="icon" class="btn btn-primary" data-bs-toggle="modal"
                      id="openAdditionalBenefitsModalButton" [hidden]="true" data-bs-target="#addMoreBenefits"
                      title="open">
                    </button>
                    <div class="row">
                      <p-table [value]="selectedCover?.limitPremium" responsiveLayout="scroll" dataKey="sectionCode"
                        selectionMode="single" responsiveLayout="scroll" [autoLayout]="true" class='ui-datatable'>
                        <ng-template pTemplate="header">
                          <tr>
                            <th class="flexible-header"></th>
                            <th class="flexible-header">{{ 'gis.quotation.section' | translate }} </th>
                            <th class="flexible-header"> {{ 'gis.quotation.limit_amount' | translate }}</th>
                            <th class="flexible-header"> {{ 'gis.quotation.premium' | translate }}</th>
                            <th class="flexible-header"></th>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-limit let-i="rowIndex">
                          <tr>
                            <td>{{ i + 1 }}.</td>
                            <td>{{ limit.description | sentenceCase }}</td>
                            <td>{{ limit?.limitAmount | number }}</td>
                            <td class="fw-semibold">{{ limit.premium | number }}</td>
                            <td id="action-buttons">
                              <button type="button" id="icon" class="btn btn-primary" title="Delete"
                                [disabled]="limit?.isMandatory === 'Y'" (click)="openRiskDeleteModal(limit)">
                                <i class="fa-solid fa-trash-can"></i>
                              </button>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
<!-- Add More Benefits Modal -->
<div class="modal fade" #addMoreBenefits id="addMoreBenefits" tabindex="-1" aria-labelledby="addMoreBenefitsModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="min-width: 608px;">
    <div class="modal-content ps-4 pt-4 pe-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <p class="modal-title mb-0" id="addMoreBenefitsModalLabel">
          {{ 'gis.quotation.additional_benefits_details' | translate }}
        </p>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"
          style="filter: invert(28%) sepia(97%) saturate(4347%) hue-rotate(349deg) brightness(88%) contrast(105%);"></button>
      </div>
      <p-table [value]="selectedCover?.additionalBenefits" id="clientTable" dataKey="sectionCode"
        [tableStyle]="{ 'max-width': '50rem', 'border-spacing': '10 10px' }" [(selection)]="selectedSections"
        [resizableColumns]="true" responsiveLayout="scroll" class='ui-datatable' [autoLayout]="true" [paginator]="false"
        [rows]="10" [scrollable]="true" scrollDirection="horizontal" [showCurrentPageReport]="true"
        currentPageReportTemplate="{first} - {last} of {totalRecords}">
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 1em; background-color: #BAD0E4;"></th>
            <th style="width: 33%; background-color: #BAD0E4;"> {{ 'gis.quotation.benefit' | translate }}</th>
            <th style="width: 33%; background-color: #BAD0E4;"> {{ 'gis.quotation.free_limit' | translate }}</th>
            <th style="width: 33%; background-color: #BAD0E4;"> {{ 'gis.quotation.value' | translate }}</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-section let-editing="editing" let-i="rowIndex">
          <tr style="height: 40px; padding: 10px; margin-bottom: 10px;">
            <td>
              <input type="checkbox" id="check_section_{{ section.sectionCode }}" [(ngModel)]="section.isChecked">
            </td>
            <td>{{ section.sectionDescription |sentenceCase }}</td>
            <td>{{ formatCurrency(section.freeLimit,this.currencyObj.prefix,this.currencyObj.thousands)}}</td>
            <td [pEditableColumn]="section.limitAmount" pEditableColumnField="limitAmount">
              <input id="section_{{ section.sectionCode }}" [(ngModel)]="section.limitAmount" [options]="currencyObj"
                currencyMask class="error-border form-control-sm" type="text" (keydown)="onKeyUp($event, section)"
                [ngClass]="{'error-border': section.isChecked && !section.limitAmount}">
            </td>

          </tr>
        </ng-template>
      </p-table>


      <div class="row mt-3 mb-3">
        <div class="col-12 d-flex justify-content-end">
          <button type="button" (click)="closeModal()" class="btn me-2" style="color: #00529B; font-size: 16px; border-radius: 4px; font-weight: 600; border: 1px solid #00529B;
               background-color: transparent;"
            onmouseover="this.style.backgroundColor='transparent'; this.style.color='#00529B';"
            onmouseout="this.style.backgroundColor='transparent'; this.style.color='#00529B';">
            {{ 'gis.quotation.cancel' | translate }}
          </button>

          <button class="btn btn-primary" type="submit" id="btnCoverTypes" (click)="addBenefits()"
            style="font-size: 16px; font-weight: 600; background-color: #00529B; border-color: #00529b;"
            onmouseover="this.style.backgroundColor='#00529b'; this.style.borderColor='#00529b';"
            onmouseout="this.style.backgroundColor='#00529b'; this.style.borderColor='#00529b';">
            {{ 'gis.quotation.update_quote' | translate }}
          </button>

        </div>
      </div>


    </div>
  </div>
</div>