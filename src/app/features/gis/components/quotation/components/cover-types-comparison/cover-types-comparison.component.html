<ng-container *ngFor="let risk of passedRiskedLevelPremiums; let riskIndex = index">

  <div class="d-flex justify-content-start mb-2 gap-2 px-3">
    <button (click)="toggleSelectRisk(riskIndex)" style="border: none; background: transparent; padding: 0; cursor: pointer;">
      <i class="fa-solid" [ngClass]="activeRiskIndex === riskIndex ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
    </button>
    <p class="mb-0 text-dark sum-insured-text">{{'gis.quotation.risk' | translate}}  {{riskIndex + 1}} {{'gis.quotation.sum_insured' | translate}} {{ risk?.sumInsured | currency: currencySymbol || '' : 'symbol'}}</p>
<!--
    <p class="mb-0 text-dark sum-insured-text">Sum Insured {{ risk?.sumInsured | currency: currencySymbol || '' : 'symbol' }}</p>
-->
  </div>
  <div class="row">
    <!-- Cover Section -->
    <div class="collapse col-5 rounded-3 p-3" [class.show]="activeRiskIndex === riskIndex">
      <div class="row">
        <div class="col-12 scrollable-container">

          <div class="card mb-3" *ngFor="let cover of risk.coverTypeDetails; let i = index">
            <div class="card-body cover-types-body">
              <label>
                <input type="radio" [name]="'coverType_' + riskIndex" [value]="cover.coverTypeCode"
                       [(ngModel)]="risk.selectedCoverType" (change)="onCoverTypeSelected(risk, cover)"
                       class="radio-btn"/>

                <span class="cover-name">
                  {{
                    cover.coverTypeDescription ||
                    cover.coverTypeShortDescription
                      | sentenceCase
                  }}
                </span>
                <br/>

                <small class="cover-premium">
                  Basic premium:
                  <span style="font-weight: bold;">
                    {{ cover.computedPremium | number: '1.2-2' }}
                  </span>
                </small>
              </label>
            </div>
          </div>

        </div>
      </div>
    </div>


    <!-- Benefits Section -->
    <div class="collapse col-7 mt-3" id="benefitsSection" [class.show]="activeRiskIndex === riskIndex">
      <!-- <p class="card-title mb-3"> {{ 'gis.quotation.benefits' | translate }}</p> -->
      <div class="card mb-3">
        <div class="card-body">
          <!-- CLAUSES CARD -->
          <div class="mb-2">
            <div class="card-body">
              <div class="row">
                <div>
                  <div>
                    <div class="row">
                      <div class="col-sm-5">
                        <p class="subheading"> {{ 'gis.quotation.clauses' | translate }}</p>
                      </div>
                      <div class="col-sm-7 d-flex justify-content-end">
                        <div class="row mb-2">
                          <div class="col-3">
                            <button type="button" id="icon" class="btn btn-primary" (click)="toggleClauseDetails(); ">
                              <i class="fa-solid"
                                 [ngClass]="isClauseDetailsOpen ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="collapse" id="clauseDetails" [class.show]="isClauseDetailsOpen">
                    <p-table [value]="clauseList" dataKey="code" selectionMode="single"
                             [tableStyle]="{'min-width': '50rem'}" [(selection)]="selectedClause"
                             responsiveLayout="scroll"
                             [autoLayout]="true" [paginator]="clauseList?.length > 5" [rows]="5"
                             [showCurrentPageReport]="clauseList?.length > 5"
                             currentPageReportTemplate="{first} - {last} of {totalRecords}" class="ui-datatable">
                      <ng-template pTemplate="header">
                        <tr>
                          <th></th>
                          <th class="flexible-header"> {{ 'gis.quotation.heading' | translate }}</th>
                          <th class="flexible-header"> {{ 'gis.quotation.description' | translate }}</th>
                          <th class="flexible-header"></th>
                          <th class="flexible-header"> {{ 'gis.quotation.mandatory' | translate }}</th>
                        </tr>
                      </ng-template>

                      <ng-template pTemplate="body" let-clauseList let-ri="rowIndex">
                        <tr [pSelectableRow]="clauseList" [class.p-highlight]="clauseList === selectedClause"
                            class="custom-row">
                          <td>{{ ri + 1 }} .</td>
                          <td class="flexible-header"
                              style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 250px;"
                              pTooltip="{{clauseList.heading }}" tooltipPosition="top">
                            {{ clauseList.heading | sentenceCase }}
                          </td>
                          <td class="flexible-header"
                              style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width:300px;">
                            {{ clauseList.wording | sentenceCase }}
                          </td>
                          <td class="flexible-header">
                            <button pButton pRipple type="button" (click)="openHelperModal(clauseList)"
                                    icon="pi pi-info-circle" class="p-button-rounded p-button-text"></button>
                          </td>
                          <td class="flexible-header">{{ clauseList.isMandatory }}</td>
                        </tr>

                        <!-- Modal for each row -->
                        <p-dialog [(visible)]="clauseList.showHelperModal" [modal]="false"
                                  [style]="{ 'width': '700px'}">
                          <ng-container *ngIf="clauseList">
                            <div pResizable [ngStyle]="{'min-width.px': 200, 'min-height.px': 150}"
                                 (onResize)="onResize($event)">
                              <p>{{ clauseList.wording }}</p>
                            </div>
                          </ng-container>
                        </p-dialog>
                      </ng-template>
                    </p-table>

                  </div>
                </div>
              </div>
            </div>
          </div>
          <hr class="divider"/>

          <!-- LIMITS OF LIABILITY -->
          <div class="mt-2 mb-2">
            <div class="card-body">
              <div class="row">
                <div>
                  <div>
                    <div class="row">
                      <div class="col-sm-5">
                        <p class="subheading"> {{ 'gis.quotation.limits_of_liability' | translate }}</p>
                      </div>
                      <div class="col-sm-7 d-flex justify-content-end">
                        <div class="row mb-2">
                          <div class="col-3">
                            <button type="button" id="icon" class="btn btn-primary" (click)="toggleLimitsDetails();">
                              <i class="fa-solid"
                                 [ngClass]="isLimitsDetailsOpen ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="collapse" id="limitsOfLiabilityDetails" [class.show]="isLimitsDetailsOpen">
                    <p-table #dt1 [value]="limitsOfLiabilityList" dataKey="code" selectionMode="single"
                             [tableStyle]="{ 'min-width': '50rem' }" responsiveLayout="scroll"
                             [paginator]="limitsOfLiabilityList?.length > 5" [rows]="5"
                             [showCurrentPageReport]="limitsOfLiabilityList?.length > 5"
                             currentPageReportTemplate=" {first} - {last} of {totalRecords}" [autoLayout]="true"
                             class='ui-datatable'>
                      <ng-template pTemplate="header">
                        <tr>
                          <th></th>
                          <th class="flexible-header"> {{ 'gis.quotation.narration' | translate }}</th>
                          <th class="flexible-header"> {{ 'gis.quotation.value' | translate }}</th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-limits let-ri="rowIndex">
                        <tr>
                          <td>{{ ri + 1 }}.</td>
                          <td style=" white-space: nowrap;
                                  overflow: hidden;
                                  text-overflow: ellipsis;
                                  overflow-y: auto;
                                  max-width: 250px;" pTooltip="{{limits.narration }}" tooltipPosition="top">
                            {{ limits.narration|sentenceCase }}
                          </td>
                          <td>{{ limits.value |number }}</td>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="emptymessage">
                        <tr>
                          <td colspan="1"></td>

                          <td colspan="10" style="padding:20px;padding-left: 30px;" id="empty">
                            {{ 'gis.quotation.no_data_to_display' | translate }}
                          </td>
                        </tr>

                      </ng-template>
                    </p-table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <hr class="divider"/>

          <!-- EXCESS APPLICABLE -->
          <div class="mt-2 mb-2">
            <div class="card-body">
              <div class="row">
                <div>
                  <div>
                    <div class="row">
                      <div class="col-sm-5">
                        <p class="subheading">{{ 'gis.quotation.excesses_applicable' | translate }}</p>
                      </div>
                      <div class="col-sm-7 d-flex justify-content-end">
                        <div class="row mb-2">
                          <div class="col-3">
                            <button type="button" id="icon" class="btn btn-primary" (click)="toggleExcessDetails()">
                              <i class="fa-solid"
                                 [ngClass]="isExcessDetailsOpen ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="collapse" id="excessDetails" [class.show]="isExcessDetailsOpen">

                    <p-table #dt1 [value]="excessesList" dataKey="code" selectionMode="single"
                             [tableStyle]="{ 'min-width': '50rem' }" responsiveLayout="scroll"
                             [paginator]="excessesList?.length > 5" [rows]="5"
                             [showCurrentPageReport]="excessesList?.length > 5"
                             currentPageReportTemplate=" {first} - {last} of {totalRecords}" [autoLayout]="true"
                             class='ui-datatable'>
                      <ng-template pTemplate="header">
                        <tr>
                          <th class="flexible-header"></th>
                          <th class="flexible-header"> {{ 'gis.quotation.narration' | translate }}</th>
                          <th class="flexible-header"> {{ 'gis.quotation.value' | translate }}</th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-limits let-ri="rowIndex">
                        <tr>
                          <td>{{ ri + 1 }}.</td>
                          <td style=" white-space: nowrap;
                                overflow: hidden;
                                text-overflow: ellipsis;
                                overflow-y: auto;
                                max-width: 250px;" pTooltip="{{limits.narration }}" tooltipPosition="top">
                            {{ limits.narration|sentenceCase }}
                          </td>
                          <td>{{ limits.value |number }}</td>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="emptymessage">
                        <tr>
                          <td colspan="1"></td>

                          <td colspan="10" style="padding:20px;padding-left: 30px;" id="empty">
                            {{ 'gis.quotation.no_data_to_display' | translate }}
                          </td>
                        </tr>

                      </ng-template>
                    </p-table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <hr class="divider"/>
          <!-- ADDITIONAL BENEFITS -->

            <div class="mt-2 mb-2">
              <div class="card-body">
                <div class="row">
                  <div>
                    <div>
                      <div class="row">
                        <div class="col-sm-5">
                          <p class="subheading"> {{ 'gis.quotation.additional_benefits' | translate }}</p>
                        </div>
                        <div class="col-sm-7 d-flex justify-content-end">
                          <div class="row mb-2">
                            <div class="col-3">
                              <button type="button" id="icon" class="btn btn-primary"
                                      (click)="toggleAdditionalBenefitsDetails()">
                                <i class="fa-solid"  [ngClass]="isBenefitsDetailsOpen ? 'fa-chevron-up' : 'fa-chevron-down'"></i>

                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="collapse" id="additionalBenefitDetails" [class.show]="isBenefitsDetailsOpen">
                      <button *ngIf="temporaryPremiumList?.length > 0" #openModalButton type="button"
                              class="btn btn-outline-primary me-2 mb-3"
                              id="btnCoverTypes" (click)="openAdditionalBenefitsModal()">
                        {{ 'gis.quotation.add_benefits' | translate }}
                      </button>
                      <button type="button" id="icon" class="btn btn-primary" data-bs-toggle="modal"
                              id="openAdditionalBenefitsModalButton" [hidden]="true" data-bs-target="#addMoreBenefits"
                              title="open">
                      </button>
                      <div class="row ">

                      <p-table [value]="passedRiskedLevelPremiums" responsiveLayout="scroll" dataKey="sectionCode"
                               selectionMode="single" responsiveLayout="scroll" [autoLayout]="true"
                               class='ui-datatable'>
                        <ng-template pTemplate="header">
                          <tr>
                            <th class="flexible-header"></th>
                            <th class="flexible-header">Section</th>
                            <th class="flexible-header">Limit amount</th>
                            <th class="flexible-header">Premium</th>
                            <th class="flexible-header"></th>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-risk>
                          <ng-container
                            *ngIf="selectedCover">
                            <tr *ngFor="let limit of selectedCover.limitPremium; let i = index">
                              <td>{{ i + 1 }}.</td>
                              <td>{{ limit.description | sentenceCase }}</td>
                              <td>{{ limit?.limitAmount | number }}</td>
                              <td class="fw-semibold">{{ limit.premium | number }}</td>
                              <td id="action-buttons">
                                <button type="button" id="icon" class="btn btn-primary" title="Delete"
                                        [disabled]="limit?.isMandatory === 'Y'" (click)="openRiskDeleteModal(limit)">
                                  <i class="fa-solid fa-trash-can"></i>
                                </button>
                              </td>
                            </tr>
                          </ng-container>
                        </ng-template>
                      </p-table>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>


</ng-container>
<!-- Add More Benefits Modal -->
<div class="modal fade" id="addMoreBenefits" tabindex="-1" aria-labelledby="addMoreBenefitsLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="min-width: 608px;">
    <div class="modal-content ps-4 pt-4 pe-4">
      <div class="d-flex justify-content-between align-items-center rounded-3 mb-4 p-1">
        <p class="modal-title mb-0" id="addMoreBenefitsLabel">
          {{ 'gis.quotation.additional_benefits_details' | translate }}</p>
        <button type="button" data-bs-dismiss="modal" class="btn p-0 border-0 bg-transparent text-danger fs-5 fw-bold"
                style="text-decoration: none;">X
        </button>
      </div>

      <p-table [value]="temporaryPremiumList" id="clientTable" dataKey="code"
               [tableStyle]="{ 'max-width': '50rem', 'border-spacing': '10 10px' }" [(selection)]="selectedSections"
               [resizableColumns]="true" responsiveLayout="scroll" class='ui-datatable' [autoLayout]="true"
               [paginator]="true"
               [rows]="10" [scrollable]="true" scrollDirection="horizontal" [showCurrentPageReport]="true"
               scrollHeight="300px"
               currentPageReportTemplate="{first} - {last} of {totalRecords}">
        <ng-template pTemplate="header">
          <tr styleClass="custom-header-row">
            <th style="width: 1em;"></th> <!-- Checkbox column -->
            <th style="width: 33%;"> {{ 'gis.quotation.benefit' | translate }}</th>
            <th style="width: 33%;"> {{ 'gis.quotation.free_limit' | translate }}</th>
            <th style="width: 33%;"> {{ 'gis.quotation.value' | translate }}</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-section let-editing="editing" let-i="rowIndex">
          <tr style="height: 40px; padding: 10px; margin-bottom: 10px;">
            <td>
              <input type="checkbox" id="check_section_{{ section.sectionCode }}" [(ngModel)]="section.isChecked">
            </td>
            <td>{{ section.sectionDescription |sentenceCase }}</td>
            <td>{{ section.freeLimit | number }}</td>
            <td [pEditableColumn]="section.limitAmount" pEditableColumnField="limitAmount">
              <input id="section_{{ section.sectionCode }}" [(ngModel)]="section.limitAmount" [options]="currencyObj"
                     currencyMask class="error-border form-control-sm" type="text" (keydown)="onKeyUp($event, section)"
                     [ngClass]="{'error-border': section.isChecked && !section.limitAmount}">
            </td>
          </tr>
        </ng-template>
      </p-table>


    </div>
  </div>
</div>
