<div class="mx-4 mt-3">
  <p class="title">Quotations:Quotation Summary</p>
  <app-stepper [currentStep]="3" [stepperData]="steps"></app-stepper>

  <div class="card mb-3">
    <div class="header mx-4 mt-2 mb-2">
      <ul class="nav">
        <li class="nav-item">
          <a class="nav-link sub-title active" data-bs-toggle="tab" id="nav-summary-tab" aria-controls="nav-summary"
            data-bs-target="#nav-summary">Quotation Summary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link sub-title" data-bs-toggle="tab" id="nav-quotation-other-details-tab"
            aria-controls="nav-quotation-other-details" data-bs-target="#nav-quotation-other-details">Quotation Other
            Details</a>
        </li>
        <li class="nav-item">
          <a class="nav-link sub-title" data-bs-toggle="tab" id="nav-reports-tab" aria-controls="nav-authorization"
            data-bs-target="#nav-reports">Reports and documents</a>
        </li>
      </ul>
    </div>
  </div>

  <div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-summary" role="tabpanel" aria-labelledby="nav-summary-tab"
      tabindex="0">
      <div class="spinner" style="position: relative">
        <ngx-spinner type="ball-clip-rotate-multiple" [fullScreen]="true" color="#00529B" size="large"
          bdColor="rgba(255, 255, 255, 0.966)"></ngx-spinner>
      </div>

      <!-- Quotation details card  -->
      <div class="card mb-4">
        <div class="card-body">
          <p class="card-titles mb-4">Quotation details</p>

          <div class="row mb-3">
            <div class="col-md-4 d-flex">
              <p class="label w-50">Quotation Number</p>
              <p class="content w-50">{{ fetchedQuoteNum }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Branch</p>
              <p class="content w-50">{{ branch?.name }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Currency</p>
              <p class="content w-50">{{ quotationView?.currency }}</p>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-4 d-flex">
              <p class="label w-50">Expiry Date</p>
              <p class="content w-50">{{ expiryDate }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Cover From</p>
              <p class="content w-50">{{ coverFrom }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Cover To</p>
              <p class="content w-50">{{ coverTo }}</p>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-4 d-flex">
              <p class="label w-50">Status</p>
              <p class="content w-50">{{ quotationView?.status }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Frequency of Payment</p>
              <p class="content w-50">
                {{ quotationView?.frequencyOfPayment }}
              </p>
            </div>
            <div class="col-md-4 d-flex align-items-center position-relative">
              <p class="label w-50 mb-0 me-2">Notes</p>

              <div class="d-flex align-items-center w-50">
                <p class="content mb-0 me-2">
                  {{
                  quotationView?.comments
                  ? quotationView.comments
                  .split(" ")
                  .slice(0, 3)
                  .join(" ") +
                  (quotationView.comments.split(" ").length > 3
                  ? "..."
                  : "")
                  : ""
                  }}
                </p>

                <i class="fas fa-edit text-primary" style="cursor: pointer" (click)="openCommentModal()"></i>
              </div>
            </div>
          </div>

          <p class="card-titles mb-4">Client information</p>

          <div class="row mb-3">
            <div class="col-md-4 d-flex">
              <p class="label w-50">Client</p>
              <p class="content w-50">{{ quotationView?.clientName }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Proposer</p>
              <p class="content w-50">{{ clientDetails?.proposer }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Introducer</p>
              <p class="content w-50">{{ clientDetails?.introducer }}</p>
            </div>
          </div>

          <div class="row mb-2">
            <div class="col-md-4 d-flex">
              <p class="label w-50">Source</p>
              <p class="content w-50">
                {{ quotationView?.source.description }}
              </p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Likelihood</p>
              <p class="content w-50">{{ quotationView?.likelihood }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Agent</p>
              <p class="content w-50">{{ quotationView?.agentName }}</p>
            </div>
          </div>

          <p class="card-titles mb-4">Financial overview</p>

          <div class="row mb-3">
            <div class="col-md-4 d-flex">
              <p class="label w-50">Premium</p>
              <p class="content w-50">{{ quotationView?.premium | number }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Sum Insured</p>
              <p class="content w-50">
                {{ quotationView?.sumInsured | number }}
              </p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Marketer Comm.</p>
              <p class="content w-50">
                {{ quotationView?.marketerCommissionAmount | number }}
              </p>
            </div>
          </div>

          <div class="row mb-2">
            <div class="col-md-4 d-flex">
              <p class="label w-50">Comm amt.</p>
              <p class="content w-50">{{ quotationView?.commissionAmount }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Comments</p>
              <p class="content w-50">{{ quotationView?.comments }}</p>
            </div>
            <div class="col-md-4 d-flex">
              <p class="label w-50">Internal Comments</p>
              <p class="content w-50">{{ quotationView?.internalComments }}</p>
            </div>
          </div>

          <div class="d-flex justify-content-end align-items-center mt-4">
            <a href="#" (click)="viewClientProfile()" class="text-primary text-decoration-underline">
              View Client Profile
            </a>

            <button class="btn btn-outline-primary custom-outline-btn" style="margin-right: 10px; margin-left: 20px"
              (click)="editQuotationDetails()" [disabled]="viewQuoteFlag">
              Edit details
            </button>
          </div>
        </div>
      </div>
      <!-- edit notes Modal -->
      <div *ngIf="showCommentModal" class="modal-backdrop-custom">
        <div class="modal d-block" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered modal-md">
            <div class="modal-content">
              <div class="modal-header border-0">
                <h5 class="modal-title">Edit Notes</h5>
                <button type="button" class="btn-close" aria-label="Close" (click)="closeCommentModal()"></button>
              </div>
              <div class="modal-body">
                <textarea [(ngModel)]="editableComment" class="form-control w-90%" rows="3"></textarea>
              </div>
              <div class="modal-footer border-0">
                <button class="btn btn-secondary btn-lightblue" (click)="closeCommentModal()">
                  Cancel
                </button>
                <button class="btn btn-primary" (click)="saveComment()">
                  Save
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Details Card -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="row">
            <div class="col-4">
              <p class="card-title mt-2" class="card-title-p mt-2">Products</p>
            </div>
            <div class="col-8 d-flex justify-content-end">
              <div class="row">
                <div class="col-4">
                  <button type="button" id="icon" class="btn btn-primary" data-bs-toggle="collapse"
                    data-bs-target="#productDetails" (click)="toggleProductDetails()"
                    [attr.aria-expanded]="!isCollapsibleOpen">
                    <i class="fa-solid" [ngClass]="
                        isCollapsibleOpen ? 'fa-chevron-up' : 'fa-chevron-down'
                      "></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="isCollapsibleOpen" class="mt-4" id="productDetails">
            <div class="row">
              <div class="col-3">
                <!-- <p class="card-title mt-2" data-bs-toggle="collapse" data-bs-target="#productDetails" (click)="toggleProductDetails()">Product Details</p> -->
                <!-- <p class="fw-semibold	card-title-collapsed mt-2"></p>
              </div> -->
                <!-- <div class="col-9 d-flex justify-content-end" id="navigationIcons">
                <div class="row"> -->
                <!-- <div class="col-sm-3"></div>
                  <div class="col-sm-3">
                    <button type="button" id="icon" class="btn btn-primary" title="Add" [disabled]="viewQuoteFlag">
                      <i class="fa-solid fa-plus"></i>
                    </button>
                  </div>
                  <div class="col-sm-3">
                    <button type="button" id="icon" class="btn btn-primary" title="Edit" [disabled]="viewQuoteFlag">
                      <i class="fa-solid fa-pencil"></i>
                    </button>
                  </div> -->

                <!-- </div>  -->
              </div>
            </div>
            <div class="mt-3" id="">
              <p-table [value]="productDetails" [tableStyle]="{ 'min-width': '50rem' }">
                <ng-template pTemplate="header">
                  <tr>
                    <th pSortableColumn="productName">
                      Product
                      <p-sortIcon field="productName"></p-sortIcon>
                    </th>

                    <th pSortableColumn="wef">
                      Cover From
                      <p-sortIcon field="wef"></p-sortIcon>
                    </th>

                    <th pSortableColumn="wet">
                      Cover To
                      <p-sortIcon field="wet"></p-sortIcon>
                    </th>

                    <th pSortableColumn="premium">
                      Premium
                      <p-sortIcon field="premium"></p-sortIcon>
                    </th>

                    <th pSortableColumn="commission">
                      Commission
                      <p-sortIcon field="commission"></p-sortIcon>
                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-data>
                  <tr (click)="handleProductClick(data)" class="point"
                    [ngClass]="{ 'selected-row': selectedProduct === data }">
                    <td>{{ data.productName | sentenceCase }}</td>
                    <td>{{ data.wef }}</td>
                    <td>{{ data.wet }}</td>
                    <td>{{ data.premium || 0.0 | number }}</td>
                    <td>{{ data.commission || 0.0 | number }}</td>
                  </tr>
                </ng-template>
              </p-table>
              <!-- Delete Product Modal -->
              <div class="modal fade" id="deleteProduct" tabindex="-1" role="dialog" aria-labelledby="deleteProduct"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content" id="deleteProduct">
                    <div class="modal-body">
                      <p class="deleteMessage mt-4 mb-4">
                        {{
                        "gis.policy.are_you_sure_you_want_to_delete"
                        | translate
                        }}
                      </p>
                      <div class="d-flex justify-content-center mb-3">
                        <button type="button" class="btn btn-primary px-5" id="delete" data-bs-dismiss="modal"
                          (click)="deleteProduct()">
                          {{ "gis.policy.yes_delete" | translate }}
                        </button>
                      </div>
                      <div class="d-flex justify-content-center mb-2">
                        <button type="button" class="btn btn-outline-primary px-5" data-bs-dismiss="modal">
                          {{ "gis.policy.no_im_not" | translate }}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- TABS  -->
              <div class="row mt-5 mb-3">
                <div class="col-7">
                  <ul class="nav nav-underline">
                    <li class="nav-item">
                      <a class="nav-link active" [class.active]="activeTab === 'clauses'"
                        (click)="setActiveTab('clauses')" aria-current="page" data-bs-toggle="tab"
                        data-bs-target="#nav-clauses">Clauses</a>
                    </li>
                    <br />
                    <li class="nav-item">
                      <a class="nav-link" [class.active]="activeTab === 'taxes'" (click)="setActiveTab('taxes')"
                        data-bs-toggle="tab" data-bs-target="#nav-taxes">Taxes</a>
                    </li>
                    <!-- <br>
                    <li class="nav-item">
                      <a class="nav-link" [class.active]="activeTab === 'limits'" (click)="setActiveTab('limits')"
                        data-bs-toggle="tab" data-bs-target="#nav-limits">Limits of Liability</a>
                    </li>
                    <br>
                    <li class="nav-item">
                      <a class="nav-link" [class.active]="activeTab === 'similarQuotes'"
                         (click)="setActiveTab('similarQuotes')" data-bs-toggle="tab"
                         data-bs-target="#nav-similarQuotes">Similar Quotes</a>
                    </li> -->
                  </ul>
                </div>
                <div class="col-5 d-flex justify-content-end" id="navigationIcons">
                  <div class="row" *ngIf="
                      activeTab === 'clauses' ||
                      activeTab === 'taxes' ||
                      activeTab === 'limits'
                    ">
                    <div class="col-sm-3"></div>
                    <!-- <div class="col-sm-3">
                      <button type="button" id="icon" class="btn btn-primary" title="Add" [disabled]="viewQuoteFlag">
                        <i class="fa-solid fa-plus"></i>
                      </button>
                    </div>
                    <div class="col-sm-3">
                      <button type="button" id="icon" class="btn btn-primary" title="Edit" [disabled]="viewQuoteFlag">
                        <i class="fa-solid fa-pencil"></i>
                      </button>
                    </div> -->
                    <div class="col-sm-3 d-flex">
                      <button *ngIf="activeTab === 'taxes'" id="openModalButtonAdd" class="btn btn-primary btn-sm"
                        style="
                          white-space: nowrap;
                          height: 30px;
                          padding: 2px 8px;
                          font-size: 13px;
                          line-height: 1;
                        " (click)="openEditTaxModal();getTransactionTypes();getProductTaxes()">
                        Add Tax
                      </button>
                      <i class="pi border border-black p-1 rounded-1 text-black" [ngClass]="{
                          'pi-caret-up': isCollapsibleOpen,
                          'pi-caret-down': !isCollapsibleOpen
                        }" style="
                          font-size: 16px;
                          cursor: pointer;
                          margin-left: 8px;
                          padding: 2px 8px;
                          height: 30px;
                        " (click)="toggleProductDetails()"></i>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tab-content mb-4" id="nav-tabContent">
                <!-- CLAUSES -->
                <div class="tab-pane fade show active" id="nav-clauses" role="tabpanel" aria-labelledby="nav-clauses"
                  tabindex="0">
                  <p-table [value]="productClauses" #productClauseTable [tableStyle]="{ 'min-width': '50rem' }"
                    [rows]="3" [paginator]="true" [rowsPerPageOptions]="[3, 6, 9]" [showCurrentPageReport]="true"
                    currentPageReportTemplate="{first} - {last} of {totalRecords}" class="ui-datatable"
                    responsiveLayout="scroll" [autoLayout]="true" [scrollable]="true" scrollHeight="200px">
                    <ng-template pTemplate="header">
                      <tr>
                        <th class="flexible-header" pSortableColumn="clauseCode">
                          ID
                          <p-sortIcon field="clauseCode"></p-sortIcon>
                        </th>

                        <th class="flexible-header" pSortableColumn="clauseHeading">
                          {{ "gis.quotation.heading" | translate }}
                          <p-sortIcon field="clauseHeading"></p-sortIcon>
                        </th>

                        <th class="flexible-header" pSortableColumn="clause">
                          {{ "gis.quotation.wording" | translate }}
                          <p-sortIcon field="clause"></p-sortIcon>
                        </th>
                        <th></th>

                      </tr>
                                                 <tr>
                         <th>
        <input
          type="text"
          pInputText
          placeholder="Filter ID"
          
          class="form-control w-70"
        
          (input)="filterTable($event, 'clauseShortDescription', productClauseTable)"
        />
      </th>
      <th>
        <input
          type="text"
          pInputText
          placeholder="Filter heading"
          class="form-control w-70"
          (input)="filterTable($event, 'clauseHeading', productClauseTable)"
        />
      </th>
       <th>
        <input
          type="text"
          pInputText
          placeholder="Filter wording"
          class="form-control w-70"
          (input)="filterTable($event, 'clause', productClauseTable)"
        />
      </th>
     
      
      <th></th>
                    </tr>

                    </ng-template>

                    <ng-template pTemplate="body" let-data let-columns="columns" >
                      
                      <tr>

                        <td>{{ data.clauseShortDescription}}</td>
                        <td>{{ data.clauseHeading | sentenceCase }}</td>
                        <td style="
                            white-space: nowrap;
                            overflow: hidden;
                            text-overflow: ellipsis;
                            max-width: 300px;
                            overflow-y: auto;
                          ">
                          {{ data.clause | sentenceCase }}
                        </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">

                      <tr>
                        <td colspan="5" class="text-center text-muted py-3">
                          “No product clauses available.”
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>

                <!-- Add tax modal -->

                <div *ngIf="showTaxModal" class="modal fade show d-block" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                    <div class="modal-content">
                      <!-- Modal Header -->
                      <div class="modal-header d-flex align-items-center no-border-header">
                        <h5 class="modal-title text-primary">Add tax</h5>
                        <button type="button" class="btn-close ms-auto" aria-label="Close"
                          (click)="closeTaxModal()"></button>
                      </div>

                      <!-- Modal Body -->
                      <div class="modal-body">
                        <form [formGroup]="taxForm">
                          <div class="row">
                            <div class="col-md-6 mb-3">
                              <label>Tax</label>
                              <div class="position-relative" *ngIf="taxTypes && taxTypes.length">
                                <input type="text" class="form-control form-control-sm"
                                  [value]="taxForm.get('rateDescription')?.value" readonly />
                                <div *ngIf="taxForm.get('tax')?.touched && taxForm.get('tax')?.invalid"
                                  class="text-danger small">
                                  Tax is required.
                                </div>

                              </div>

                            </div>

                            <div class="col-md-6 mb-3">
                              <label>Tax type</label>
                              <p-dropdown formControlName="taxType" [options]="taxTypes" optionLabel="label"
                                optionValue="value" placeholder="Select tax type"
                                class="w-100 p-inputtext-sm slim-dropdown" [showClear]="true" [filter]="true">
                              </p-dropdown>
                              <div *ngIf="taxForm.get('taxType')?.touched && taxForm.get('taxType')?.invalid"
                                class="text-danger small">
                                Tax type is required.
                              </div>
                            </div>

                            <div class="col-md-6 mb-3">
                              <label>Transaction type</label>
                              <p-dropdown formControlName="transactionType" [options]="transactionTypes"
                                optionLabel="description" optionValue="code" placeholder=""
                                class="w-100 p-inputtext-sm slim-dropdown" [showClear]="true" [filter]="true"
                                filterBy="description">
                              </p-dropdown>
                              <div
                                *ngIf="taxForm.get('transactionType')?.touched && taxForm.get('transactionType')?.invalid"
                                class="text-danger small">
                                Transaction type is required.
                              </div>

                            </div>

                            <div class="col-md-6 mb-3">
                              <label>Computation level</label><br />
                              <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" formControlName="computationLevel"
                                  value="Policy" />
                                <label class="form-check-label">Policy</label>
                              </div>
                              <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" formControlName="computationLevel"
                                  value="Risk" />
                                <label class="form-check-label">Risk</label>
                              </div>
                              <div
                                *ngIf="taxForm.get('computationLevel')?.touched && taxForm.get('computationLevel')?.invalid"
                                class="text-danger small">
                                Computation level is required.
                              </div>
                            </div>

                            <div class="col-md-6 mb-3">
                              <label>Tax</label><br />
                              <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" formControlName="taxMode" value="Rate" />
                                <label class="form-check-label">Rate</label>
                              </div>
                              <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" formControlName="taxMode" value="Amount" />
                                <label class="form-check-label">Amount</label>
                              </div>
                              <div *ngIf="taxForm.get('taxMode')?.touched && taxForm.get('taxMode')?.invalid"
                                class="text-danger small">
                                Tax mode is required.
                              </div>
                            </div>

                            <div class="col-md-6 mb-3">
                              <label>Tax value</label>
                              <input formControlName="taxValue" type="text" class="form-control form-control-sm" />
                              <div *ngIf="taxForm.get('taxValue')?.touched && taxForm.get('taxValue')?.errors"
                                class="text-danger small">
                                <div *ngIf="taxForm.get('taxValue')?.errors['required']">Tax value is required.</div>
                                <div *ngIf="taxForm.get('taxValue')?.errors['pattern']">Must be a valid number (e.g., 12
                                  or 12.5).</div>
                              </div>
                            </div>

                            <div class="col-md-6 mb-3">
                              <label>Override</label><br />
                              <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" formControlName="override" value="Yes" />
                                <label class="form-check-label">Yes</label>
                              </div>
                              <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" formControlName="override" value="No" />
                                <label class="form-check-label">No</label>
                              </div>
                              <div *ngIf="taxForm.get('override')?.touched && taxForm.get('override')?.invalid"
                                class="text-danger small">
                                Override selection is required.
                              </div>
                            </div>
                          </div>
                        </form>

                      </div>

                      <!-- Modal Footer -->
                      <div class="modal-footer gap-3">
                        <button type="button" class="btn btn-outline-primary" (click)="closeTaxModal()">
                          Cancel
                        </button>
                        <button type="button" class="btn btn-primary" (click)="saveTax()">
                          Save
                        </button>
                      </div>
                    </div>
                  </div>
                </div>


                <!-- Edit Tax Modal -->
                <div *ngIf="showEditTaxModal" class="modal fade show d-block" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                    <div class="modal-content">
                      <!-- Modal Header -->
                      <div class="modal-header">
                        <h5 class="modal-title text-primary">Select tax</h5>
                        <button type="button" class="btn-close" aria-label="Close"
                          (click)="closeEditTaxModal()"></button>
                      </div>

                      <!-- Modal Body -->
                      <div class="modal-body">
                        <p-table [value]="taxes" #selectTaxTable selectionMode="single" [(selection)]="selectedTax"
                          [tableStyle]="{  'width': '100%' }" [rows]="4" [paginator]="true"
                          [rowsPerPageOptions]="[2, 4, 6]" [showCurrentPageReport]="true"
                          currentPageReportTemplate="{first} - {last} of {totalRecords}" class="ui-datatable"
                          responsiveLayout="scroll" [autoLayout]="true" scrollHeight="200px">
                          <ng-template pTemplate="header">
                            <tr>
                              <th class="flexible-header" pSortableColumn="id">
                                ID
                                <p-sortIcon field="id"></p-sortIcon>
                              </th>

                              <th class="flexible-header" pSortableColumn="tax-description">
                                Tax description
                                <p-sortIcon field="tax-description"></p-sortIcon>
                              </th>
                              <th></th>
                              <th></th>

                            </tr>
                                      <tr>
                         <th>
        <input
          type="text"
          pInputText
          placeholder="Filter ID"
          
          class="form-control w-70"
        
          (input)="filterTable($event, 'taxCode', selectTaxTable)"
        />
      </th>
      <th>
        <input
          type="text"
          pInputText
          placeholder="Filter description"
          class="form-control w-70"
          (input)="filterTable($event, 'description', selectTaxTable)"
        />
      </th>
     
      <th></th>
      <th></th>
                    </tr>
                          </ng-template>

                          <ng-template pTemplate="body" let-data >
                           
                            <tr [pSelectableRow]="data">
                              <td>{{ data.taxCode }}</td>

                              <td>{{ data.description | sentenceCase }}</td>
                            </tr>
                          </ng-template>
                        </p-table>
                      </div> <!-- Modal Footer -->
                      <div class="modal-footer gap-3">
                        <button type="button" class="btn btn-outline-primary" (click)="closeEditTaxModal()">
                          Cancel
                        </button>
                        <button type="button" class="btn btn-primary" (click)="handleNextClick()">
                          Next
                        </button>
                      </div>

                    </div>
                  </div>
                </div>

                <!-- TAXES -->
                <div class="tab-pane fade" id="nav-taxes" role="tabpanel" aria-labelledby="nav-taxes" tabindex="0">
                  <p-table [value]="taxDetails" [tableStyle]="{ 'min-width': '50rem' }" class="ui-datatable"
                    responsiveLayout="scroll" [autoLayout]="true" [scrollable]="true" scrollHeight="200px">
                    <ng-template pTemplate="header">
                      <tr>
                        <th pSortableColumn="taxPayer">
                          Tax payer
                          <p-sortIcon field="taxPayer"></p-sortIcon>
                        </th>

                        <th pSortableColumn="rateDescription">
                          Short description
                          <p-sortIcon field="rateDescription"></p-sortIcon>
                        </th>

                        <th pSortableColumn="rateDescription">
                          Tax description
                          <p-sortIcon field="rateDescription"></p-sortIcon>
                        </th>

                        <th pSortableColumn="rate">
                          Rate
                          <p-sortIcon field="rate"></p-sortIcon>
                        </th>

                        <th pSortableColumn="taxAmount">
                          Tax amount
                          <p-sortIcon field="taxAmount"></p-sortIcon>
                        </th>
                        <th pSortableColumn="rateType">
                          Rate type
                          <p-sortIcon field="rateType"></p-sortIcon>
                        </th>
                        <th pSortableColumn="taxType">
                          Tax type
                          <p-sortIcon field="taxType"></p-sortIcon>
                        </th>
                        <th></th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-data>
                      <tr>
                        <td>{{ data.taxPayer }}</td>
                        <td>{{ data.rateDescription }}</td>
                        <td>{{ data.rateDescription }}</td>
                        <td>{{ data.rate }}</td>
                        <td>{{ data.taxAmount }}</td>
                        <td>{{data.rateType}}</td>
                        <td>{{ data.taxType }}</td>
                        <td>
                          <button class="btn btn-sm borderless-button me-2" (click)="openTaxModal(data)">
                            Edit
                          </button>
                          <button class="btn btn-sm borderless-button">
                            Delete
                          </button>
                        </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                      <tr>
                        <td colspan="7" class="text-center text-muted py-3">
                          “No taxes. Click on ‘Add Tax’ to add a new tax.”
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
                <!-- LIMITS -->
                <div class="tab-pane fade" id="nav-limits" role="tabpanel" aria-labelledby="nav-limits" tabindex="0">
                  <div class="row">
                    <div class="col-3">
                      <div>
                        <div class="listing">
                          <p class="subclass-title">
                            {{ "gis.quotation.subclass" | translate }}
                          </p>
                          <ul class="scrollable-list">
                            <li *ngFor="let data of productSubclass" (click)="onSubclassClick(data.code)">
                              {{ data.description | sentenceCase }}
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                    <div class="col-9">
                      <p-table [value]="limitsOfLiabilityList" [tableStyle]="{ 'min-width': '50rem' }"
                        class="ui-datatable" responsiveLayout="scroll" [autoLayout]="true" [scrollable]="true"
                        scrollHeight="200px">
                        <ng-template pTemplate="header">
                          <tr>
                            <th class="flexible-header">
                              {{ "gis.quotation.narration" | translate }}
                            </th>
                            <th class="flexible-header">Scl Desc</th>
                            <th class="flexible-header">
                              {{ "gis.quotation.value" | translate }}
                            </th>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-data>
                          <tr>
                            <td style="
                                white-space: nowrap;
                                overflow: hidden;
                                text-overflow: ellipsis;
                                max-width: 300px;
                                overflow-y: auto;
                              ">
                              {{ data.narration | sentenceCase }}
                            </td>
                            <td>{{ data.subclassCode }}</td>
                            <td>{{ data.value }}</td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </div>
                <!-- SIMILAR QUOTES -->
                <div class="tab-pane fade" id="nav-similarQuotes" role="tabpanel" aria-labelledby="nav-similarities"
                  tabindex="0">
                  <p-table [value]="similarQuotesList" [tableStyle]="{ 'min-width': '50rem' }" class="ui-datatable"
                    responsiveLayout="scroll" [autoLayout]="true" [scrollable]="true" scrollHeight="200px">
                    <ng-template pTemplate="header">
                      <tr>
                        <th class="flexible-header">
                          {{ "gis.quotation.quotation_number" | translate }}
                        </th>
                        <th class="flexible-header">
                          {{ "gis.quotation.client" | translate }}
                        </th>
                        <th class="flexible-header">
                          {{ "gis.quotation.cover_from" | translate }}
                        </th>
                        <th class="flexible-header">
                          {{ "gis.quotation.cover_to" | translate }}
                        </th>
                        <th class="flexible-header">
                          {{ "gis.quotation.branch" | translate }}
                        </th>
                        <th class="flexible-header">
                          {{ "gis.quotation.agent" | translate }}
                        </th>
                        <th class="flexible-header">
                          {{ "gis.quotation.product" | translate }}
                        </th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-data>
                      <tr>
                        <td>{{ data.quotNo }}</td>
                        <td>{{ data.client | sentenceCase }}</td>
                        <td>{{ data.quotCoverFrom }}</td>
                        <td>{{ data.quotCoverTo }}</td>
                        <td>{{ data.branchName | sentenceCase }}</td>
                        <td>{{ data.agentName | sentenceCase }}</td>
                        <td>{{ data.productDesc | sentenceCase }}</td>
                      </tr>
                    </ng-template>

                    <!-- Template for empty data -->
                    <ng-template pTemplate="emptymessage">
                      <tr>
                        <td colspan="7" class="text-center">
                          No similar quotations to display
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Risk Details Card -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="row">
            <div class="col-4">
              <p *ngIf="!isRiskCollapsibleOpen" class="card-title mt-2" style="cursor: pointer;"
                (click)="toggleRiskDetails()">
                Risks
              </p>

            </div>
            <div class="col-8 d-flex justify-content-end">
              <div class="row">
                <div class="col-4" *ngIf="!isRiskCollapsibleOpen">
                  <button type="button" id="icon" class="btn btn-primary p-0.5 px-2.5" (click)="toggleRiskDetails()"
                    [attr.aria-expanded]="isRiskCollapsibleOpen">
                    <i class="fa-solid" [ngClass]="{
    'fa-chevron-down': !isRiskCollapsibleOpen,
    'fa-chevron-up': isRiskCollapsibleOpen
  }"></i>
                  </button>



                </div>
              </div>
            </div>
          </div>

          <div class="mt-4" [ngClass]="{ 'collapse': true, 'show': isRiskCollapsibleOpen }" id="riskDetails">
            <div class="row mb-3">
              <div class="col-4">
                <p class="mt-2 fw-semibold" data-bs-toggle="collapse" data-bs-target="#riskDetails">
                  Risk Details
                </p>
              </div>

              <div class="col-12">
                <div class="d-flex justify-content-between align-items-start w-100">

                 <ul class="nav nav-tabs me-auto"  id="taxTabs" role="tablist">
  <li class="nav-item" role="presentation" *ngFor="let product of products">
    <button
      class="nav-link"
      [class.active]="activeRiskTab === product.code"
      (click)="activeRiskTab = product.code"
      type="button"
    >
      {{ product.productName }}
    </button>
  </li>
</ul>


                  <!-- Toggle button aligned to end -->
                  <button type="button" class="btn btn-primary p-0.5 px-2.5" (click)="toggleRiskDetails()"
                    [attr.aria-expanded]="isRiskCollapsibleOpen">
                    <i class="fa-solid" [ngClass]="{
            'fa-chevron-up': isRiskCollapsibleOpen,
            'fa-chevron-down': !isRiskCollapsibleOpen
          }"></i>
                  </button>
                </div>
              </div>
            </div>



            <p-table [value]="filteredRiskDetails" [tableStyle]="{ 'min-width': '50rem' }" class="ui-datatable"[paginator]="true" [rows]="2" [rowsPerPageOptions]="[2,4,6]" [scrollable]="true" responsiveLayout="scroll"
              styleClass="p-datatable-striped">
              <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="id">Risk ID<p-sortIcon field="id"></p-sortIcon></th>
                  <th pSortableColumn="description">Risk Description<p-sortIcon field="description"></p-sortIcon></th>
                  <th pSortableColumn="subclass">Subclass<p-sortIcon field="subclass"></p-sortIcon></th>
                  <th pSortableColumn="cover-type">Cover type<p-sortIcon field="cover-type"></p-sortIcon></th>
                  <th pSortableColumn="premium-band">Premium band<p-sortIcon field="premium-band"></p-sortIcon></th>
                  <th pSortableColumn="icover-from">Cover from<p-sortIcon field="cover-from"></p-sortIcon></th>
                  <th pSortableColumn="cover-to">Cover to<p-sortIcon field="cover-to"></p-sortIcon></th>
                  <th></th>

                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-data>
                <tr [class.p-highlight]="data === selectedRisk" [pSelectableRow]="riskDetails" class="point"
                  (click)="handleRowClick(data)" [class.disabled]="!data?.code">
                  <td>{{ data?.quotationRiskNo || "-" }}</td>
                  <td>{{ data?.propertyId || "-" }}</td>
                  <td>
                    {{ data?.subclass?.description || "-" | sentenceCase }}
                  </td>
                  <td>
                    {{ data?.coverTypeDescription || "-" | sentenceCase }}
                  </td>
                  <td>
                    {{ data?.sectionsDetails[0]?.limitAmount || 0 | number }}
                  </td>

                  <td>
                    {{ data?.wef}}
                  </td>
                  <td>
                    {{ data?.wet}}
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="7" class="text-center text-muted py-3">
                    “No risks available for this product.”
                  </td>
                </tr>
              </ng-template>


            </p-table>
            <!-- Delete Risk Modal -->
            <div class="modal fade" id="deleteRisk" tabindex="-1" role="dialog" aria-labelledby="deleteRisk"
              aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content" id="deleteRisk">
                  <div class="modal-body">
                    <p class="deleteMessage mt-4 mb-4">
                      {{
                      "gis.policy.are_you_sure_you_want_to_delete" | translate
                      }}
                    </p>
                    <div class="d-flex justify-content-center mb-3">
                      <button type="button" class="btn btn-primary px-5" id="delete" data-bs-dismiss="modal"
                        (click)="deleteRisk()">
                        {{ "gis.policy.yes_delete" | translate }}
                      </button>
                    </div>
                    <div class="d-flex justify-content-center mb-2">
                      <button type="button" class="btn btn-outline-primary px-5" data-bs-dismiss="modal">
                        {{ "gis.policy.no_im_not" | translate }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <br />
            <ul class="nav nav-underline mt-2 mb-4">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" data-bs-toggle="tab"
                  data-bs-target="#nav-sections">Sections</a>
              </li>
              <br />
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-riskClauses">Clauses</a>
              </li>
              <br />
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-schedules">Schedules</a>
              </li>
              <br />
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-excesses">Risk peril</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-excesses">Excess</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-excesses">Comments</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-excesses">Limits of liability</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-excesses">Commissions</a>
              </li>
            </ul>
            <div class="tab-content mb-4" id="nav-tabContent">
              <!-- SECTIONS -->
              <div class="tab-pane fade show active" id="nav-sections" role="tabpanel" aria-labelledby="nav-sections"
                tabindex="0">
                <p-table [value]="sections" [tableStyle]="{ 'min-width': '50rem' }"[paginator]="true" [rows]="2" [rowsPerPageOptions]="[2,4,6]" [scrollable]="true" responsiveLayout="scroll">
                  <ng-template pTemplate="header">
                    <tr>
                      <th pSortableColumn="row-num">Row number<p-sortIcon field="row-num"></p-sortIcon></th>
                      <th class="flexible-header"pSortableColumn="group">Group<p-sortIcon field="group"></p-sortIcon></th>
                      <th class="flexible-header" pSortableColumn="code">Code<p-sortIcon field="code"></p-sortIcon></th>
                      <th class="flexible-header"pSortableColumn="benefit">Benefit<p-sortIcon field="benefit"></p-sortIcon></th>
                      <th class="flexible-header" pSortableColumn="limit-amount">Limit amount<p-sortIcon field="limit-amount"></p-sortIcon></th>
                      <th class=" flexible-header" pSortableColumn="premium-rate">Premium rate<p-sortIcon field="premium-rate"></p-sortIcon></th>
                      <th class="flexible-header" pSortableColumn="rate-type">Rate Type<p-sortIcon field="rate-type"></p-sortIcon></th>
                      <th></th>
                    
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-data>
                    <tr>
                      <td class="flexible-header">
                        {{ data.rowNumber }}
                      </td>
                      <td class="flexible-header">{{ data.calcGroup }}</td>
                      <td class="flexible-header">
                        {{ data.sectionCode }}
                      </td>
                      <td class="flexible-header">{{ data.freeLimit }}</td>
                      <td class="flexible-header">{{ data.limitAmount }}</td>
                      <td class="flexible-header">
                        {{ data.premiumRate| number }}
                      </td>
                      <td class="flexible-header">
                        {{ data.rateType }}
                      </td>
                    
                    </tr>
                  </ng-template>
                   <ng-template pTemplate="emptymessage">
                        <tr>
                        <td colspan="7" class="text-center text-muted py-3">
                           “No sections available for this product.”
                        </td>
                      </tr>
                    </ng-template>
                </p-table>
              </div>
              <!-- RISK CLAUSES -->
              <div class="tab-pane fade" id="nav-riskClauses" role="tabpanel" aria-labelledby="nav-riskClauses"
                tabindex="0">
                <p-table [value]="riskClauses" #riskClausesTable dataKey="code" editMode="row" [tableStyle]="{ 'width': '100%' }"
                [paginator]="true" [rows]="2" [rowsPerPageOptions]="[2,4,6]" [scrollable]="true" responsiveLayout="scroll"
                  responsiveLayout="scroll" class="ui-datatable" [autoLayout]="true">
                  <ng-template pTemplate="header">
                    <tr>
                       <th class="flexible-header1" pSortableColumn="id">
                            ID <p-sortIcon field="id" />
                        </th>
                        <th class="flexible-header1"  pSortableColumn="heading">
                            Heading <p-sortIcon field="heading" />
                        </th>
                        <th class="flexible-header1" pSortableColumn="wording">
                            Wording <p-sortIcon field="wording" />
                        </th>
                        <th></th>
                        <th></th>
                      
                    </tr>
                    <tr>
                         <th>
        <input
          type="text"
          pInputText
          placeholder="Filter ID"
          
          class="form-control w-50"
          (input)="filterTable($event,'clauseCode',riskClausesTable)"
        />
      </th>
      <th>
        <input
          type="text"
          pInputText
          placeholder="Filter Heading"
          class="form-control w-50"
          (input)="filterTable($event,'shortDescription',riskClausesTable)"
        />
      </th>
      <th>
        <input
          type="text"
          pInputText
          placeholder="Filter Wording"
          class="form-control w-50"
          (input)="filterTable($event,'clause',riskClausesTable)"
        />
      </th>
      <th></th>
      <th></th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-selectedClauseList let-editing="editing" let-ri="rowIndex">
                    <tr [pEditableRow]="selectedClauseList">
                      <td>
                        {{ selectedClauseList.clauseCode }}
                      </td>
                      <td>
                        {{
                        selectedClauseList.shortDescription | sentenceCase
                        }}
                      </td>
<td style="
  max-width: 300px;
  max-height: 100px;
  overflow: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
  padding-right: 10px;
">
  <p-cellEditor>
    <ng-template pTemplate="input">
      <input pInputText type="text" [(ngModel)]="selectedClauseList.clause"
        class="form-control form-control-sm" [ngModelOptions]="{ standalone: true }" />
    </ng-template>
    <ng-template pTemplate="output">
      <div style="max-height: 100px; overflow: auto;">
        {{ selectedClauseList.clause }}
      </div>
    </ng-template>
  </p-cellEditor>
</td>

                      
                      <td>
                        <button pButton pRipple type="button" (click)="openHelperModal(selectedClauseList)"
                          icon="pi pi-info-circle" class="p-button-rounded p-button-text" style="margin-left: 40px"></button>
                      </td>
                      <td>{{ selectedClauseList.clauseEditable }}</td>
                    </tr>
                    <!-- Modal for each row -->
                    <p-dialog [(visible)]="selectedClauseList.showHelperModal" [modal]="false"
                      [style]="{ width: '700px' }">
                      <ng-container *ngIf="selectedClauseList">
                        <div pResizable [ngStyle]="{
                            'min-width.px': 200,
                            'min-height.px': 150
                          }" (onResize)="onResize($event)">
                          <p>{{ selectedClauseList.clause }}</p>
                        </div>
                      </ng-container>
                    </p-dialog>
                  </ng-template>
                   <ng-template pTemplate="emptymessage">
                        <tr>
                        <td colspan="4" class="text-center text-muted py-3">
                           “No Clauses available for this product.”
                        </td>
                      </tr>
                    </ng-template>
                </p-table>
              </div>
              <!-- SCHEDULES -->
              <div class="tab-pane fade" id="nav-schedules" role="tabpanel" aria-labelledby="nav-schedules"
                tabindex="0">
                <p-table [value]="schedules" [tableStyle]="{ 'min-width': '50rem' }">
                  <ng-template pTemplate="header">
                    <tr>
                      <th class="flexible-header">Reg no.</th>
                      <th class="flexible-header">Vehicle make</th>
                      <th class="flexible-header">Cubic capacity</th>
                      <th class="flexible-header">Year of manufacture</th>
                      <th class="flexible-header">Seating capacity</th>
                      <th class="flexible-header">Value</th>
                      <th class="flexible-header">Body type</th>
                      <th class="flexible-header">Cover type</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-data>
                    <tr>
                      <td class="flexible-header">
                        {{ data.registrationNumber }}
                      </td>
                      <td class="flexible-header">{{ data.Make }}</td>
                      <td class="flexible-header">{{ data.cubicCapacity }}</td>
                      <td class="flexible-header">
                        {{ data.yearOfManufacture }}
                      </td>
                      <td class="flexible-header">{{ data.carryCapacity }}</td>
                      <td class="flexible-header">{{ data.value }}</td>
                      <td class="flexible-header">{{ data.bodyType }}</td>
                      <td class="flexible-header">{{ data.coverType }}</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
              <!-- EXCESSES -->
              <div class="tab-pane fade" id="nav-excesses" role="tabpanel" aria-labelledby="nav-excesses" tabindex="0">
                <p-table [value]="excessesList" [tableStyle]="{ 'min-width': '50rem' }">
                  <ng-template pTemplate="header">
                    <tr>
                      <th>Narration</th>
                      <th>Value</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-data>
                    <tr>
                      <td>{{ data.description }}</td>
                      <td>{{ data.excess }}</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Reassign quote Modal 1 (re assign)-->
      <div class="modal fade" id="reassignQuotationModal" #reassignQuotationModal tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" style="min-width: 200px">
          <div class="modal-content ps-4 pt-2 pb-5 pe-4">
            <div class="d-flex justify-content-between align-items-center rounded-3 mb-2 p-0">
              <p class="modal-title" style="color: #00529b; font-weight: 600; font-size: 20px">
                Reassign task
              </p>
              <button type="button" data-bs-dismiss="modal" class="btn p-0 text-danger fw-bold" style="border: none">
                X
              </button>
            </div>

            <div class="w-75 mb-3 mt-2">
              <p style="color: #000000">Group User</p>
              <p-dropdown [options]="clientOptions" [(ngModel)]="clientToReassignQuotation"
                placeholder="Select a client" [showClear]="true" styleClass="w-full">
              </p-dropdown>
            </div>

            <div class="w-75">
              <p style="color: #000000">Default User</p>
              <input pInputText type="text" style="color: #000000" class="form-control"
                (click)="openChooseClientReassignModal()" [(ngModel)]="clientToReassignQuotation" />
            </div>

            <div class="w-75 mt-4 mb-3">
              <p style="color: #000000">Comments</p>
              <textarea name="reassignProduct" style="color: #000000" class="form-control" style="height: 70px"
                [(ngModel)]="reassignQuotationComment"></textarea>
            </div>

            <small class="text-danger block" [class.invisible]="!noCommentleft">
              Please leave a comment before reassigning
            </small>

            <small class="text-danger block" [class.invisible]="!noUserChosen">
              Please select a person to reassign before continuing
            </small>

            <div class="w-full d-flex flex-row-reverse gap-4 mt-2">
              <button type="button" class="btn" style="
                  background-color: #00529b;
                  color: white;
                  text-decoration: none;
                " (click)="reassignQuotation()">
                {{ "gis.quotation.reassign" | translate }}
              </button>
              <button type="button" (click)="closeReassignQuotationModal()" class="btn btn-outline-primary"
                style="text-decoration: none">
                {{ "gis.quotation.cancel" | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- reassign quote modal 2 (choose user)-->
      <div class="modal fade" id="chooseClientReassignModal" #chooseClientReassignModal tabindex="-1"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" style="min-width: 500px">
          <div class="modal-content ps-4 pt-2 pe-4">
            <div class="d-flex justify-content-between align-items-center rounded-3 mb-1 p-1">
              <p class="modal-title" style="color: #00529b; font-weight: 600; font-size: 20px">
                {{ "gis.quotation.reassign_task" | translate }}
              </p>
              <button type="button" (click)="closeChooseClientReassignModal()" class="btn p-0 text-danger fw-bold"
                style="border: none">
                X
              </button>
            </div>
            <div class="row mt-2">
              <p-table #dt [value]="users" [rows]="3" [paginator]="true" [globalFilterFields]="['id', 'name']"
                selectionMode="single" [(selection)]="selectedUser" styleClass="p-datatable-striped"
                (onRowSelect)="onUserSelect()" (onRowUnselect)="onUserUnselect()">
                <ng-template pTemplate="header">
                  <tr>
                    <th>User ID</th>
                    <th>Full Name</th>
                  </tr>
                  <tr styleClass="p-striped">
                    <th>
                      <input type="text" [(ngModel)]="globalSearch" (input)="filterGlobal($event)" />
                    </th>
                    <th>
                      <input type="text" [(ngModel)]="fullNameSearch" (input)="filterByFullName($event)" />
                    </th>
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-user>
                  <tr [pSelectableRow]="user">
                    <td>{{ user.id }}</td>
                    <td>{{ user.name }}</td>
                  </tr>
                </ng-template>

                <!-- empty/search states -->
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="4" style="text-align: center; padding: 20px">
                      <div style="color: #6c757d; font-size: 15px">
                        <ng-container *ngIf="users.length === 0">
                          No users available.
                        </ng-container>
                        <ng-container *ngIf="users.length > 0">
                          No user found matching your search
                        </ng-container>
                      </div>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>

            <hr class="mt-1" style="border: none; border-top: 2.5px solid #0000004d" />
            <small class="text-danger block" [class.invisible]="!noUserChosen">
              Please select a person to reassign before continuing
            </small>

            <div class="d-flex flex-row-reverse gap-3 align-items-center rounded-3 mb-2 mt-2 p-0">
              <button type="button" class="btn" style="
                  background-color: #00529b;
                  color: white;
                  text-decoration: none;
                " (click)="selectClient()">
                {{ "gis.quotation.reassign" | translate }}
              </button>
              <button type="button" (click)="closeChooseClientReassignModal()" class="btn btn-outline-primary"
                style="text-decoration: none">
                {{ "gis.quotation.cancel" | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- reject quote modal -->
      <div class="modal fade" id="rejectQuote" #rejectQuotationModal tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" style="min-width:400px">
          <div class="modal-content ps-4 pt-2 pe-4">
            <div class="d-flex justify-content-between align-items-center rounded-3 mb-1">
              <p class="modal-title fw-bold ms-0">{{ 'gis.quotation.reject_quote' | translate }}</p>
              <button type="button" data-bs-dismiss="modal" class="btn p-1 text-danger fw-bold" style="border: none;">X
              </button>
            </div>
            <p class="text-dark mb-3">Are you sure you want to reject this quote? </p>

            <p [class.invisible]="!noComment" class="text-danger">Comment is required</p>

            <label class="text-dark mt-0" for="comment">Comment</label>
            <textarea rows="3" cols="25" pInputTextarea [(ngModel)]="rejectComment">

            </textarea>

            <div class="d-flex flex-row-reverse gap-3 align-items-center rounded-3 my-3 p-0">
              <button type="button" data-bs-dismiss="modal" class="btn btn-outline-primary"
                style="text-decoration: none;">{{
                'gis.quotation.cancel' | translate
                }}
              </button>
              <button type="button" class="btn" style="background-color: #00529B;color:white;text-decoration: none;"
                (click)="rejectQuotation(quotationDetails.code)">{{
                'gis.quotation.save_changes' |
                translate
                }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="mb-5">
        <button type="button" class="btn btn-outline-primary mx-2" (click)="openReassignQuotationModal()"
          [disabled]="afterRejectQuote">
          {{ "gis.quotation.reassign" | translate }}
        </button>

        <button type="button" class="btn btn-outline-primary" (click)="openRejectQuotationModal()"
          [disabled]="afterRejectQuote">
          {{'gis.quotation.reject' | translate}}
        </button>
      </div>


    </div>

    <!-- quotation other details -->
    <div class="tab-pane fade" id="nav-quotation-other-details" role="tabpanel" aria-labelledby="nav-authorization-tab"
      tabindex="0">

      <app-quotation-other-details></app-quotation-other-details>

    </div>

    <!-- quotation report  -->
    <div class="tab-pane fade" id="nav-reports" role="tabpanel" aria-labelledby="nav-authorization-tab" tabindex="0">
      <app-quotation-report></app-quotation-report>

    </div>



  </div>
</div>