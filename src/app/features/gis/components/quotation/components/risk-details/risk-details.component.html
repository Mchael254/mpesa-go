<!-- RISK DETAILS CARD -->
<div class="card  mb-3 border-0 ">
    <div class="card-body border-0 mx-4" style="padding-top: 0px;">

        <p-table [value]="riskDetails" [tableStyle]="{'min-width': '300px'}" selectionMode="single" dataKey="code"
            [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5, 10, 20, 50]">
            <ng-template pTemplate="header">
                <tr>
                    <th class="flexible-header">{{'gis.quotation.risk_id' | translate}}</th>
                    <th class="flexible-header"> {{'gis.quotation.risk_description' | translate}}</th>
                    <th class="flexible-header"> {{'gis.quotation.subclass' | translate}}</th>
                    <th class="flexible-header">{{'gis.quotation.cover_type' | translate}}</th>
                    <th class="flexible-header">{{'gis.quotation.premium_band' | translate}}</th>
                    <th class="flexible-header"> {{'gis.quotation.cover_from' | translate}}</th>
                    <th class="flexible-header">{{'gis.quotation.cover_to' | translate}}</th>
                    <th class="flexible-header"></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-ri="rowIndex" let-risk>
                <tr [class.p-highlight]="risk === selectedRisk" [pSelectableRow]="riskDetails" class="point"
                    (click)="handleRowClick(risk)">
                    <td class="flexible-header">{{risk.propertyId}}</td>
                    <td class="flexible-header">{{risk.itemDesc}}</td>
                    <td class="flexible-header">{{risk.subclass.description
                        |sentenceCase}}</td>
                    <td class="flexible-header">{{risk.coverTypeDescription |sentenceCase}}</td>
                    <td class="flexible-header">{{risk.binderCode}}</td>
                    <td class="flexible-header">{{risk.wef}}</td>
                    <td class="flexible-header">{{risk.wet}}</td>
                    <td class="flexible-header">
                        <!-- Edit Button -->
                        <button pButton pRipple type="button"
                            class="p-button-text p-button-sm p-button-info custom-button p-text-bold"
                            tooltipPosition="top" (click)="openEditRiskModal(risk)">
                            Edit
                        </button>

                        <!-- Delete Button -->
                        <button pButton pRipple type="button"
                            class="p-button-text p-button-sm custom-button p-text-bold" tooltipPosition="top"
                            data-bs-toggle="modal" data-bs-target="#deleteRisk">
                            Delete
                        </button>
                    </td>

                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="8" style="padding: 20px; text-align:center" id="empty">
                        No risk Click on + icon to add risk</td>
                </tr>
            </ng-template>
        </p-table>
        <!-- Add/edit Risk  Modal -->
        <div class="modal fade" id="addRisk" #addRiskModal tabindex="-1" role="dialog" aria-labelledby="addRiskLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 700px;">
                <div class="modal-content" style="max-height: 704px; overflow: hidden;min-height: 250px;">

                    <div class="modal-body" style="height: 100%; max-height: 500px; overflow-y: auto;">
                        <h5 *ngIf="!isEditMode" class="modal-title mt-2 mb-2 addRiskTitle ">Add risk
                            <button type="button" class="btn-close red-close float-end" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </h5>

                        <h5 *ngIf="isEditMode" class="modal-title mt-2 mb-2 addRiskTitle ">Edit risk
                            <button type="button" class="btn-close red-close float-end" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </h5>
                        <form [formGroup]="riskDetailsForm">
                            <div class="row ">
                                <ng-container *ngFor="let field of formData; let i = index">
                                    <div class="col-sm-6 col-6 mb-4">
                                        <div class="form-group form-group-sm">
                                            <label *ngIf="field.name" [attr.for]="i + field.name" id="quote-label"
                                                [ngClass]="{ 'required': field.isMandatory === 'Y' }">
                                                {{ field.label | translate }}
                                            </label>

                                            <!-- text input -->
                                            <input *ngIf="field.type === 'text'" type="text" class="form-control"
                                                [formControlName]="field.name"
                                                [attr.placeholder]="field.label | translate" />

                                            <!-- select -->

                                            <ng-container
                                                *ngIf="field.name !== 'insureds' && riskDetailsForm && riskDetailsForm.contains(field.name)">
                                                <p-dropdown *ngIf="field.type === 'select'"
                                                    [formControlName]="field.name" [options]="field.selectOptions"
                                                    optionLabel="label" optionValue="value" [filter]="true"
                                                    [showClear]="true" [attr.placeholder]="field.label | translate"
                                                    (onChange)="field.name === 'subclass' && onSubclassSelected($event)">
                                                </p-dropdown>
                                            </ng-container>
                                            <!-- INSURED -->
                                            <ng-container *ngIf="field.name === 'insureds' && clientsData?.length">
                                                <p-dropdown formControlName="insureds" [options]="clientsData"
                                                    optionLabel="clientFullName" optionValue="id"
                                                    placeholder="Select Insured" [filter]="true"
                                                    filterBy="clientFullName">
                                                </p-dropdown>
                                            </ng-container>

                                            <!-- date -->
                                            <p-calendar *ngIf="field.type === 'date'" [formControlName]="field.name"
                                                dateFormat="yy-mm-dd" [showIcon]="true"
                                                [attr.placeholder]="field.label | translate">
                                            </p-calendar>

                                            <!-- number -->
                                            <input *ngIf="field.type === 'number'" type="text" class="form-control"
                                                [formControlName]="field.name"
                                                [attr.placeholder]="field.label | translate" />

                                            <!-- currency -->
                                            <input *ngIf="field.type === 'currency'" type="text" class="form-control"
                                                currencyMask [options]="currencyObj" [formControlName]="field.name"
                                                [attr.placeholder]="field.label | translate" />

                                            <!-- validation -->
                                            <div *ngIf="
                                                riskDetailsForm.get(field.name)?.invalid &&
                                                riskDetailsForm.get(field.name)?.touched"
                                                class="text-danger small mt-1">
                                                {{ field.label | translate }} is required.
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>

                                <!-- dynamic subclass fields -->
                                <ng-container *ngFor="let field of subclassFormData; let j = index">
                                    <div class="col-sm-6 col-6 mb-4">
                                        <div class="form-group form-group-sm">
                                            <label *ngIf="field.name" [attr.for]="j + field.name" id="quote-label"
                                                [ngClass]="{ required: field.isMandatory === 'Y' }">
                                                {{ field.label | translate }}
                                            </label>

                                            <!-- text input fields -->
                                            <ng-container
                                                *ngIf="field.name !== 'registrationNumber' && field.name !== 'riskDescription' && riskDetailsForm && riskDetailsForm.contains(field.name)">
                                                <input *ngIf="field.type === 'text'" type="text" class="form-control"
                                                    [formControlName]="field.name"
                                                    [attr.placeholder]="field.label | translate" />
                                            </ng-container>

                                            <ng-container *ngIf="field.name === 'registrationNumber'">
                                                <input type="text" id="quote-input"
                                                    class="form-control form-control-sm mb-1"
                                                    formControlName="registrationNumber"
                                                    (input)="riskIdPassed($event); transformToUpperCase($event)"
                                                    placeholder="KAA 123X">
                                            </ng-container>
                                            <ng-container *ngIf="field.name === 'riskDescription'">
                                                <input type="text" id="quote-input"
                                                    class="form-control form-control-sm mb-1 bg-light text-muted"
                                                    formControlName="riskDescription" [readonly]="true"
                                                    [value]="vehiclemakeModel">

                                            </ng-container>

                                            <!-- select fields -->
                                            <ng-container
                                                *ngIf="field.name !== 'yearOfManufacture' && riskDetailsForm && riskDetailsForm.contains(field.name)">
                                                <p-dropdown *ngIf="field.type === 'select'"
                                                    [formControlName]="field.name" [options]="field.selectOptions"
                                                    optionLabel="label" optionValue="value" [filter]="true"
                                                    [showClear]="true" [attr.placeholder]="field.label | translate"
                                                    (onChange)="handleSelectChange(field.name, $event)">
                                                </p-dropdown>
                                            </ng-container>
                                            <!-- YEAR OF MANUFACTURE -->
                                            <ng-container *ngIf="field.name === 'yearOfManufacture'">
                                                <p-dropdown formControlName="yearOfManufacture" [options]="yearList"
                                                    placeholder="" [filter]="true">
                                                </p-dropdown>

                                            </ng-container>

                                            <!-- DATE -->
                                            <p-calendar *ngIf="field.type === 'date'" [formControlName]="field.name"
                                                dateFormat="yy-mm-dd" [showIcon]="true"
                                                [attr.placeholder]="field.label | translate">
                                            </p-calendar>

                                            <!-- number -->
                                            <input *ngIf="field.type === 'number'" type="text" class="form-control"
                                                [formControlName]="field.name"
                                                [attr.placeholder]="field.label | translate" />

                                            <!-- currency -->
                                            <input *ngIf="field.type === 'currency'" type="text" class="form-control"
                                                currencyMask [options]="currencyObj" [formControlName]="field.name"
                                                [attr.placeholder]="field.label | translate" />
                                            <div *ngIf="riskDetailsForm.get(field.name)?.touched && riskDetailsForm.get(field.name)?.errors as errors"
                                                class="text-danger small mt-1">

                                                <div *ngIf="errors['required']">
                                                    {{ field.label | translate }} is required.
                                                </div>

                                                <div *ngIf="errors['pattern']">
                                                    {{ field.label | translate }} format is invalid.
                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                        </form>


                        <div class="mt-4 d-flex justify-content-end">
                            <button type="button" class="btn btn-outline-primary mx-2" id="saveDetails"
                                data-bs-dismiss="modal" (click)="clearRiskForm()">{{'gis.policy.cancel' |
                                translate}}</button>
                            <button *ngIf="!isEditMode" type="button" class="btn btn-primary " id="saveDetails"
                                (click)="createRiskDetail()">Save</button>
                            <button *ngIf="isEditMode" type="button" class="btn btn-primary " id="saveDetails"
                                (click)="UpdateRiskDetail()">Save changes</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- Delete Risk Modal -->
        <div class="modal fade" id="deleteRisk" tabindex="-1" role="dialog" aria-labelledby="deleteProduct"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content" id="deleteProduct">
                    <div class="modal-body ">
                        <p class="deleteMessage mt-4 mb-4">{{'gis.policy.are_you_sure_you_want_to_delete' |
                            translate}}</p>
                        <div class="d-flex justify-content-center mb-3">
                            <button type="button" class="btn btn-primary px-5" id="delete" data-bs-dismiss="modal"
                                (click)="deleteRisk()">{{'gis.policy.yes_delete'
                                | translate}}</button>
                        </div>
                        <div class="d-flex justify-content-center mb-2">
                            <button type="button" class="btn btn-outline-primary px-5"
                                data-bs-dismiss="modal">{{'gis.policy.no_im_not' | translate}}</button>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- SCHEDULE DETAILS CARD -->
<div class="card  mb-3">
    <div class="card-body my-4 mx-4">

        <!-- TABS -->
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <div class="nav-tabs-wrapper overflow-auto flex-grow-1 me-3">
                <ul class="nav nav-tabs flex-nowrap mb-0" style="min-width: max-content;">
                    <li class="nav-item" *ngFor="let tab of scheduleTabs">
                        <a class="nav-link" [ngClass]="{ 'active-tab': activeTab?.levelNumber === tab.levelNumber }"
                            (click)="activeTab = tab">
                            {{ tab.levelName | sentenceCase }}
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- ACTIVE TAB CONTEXT -->
        <div *ngIf="activeTab as tab">
            <!-- ADD BUTTON for level > 1 -->
            <div class="d-flex justify-content-end my-2" *ngIf="tab.levelNumber !== 1">
                <button class="btn btn-sm btn-primary" (click)="onAddOtherSchedule(tab)">
                    Add {{ tab.levelName | sentenceCase }}
                </button>
            </div>

            <!-- TABLE -->
            <div *ngIf="levelTableColumnsMap[tab.levelName]">
                <p-table [columns]="levelTableColumnsMap[tab.levelName]" [value]="levelDataMap[tab.levelName] || []"
                    selectionMode="single" [(selection)]="selectedSchedule" dataKey="code">
                    <!-- Header -->
                    <ng-template pTemplate="header" let-columns>
                        <tr>
                            <th *ngFor="let col of columns" class="flexible-header">
                                {{ col.header }}
                            </th>
                        </tr>
                    </ng-template>

                    <!-- Body -->
                    <ng-template pTemplate="body" let-row let-columns="columns">
                        <tr (click)="onSelectSchedule(row?.__originalSchedule)" [pEditableRow]="row"
                            [class.p-highlight]="row?.__originalSchedule === selectedSchedule">
                            <td *ngFor="let col of columns" class="flexible-header">
                                <!-- Actions Column -->
                                <ng-container *ngIf="col.field === 'actions'; else defaultCell">
                                    <button pButton pRipple type="button"
                                        class="p-button-text p-button-sm p-button-info custom-button" tooltip="Edit"
                                        (click)="editOtherDetails(tab)">
                                        Edit
                                    </button>

                                    <button pButton pRipple type="button"
                                        class="p-button-text p-button-sm custom-button" data-bs-toggle="modal"
                                        data-bs-target="#deleteSchedule" tooltip="Delete"
                                        (click)="getLevelName(tab.levelNumber)">
                                        Delete
                                    </button>
                                </ng-container>

                                <!-- Default Cell Content -->
                                <ng-template #defaultCell>
                                    {{ row[col.field] }}
                                </ng-template>
                            </td>
                        </tr>
                    </ng-template>

                    <!-- Empty Message -->
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td [attr.colspan]="levelTableColumnsMap[tab.levelName]?.length || 1" class="text-center">
                                No schedule. Click on + icon to add schedule.
                            </td>
                        </tr>
                    </ng-template>
                </p-table>

            </div>
        </div>

        <div class="modal fade" id="addOtherDetailsModal" #addotherScheduleModal tabindex="-1"
            aria-labelledby="addOtherDetailsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content mx-4 " style=" max-width:700px;">
                    <form [formGroup]="scheduleOtherDetailsForm">


                        <div class="modal-body">
                            <h5 class="modal-title mt-2 mb-4 ">Add {{ activeModalTab?.levelName |
                                sentenceCase }}

                                <button type="button" class="btn-close red-close float-end" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </h5>
                            <div class="row">
                                <ng-container *ngFor="let field of activeFormFields; let i = index">
                                    <div class="col-sm-6 mb-4">
                                        <div class="form-group">
                                            <label *ngIf="field.name" [attr.for]="i + field.name" class="form-label"
                                                [ngClass]="{ 'required': field.isMandatory === 'Y' }">
                                                {{ field.label | translate }}
                                            </label>
                                            <ng-container *ngIf="field.name === 'authorisedDriver'">
                                                <input type="text" id="quote-input"
                                                    class="form-control form-control-sm mb-1 bg-light text-muted"
                                                    formControlName="authorisedDriver" [value]="clientName">

                                            </ng-container>
                                            <!-- Text -->
                                            <input *ngIf="field.name !== 'authorisedDriver' && field.type === 'text'"
                                                type="text" class="form-control" [formControlName]="field.name" />

                                            <!-- Select -->
                                            <ng-container *ngIf=" scheduleOtherDetailsForm?.contains(field.name)">
                                                <p-dropdown *ngIf="field.type === 'select'"
                                                    [formControlName]="field.name" [options]="field.selectOptions"
                                                    optionLabel="label" optionValue="value" [filter]="true"
                                                    [showClear]="true">
                                                </p-dropdown>
                                            </ng-container>



                                            <!-- Date -->
                                            <p-calendar *ngIf="field.type === 'date'" [formControlName]="field.name"
                                                dateFormat="yy-mm-dd" [showIcon]="true">
                                            </p-calendar>

                                            <!-- Number -->
                                            <input *ngIf="field.type === 'number'" type="number" class="form-control"
                                                [formControlName]="field.name" />

                                            <!-- Currency -->
                                            <input *ngIf="field.type === 'currency'" type="text" class="form-control"
                                                currencyMask [options]="currencyObj" [formControlName]="field.name" />

                                            <!-- Validation error -->
                                            <div *ngIf="riskDetailsForm.get(field.name)?.invalid && riskDetailsForm.get(field.name)?.touched"
                                                class="text-danger small mt-1">
                                                {{ field.label | translate }} is required.
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                        </div>


                    </form>
                    <div class="mt-4 mb-4 d-flex justify-content-end">
                        <button type="button" class="btn btn-outline-primary mx-2" id="saveDetails"
                            data-bs-dismiss="modal">{{'gis.policy.cancel' |
                            translate}}</button>

                        <button type="button" class="btn btn-primary " id="saveDetails" (click)=onOtherDetailSave()>Save
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Delete Schedule Modal -->
        <div class="modal fade" id="deleteSchedule" tabindex="-1" role="dialog" aria-labelledby="deleteSchedule"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content" id="deleteSchedule">
                    <div class="modal-body ">
                        <p class="deleteMessage mt-4 mb-4">{{'gis.policy.are_you_sure_you_want_to_delete' |
                            translate}}</p>
                        <div class="d-flex justify-content-center mb-3">
                            <button type="button" class="btn btn-primary px-5" id="delete" data-bs-dismiss="modal"
                                (click)="deleteScheduleForLevel()">{{'gis.policy.yes_delete'
                                | translate}}</button>
                        </div>
                        <div class="d-flex justify-content-center mb-2">
                            <button type="button" class="btn btn-outline-primary px-5"
                                data-bs-dismiss="modal">{{'gis.policy.no_im_not' | translate}}</button>
                        </div>


                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<!-- SECTION DETAILS CARD -->
<div class="card mb-3">
    <div class="card-body mx-4">
        <div class="row">
            <div class="col-4 ">
                <p class="section-title "> {{'gis.quotation.section_details' | translate}}</p>
            </div>
            <div class="col-8 d-flex justify-content-end">
                <div class="row">

                    <div class="col-4 ">
                        <button type="button" id="icon" class="btn btn-primary" data-bs-toggle="collapse"
                            data-bs-target="#sectionDetails" aria-expanded="false"
                            [attr.aria-expanded]="isSectionDetailsOpen" (click)="toggleSectionDetails()">
                            <i class="fa-solid"
                                [ngClass]="isSectionDetailsOpen ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                        </button>
                    </div>
                </div>

            </div>
            <!-- ADD SECTION BUTTON ROW -->
            <div class="row mt-3" *ngIf="isSectionDetailsOpen">
                <div class="col-12 d-flex justify-content-end">
                    <button id="openModalButtonAdd" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                        (click)="openAddSectionModal()"> Add Section
                    </button>

                    <i class="pi border border-black p-1 rounded-1 text-black" [ngClass]="{
                   'pi-caret-up': showSections,
                   'pi-caret-down': !showSections
                 }" style="font-size: 15px; cursor: pointer; margin-left: 8px; padding: 4px 6px;"></i>
                    <!-- <i #iconTrigger class="pi border border-black p-1 rounded-1 text-black"
                        [ngClass]="{ 'pi-caret-up': showSections, 'pi-caret-down': !showSections }"
                        style="font-size: 15px; cursor: pointer; margin-left: 8px; padding: 4px 6px;"
                        (click)="toggleSections(iconTrigger)">
                    </i> -->

                </div>
            </div>
        </div>


        <div [@slideInOut]="isSectionDetailsOpen ? 'open' : 'closed'" class="mt-2">

            <!-- Add Risk Section Modal -->

            <div class="modal fade" #addRiskSection Modal id="addSection" tabindex="-1" role="dialog"
                aria-labelledby="addSectionLabel">
                <div class="modal-dialog modal-dialog-centered" style="min-width: 708px;" role="document">
                    <div class="modal-content" id="addSectionModal">
                        <div class="modal-body">
                            <h5 class="modal-title mt-2" id="editOtherDetailsLabel">Add risk section
                                <button type="button" class="btn-close red-close float-end" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </h5>

                            <p-table #sectionTable [value]="sectionPremium" id="clientTable" dataKey="code"
                                [tableStyle]="{ 'max-width': '50rem', 'border-spacing': '10 10px' }"
                                [(selection)]="selectedSections" [resizableColumns]="true" responsiveLayout="scroll"
                                class='ui-datatable' [autoLayout]="true" [paginator]="true" [rows]="5"
                                [rowsPerPageOptions]="[5, 10, 20]" [scrollable]="true" scrollDirection="horizontal"
                                [showCurrentPageReport]="true"
                                currentPageReportTemplate="{first} - {last} of {totalRecords}"
                                [globalFilterFields]="['sectionDescription']">
                                <ng-template pTemplate="header">
                                    <tr>

                                        <th style="width: 2%;">
                                            <input type="checkbox" [(ngModel)]="selectAll"
                                                (change)="toggleSelectAll($event)" />
                                        </th>

                                        <th class="flexible-header" pSortableColumn="sectionDescription"> {{
                                            'gis.quotation.benefit' |
                                            translate }}<p-sortIcon field="benefit" /></th>
                                        <th class="flexible-header" pSortableColumn="free_limit"> {{
                                            'gis.quotation.free_limit' | translate }}<p-sortIcon field="free_limit" />
                                        </th>
                                        <th class="flexible-header" pSortableColumn="limit of amount"> {{
                                            'gis.quotation.limit_amount' | translate }}<p-sortIcon
                                                field="limit of amount" /></th>
                                        <th class="flexible-header" pSortableColumn="rate"> {{ 'gis.quotation.rate' |
                                            translate }} <p-sortIcon field="rate" /></th>

                                    </tr>
                                    <tr>
                                        <td colspan="5" style="padding-left: 50px;">
                                            <input #globalFilterInput class="form-control form-control-sm my-2"
                                                id="search-input-Rsection" pInputText type="text"
                                                (input)="sectionTable.filterGlobal(globalFilterInput.value, 'contains')"
                                                placeholder=""
                                                style="width: 100px; margin-top: 6px; margin-bottom: 6px;" />
                                        </td>
                                    </tr>

                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted py-3">
                                            No sections found matching your search.
                                        </td>
                                    </tr>
                                </ng-template>

                                <ng-template pTemplate="body" let-section let-editing="editing" let-i="rowIndex">
                                    <tr style="height: 40px; padding: 10px; margin-bottom: 10px;">
                                        <td>
                                            <input type="checkbox" id="check_section_{{ section.sectionCode }}"
                                                [(ngModel)]="section.isChecked">
                                        </td>
                                        <td class="flexible-header">{{ section.sectionDescription |sentenceCase }}</td>
                                        <td class="flexible-header">
                                            <ng-container
                                                *ngIf="section.isFreeLimitEditable === 'Y'; else readOnlyFreeLimit">
                                                <input type="text" class="form-control form-control-sm"
                                                    [(ngModel)]="section.freeLimit" [options]="currencyObj"
                                                    currencyMask />
                                            </ng-container>
                                            <ng-template #readOnlyFreeLimit>
                                                {{ section.freeLimit | number }}
                                            </ng-template>
                                        </td>
                                        <td class="flexible-header" [pEditableColumn]="section.limitAmount"
                                            pEditableColumnField="limitAmount">
                                            <input class=" form-control form-control-sm  error-border"
                                                id="section_{{ section.sectionCode }}" [(ngModel)]="section.limitAmount"
                                                [options]="currencyObj" currencyMask type="text"
                                                (keydown)="onKeyUp($event, section)"
                                                [ngClass]="{'error-border': section.isChecked && !section.limitAmount}">
                                        </td>
                                        <td class="flexible-header" [pEditableColumn]="section.rate"
                                            pEditableColumnField="rate">
                                            <input class="form-control form-control-sm  error-border"
                                                id="section_{{ section.sectionCode }}" [(ngModel)]="section.rate"
                                                type="number" (keydown)="onKeyUp($event, section)"
                                                [ngClass]="{'error-border': section.isChecked && !section.rate}">
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                            <div class="mt-4 d-flex justify-content-end ">
                                <button type="button" class="btn btn-outline-primary me-2"
                                    data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary " id="saveDetails" data-bs-dismiss="modal"
                                    (click)="createRiskSection()">{{'gis.quotation.save_details' |
                                    translate}}</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Edit Risk Section Modal -->
            <div class="modal fade  " id="editSectionModal" #editSectionModal tabindex="-1" role="dialog"
                aria-labelledby="editSectionLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                    <div class="modal-content" style=" min-width:700px;">
                        <div class="modal-body" style="padding-left: 40px; max-height:550px; overflow-y: auto;">
                            <h5 class="modal-title mt-2" id="editScheduleLabel">
                                Edit section details
                                <button type="button" class="btn-close red-close float-end"
                                    (click)="closeEditSectionModal()" aria-label="Close"></button>
                            </h5>
                            <form [formGroup]="sectionDetailsForm">
                                <!-- **ROW 1** -->
                                <div class="row mb-1" id="scheduleRows">
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.id'
                                                | translate}} :</label>
                                            <div class="col-7">
                                                <input type="text" id="scheduleInput"
                                                    class="form-control form-control-sm mb-1"
                                                    formControlName="sectionShortDescription" style="width:300px"
                                                    readonly>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.description' | translate}}:</label>
                                            <div class="col-7">
                                                <input type="text" id="scheduleInput"
                                                    class="form-control form-control-sm mb-1" style="width:300px"
                                                    formControlName="sectionShortDescription">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- **ROW 2** -->
                                <div class="row mb-0" id="scheduleRows">
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label" id="scheduleLabel">
                                                {{'gis.quotation.rate_type' | translate}} :</label>
                                            <div class="col-7">
                                                <input type="text" id="scheduleInput"
                                                    class="form-control form-control-sm mb-1" style="width:300px"
                                                    formControlName="rateType">
                                                <!-- <select class="form-select form-control-sm mb-1" id="scheduleInput"
                                                    formControlName="rateType">
                                                    <option value="FXD">{{'gis.quotation.fixed' | translate}}</option>
                                                    <option value="RCU">{{'gis.quotation.recursive' | translate}}
                                                    </option>
                                                    <option value="RT">{{'gis.quotation.rate_table' | translate}}
                                                    </option>
                                                    <option value="ARG"> {{'gis.quotation.absolute_range' | translate}}
                                                    </option>
                                                    <option value="SRG">{{'gis.quotation.step_ranges' | translate}}
                                                    </option>
                                                </select> -->

                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="mb-1">
                                            <label for="minmax-buttons" class="col-5 col-form-label" id="scheduleLabel">
                                                {{ 'gis.quotation.premium_type' | translate }}:
                                            </label>

                                            <div class="col-7">
                                                <div class="col-7">
                                                    <input type="text" id="scheduleInput" style="width:300px"
                                                        class="form-control form-control-sm mb-1"
                                                        formControlName="sectionType">
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                                <!-- **ROW 3** -->
                                <div class="row mb-0" id="scheduleRows">
                                    <div class="col-xl-6">
                                        <div class="mb-1">
                                            <label class="col-5 col-form-label" id="scheduleLabel">
                                                {{ 'gis.quotation.free_limit' | translate }} :
                                            </label>
                                            <div class="col-7">
                                                <ng-container *ngIf="isEditable; else readOnlyInput">
                                                    <!-- Editable number input -->
                                                    <input type="text" class="form-control form-control-sm mb-1"
                                                        formControlName="freeLimit" style="width:300px"
                                                        [value]="freeLimitValue|translate" currencyMask
                                                        [options]="currencyObj" />
                                                </ng-container>

                                                <!-- Read-only number input -->
                                                <ng-template #readOnlyInput>
                                                    <input type="text" class="form-control form-control-sm mb-1"
                                                        [value]="freeLimitValue|translate" currencyMask
                                                        [options]="currencyObj" style="width:300px" readonly />
                                                </ng-template>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.limit_amount' | translate}}:</label>

                                            <div class="col-7">
                                                <input type="text" id="scheduleInput" style="width:300px"
                                                    class="form-control form-control-sm mb-1" currencyMask
                                                    [options]="currencyObj" formControlName="limitAmount">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- **ROW 4** -->
                                <div class="row mb-0" id="scheduleRows">
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.group' | translate}}:</label>
                                            <div class="col-7">
                                                <input type="number" id="scheduleInput" style="width:300px"
                                                    class="form-control form-control-sm mb-1"
                                                    formControlName="calcGroup">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.premium_rate' | translate}}:</label>

                                            <div class="col-7">
                                                <input type="number" id="scheduleInput" style="width:300px"
                                                    class="form-control form-control-sm mb-1"
                                                    formControlName="premiumRate">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- **ROW 5** -->
                                <div class="row mb-0" id="scheduleRows">
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.div_by' | translate}}:</label>
                                            <div class="col-7">
                                                <input type="number" id="scheduleInput" style="width:300px"
                                                    class="form-control form-control-sm mb-1"
                                                    formControlName="multiplierDivisionFactor">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.multi_rate' | translate}} :</label>
                                            <div class="col-7">
                                                <input type="number" id="scheduleInput" style="width:300px"
                                                    class="form-control form-control-sm mb-1"
                                                    formControlName="multiplierRate">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- **ROW 6** -->
                                <div class="row mb-0" id="scheduleRows">
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.div_multi_by' | translate}}:</label>
                                            <div class="col-7">
                                                <input type="number" id="scheduleInput" style="width:300px"
                                                    class="form-control form-control-sm mb-1"
                                                    formControlName="multiplierDivisionFactor">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.premium' | translate}}:</label>
                                            <div class="col-7">
                                                <input type="text" id="scheduleInput" style="width:300px"
                                                    class="form-control form-control-sm mb-1" currencyMask
                                                    [options]="currencyObj" formControlName="premiumAmount">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- **ROW 7** -->
                                <div class="row mb-0" id="scheduleRows">
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label" style="width:300px"
                                                id="scheduleLabel">{{'gis.quotation.minimum_premium' |
                                                translate}}:</label>
                                            <div class="col-7">
                                                <input type="text" id="scheduleInput" style="width:300px"
                                                    class="form-control form-control-sm mb-1" currencyMask
                                                    [options]="currencyObj" formControlName="minimumPremium">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.accumulation' | translate}}:</label>
                                            <div class="col-7">
                                                <input type="text" id="scheduleInput" style="width:300px"
                                                    class="form-control form-control-sm mb-1" formControlName="">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- **ROW 8** -->
                                <div class="row mb-0" id="scheduleRows">
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.remarks' | translate}}:</label>
                                            <div class="col-7">

                                                <textarea type="text" id="scheduleInput"
                                                    class="form-control form-control-sm mb-1" style="width:300px"
                                                    formControlName="description"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.declaration' | translate}}:</label>
                                            <div class="col-7">
                                                <div class="d-flex gap-4">
                                                    <!-- YES option -->
                                                    <div class="d-flex align-items-center" style="cursor: pointer;"
                                                        (click)="setDeclaration1(true)">
                                                        <div class="rounded-circle me-2" [ngStyle]="{
                                                            width: '18px',
                                                            height: '18px',
                                                            backgroundColor: declaration1 === true ? '#198754' : 'transparent',
                                                            border: '2px solid',
                                                            borderColor: declaration1 === true ? '#198754' : '#6c757d'
                                                          }" style="user-select: none; outline: none;" tabindex="-1">
                                                        </div>
                                                        {{ 'gis.policy.yes' | translate }}
                                                    </div>

                                                    <!-- NO option -->
                                                    <div class="d-flex align-items-center" style="cursor: pointer;"
                                                        (click)="setDeclaration1(false)">
                                                        <div class="rounded-circle me-2" [ngStyle]="{
                                                            width: '18px',
                                                            height: '18px',
                                                            backgroundColor: declaration1 === false ? '#dc3545' : 'transparent',
                                                            border: '2px solid',
                                                            borderColor: declaration1 === false ? '#dc3545' : '#6c757d'
                                                          }" style="user-select: none; outline: none;" tabindex="-1">
                                                        </div>
                                                        {{ 'gis.policy.no' | translate }}
                                                    </div>
                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                </div>
                                <!-- **ROW 9** -->
                                <div class="row mb-0" id="scheduleRows">
                                    <div class="col-xl-6">
                                        <div class="mb-1 ">
                                            <label for="minmax-buttons" class="col-5 col-form-label"
                                                id="scheduleLabel">{{'gis.quotation.compute' | translate}}:</label>
                                            <div class="col-7">
                                                <div class="d-flex gap-4">
                                                    <!-- YES option -->
                                                    <div class="d-flex align-items-center" style="cursor: pointer;"
                                                        (click)="setDeclaration2(true)">
                                                        <div class="rounded-circle me-2" [ngStyle]="{
                                                            width: '18px',
                                                            height: '18px',
                                                            backgroundColor: declaration2 === true ? '#198754' : 'transparent',
                                                            border: '2px solid',
                                                            borderColor: declaration2 === true ? '#198754' : '#6c757d'
                                                          }" style="user-select: none; outline: none;" tabindex="-1">
                                                        </div>
                                                        {{ 'gis.policy.yes' | translate }}
                                                    </div>

                                                    <!-- NO option -->
                                                    <div class="d-flex align-items-center" style="cursor: pointer;"
                                                        (click)="setDeclaration2(false)">
                                                        <div class="rounded-circle me-2" [ngStyle]="{
                                                            width: '18px',
                                                            height: '18px',
                                                            backgroundColor: declaration2 === false ? '#dc3545' : 'transparent',
                                                            border: '2px solid',
                                                            borderColor: declaration2 === false ? '#dc3545' : '#6c757d'
                                                          }" style="user-select: none; outline: none;" tabindex="-1">
                                                        </div>
                                                        {{ 'gis.policy.no' | translate }}
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="col-xl-6">

                                    </div>
                                </div>


                            </form>
                            <div class="row mt-3 mb-2">
                                <div class="col-6 ">
                                </div>
                                <div class="col-6 d-flex justify-content-end">
                                    <button type="button" class="btn btn-primary" (click)="closeEditSectionModal()"
                                        style="background-color:#ffffff; color: #00529b;">Cancel</button>
                                    <!-- <button type="button" class="btn btn-primary"  data-bs-dismiss="modal" (click)="updateRiskSection()" >Save Details</button> -->
                                    <button type="button" class="btn btn-primary" (click)="editSection()">
                                        {{'gis.quotation.save_details' | translate}}</button>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Delete Section Modal -->
            <div class="modal fade" id="deleteSection" tabindex="-1" aria-labelledby="deleteSectionLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered ">
                    <div class="modal-content">
                        <div class="modal-header" style="border-bottom: none;">
                            <h5 class="delete-title" id="exampleModalLabel">Delete section</h5>
                            <button type="button" class="btn-close red-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p class="d-flex justify-content-center" id="deleteLabel">
                                {{'gis.quotation.are_you_sure_you_want_to_delete_section' | translate}}?</p>
                            <div class=" d-flex justify-content-center">
                                <button type="button" class="btn btn-primary " id="delete" (click)="confirmDelete()"
                                    data-bs-dismiss="modal">{{'gis.quotation.yes_delete' | translate}}</button>
                            </div><br>
                            <div class="d-flex justify-content-center">
                                <button type="button" class="btn btn-outline-primary" id="delete"
                                    data-bs-dismiss="modal">
                                    {{'gis.quotation.no_im_not' | translate}}</button>
                            </div><br>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Column Selector Modal -->
            <!-- Floating Column Selector -->
            <div *ngIf="showColumnModal" class="card shadow rounded p-2 position-absolute bg-white border"
                [ngStyle]="{ top: columnModalPosition.top, left: columnModalPosition.left, zIndex: 1000 }">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <strong class="text-primary">Select Columns</strong>
                    <button class="btn-close btn-sm" (click)="showColumnModal = false"></button>
                </div>
                <div style="max-height: 250px; overflow-y: auto;">
                    <div *ngFor="let col of columns">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" style="color: #00529B;"
                                [(ngModel)]="col.visible" [id]="col.field">
                            <label class="form-check-label" [for]="col.field">
                                {{ col.header }}
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- <p-table [value]="sectionDetails" [tableStyle]="{ 'min-width': '300px' }" selectionMode="single"
                [(selection)]="selectedSection" dataKey="code" editMode="row" [paginator]="true" [rows]="2"
                [rowsPerPageOptions]="[2, 4, 6]">

               
                <ng-template pTemplate="header">
                    <tr>
                        <th *ngFor="let col of columns" [hidden]="!col.visible" class="flexible-header"
                            [pSortableColumn]="col.field">
                            {{ col.header }}
                            <p-sortIcon [field]="col.field"></p-sortIcon>
                        </th>
                    </tr>
                </ng-template>

               
                <ng-template pTemplate="body" let-section let-rowIndex="rowIndex">
                    <tr (click)="onSelectSection(section)" [pEditableRow]="section">
                        <td *ngFor="let col of columns" [hidden]="!col.visible" class="flexible-header">
                            <ng-container [ngSwitch]="col.field">
                                <ng-container *ngSwitchCase="'actions'">
                                    
                                    <button pButton type="button" class="p-button-text p-button-sm"
                                        (click)="onOpenEditSectionModal(section)">
                                        Edit
                                    </button>
                                   
                                    <button pButton type="button" class="p-button-text p-button-sm text-danger"
                                        (click)="setSectionToDelete(section)" data-bs-toggle="modal"
                                        data-bs-target="#deleteSection">
                                        Delete
                                    </button>
                                </ng-container>
                                <ng-container *ngSwitchDefault>
                                    {{ section[col.field] }}
                                </ng-container>
                            </ng-container>
                        </td>
                    </tr>
                </ng-template>


                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td [attr.colspan]="columns.length" style="padding: 20px; text-align:center">
                            No section. Click on + icon to add section.
                        </td>
                    </tr>
                </ng-template>

            </p-table> -->

            <p-table [value]="sectionDetails" [tableStyle]="{'min-width': '300px'}" selectionMode="single"
                [(selection)]="selectedSection" dataKey="code" editMode="row" [paginator]="true" [rows]="2"
                [rowsPerPageOptions]="[2, 4, 6]">
                <ng-template pTemplate="header">
                    <tr>


                        <th class="flexible-header" pSortableColumn="rowNum">
                            {{ 'gis.quotation.row_num' | translate }}
                            <p-sortIcon field="rowNum" />
                        </th>
                        <th class="flexible-header" pSortableColumn="group">
                            {{ 'gis.quotation.group' | translate }}
                            <p-sortIcon field="group" />
                        </th>

                        <th class="flexible-header" pSortableColumn="shortDescription">
                            {{ 'gis.quotation.code' | translate }}
                            <p-sortIcon field="code" />
                        </th>

                        <th class="flexible-header" pSortableColumn="description">
                            {{ 'gis.quotation.benefit' | translate }}
                            <p-sortIcon field="benefit" />
                        </th>

                        <th class="flexible-header" pSortableColumn="limitAmount">
                            {{ 'gis.quotation.limit_amount' | translate }}
                            <p-sortIcon field="limitAmount" />
                        </th>

                        <th class="flexible-header" pSortableColumn="premiumRate">
                            {{ 'gis.quotation.premium_rate' | translate }}
                            <p-sortIcon field="premiumRate" />
                        </th>

                        <th class="flexible-header" pSortableColumn="rateType">
                            {{ 'gis.quotation.rate_type' | translate }}
                            <p-sortIcon field="rateType" />
                        </th>
                        <th class="flexible-header" pSortableColumn="actions">
                            {{ 'gis.quotation.actions' | translate }}
                            <p-sortIcon field="actions" />
                        </th>


                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-sectionArray let-editing="editing" let-ri="rowIndex">
                    <tr (click)="onSelectSection(sectionArray)" [pEditableRow]="sectionArray">
                        <td class="flexible-header">{{sectionArray.rowNumber}}</td>
                        <td class="flexible-header">{{sectionArray.calcGroup}}</td>
                        <td class="flexible-header">{{sectionArray.sectionCode}}</td>
                        <td class="flexible-header">{{sectionArray.sectionShortDescription |sentenceCase}}</td>
                        <td class="flexible-header">{{sectionArray.limitAmount}}</td>
                        <td class="flexible-header">{{sectionArray.premiumRate}}</td>
                        <td class="flexible-header">{{sectionArray.rateType}}</td>

                        <td class="flexible-header">

                            <button pButton pRipple type="button" pInitEditableRow
                                class="p-button-rounded p-button-text custom-button " pTooltip="" tooltipPosition="top"
                                (click)="onOpenEditSectionModal(sectionArray)">
                                Edit
                            </button>


                            <button pButton pRipple type="button" class="p-button-rounded p-button-text custom-button  "
                                data-bs-toggle="modal" data-bs-target="#deleteSection"
                                (click)="setSectionToDelete(sectionArray)">
                                Delete
                            </button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="8" style="padding: 20px; text-align:center" id="empty">
                            No section Click on + icon to add section</td>
                    </tr>
                </ng-template>

            </p-table>

        </div>
    </div>
</div>
<!-- OTHER RISK DETAILS CARD -->
<div class="card mb-1">
    <div class="card-body mx-4">

        <div class="row mb-2">
            <div class="col-4 clause-title">
                <p class="section-title">{{'gis.quotation.other_risk_details' | translate}}</p>
            </div>

            <div class="col-8 d-flex justify-content-end">
                <button type="button" id="icon" class="btn btn-primary" data-bs-toggle="collapse"
                    data-bs-target="#riskClauses" aria-expanded="false" aria-controls="riskClauses"
                    (click)="toggleClausesopen()">
                    <i class="fa-solid fa-chevron-down"></i>
                </button>
            </div>
        </div>

        <!-- Other risk details action buttons -->
        <div class="row mb-" *ngIf="isClausesOpen">

            <!-- tab buttons -->
            <div class="d-flex justify-content-between align-items-end m-0">
                <div class="d-flex justify-content-between px-1" style="width:60%">
                    <div>
                        <button class="btn btn-sm"
                            [ngClass]="{'no-border-bottom': riskActiveTab === 'riskClauses', 'text-primary border-0': riskActiveTab !== 'riskClauses'}"
                            (click)="setRiskTab('riskClauses')"> {{'gis.quotation.risk_clauses' | translate}}
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-sm"
                            [ngClass]="{'no-border-bottom': riskActiveTab === 'riskLimits', 'text-primary border-0': riskActiveTab !== 'riskLimits'}"
                            (click)="setRiskTab('riskLimits')"> {{'gis.quotation.limits_of_liability' | translate}}
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-sm"
                            [ngClass]="{'no-border-bottom': riskActiveTab === 'riskPerils', 'text-primary border-0': riskActiveTab !== 'riskPerils'}"
                            (click)="setRiskTab('riskPerils')"> {{'gis.quotation.perils' | translate}}
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-sm"
                            [ngClass]="{'no-border-bottom': riskActiveTab === 'riskCommissions', 'text-primary border-0': riskActiveTab !== 'riskCommissions'}"
                            (click)="setRiskTab('riskCommissions')"> {{'gis.quotation.commissions' | translate}}
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-sm"
                            [ngClass]="{'no-border-bottom': riskActiveTab === 'riskExcesses', 'text-primary border-0': riskActiveTab !== 'riskExcesses'}"
                            (click)="setRiskTab('riskExcesses')"> {{'gis.quotation.excesses' | translate}}
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-sm"
                            [ngClass]="{'no-border-bottom': riskActiveTab === 'riskTaxes', 'text-primary border-0': riskActiveTab !== 'riskTaxes'}"
                            (click)="setRiskTab('riskTaxes'); loadTaxDetails()"> Taxes
                        </button>
                    </div>

                </div>

                <!-- action buttons -->
                <div class="d-flex align-items-center ms-2 mb-1">

                    <!-- clause action tabs -->
                    <div *ngIf="riskActiveTab === 'riskClauses'">
                        <button class="btn btn-primary btn-sm mb-1" (click)="openClauseModal()">
                            Add risk Clause
                        </button>

                        <i class="pi border border-black p-1 rounded-1 text-black mb-1" [ngClass]="{
                            'pi-caret-up': showSections,
                            'pi-caret-down': !showSections
                            }" style="font-size: 15px; cursor: pointer; margin-left: 8px; padding: 4px 6px;"></i>
                    </div>

                    <!-- limits action tabs -->
                    <div *ngIf="riskActiveTab === 'riskLimits'">
                        <button class="btn btn-primary btn-sm mb-1" (click)="openLimitModal()">
                            Add risk limit
                        </button>

                        <i class="pi border border-black p-1 rounded-1 text-black mb-1" [ngClass]="{
                            'pi-caret-up': showSections,
                            'pi-caret-down': !showSections
                            }" style="font-size: 15px; cursor: pointer; margin-left: 8px; padding: 4px 6px;"></i>
                    </div>

                    <!-- perils action tabs -->
                    <div *ngIf="riskActiveTab === 'riskPerils'">
                        <button class="btn btn-primary btn-sm mb-1" (click)="openChoosePerilsModal()">
                            Add Perils
                        </button>

                        <i class="pi border border-black p-1 rounded-1 text-black mb-1" [ngClass]="{
                            'pi-caret-up': showSections,
                            'pi-caret-down': !showSections
                            }" style="font-size: 15px; cursor: pointer; margin-left: 8px; padding: 4px 6px;"></i>
                    </div>

                    <!-- excess action tabs -->
                    <div *ngIf="riskActiveTab === 'riskExcesses'">
                        <button class="btn btn-primary btn-sm mb-1" (click)="openExcessModal()">
                            Add risk excess
                        </button>

                        <i class="pi border border-black p-1 rounded-1 text-black mb-1" [ngClass]="{
                            'pi-caret-up': showSections,
                            'pi-caret-down': !showSections
                            }" style="font-size: 15px; cursor: pointer; margin-left: 8px; padding: 4px 6px;"></i>
                    </div>
                    <!-- taxes action tabs -->
                    <div *ngIf="riskActiveTab === 'riskTaxes'">
                        <button class="btn btn-primary btn-sm mb-1" type="button" (click)="handleAddTaxClick()">
                            Add Tax
                        </button>

                        <i class="pi border border-black p-1 rounded-1 text-black mb-1" [ngClass]="{
                            'pi-caret-up': showSections,
                            'pi-caret-down': !showSections
                            }" style="font-size: 15px; cursor: pointer; margin-left: 8px; padding: 4px 6px;"></i>
                    </div>



                </div>
            </div>
        </div>

        <!-- risk clauses -->
        <div *ngIf="riskActiveTab === 'riskClauses'" [@slideInOut]="isClausesOpen ? 'open' : 'closed'"
            class="mt-0 w-100">
            <!-- risk clause table -->
            <p-table #riskClauseTable [value]="sessionClauses" dataKey="code" [paginator]="true" [rows]="3"
                [rowsPerPageOptions]="[3, 5, 10]" [globalFilterFields]="['shortDescription', 'wording', 'heading']"
                [scrollable]="true" scrollDirection="horizontal" responsiveLayout="scroll" class="mt-3"
                [(selection)]="selectedClause" selectionMode="multiple">
                <!-- Table Header -->
                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="narration" class="flexible-header" style="width: 13%">
                            ID <p-sortIcon field="narration" />
                        </th>
                        <th pSortableColumn="value" class="flexible-header" style="width: 20%">
                            Heading <p-sortIcon field="value" />
                        </th>
                        <th pSortableColumn="value" class="flexible-header" style="width: 35%">
                            Wording <p-sortIcon field="value" />
                        </th>
                        <th style="width: 15%">Actions</th>
                    </tr>
                    <tr class="py-2">
                        <td class="px-3"> <!-- Horizontal padding for cells -->
                            <input class="form-control form-control-sm my-1" pInputText #idFilter type="text"
                                (input)="riskClauseTable.filterGlobal(idFilter.value, 'contains')"
                                style="width: 70%;" />
                        </td>
                        <td class="px-3"> <!-- Horizontal padding for cells -->
                            <input class="form-control form-control-sm my-1" pInputText #headingFilter type="text"
                                (input)="riskClauseTable.filterGlobal(headingFilter.value, 'contains')"
                                style="width: 50%;" />
                        </td>
                        <td class="px-3"> <!-- Horizontal padding for cells -->
                            <input class="form-control form-control-sm my-1" pInputText #valueFilter type="text"
                                (input)="riskClauseTable.filterGlobal(valueFilter.value, 'contains')"
                                style="width: 50%;" />
                        </td>
                        <td></td>
                    </tr>
                </ng-template>

                <!-- Table Body -->
                <ng-template pTemplate="body" let-clause>
                    <tr>
                        <td>{{clause.shortDescription}}</td>
                        <td>{{clause.heading | truncate:3 | sentenceCase}}</td>
                        <td class="position-relative ">
                            <div class="clause-wrapper">
                                {{ clause.wording | truncate:5 | sentenceCase}}

                                <div class="hover-card">
                                    {{ clause.wording |sentenceCase }}
                                </div>
                            </div>
                        </td>
                        <td class="flexible-header1" style="text-align: left">
                            <div class="flex justify-start  gap-2">
                                <!-- Edit -->
                                <span class="p-button-label p-text-bold " [ngStyle]="{
                    color: clause.isEditable === 'Y' ? '#00529B' : '#6B7280', 
                   
                    cursor: clause.isEditable === 'Y' ? 'pointer' : 'default',
                    display: 'inline-block',
                    width: '60px'  
                    }" [attr.data-bs-toggle]="clause.isEditable === 'Y' ? 'modal' : null"
                                    [attr.data-bs-target]="clause.isEditable === 'Y' ? '#editClause' : null"
                                    (click)="clause.isEditable === 'Y' && populateEditClauseModal(clause)">
                                    {{ clause.isEditable === 'Y' ? ('gis.quotation.edit' | translate) : '--' }}
                                </span>

                                <!-- Delete -->

                                <span *ngIf="clause.isMandatory === 'N'" class="p-button-label p-text-bold " [ngStyle]="{
                                                        color: '#00529B',
                                                        cursor: 'pointer'
                                                      }" data-bs-toggle="modal" data-bs-target="#deleteClause"
                                    (click)="prepareDeleteClause(clause)">
                                    {{ 'gis.quotation.delete' | translate }}
                                </span>
                            </div>

                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="3" class="text-center p-4 text-muted">
                            <ng-container *ngIf="sessionClauses?.length > 0; else noClauses">
                                <i class="pi pi-search" style="font-size: 2rem; margin-bottom: 10px;"></i>
                                <p>No matching clauses found.</p>
                            </ng-container>
                            <ng-template #noClauses>
                                <p><strong>No clauses available.</strong> There are currently no
                                    clauses to add.</p>
                            </ng-template>
                        </td>
                    </tr>
                </ng-template>

            </p-table>

            <!-- Add risk clause modal -->
            <div class="modal fade" id="addClause" tabindex="-1" role="dialog" aria-labelledby="addSectionLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" style="min-width: 708px;" role="document">
                    <div class="modal-content" id="addSectionModal">
                        <div class="modal-body">
                            <h5 class="modal-title mt-2" id="editOtherDetailsLabel">
                                Add risk clause
                                <button type="button" class="btn-close red-close float-end" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </h5>

                            <ng-container>
                                <p-table #clauseTable [value]="nonMandatoryClauses" dataKey="clauseCode"
                                    [paginator]="true" [rows]="3" [rowsPerPageOptions]="[3, 5, 10]"
                                    [globalFilterFields]="['shortDescription', 'heading']" [scrollable]="true"
                                    scrollDirection="horizontal" responsiveLayout="scroll" class="mt-3"
                                    [(selection)]="selectedRiskClauses" selectionMode="multiple">
                                    <!-- Table Header -->
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="width: 3%"><p-tableHeaderCheckbox /></th>
                                            <th pSortableColumn="id" class="flexible-header">
                                                ID <p-sortIcon field="id" />
                                            </th>
                                            <th pSortableColumn="description" class="flexible-header">
                                                Description <p-sortIcon field="description" />
                                            </th>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td>
                                                <input class="form-control form-control-sm" pInputText #idFilter
                                                    type="text"
                                                    (input)="clauseTable.filterGlobal(idFilter.value, 'contains')"
                                                    style="width: 50%;" />
                                            </td>
                                            <td>
                                                <input class="form-control form-control-sm" pInputText #descFilter
                                                    type="text"
                                                    (input)="clauseTable.filterGlobal(descFilter.value, 'contains')"
                                                    style="width: 50%;" />
                                            </td>
                                        </tr>
                                    </ng-template>

                                    <!-- Table Body -->
                                    <ng-template pTemplate="body" let-clause>
                                        <tr>
                                            <td><p-tableCheckbox [value]="clause" /></td>
                                            <td>{{ clause.shortDescription }}</td>
                                            <td>{{ clause.heading }}</td>
                                        </tr>
                                    </ng-template>

                                    <!-- empty and search -->
                                    <ng-template pTemplate="emptymessage">
                                        <tr>
                                            <td colspan="3" class="text-center p-4 text-muted">
                                                <ng-container *ngIf="nonMandatoryClauses?.length > 0; else noClauses">
                                                    <i class="pi pi-search"
                                                        style="font-size: 2rem; margin-bottom: 10px;"></i>
                                                    <p>No matching clauses found.</p>
                                                </ng-container>
                                                <ng-template #noClauses>
                                                    <p><strong>No clauses available.</strong> There are currently no
                                                        clauses to add.</p>
                                                </ng-template>
                                            </td>
                                        </tr>
                                    </ng-template>
                                </p-table>
                            </ng-container>

                            <!-- Buttons -->
                            <div class="mt-4 d-flex justify-content-end">
                                <button type="button" class="btn btn-outline-primary me-2"
                                    data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" id="saveDetails" data-bs-dismiss="modal"
                                    (click)="addRiskClauses()">
                                    Save
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- edit risk clause modal -->
            <div class="modal fade" id="editClause">
                <div class="modal-dialog modal-dialog-centered" style="min-width:600px">
                    <div class="modal-content ps-4 pt-2 pe-4">
                        <div class="d-flex justify-content-between align-items-center rounded-3 mb-2 p-1">
                            <p class="modal-title" style="color: #00529B; font-weight:600; font-size:20px;">
                                {{ 'gis.quotation.edit_clause' | translate }}</p>
                            <button type="button" data-bs-dismiss="modal" class="btn p-0 text-danger fw-bold"
                                style="border: none;">X
                            </button>
                        </div>

                        <div class="d-flex justify-content-between text-black">
                            <div class="d-flex flex-column bg-gray-300 w-25">
                                <label for="id">ID</label>
                                <input type="text" [value]=" selectedRiskClause.shortDescription" pInputText
                                    style="background-color:rgb(215, 212, 212); width:18vw" readonly>

                            </div>
                            <div class="d-flex flex-column w-50 ">
                                <label for="heading">Heading</label>
                                <input class="bg-gray-300" pInputText
                                    [value]=" selectedRiskClause.heading | truncate:10"
                                    pTooltip="{{  selectedRiskClause.heading }}"
                                    style="background-color:rgb(215, 212, 212); width:20vw; z-index:auto" readonly>
                            </div>
                        </div>

                        <div class="d-flex flex-column mt-5">
                            <label class="text-dark mt-0" for="comment">Wording</label>
                            <textarea rows="5" pTextarea [(ngModel)]=" selectedRiskClause.wording"
                                class="p-inputtextarea w-full" style="border: 1px solid #ced4da;min-height: 130px">
                            </textarea>
                        </div>

                        <div class="d-flex flex-row-reverse gap-3 align-items-center rounded-3 mb-3 mt-5 p-0">
                            <button #closeReassignButton type="button" data-bs-dismiss="modal"
                                style="display: none;"></button>
                            <button type="button" class="btn" data-bs-dismiss="modal"
                                style="background-color: #00529B;color:white;text-decoration: none;"
                                (click)="editRiskClause()" [disabled]="!wasModified()">{{ 'gis.quotation.save_changes' |
                                translate }}
                            </button>
                            <button type="button" data-bs-dismiss="modal" class="btn btn-outline-primary"
                                style="text-decoration: none;">{{
                                'gis.quotation.cancel' | translate
                                }}
                            </button>
                        </div>

                    </div>
                </div>

            </div>

            <!-- delete clause modal -->
            <div class="modal fade" id="deleteClause">
                <div class="modal-dialog modal-dialog-centered" style="min-width:600px">
                    <div class="modal-content ps-4 pt-2 pe-4">
                        <div class="d-flex justify-content-between align-items-center rounded-3 mb-2 p-1">
                            <p class="modal-title" style="color: #00529B; font-weight:600; font-size:20px;">
                                {{ 'gis.quotation.delete_clause' | translate }}</p>
                            <button type="button" data-bs-dismiss="modal" class="btn p-0 text-danger fw-bold"
                                style="border: none;">X
                            </button>
                        </div>

                        <div class="d-flex justify-content-between text-black">
                            <p>Are you sure you want to delete this clause?</p>
                        </div>

                        <div class="d-flex flex-row-reverse gap-3 align-items-center rounded-3 mb-3 mt-5 p-0">
                            <button type="button" class="btn" data-bs-dismiss="modal"
                                style="background-color: #00529B;color:white;text-decoration: none;"
                                (click)="deleteRiskClause()">
                                {{ 'gis.quotation.delete' | translate }}
                            </button>
                            <button type="button" data-bs-dismiss="modal" class="btn btn-outline-primary"
                                style="text-decoration: none;">{{
                                'gis.quotation.cancel' | translate
                                }}
                            </button>
                        </div>

                    </div>
                </div>

            </div>

        </div>

        <!-- limits of liablity -->
        <div *ngIf="riskActiveTab === 'riskLimits'" [@slideInOut]="isClausesOpen ? 'open' : 'closed'"
            class="mt-0 w-100">

            <!-- limits table -->
            <p-table #addedlimitTable [value]="addedLimitsOfLiability" dataKey="code" [paginator]="true" [rows]="3"
                [rowsPerPageOptions]="[3, 5, 10]" [globalFilterFields]="['narration', 'value']" [scrollable]="true"
                scrollDirection="horizontal" responsiveLayout="scroll" class="mt-3">
                <!-- Table Header -->
                <ng-template pTemplate="header">
                    <tr class="mt-2">
                        <th pSortableColumn="narration" class="flexible-header" style="width: 40%">
                            Narration <p-sortIcon field="narration" />
                        </th>
                        <th pSortableColumn="value" class="flexible-header" style="width: 40%">
                            Value <p-sortIcon field="value" />
                        </th>
                        <th style="width: 20%">Actions</th>
                    </tr>
                    <tr class="py-2"> <!-- Vertical padding for row -->
                        <td class="px-3"> <!-- Horizontal padding for cells -->
                            <input class="form-control form-control-sm my-1" pInputText #narrationFilter type="text"
                                (input)="addedlimitTable.filterGlobal(narrationFilter.value, 'contains')"
                                style="width: 70%;" />
                        </td>
                        <td class="px-3"> <!-- Horizontal padding for cells -->
                            <input class="form-control form-control-sm my-1" pInputText #valueFilter type="text"
                                (input)="addedlimitTable.filterGlobal(valueFilter.value, 'contains')"
                                style="width: 50%;" />
                        </td>
                        <td></td>
                    </tr>
                </ng-template>

                <!-- Table Body -->
                <ng-template pTemplate="body" let-limit>
                    <tr>
                        <td class="position-relative ">
                            <div class="clause-wrapper">
                                {{ limit.narration | truncate:5 | sentenceCase}}

                                <div class="hover-card">
                                    {{ limit.narration |sentenceCase }}
                                </div>
                            </div>
                        </td>
                        <td>{{ limit.value }}</td>
                        <td style="width: 15%; text-align: left">
                            <div class="flex justify-start gap-2">
                                <!-- Edit -->
                                <span class="p-button-label p-text-bold"
                                    style="color: #00529B; cursor: pointer; display: inline-block; width: 60px"
                                    data-bs-toggle="modal" data-bs-target="#editLimit"
                                    (click)="populateEditLimitModal(limit)">
                                    {{ 'gis.quotation.edit' | translate }}
                                </span>

                                <!-- Delete -->
                                <span class="p-button-label p-text-bold" style="color: #00529B; cursor: pointer"
                                    data-bs-toggle="modal" data-bs-target="#deleteLimit"
                                    (click)="prepareDeleteLimit(limit)">
                                    {{ 'gis.quotation.delete' | translate }}
                                </span>
                            </div>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="3" class="text-center p-4 text-muted">
                            <ng-container *ngIf="addedLimitsOfLiability?.length > 0; else noClauses">
                                <i class="pi pi-search" style="font-size: 2rem; margin-bottom: 10px;"></i>
                                <p>No matching limits of liability found.</p>
                            </ng-container>
                            <ng-template #noClauses>
                                <p><strong>No limits of liability available.</strong> There are currently no
                                    limits of liability to add.</p>
                            </ng-template>
                        </td>
                    </tr>
                </ng-template>

            </p-table>

            <!-- Add risk limit modal -->
            <div class="modal fade" id="addLimit" tabindex="-1" role="dialog" aria-labelledby="addSectionLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" style="min-width: 708px;" role="document">
                    <div class="modal-content" id="addSectionModal">
                        <div class="modal-body">
                            <h5 class="modal-title mt-2" id="editOtherDetailsLabel">
                                Add limits of liability
                                <button type="button" class="btn-close red-close float-end" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </h5>

                            <ng-container>
                                <p-table #limitTable [value]="limitsOfLiability" dataKey="code" [paginator]="true"
                                    [rows]="3" [rowsPerPageOptions]="[3, 5, 10]"
                                    [globalFilterFields]="['narration', 'value']" [scrollable]="true"
                                    scrollDirection="horizontal" responsiveLayout="scroll" class="mt-3"
                                    [(selection)]="selectedRiskLimits" selectionMode="multiple">
                                    <!-- Table Header -->
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="width: 3%"><p-tableHeaderCheckbox /></th>
                                            <th style="width: 60%" pSortableColumn="narration" class="flexible-header">
                                                Narration <p-sortIcon field="narration" />
                                            </th>
                                            <th style="width: 40%" pSortableColumn="value" class="flexible-header">
                                                Value <p-sortIcon field="value" />
                                            </th>
                                        </tr>
                                        <tr class="mb-1">
                                            <td></td>
                                            <td class="py-2">
                                                <input class="form-control form-control-sm my-1" pInputText
                                                    #narrationFilter type="text"
                                                    (input)="limitTable.filterGlobal(narrationFilter.value, 'contains')"
                                                    style="width: 60%;" />
                                            </td>
                                            <td class="py-2">
                                                <input class="form-control form-control-sm my-1" pInputText #valueFilter
                                                    type="text"
                                                    (input)="limitTable.filterGlobal(valueFilter.value, 'contains')"
                                                    style="width: 60%;" />
                                            </td>
                                        </tr>
                                    </ng-template>

                                    <!-- Table Body -->
                                    <ng-template pTemplate="body" let-limit>
                                        <tr>
                                            <td><p-tableCheckbox [value]="limit" /></td>
                                            <td class="position-relative">
                                                <div class="clause-wrapper">
                                                    {{ limit.narration | truncate:10 | sentenceCase }}

                                                    <div class="hover-card">
                                                        {{ limit.narration | sentenceCase }}
                                                    </div>
                                                </div>
                                            </td>
                                            <td>{{ limit.value }}</td>
                                        </tr>
                                    </ng-template>

                                    <!-- empty table and no search -->
                                    <ng-template pTemplate="emptymessage">
                                        <tr>
                                            <td colspan="3" class="text-center p-4 text-muted">
                                                <ng-container *ngIf="limitsOfLiability?.length > 0; else noClauses">
                                                    <i class="pi pi-search"
                                                        style="font-size: 2rem; margin-bottom: 10px;"></i>
                                                    <p>No matching limits of liability found.</p>
                                                </ng-container>
                                                <ng-template #noClauses>
                                                    <p><strong>No limits of liability available.</strong> There are
                                                        currently no
                                                        limits of liability to add.</p>
                                                </ng-template>
                                            </td>
                                        </tr>
                                    </ng-template>

                                </p-table>

                            </ng-container>

                            <!-- Buttons -->
                            <div class="mt-4 d-flex justify-content-end">
                                <button type="button" class="btn btn-outline-primary me-2"
                                    data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" id="saveDetails" data-bs-dismiss="modal"
                                    (click)="addRiskLimit()">
                                    Save
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- edit risk limit modal -->
            <div class="modal fade" id="editLimit">
                <div class="modal-dialog modal-dialog-centered" style="min-width:600px">
                    <div class="modal-content ps-4 pt-2 pe-4">
                        <div class="d-flex justify-content-between align-items-center rounded-3 mb-2 p-1">
                            <p class="modal-title" style="color: #00529B; font-weight:600; font-size:20px;">
                                {{ 'gis.quotation.edit_limits_of_liability' | translate }}</p>
                            <button type="button" data-bs-dismiss="modal" class="btn p-0 text-danger fw-bold"
                                style="border: none;">X
                            </button>
                        </div>

                        <div class="d-flex justify-content-between text-black">
                            <div class="d-flex flex-column bg-gray-300 w-25">
                                <label for="id">Value</label>
                                <input pInputText type="text" [(ngModel)]="selectedLimit.value">
                            </div>
                        </div>

                        <div class="d-flex flex-column mt-5">
                            <label class="text-dark mt-0" for="comment">Narration</label>
                            <textarea rows="5" cols="30" pTextarea [(ngModel)]="selectedLimit.narration"></textarea>
                        </div>

                        <div class="d-flex flex-row-reverse gap-3 align-items-center rounded-3 mb-3 mt-5 p-0">
                            <button #closeReassignButton type="button" data-bs-dismiss="modal"
                                style="display: none;"></button>
                            <button type="button" class="btn" data-bs-dismiss="modal"
                                style="background-color: #00529B;color:white;text-decoration: none;"
                                (click)="editLimit()" [disabled]="!wasLimitModified()">
                                {{ 'gis.quotation.save_changes' | translate }}
                            </button>
                            <button type="button" data-bs-dismiss="modal" class="btn btn-outline-primary"
                                style="text-decoration: none;">{{
                                'gis.quotation.cancel' | translate
                                }}
                            </button>
                        </div>

                    </div>
                </div>

            </div>

            <!-- delete limit modal -->
            <div class="modal fade" id="deleteLimit">
                <div class="modal-dialog modal-dialog-centered" style="min-width:600px">
                    <div class="modal-content ps-4 pt-2 pe-4">
                        <div class="d-flex justify-content-between align-items-center rounded-3 mb-2 p-1">
                            <p class="modal-title" style="color: #00529B; font-weight:600; font-size:20px;">
                                {{ 'gis.quotation.delete_limit' | translate }}</p>
                            <button type="button" data-bs-dismiss="modal" class="btn p-0 text-danger fw-bold"
                                style="border: none;">X
                            </button>
                        </div>

                        <div class="d-flex justify-content-between text-black">
                            <p>Are you sure you want to delete this limit?</p>
                        </div>

                        <div class="d-flex flex-row-reverse gap-3 align-items-center rounded-3 mb-3 mt-5 p-0">
                            <button type="button" class="btn" data-bs-dismiss="modal"
                                style="background-color: #00529B;color:white;text-decoration: none;"
                                (click)="deleteLimit()">
                                {{ 'gis.quotation.delete' | translate }}
                            </button>
                            <button type="button" data-bs-dismiss="modal" class="btn btn-outline-primary"
                                style="text-decoration: none;">{{
                                'gis.quotation.cancel' | translate
                                }}
                            </button>
                        </div>

                    </div>
                </div>

            </div>

        </div>


        <!-- perils -->
        <div *ngIf="riskActiveTab === 'riskPerils'" [@slideInOut]="isClausesOpen ? 'open' : 'closed'"
            class="mt-2 w-100">

            <!-- perils table -->
            <p-table #perilTable [value]="addedPerils" dataKey="code" [paginator]="true" [rows]="3"
                [rowsPerPageOptions]="[3, 5, 10]" [globalFilterFields]="['narration', 'value']" [scrollable]="true"
                scrollDirection="horizontal" responsiveLayout="scroll" class="mt-3">
                <!-- Table Header -->
                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="narration" style="width: 15%">
                            ID <p-sortIcon field="narration" />
                        </th>
                        <th pSortableColumn="value" style="width: 35%">
                            Description <p-sortIcon field="value" />
                        </th>
                        <th pSortableColumn="value" style="width: 35%">
                            Section <p-sortIcon field="value" />
                        </th>
                        <th style="width: 15%">Actions</th>
                    </tr>
                    <tr class="py-2">
                        <td class="px-3">
                            <input class="form-control form-control-sm my-1" pInputText #narrationFilter type="text"
                                (input)="perilTable.filterGlobal(narrationFilter.value, 'contains')"
                                style="width: 100%;" />
                        </td>
                        <td class="px-3">
                            <input class="form-control form-control-sm my-1" pInputText #valueFilter type="text"
                                (input)="perilTable.filterGlobal(valueFilter.value, 'contains')" style="width: 80%;" />
                        </td>
                        <td class="px-3">
                            <input class="form-control form-control-sm my-1" pInputText #valueFilter type="text"
                                (input)="perilTable.filterGlobal(valueFilter.value, 'contains')" style="width: 80%;" />
                        </td>
                        <td></td>
                    </tr>
                </ng-template>

                <!-- Table Body -->
                <ng-template pTemplate="body" let-peril>
                    <tr>
                        <td style="width: 15%"> {{peril.perilShortDescription}} </td>
                        <td style="width: 35%" class="position-relative">
                            <div class="clause-wrapper">
                                {{ peril.description | truncate:10 | sentenceCase }}
                                <div class="hover-card">
                                    {{ peril.description | sentenceCase }}
                                </div>
                            </div>
                        </td>
                        <td style="width: 35%">{{ peril.sumInsuredOrLimitDesc }}</td>
                        <td style="width: 15%; text-align: left">
                            <div class="flex justify-start gap-2">
                                <!-- Edit -->
                                <span class="p-button-label p-text-bold"
                                    style="color: #00529B; cursor: pointer; display: inline-block; width: 60px"
                                    (click)="populatePerilEditModal(peril)">
                                    {{ 'gis.quotation.edit' | translate }}
                                </span>

                                <!-- Delete -->
                                <span class="p-button-label p-text-bold" style="color: #00529B; cursor: pointer"
                                    data-bs-toggle="modal" data-bs-target="#deletePeril"
                                    (click)="prepareDeletePeril(peril)">
                                    {{ 'gis.quotation.delete' | translate }}
                                </span>
                            </div>
                        </td>

                    </tr>
                </ng-template>

                <!-- empty table and no search -->
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="4" class="text-center p-4 text-muted">
                            <ng-container *ngIf="addedPerils?.length > 0; else noClauses">
                                <i class="pi pi-search" style="font-size: 2rem; margin-bottom: 10px;"></i>
                                <p>No matching clauses found.</p>
                            </ng-container>
                            <ng-template #noClauses>
                                <p><strong>No perils available.</strong> Click on Add Perils to add</p>
                            </ng-template>
                        </td>
                    </tr>
                </ng-template>
            </p-table>

            <!-- Add risk peril modal 1 perils modal-->
            <div #perilsModal class="modal fade" tabindex="-1" role="dialog" aria-labelledby="addSectionLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" style="min-width: 708px;" role="document">
                    <div class="modal-content" id="addSectionModal">
                        <div class="modal-body">
                            <h5 class="modal-title mt-1 mb-2" id="editOtherDetailsLabel">
                                Add peril
                                <button type="button" class="btn-close red-close float-end" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </h5>

                            <ng-container>
                                <p-table #perilTable [value]="perils" dataKey="code" [paginator]="true" [rows]="3"
                                    [rowsPerPageOptions]="[3, 5, 10]" [globalFilterFields]="['narration', 'value']"
                                    [scrollable]="true" responsiveLayout="scroll" class="mt-3"
                                    [(selection)]="selectedPeril" selectionMode="single">
                                    <!-- Table Header -->
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="width: 35%" pSortableColumn="value" class="flexible-header">
                                                Section description <p-sortIcon field="value" />
                                            </th>
                                            <th style="width: 35%" pSortableColumn="value" class="flexible-header">
                                                Description <p-sortIcon field="value" />
                                            </th>
                                        </tr>
                                        <tr class="mb-1">
                                            <td class="py-2">
                                                <input class="form-control form-control-sm my-1" pInputText
                                                    #narrationFilter type="text"
                                                    (input)="perilTable.filterGlobal(narrationFilter.value, 'contains')"
                                                    style="width: 40%;" />
                                            </td>
                                            <td class="py-2">
                                                <input class="form-control form-control-sm my-1" pInputText
                                                    #narrationFilter type="text"
                                                    (input)="perilTable.filterGlobal(narrationFilter.value, 'contains')"
                                                    style="width: 60%;" />
                                            </td>

                                        </tr>
                                    </ng-template>

                                    <!-- Table Body -->
                                    <ng-template pTemplate="body" let-peril>
                                        <tr [pSelectableRow]="peril">
                                            <td class="position-relative">
                                                <div class="clause-wrapper">
                                                    {{ peril.description | truncate:10 | sentenceCase }}
                                                    <div class="hover-card">
                                                        {{ peril.description | sentenceCase }}
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="position-relative">
                                                <div class="clause-wrapper">
                                                    {{ peril.shortDescription | truncate:10 | sentenceCase }}
                                                    <div class="hover-card">
                                                        {{ peril.shortDescription | sentenceCase }}
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </ng-template>


                                    <!-- empty table and no search -->
                                    <ng-template pTemplate="emptymessage">
                                        <tr>
                                            <td colspan="3" class="text-center p-4 text-muted">
                                                <ng-container *ngIf="perils?.length > 0; else noClauses">
                                                    <i class="pi pi-search"
                                                        style="font-size: 2rem; margin-bottom: 10px;"></i>
                                                    <p>No matching perils found.</p>
                                                </ng-container>
                                                <ng-template #noClauses>
                                                    <p><strong>No perils available.</strong> There are currently no
                                                        perils to add.</p>
                                                </ng-template>
                                            </td>
                                        </tr>
                                    </ng-template>

                                </p-table>

                            </ng-container>

                            <!-- Buttons -->
                            <div class="mt-4 d-flex justify-content-end">
                                <button type="button" class="btn btn-outline-primary me-2"
                                    data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" id="saveDetails" data-bs-dismiss="modal"
                                    [disabled]="!selectedPeril" (click)="selectRiskLimit()">
                                    Save
                                </button>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add risk peril modal 2-choose peril modal -->
            <div #choosePerilsModal class="modal fade" tabindex="-1" aria-labelledby="perilDetailsLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="perilDetailsLabel">
                                {{ isEditMode ? 'Edit Peril' : 'Peril Details' }}
                            </h5>
                            <button type="button" class="btn-close" (click)="closeChoosePerilsModal()"
                                aria-label="Close"></button>
                        </div>

                        <div class="modal-body">
                            <form [formGroup]="perilDetailsForm">

                                <div class="row mb-3">
                                    <!-- first Row -->
                                    <div class="col-md-6">
                                        <label>Peril</label>
                                        <span class="p-input-icon-right w-100">
                                            <input type="text" pInputText formControlName="description" class="w-100"
                                                [readonly]="isPerilEditMode" [ngClass]="{ 'bg-light': isPerilEditMode }"
                                                (click)="!isPerilEditMode && openPerilsModal()" />
                                            <i *ngIf="!isPerilEditMode" class="pi pi-search" (click)="openPerilsModal()"
                                                style="cursor:pointer"></i>
                                        </span>
                                    </div>

                                    <div class="col-md-6">
                                        <label>ID</label>
                                        <input type="text" class="form-control" formControlName="shortDescription"
                                            [readonly]="isPerilEditMode" [ngClass]="{ 'bg-light': isPerilEditMode }" />
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <!-- Second Row -->
                                    <div class="col-md-6">
                                        <label>Type</label>
                                        <p-dropdown [options]="perilTypeOptions" optionLabel="label" optionValue="value"
                                            formControlName="plExcessType" [style]="{'width':'100%'}"></p-dropdown>
                                    </div>

                                    <div class="col-md-6">
                                        <label>Sum insured/ Limit</label>
                                        <p-dropdown [options]="sumInsuredOptions" optionLabel="label"
                                            optionValue="value" formControlName="sumInsuredOrLimit"
                                            [style]="{'width':'100%'}"></p-dropdown>
                                    </div>

                                </div>

                                <div class="row mb-3">
                                    <!-- Third Row -->
                                    <div class="col-md-6">
                                        <label>Person limit</label>
                                        <input type="number" class="form-control" formControlName="personLimit" />
                                    </div>
                                    <div class="col-md-6">
                                        <label>Limit amount</label>
                                        <input type="number" class="form-control" formControlName="excess" />
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <!-- Fourth Row -->
                                    <div class="col-md-6">
                                        <label>Claim limit</label>
                                        <input type="number" class="form-control" formControlName="claimLimit" />
                                    </div>
                                    <div class="col-md-6">
                                        <label>Excess type</label>
                                        <p-dropdown [options]="excessTypeOptions" optionLabel="label"
                                            optionValue="value" formControlName="tlExcessType"
                                            [style]="{'width':'100%'}"></p-dropdown>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <!-- Fifth Row -->
                                    <div class="col-md-6">
                                        <label>Excess</label>
                                        <input type="number" class="form-control" formControlName="excess" />
                                    </div>
                                    <div class="col-md-6">
                                        <label>Excess minimum</label>
                                        <input type="number" class="form-control" formControlName="excessMin" />
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <!-- Sixth Row -->
                                    <div class="col-md-6">
                                        <label>Excess maximum</label>
                                        <input type="number" class="form-control" formControlName="excessMax" />
                                    </div>
                                    <div class="col-md-6">

                                    </div>
                                </div>

                            </form>
                        </div>

                        <div class="modal-footer justify-content-end">
                            <button type="button" class="btn btn-outline-primary me-2"
                                (click)="closeChoosePerilsModal()">
                                Cancel
                            </button>
                            <button type="button" class="btn btn-primary"
                                (click)="isPerilEditMode ? updatePeril() : addPerils()">
                                {{ isEditMode ? 'Update' : 'Save' }}
                            </button>
                        </div>

                    </div>
                </div>
            </div>

            <!-- delete peril modal -->
            <div class="modal fade" id="deletePeril">
                <div class="modal-dialog modal-dialog-centered" style="min-width:600px">
                    <div class="modal-content ps-4 pt-2 pe-4">
                        <div class="d-flex justify-content-between align-items-center rounded-3 mb-2 p-1">
                            <p class="modal-title" style="color: #00529B; font-weight:600; font-size:20px;">
                                Delete peril</p>
                            <button type="button" data-bs-dismiss="modal" class="btn p-0 text-danger fw-bold"
                                style="border: none;">X
                            </button>
                        </div>

                        <div class="d-flex justify-content-between text-black">
                            <p>Are you sure you want to delete this peril?</p>
                        </div>

                        <div class="d-flex flex-row-reverse gap-3 align-items-center rounded-3 mb-3 mt-5 p-0">
                            <button type="button" class="btn" data-bs-dismiss="modal"
                                style="background-color: #00529B;color:white;text-decoration: none;"
                                (click)="deletePeril()">
                                {{ 'gis.quotation.delete' | translate }}
                            </button>
                            <button type="button" data-bs-dismiss="modal" class="btn btn-outline-primary"
                                style="text-decoration: none;">{{
                                'gis.quotation.cancel' | translate
                                }}
                            </button>
                        </div>

                    </div>
                </div>

            </div>

        </div>

        <!-- commissions table -->
        <div *ngIf="riskActiveTab === 'riskCommissions'" [@slideInOut]="isClausesOpen ? 'open' : 'closed'"
            class="mt-2 w-100">

            <h1>{{'gis.quotation.commissions' | translate}}</h1>
        </div>

        <!-- Add tax modal -->

        <div *ngIf="showTaxModal" class="modal  d-block" tabindex="-1" role="dialog"
            style="background: transparent !important;">
            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header d-flex align-items-center no-border-header">
                        <h5 class="modal-title text-primary">Add tax</h5>
                        <button type="button" class="btn-close ms-auto" aria-label="Close"
                            (click)="closeTaxModal()"></button>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body">
                        <form [formGroup]="taxForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label>Tax</label>
                                    <div class="position-relative" *ngIf="taxTypes && taxTypes.length">
                                        <div class="input-group input-group-sm">
                                            <input type="text" class="form-control"
                                                [value]="taxForm.get('rateDescription')?.value" readonly>
                                            <button class="btn btn-outline-secondary" type="button"
                                                (click)="openEditTaxModalFromAdd()">
                                                <i class="pi pi-search"></i>
                                            </button>
                                        </div>

                                        <div *ngIf="taxForm.get('tax')?.touched && taxForm.get('tax')?.invalid"
                                            class="text-danger small">
                                            Tax is required.
                                        </div>

                                    </div>

                                </div>

                                <div class="col-md-6 mb-3">
                                    <label>Tax type</label>
                                    <p-dropdown formControlName="taxType" [options]="taxTypes" optionLabel="label"
                                        optionValue="value" placeholder="Select tax type"
                                        class="w-100 p-inputtext-sm slim-dropdown" [showClear]="true" [filter]="true">
                                    </p-dropdown>
                                    <div *ngIf="taxForm.get('taxType')?.touched && taxForm.get('taxType')?.invalid"
                                        class="text-danger small">
                                        Tax type is required.
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label>Transaction type</label>
                                    <p-dropdown formControlName="transactionType" [options]="transactionTypes"
                                        optionLabel="description" optionValue="code" placeholder=""
                                        class="w-100 p-inputtext-sm slim-dropdown" [showClear]="true" [filter]="true"
                                        filterBy="description">
                                    </p-dropdown>
                                    <div *ngIf="taxForm.get('transactionType')?.touched && taxForm.get('transactionType')?.invalid"
                                        class="text-danger small">
                                        Transaction type is required.
                                    </div>

                                </div>

                                <div class="col-md-6 mb-3">
                                    <label>Computation level</label><br />
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" formControlName="computationLevel"
                                            value="Policy" />
                                        <label class="form-check-label">Policy</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" formControlName="computationLevel"
                                            value="Risk" />
                                        <label class="form-check-label">Risk</label>
                                    </div>
                                    <div *ngIf="taxForm.get('computationLevel')?.touched && taxForm.get('computationLevel')?.invalid"
                                        class="text-danger small">
                                        Computation level is required.
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label>Tax</label><br />
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" formControlName="taxMode"
                                            value="Rate" />
                                        <label class="form-check-label">Rate</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" formControlName="taxMode"
                                            value="Amount" />
                                        <label class="form-check-label">Amount</label>
                                    </div>
                                    <div *ngIf="taxForm.get('taxMode')?.touched && taxForm.get('taxMode')?.invalid"
                                        class="text-danger small">
                                        Tax mode is required.
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label>Tax value</label>
                                    <input formControlName="taxValue" type="text"
                                        class="form-control form-control-sm" />
                                    <div *ngIf="taxForm.get('taxValue')?.touched && taxForm.get('taxValue')?.errors"
                                        class="text-danger small">
                                        <div *ngIf="taxForm.get('taxValue')?.errors['required']">Tax value is required.
                                        </div>
                                        <div *ngIf="taxForm.get('taxValue')?.errors['pattern']">Must be a valid number
                                            (e.g., 12
                                            or 12.5).</div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label>Override</label><br />
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" formControlName="override"
                                            value="Yes" />
                                        <label class="form-check-label">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" formControlName="override"
                                            value="No" />
                                        <label class="form-check-label">No</label>
                                    </div>
                                    <div *ngIf="taxForm.get('override')?.touched && taxForm.get('override')?.invalid"
                                        class="text-danger small">
                                        Override selection is required.
                                    </div>
                                </div>
                            </div>
                        </form>

                    </div>

                    <!-- Modal Footer -->
                    <div class="modal-footer gap-3">
                        <button type="button" class="btn btn-outline-primary" (click)="closeTaxModal()">
                            Cancel
                        </button>
                        <button type="button" class="btn btn-primary" (click)="saveTax()">
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Edit Tax Modal -->
        <div *ngIf="showEditTaxModal" class="modal  d-block" tabindex="-1" role="dialog"
            style="background: transparent !important;">
            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h5 class="modal-title text-primary">Select tax</h5>
                        <button type="button" class="btn-close" aria-label="Close"
                            (click)="closeEditTaxModal()"></button>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body">
                        <p-table [value]="taxes" #selectTaxTable selectionMode="single" [(selection)]="selectedTax"
                            [tableStyle]="{  'width': '100%' }" [rows]="4" [paginator]="true"
                            [rowsPerPageOptions]="[2, 4, 6]" [showCurrentPageReport]="true"
                            currentPageReportTemplate="{first} - {last} of {totalRecords}" class="ui-datatable"
                            responsiveLayout="scroll" [autoLayout]="true" scrollHeight="200px">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th class="flexible-header" pSortableColumn="id">
                                        ID
                                        <p-sortIcon field="id"></p-sortIcon>
                                    </th>

                                    <th class="flexible-header" pSortableColumn="tax-description">
                                        Tax description
                                        <p-sortIcon field="tax-description"></p-sortIcon>
                                    </th>


                                </tr>

                            </ng-template>

                            <ng-template pTemplate="body" let-data let-columns="columns" let-rowIndex="rowIndex">
                                <ng-container *ngIf="rowIndex === 0">
                                    <tr>

                                        <td>
                                            <input type="text" pInputText placeholder="" class="form-control w-70"
                                                (input)="filterTable($event, 'taxCode', selectTaxTable)" />
                                        </td>
                                        <td>
                                            <input type="text" pInputText placeholder="" class="form-control w-70"
                                                (input)="filterTable($event, 'description', selectTaxTable)" />
                                        </td>


                                    </tr>
                                </ng-container>
                                <tr [pSelectableRow]="data">
                                    <td>{{ data.taxCode }}</td>

                                    <td>{{ data.description | sentenceCase }}</td>
                                </tr>
                            </ng-template>

                            <ng-template pTemplate="emptymessage">
                                <tr>
                                    <td colspan="3" class="text-center text-muted py-3">
                                        No taxes found for this quotation.
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div> <!-- Modal Footer -->
                    <div class="modal-footer gap-3">
                        <button type="button" class="btn btn-outline-primary" (click)="closeEditTaxModal()">
                            Cancel
                        </button>
                        <button type="button" class="btn btn-primary" (click)="handleNextClick()">
                            Next
                        </button>
                    </div>

                </div>
            </div>
        </div>

        <!-- TAXES -->
        <div *ngIf="riskActiveTab === 'riskTaxes'" role="tabpanel" aria-labelledby="nav-taxes" tabindex="0"
            [@slideInOut]="isClausesOpen ? 'open' : 'closed'">
            <p-table [value]="taxDetails" #taxTable class="ui-datatable" responsiveLayout="scroll" [autoLayout]="true"
                [scrollable]="true" scrollHeight="200px">
                <ng-template pTemplate="header">
                    <tr>

                        <th class="flexible-header" pSortableColumn="taxType">
                            Tax payer
                            <p-sortIcon field="taxType"></p-sortIcon>
                        </th>


                        <th class="flexible-header" pSortableColumn="rateDescription">
                            <span class="sort-header">
                                Short description
                                <p-sortIcon field="rateDescription"></p-sortIcon>
                            </span>
                        </th>


                        <th class="flexible-header" pSortableColumn="rateDescription">

                            <span class="sort-header">
                                Tax description
                                <p-sortIcon field="rateDescription"></p-sortIcon>
                            </span>
                        </th>


                        <th class="flexible-header" pSortableColumn="rate">
                            Rate
                            <p-sortIcon field="rate"></p-sortIcon>
                        </th>

                        <th class="flexible-header" pSortableColumn="taxAmount">
                            Tax amount
                            <p-sortIcon field="taxAmount"></p-sortIcon>
                        </th>
                        <th class="flexible-header" pSortableColumn="rateType">
                            Rate type
                            <p-sortIcon field="rateType"></p-sortIcon>
                        </th>
                        <th class="flexible-header" pSortableColumn="taxType">
                            Tax type
                            <p-sortIcon field="taxType"></p-sortIcon>
                        </th>
                        <th></th>

                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-data let-columns="columns" let-rowIndex="rowIndex">
                    <ng-container *ngIf="rowIndex === 0">
                        <tr>

                            <td class="flexible-header">
                                <input type="text" pInputText placeholder="" class="form-control w-70"
                                    (input)="filterTable($event, 'taxType', taxTable)" />
                            </td>
                            <td class="flexible-header">
                                <input type="text" pInputText placeholder="" class="form-control w-70"
                                    (input)="filterTable($event, 'rateDescription', taxTable)" />
                            </td>
                            <td class="flexible-header">
                                <input type="text" pInputText placeholder="" class="form-control w-70"
                                    (input)="filterTable($event, 'rateDescription', taxTable)" />
                            </td>
                            <td class="flexible-header">
                                <input type="text" pInputText placeholder="" class="form-control w-70"
                                    (input)="filterTable($event, 'rate', taxTable)" />
                            </td>
                            <td class="flexible-header">
                                <input type="text" pInputText placeholder="" class="form-control w-70"
                                    (input)="filterTable($event, 'taxAmount', taxTable)" />
                            </td>
                            <td class="flexible-header">
                                <input type="text" pInputText placeholder="" class="form-control w-70"
                                    (input)="filterTable($event, 'rateType', taxTable)" />
                            </td>
                            <td class="flexible-header">
                                <input type="text" pInputText placeholder="" class="form-control w-70"
                                    (input)="filterTable($event, 'taxType', taxTable)" />
                            </td>
                            <td></td>


                        </tr>
                    </ng-container>
                    <tr [pSelectableRow]="data">
                        <td>{{ data.taxType }}</td>
                        <td>{{ data.rateDescription }}</td>
                        <td>{{ data.rateDescription }}</td>
                        <td>{{ data.rate }}</td>
                        <td>{{ data.taxAmount }}</td>
                        <td>{{data.rateType}}</td>
                        <td>{{ data.taxType }}</td>

                        <td class="d-flex align-items-center">
                            <button class="btn btn-sm text-primary me-2" (click)="openEditTaxModalFromDB(data)">
                                Edit
                            </button>
                            <button class="btn btn-sm text-primary" (click)="deleteTaxes(data)">
                                Delete
                            </button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="9" class="text-center text-muted py-3">
                            No taxes. Click on Add Tax to add a new tax.
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>






        <!-- excesses table -->
        <div *ngIf="riskActiveTab === 'riskExcesses'" [@slideInOut]="isClausesOpen ? 'open' : 'closed'"
            class="mt-2 w-100">

            <!-- excesses table -->
            <p-table #excessTable [value]="addedExcessess" dataKey="code" [paginator]="true" [rows]="3"
                [rowsPerPageOptions]="[3, 5, 10]" [globalFilterFields]="['narration', 'value']" [scrollable]="true"
                scrollDirection="horizontal" responsiveLayout="scroll" class="mt-3">
                <!-- Table Header -->
                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="narration" class="flexible-header">
                            Narration <p-sortIcon field="narration" />
                        </th>
                        <th pSortableColumn="value" class="flexible-header">
                            Value <p-sortIcon field="value" />
                        </th>
                        <th>Actions</th>
                    </tr>
                    <tr class="py-2">
                        <td class="px-3">
                            <input class="form-control form-control-sm my-1" pInputText #narrationFilter type="text"
                                (input)="excessTable.filterGlobal(narrationFilter.value, 'contains')"
                                style="width: 40%;" />
                        </td>
                        <td class="px-3">
                            <input class="form-control form-control-sm my-1" pInputText #valueFilter type="text"
                                (input)="excessTable.filterGlobal(valueFilter.value, 'contains')" style="width: 70%;" />
                        </td>
                        <td style="width: 30%"></td>
                    </tr>

                </ng-template>

                <!-- Table Body -->
                <ng-template pTemplate="body" let-excess>
                    <tr>
                        <td class="position-relative">
                            <div class="clause-wrapper">
                                {{ excess.narration | truncate:10 | sentenceCase }}

                                <div class="hover-card">
                                    {{ excess.narration | sentenceCase }}
                                </div>
                            </div>
                        </td>
                        <td>{{ excess.value }}</td>
                        <td style="width: 15%; text-align: left">
                            <div class="flex justify-start gap-2">
                                <!-- Edit -->
                                <span class="p-button-label p-text-bold"
                                    style="color: #00529B; cursor: pointer; display: inline-block; width: 60px"
                                    data-bs-toggle="modal" data-bs-target="#editExcess"
                                    (click)="populateEditExcessModal(excess)">
                                    {{ 'gis.quotation.edit' | translate }}
                                </span>

                                <!-- Delete -->
                                <span class="p-button-label p-text-bold" style="color: #00529B; cursor: pointer"
                                    data-bs-toggle="modal" data-bs-target="#deleteExcess"
                                    (click)="prepareDeleteExcess(excess)">
                                    {{ 'gis.quotation.delete' | translate }}
                                </span>
                            </div>
                        </td>
                    </tr>

                </ng-template>

                <!-- empty table and no search -->
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="3" class="text-center p-4 text-muted">
                            <ng-container *ngIf="addedExcessess?.length > 0; else noClauses">
                                <i class="pi pi-search" style="font-size: 2rem; margin-bottom: 10px;"></i>
                                <p>No matching excesses found.</p>
                            </ng-container>
                            <ng-template #noClauses>
                                <p><strong>No excesses available.</strong> There are currently no
                                    excesses to add.</p>
                            </ng-template>
                        </td>
                    </tr>
                </ng-template>

            </p-table>

            <!-- Add risk excess modal -->
            <div class="modal fade" id="addExcess" tabindex="-1" role="dialog" aria-labelledby="addSectionLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" style="min-width: 708px;" role="document">
                    <div class="modal-content" id="addSectionModal">
                        <div class="modal-body">
                            <h5 class="modal-title mt-2" id="editOtherDetailsLabel">
                                Add risk excess
                                <button type="button" class="btn-close red-close float-end" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </h5>

                            <ng-container>
                                <p-table #excessTable [value]="excessesData" dataKey="code" [paginator]="true"
                                    [rows]="3" [rowsPerPageOptions]="[3, 5, 10]"
                                    [globalFilterFields]="['narration', 'value']" [scrollable]="true"
                                    scrollDirection="horizontal" responsiveLayout="scroll" class="mt-3"
                                    [(selection)]="selectedExcessess" selectionMode="multiple">
                                    <!-- Table Header -->
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="width: 3%"><p-tableHeaderCheckbox /></th>
                                            <th pSortableColumn="narration" class="flexible-header">
                                                Narration <p-sortIcon field="narration" />
                                            </th>
                                            <th pSortableColumn="value" class="flexible-header">
                                                Value <p-sortIcon field="value" />
                                            </th>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td>
                                                <input class="form-control form-control-sm" pInputText #narrationFilter
                                                    type="text"
                                                    (input)="excessTable.filterGlobal(narrationFilter.value, 'contains')"
                                                    style="width: 50%;" />
                                            </td>
                                            <td>
                                                <input class="form-control form-control-sm" pInputText #valueFilter
                                                    type="text"
                                                    (input)="excessTable.filterGlobal(valueFilter.value, 'contains')"
                                                    style="width: 50%;" />
                                            </td>
                                        </tr>
                                    </ng-template>

                                    <!-- Table Body -->
                                    <ng-template pTemplate="body" let-excess>
                                        <tr>
                                            <td><p-tableCheckbox [value]="excess" /></td>
                                            <td class="position-relative">
                                                <div class="clause-wrapper">
                                                    {{ excess.narration | truncate:10 | sentenceCase }}

                                                    <div class="hover-card">
                                                        {{ excess.narration | sentenceCase }}
                                                    </div>
                                                </div>
                                            </td>
                                            <td>{{ excess.value }}</td>
                                        </tr>
                                    </ng-template>

                                    <!-- empty table and no search -->
                                    <ng-template pTemplate="emptymessage">
                                        <tr>
                                            <td colspan="3" class="text-center p-4 text-muted">
                                                <ng-container *ngIf="excessesData?.length > 0; else noClauses">
                                                    <i class="pi pi-search"
                                                        style="font-size: 2rem; margin-bottom: 10px;"></i>
                                                    <p>No matching excesses found.</p>
                                                </ng-container>
                                                <ng-template #noClauses>
                                                    <p><strong>No excesses available.</strong> There are currently no
                                                        excesses to add.</p>
                                                </ng-template>
                                            </td>
                                        </tr>
                                    </ng-template>
                                </p-table>
                            </ng-container>

                            <!-- Buttons -->
                            <div class="mt-4 d-flex justify-content-end">
                                <button type="button" class="btn btn-outline-primary me-2"
                                    data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" id="saveDetails" data-bs-dismiss="modal"
                                    (click)="addExcesses()">
                                    Save
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- edit excess modal -->
            <div class="modal fade" id="editExcess">
                <div class="modal-dialog modal-dialog-centered" style="min-width:600px">
                    <div class="modal-content ps-4 pt-2 pe-4">
                        <div class="d-flex justify-content-between align-items-center rounded-3 mb-2 p-1">
                            <p class="modal-title" style="color: #00529B; font-weight:600; font-size:20px;">
                                {{ 'gis.quotation.edit_excess' | translate }}</p>
                            <button type="button" data-bs-dismiss="modal" class="btn p-0 text-danger fw-bold"
                                style="border: none;">X
                            </button>
                        </div>

                        <div class="d-flex justify-content-between text-black">
                            <div class="d-flex flex-column bg-gray-300 w-25">
                                <label for="id">Value</label>
                                <input pInputText type="text" [(ngModel)]="selectedExcess.value">
                            </div>
                        </div>

                        <div class="d-flex flex-column mt-5">
                            <label class="text-dark mt-0" for="comment">Narration</label>
                            <textarea rows="5" cols="30" pTextarea [(ngModel)]="selectedExcess.narration"></textarea>
                        </div>

                        <div class="d-flex flex-row-reverse gap-3 align-items-center rounded-3 mb-3 mt-5 p-0">
                            <button #closeReassignButton type="button" data-bs-dismiss="modal"
                                style="display: none;"></button>
                            <button type="button" class="btn" data-bs-dismiss="modal"
                                style="background-color: #00529B;color:white;text-decoration: none;"
                                (click)="editExcess()" [disabled]="!wasExcessModified()">
                                {{ 'gis.quotation.save_changes' | translate }}
                            </button>
                            <button type="button" data-bs-dismiss="modal" class="btn btn-outline-primary"
                                style="text-decoration: none;">{{
                                'gis.quotation.cancel' | translate
                                }}
                            </button>
                        </div>

                    </div>
                </div>

            </div>

            <!-- delete excess modal -->
            <div class="modal fade" id="deleteExcess">
                <div class="modal-dialog modal-dialog-centered" style="min-width:600px">
                    <div class="modal-content ps-4 pt-2 pe-4">
                        <div class="d-flex justify-content-between align-items-center rounded-3 mb-2 p-1">
                            <p class="modal-title" style="color: #00529B; font-weight:600; font-size:20px;">
                                {{ 'gis.quotation.delete_excess' | translate }}</p>
                            <button type="button" data-bs-dismiss="modal" class="btn p-0 text-danger fw-bold"
                                style="border: none;">X
                            </button>
                        </div>

                        <div class="d-flex justify-content-between text-black">
                            <p>Are you sure you want to delete this excess?</p>
                        </div>

                        <div class="d-flex flex-row-reverse gap-3 align-items-center rounded-3 mb-3 mt-5 p-0">
                            <button type="button" class="btn" data-bs-dismiss="modal"
                                style="background-color: #00529B;color:white;text-decoration: none;"
                                (click)="deleteExcess()">
                                {{ 'gis.quotation.delete' | translate }}
                            </button>
                            <button type="button" data-bs-dismiss="modal" class="btn btn-outline-primary"
                                style="text-decoration: none;">{{
                                'gis.quotation.cancel' | translate
                                }}
                            </button>
                        </div>

                    </div>
                </div>

            </div>

        </div>

    </div>
</div>

<div class="mt-2 d-flex justify-content-between mx-3">
    <button style="border: none; background: transparent; text-decoration: underline; cursor: pointer;color:#00529B"
        (click)="navigateToRiskDetails()">Back</button>
    <button class="btn btn-primary" (click)="computePremium()">Next</button>
</div>