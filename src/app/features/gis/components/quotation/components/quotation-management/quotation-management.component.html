<p class="titleMain mt-3 ms-4">{{ 'gis.quotation.quotation_management' | translate }}</p>
<div class=" mx-4 mt-n1">
  <div class="card mb-3" style=" position: relative;">
    <div class="card-body">
      <div class="row mb-2">
        <div class="col-7">
          <!-- <div>
                  <div class="row">
                    <div class="col-8">
                      <div class="input-group mb-3" style="font-size: 15px">
                        <span class="input-group-text" id="basic-addon1">
                          <i class="fa-solid fa-magnifying-glass"></i>
                        </span>
                        <input style="font-size: 12px !important" type="text" class="form-control" placeholder="Search"
                          aria-label="Username" aria-describedby="basic-addon1" />
                      </div>
                    </div>
                    <div class="col-4">
                      <div class="input-group mb-3">
                        <label class="input-group-text" for="inputGroupSelect01" style="font-size: 11px !important">Sort
                          by:</label>
                        <select style="font-size: 11px;" class="form-select" id="inputGroupSelect01">
                          <option selected>
                            Status
                          </option>
                          <option></option>
        
                        </select>
                      </div>
                    </div>
                  </div>
                </div> -->
        </div>

        <div class="col-5">
          <div class="d-flex justify-content-end">
            <button style="padding: 0.5em; font-size: 12px !important" type="button" class="btn btn-sm btn-primary"
              (click)="createQuote('QUICK')">Quick Quotation</button>
            <button style="padding: 0.5em; font-size: 12px !important" type="button" class="btn btn-sm btn-primary"
              (click)="createQuote('NORMAL')"> Normal Quotation </button>

          </div>
        </div>
      </div>
      <p-table [value]="gisQuotationList" [paginator]="true" [rows]="10" [scrollable]="true"
        scrollDirection="horizontal" [showCurrentPageReport]="true" [tableStyle]="{'max-width': '150rem'}"
        currentPageReportTemplate=" {first} - {last} of {totalRecords}" [responsiveLayout]="'scroll'"
        [resizableColumns]="true" [reorderableColumns]="true" [rowsPerPageOptions]="[5, 10, 20]"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">
        <ng-template pTemplate="header">
          <tr>
            <th style="background-color: #f0f0f0;" pSortableColumn="quotation_number" class="flexible-header">
              {{ 'gis.quotation.quotation_number' | translate }}
              <p-sortIcon field="quotation_number"></p-sortIcon>
            </th>
            <th style="background-color: #f0f0f0;" pSortableColumn="client" class="flexible-header">
              {{ 'gis.quotation.client' | translate }}
              <p-sortIcon field="client"></p-sortIcon>
            </th>
            <th style="background-color: #f0f0f0;" pSortableColumn="agent" class="flexible-header">
              {{ 'gis.quotation.agent' | translate }}
              <p-sortIcon field="agent"></p-sortIcon>
            </th>
            <th style="background-color: #f0f0f0;" pSortableColumn="cover_from" class="flexible-header">
              {{ 'gis.quotation.cover_from' | translate }}
              <p-sortIcon field="cover_from"></p-sortIcon>
            </th>
            <th style="background-color: #f0f0f0;" pSortableColumn="cover_to" class="flexible-header">
              {{ 'gis.quotation.cover_to' | translate }}
              <p-sortIcon field="cover_to"></p-sortIcon>
            </th>
            <th style="background-color: #f0f0f0;" pSortableColumn="status" class="flexible-header">
              {{ 'gis.quotation.status' | translate }}
              <p-sortIcon field="status"></p-sortIcon>
            </th>
            <th style="background-color: #f0f0f0;" pSortableColumn="premium" class="flexible-header text-end">
              {{ 'gis.quotation.premium' | translate }}
              <p-sortIcon field="premium"></p-sortIcon>
            </th>
            <th style="background-color: #f0f0f0;" class="flexible-header text-end">
              Actions
            </th>
          </tr>

          <tr class=" filter-row mb-5 mt-5">
            <td class="me-1" style="background-color: #ffffff;">
              <input type="text" class="form-control" style="width: 100%;" (keyup.enter)="fetchGISQuotations();"
                (input)="inputQuotationNo($event)">
            </td>
            <td class="me-1" style="background-color: #ffffff;">
              <div class="position-relative">
                <input type="text" id="quote-input" class="form-select form-control custom-select" style="width: 100%;"
                  [value]="displayClientName" (click)="openClientSearchModal()" readonly
                  (keyup.enter)="fetchGISQuotations();" />

                <!-- Clear button with X icon - only shows when there's a value -->
                <button *ngIf="displayClientName" class="btn btn-sm position-absolute clear-btn"
                  style="right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; z-index: 5;"
                  (click)="clearClientName()">
                  <i class="pi pi-times"></i>
                </button>

                <!-- Client Search Modal Component -->
                <!-- <app-client-search-modal (onClickSaveClient)="onClientSelected($event)"
                *ngIf="isClientSearchModalVisible"></app-client-search-modal> -->
                <app-client-search-modal *ngIf="isClientSearchModalVisible"
                  (onClickSaveClient)="onClientSelected($event)" (modalClosed)="isClientSearchModalVisible = false">
                </app-client-search-modal>
              </div>
            </td>
            <td style="background-color: #ffffff;">
              <div class="position-relative">
                <input type="text" id="quote-input" class="form-select form-control custom-select" style="width: 100%;"
                  [value]="displayAgentName" data-bs-toggle="modal" data-bs-target="#agentSearchModal" readonly
                  (keyup.enter)="fetchGISQuotations();" />

                <!-- Clear button with X icon - only shows when there's a value -->
                <button *ngIf="displayAgentName" class="btn btn-sm position-absolute clear-btn"
                  style="right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; z-index: 5;"
                  (click)="clearAgentName()">
                  <i class="pi pi-times"></i>
                </button>

                <!-- Agent Search Modal Component -->
                <app-agent-search-modal (agentSelected)="onAgentSelected($event)"></app-agent-search-modal>
              </div>
            </td>
            <td style="background-color: #ffffff;">
              <!-- <p-calendar name="withEffectiveFromDate" [(ngModel)]="fromDate" [dateFormat]="dateFormat"
                [showIcon]="true" [showButtonBar]="true" [minDate]="minDate" (onSelect)="onDateFromInputChange($event)"
                (onClear)="clearDateFilters()" appendTo="body" (keyup.enter)="fetchGISQuotations();"
                [style]="{'width': '100%'}">
              </p-calendar> -->
              <p-calendar name="withEffectiveFromDate" [(ngModel)]="fromDate" [dateFormat]="dateFormat"
                [showIcon]="true" [showButtonBar]="true" [minDate]="minDate" (onSelect)="onDateFromInputChange($event)"
                (onClear)="clearDateFilters()" appendTo="body" (keyup.enter)="fetchGISQuotations()"
                styleClass="calendar-input w-100">
              </p-calendar>

            </td>
            <td style="background-color: #ffffff;">
              <!-- <p-calendar name="withEffectiveToDate" [(ngModel)]="toDate" [dateFormat]="dateFormat" [showIcon]="true"
                [showButtonBar]="true" [minDate]="minToDate" appendTo="body" (onSelect)="onDateToInputChange($event)"
                (onClear)="clearDateFilters()" (keyup.enter)="fetchGISQuotations();" [style]="{'width': '100%'}">
              </p-calendar> -->
              <p-calendar name="withEffectiveToDate" [(ngModel)]="toDate" [dateFormat]="dateFormat" [showIcon]="true"
                [showButtonBar]="true" [minDate]="minToDate" (onSelect)="onDateToInputChange($event)"
                (onClear)="clearDateFilters()" appendTo="body" (keyup.enter)="fetchGISQuotations()"
                styleClass="calendar-input w-100">
              </p-calendar>
            </td>
            <td style="background-color: #ffffff;">
              <p-dropdown [options]="status" optionLabel="status" optionValue="status" [filter]="true" filterBy="status"
                [(ngModel)]="selectedStatus" appendTo="body" [style]="{ 'width': '100%', 'height': '35px' }"
                (onChange)="onStatusSelected($event.value)" (keyup.enter)="fetchGISQuotations();" [showClear]="true"
                styleClass="custom-dropdown">
              </p-dropdown>
            </td>
            <td></td>
            <td style="background-color: #ffffff;" class="text-end">
              <button type="button" class="btn btn-sm  btn-outline-primary" (click)="clearFilters();">{{
                'gis.quotation.clear' | translate }}</button>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-quotation>
          <tr style="cursor: pointer">
            <td>{{quotation.quotationNumber}}</td>
            <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 250px;">
              {{quotation.clientName |sentenceCase}}</td>
            <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 250px;">
              {{quotation.agentShortDescription |sentenceCase}}</td>
            <td>{{quotation.fromDate}}</td>
            <td>{{quotation.toDate}}</td>
            <td>{{quotation.status}}</td>
            <td class="text-end">{{quotation.premium || 0 |number}}</td>
            <!-- <td class="text-end" style="padding-top: 0; padding-bottom: 0;">
              <span class="action-buttons-container">
                <button type="button" class="btn btn-sm btn-action" (click)="toggleMenu($event, quotation)"
                  style="line-height: 0; padding: 0;">
                  <i class="pi pi-ellipsis-h"></i>
                </button>
                <p-menu #menu [popup]="true" [model]="menuItems" appendTo="body"
                  [styleClass]="'horizontal-menu'"></p-menu>
              </span>
            </td> -->
            <td class="text-end" style="padding-top: 0; padding-bottom: 0;">
              <span class="action-buttons-container d-flex align-items-center justify-content-end gap-2">
                <!-- Display first 3 actions as text links -->
                <ng-container *ngFor="let item of getFirstThreeActions(quotation); let i = index">
                  <a href="javascript:void(0)" class="text-decoration-none text-primary small fw-medium"
                    (click)="executeAction(item, quotation)" [title]="item.label">
                    {{ item.label }}
                  </a>
                  <span *ngIf="i < getFirstThreeActions(quotation).length - 1" class="text-muted"></span>
                </ng-container>

                <!-- Show ellipsis if there are more than 3 actions -->
                <ng-container *ngIf="hasMoreThanThreeActions(quotation)">
                  <span class="text-muted"></span>
                  <button type="button" class="btn btn-sm p-0 text-primary" (click)="showMoreActions($event, quotation)"
                    style="background: none; border: none; font-size: 0.875rem;">
                    <i class="pi pi-ellipsis-h"></i>
                  </button>
                </ng-container>

                <!-- Popup menu for additional actions -->
                <p-menu #moreActionsMenu [popup]="true" [model]="remainingMenuItems" appendTo="body"
                  styleClass="additional-actions-menu">
                </p-menu>
              </span>
            </td>
          </tr>
        </ng-template>
        <!-- Empty Message -->
        <ng-template pTemplate="emptymessage">
          <tr>
            <td [attr.colspan]="gisQuotationList.length" class="text-center p-4 text-muted">
              <ng-container>

                No quotations found
              </ng-container>
              <!-- <ng-container *ngIf="riskClauseTable.filteredValue?.length === 0 && sessionClauses?.length > 0">
        
                {{'gis.quotation.no_matching_clauses_found' | translate}}
              </ng-container> -->
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <br>
  <br><br><br><br>