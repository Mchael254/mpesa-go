<div class="container">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <app-stepper [currentStep]="1" [stepperData]="steps"></app-stepper>
        </div>
      </div>

      <div id="container">
        <p-confirmDialog></p-confirmDialog>  <!--confirm dialog, used more than once -->
        <!-- lodaing spinner, used more then once -->
        <ngx-spinner
      name="download_view"
        type="ball-clip-rotate-multiple"

        [fullScreen]="true"
        color="#00529B"
        size="medium"
        bdColor="rgba(255, 255, 255, 0.9)"
      ></ngx-spinner>
        <div>
        <h5>Client details</h5>

        <form [formGroup]="clientDetailsForm">
            <div class="row" style="padding-top: 10px;">
                <div class="col-md-4">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" value="newClient" formControlName="clientType"
                            id="inlineRadio1" name="clientType" />
                        <label class="form-check-label" for="inlineRadio1">New Client</label>
                    </div>
                    <div class="form-check form-check-inline" id="moveToEnd">
                        <input class="form-check-input" type="radio" value="existingClient" formControlName="clientType"
                            id="inlineRadio2" name="clientType" checked />
                        <label class="form-check-label" for="inlineRadio2">Existing Client</label>
                    </div>
                </div>
            </div>
            
            <div class="row" style="padding-top: 10px;">
                <div class="col-md-4"  *ngIf="clientDetailsForm.get('clientType').value === 'newClient'">
                    <div>
                        <div>
                            <label for="clientName" style="color: black;">Client name<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-group">
                            <div>
                                <input 
                                    type="text"
                                    pInputText
                                    class="form-control"
                                    id="clientName" 
                                    [style]="{ width: '100%' }"
                                    formControlName="clientName"
                                    [ngClass]="{'is-invalid': highlightInvalid('clientName')}">
                                    <div *ngIf="highlightInvalid('clientName')" class="invalid-feedback">New client name is required</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4"  *ngIf="clientDetailsForm.get('clientType').value === 'existingClient'">
                    <div>
                        <div>
                            <label for="clientName" style="color: black;">Client name<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-group">
                            <div>
                                <div>
                                    <p-dropdown id='value' [options]='clientList' [optionLabel]="'label'" [dataKey]="'value'" [editable]="true"
                                                [style]="{width: '100%', height: '37px', 'line-height': '10px' }" placeholder="Select or Type Client name"
                                                formControlName='clientName' class="select" #clientDropdown [showClear]="true"  (onClear)="onDropdownClear()"
                                                [ngClass]="{'is-invalid': highlightInvalid('clientName')}">
                                    </p-dropdown>
                                    <div *ngIf="highlightInvalid('clientName')" class="invalid-feedback">Name is required</div>
                                </div>
                            </div>
                        </div> 
                    </div>
                </div>
        
                <div class="col-md-4">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <label for="type" style="color: black;">Type<span style="color: red;">*</span></label>
                        <select class="form-select" [id]="'type'" formControlName="type" [ngClass]="{'is-invalid': highlightInvalid('type')}">
                          <option selected="true" disabled="disabled"></option>
                          <option *ngFor="let clientType of OrganizationClientType" [value]="clientType.code">{{ clientType.clientTypeName | titlecase }}</option>
                        </select>
                        <div *ngIf="highlightInvalid('type')" class="invalid-feedback">Type is required</div>
                      </div>                      
                </div>
        
                <div class="col-md-4">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <label for="status" style="color: black;">Status<span style="color: red;">*</span></label>
                        <select class="form-select" [id]="'status'" formControlName="status" [ngClass]="{'is-invalid': highlightInvalid('status')}">
                            <option selected="true" disabled="disabled"></option>
                            <option value="A">Active</option>
                            <option value="I">Inactive</option>
                        </select>
                        <div *ngIf="highlightInvalid('status')" class="invalid-feedback">Status is required</div>
                    </div>
                </div>
            </div>

            <div class="row row-spacing">
                <div class="col-md-4">
                    <div>
                        <div>
                            <label for="incorporationDate" style="color: black;">Incorporation date<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-group">
                            <div >
                                <p-calendar formControlName="incorporationDate" 
                                            dateFormat="dd/mm/yy" 
                                            [showIcon]="true" 
                                            [showButtonBar]="true"
                                            placeholder="dd/mm/yy"
                                            [maxDate]="maxDate"
                                            [ngClass]="{'is-invalid': highlightInvalid('incorporationDate')}">
                                </p-calendar>
                                <div *ngIf="highlightInvalid('incorporationDate')" class="invalid-feedback">Inc date is required</div>
                              </div>
                        </div>
                    </div>
                </div>
                  <div class="col-md-4">
                      <div class="col-lg-12 col-md-12 col-sm-12">
                        <label for="modeOfIdentity" style="color: black;">Mode of Identity<span style="color: red;">*</span></label>
                        <select class="form-select" [id]="'modeOfIdentity'" formControlName="modeOfIdentity" [ngClass]="{'is-invalid': highlightInvalid('modeOfIdentity')}" (change)="onModeOfIdentitySelected($event)">
                            <option selected="true" disabled="disabled"></option>
                            <option *ngFor="let modeOfIdentity of identityType" [value]="modeOfIdentity.id">{{ modeOfIdentity.name | titlecase }}</option>
                        </select>
                        <div *ngIf="highlightInvalid('modeOfIdentity')" class="invalid-feedback">Identity mode is required</div>
                    </div>
                    
                </div>
        
                <div class="col-md-4">
                    <div>
                        <div>
                            <label for="registrationNumber" style="color: black;">Registration number<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-group">
                            <div>
                                <input 
                                    type="text"
                                    pInputText
                                    class="form-control"
                                    id="registrationNumber" 
                                    [style]="{ width: '100%' }"
                                    formControlName="registrationNumber"
                                    [ngClass]="{'is-invalid': highlightInvalid('registrationNumber')}"
                                    (input)="validateRegistrationNumber()"
                                    (blur)="validateRegistrationNumber()"
                                    (keydown)="onRegistrationNumberKeydown($event)">
                                    <div *ngIf="highlightInvalid('registrationNumber')" class="invalid-feedback">{{ validateRegistrationNumber() }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row row-spacing">
                <div class="col-md-4">
                    <div>
                        <div>
                            <label for="occupation" style="color: black;">Occupation<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-group">
                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <select class="form-select" [id]="'occupation'" formControlName="occupation" [ngClass]="{'is-invalid': highlightInvalid('occupation')}">
                                    <ng-container *ngFor="let occupation of occupation">
                                        <option [value]="occupation['occupation_code']">{{ occupation['occupation_desc'] | titlecase }}
                                        </option>
                                    </ng-container>
                                </select>
                                <div *ngIf="highlightInvalid('occupation')" class="invalid-feedback">Occupation is required</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div>
                        <div>
                            <label for="pinNumber" style="color: black;">Pin number<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-group">
                            <div>
                                <input 
                                    type="text"
                                    pInputText
                                    class="form-control"
                                    id="pinNumber" 
                                    [style]="{ width: '100%' }"
                                    formControlName="pinNumber"
                                    [ngClass]="{'is-invalid': highlightInvalid('pinNumber')}">
                                    <div *ngIf="highlightInvalid('pinNumber')" class="invalid-feedback">PIN no is required</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="padding-top: 60px;"><h5>Contact information</h5></div>
            <div class="row" style="padding-top: 10px;">
                <div class="col-md-4">
                    <div>
                        <div>
                            <label for="phoneNumber" style="color: black;">Phone number<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-group">
                            <div>
                                <input 
                                    type="number"
                                    pInputText
                                    class="form-control"
                                    id="phoneNumber" 
                                    [style]="{ width: '100%' }"
                                    formControlName="phoneNumber"
                                    [ngClass]="{'is-invalid': highlightInvalid('phoneNumber')}">
                                    <div *ngIf="highlightInvalid('phoneNumber')" class="invalid-feedback">Phone no is required</div>
                            </div>
                        </div>
                    </div>
                </div>
        
                <div class="col-md-4">
                    <div>
                        <div>
                            <label for="email" style="color: black;">Email<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-group">
                            <div>
                                <input 
                                    type="text"
                                    pInputText
                                    class="form-control"
                                    id="email" 
                                    [style]="{ width: '100%' }"
                                    formControlName="email"
                                    [ngClass]="{'is-invalid': highlightInvalid('email')}">
                                    <div *ngIf="highlightInvalid('email')" class="invalid-feedback">Email is required</div>
                            </div>
                        </div>
                    </div>
                </div>
        
                <div class="col-md-4">
                    <div>
                        <div>
                            <label for="address" style="color: black;">Physical address<span style="color: red;">*</span></label>
                        </div>
                        <div class="form-group">
                            <div>
                                <input 
                                    type="text"
                                    pInputText
                                    class="form-control"
                                    id="address" 
                                    [style]="{ width: '100%' }"
                                    formControlName="address"
                                    [ngClass]="{'is-invalid': highlightInvalid('address')}">
                                    <div *ngIf="highlightInvalid('address')" class="invalid-feedback">Address is required</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row row-spacing">
                <div class="col-md-4">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <label for="country" style="color: black;">Country<span style="color: red;">*</span></label>
                        <select class="form-select" [id]="'country'" formControlName="country" (change)="selectCountry($event)"
                        [ngClass]="{'is-invalid': highlightInvalid('country')}">
                            <option *ngFor="let data of countryList | sort : 'asc' : 'name'" [value]="data?.id">
                                {{ data?.name | titlecase }}
                            </option>
                        </select>
                        <div *ngIf="highlightInvalid('country')" class="invalid-feedback">Country is required</div>
                    </div>
                </div>
        
                <div class="col-md-4">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <label for="county" style="color: black;">County/State<span style="color: red;">*</span></label>
                        <select class="form-select" [id]="'county'" formControlName="county" (change)="selectState($event)"
                        [ngClass]="{'is-invalid': highlightInvalid('county')}">
                            <option *ngFor="let data of stateList | sort : 'asc' : 'name'" [value]="data?.id">
                                {{ data?.name | titlecase }}
                            </option>
                        </select>
                        <div *ngIf="highlightInvalid('county')" class="invalid-feedback">County/State is required</div>
                    </div>
                </div>
        
                <div class="col-md-4">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <label for="city" style="color: black;">City/Town<span style="color: red;">*</span></label>
                        <select class="form-select" [id]="'city'" formControlName="city" [ngClass]="{'is-invalid': highlightInvalid('city')}">
                            <option *ngFor="let data of townList | sort : 'asc' : 'name'" [value]="data.id">
                                {{ data?.name | titlecase }}
                            </option>
                        </select>
                        <div *ngIf="highlightInvalid('city')" class="invalid-feedback">City is required</div>
                    </div>
                </div>
            </div>

            <div style="padding-top: 60px;"><h5>Other details</h5></div>

            <div class="row" style="padding-top: 10px;">
                <div class="col-md-4">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <label for="affiliatedToInsurer" style="color: black;">Affiliated to the insurer</label>
                        <select class="form-select" [id]="'affiliatedToInsurer'" formControlName="affiliatedToInsurer">
                            <option selected="true" disabled="disabled"></option>
                            <option value="Y">Yes</option>
                            <option value="N">No</option>
                        </select>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <label for="representation" style="color: black;">Representation<span style="color: red;">*</span></label>
                        <select class="form-select" [id]="'representation'" formControlName="representation"
                        [ngClass]="{'is-invalid': highlightInvalid('representation')}">
                            <option selected="true" disabled="disabled"></option>
                            <option value="C">Direct</option>
                            <option value="I">Indirect</option>
                        </select>
                        <div *ngIf="highlightInvalid('representation')" class="invalid-feedback">Representation is required</div>
                    </div>
                </div>
            </div>
        </form>
        


      </div>
</div>

<div class="col-12" style="margin-top: 20px;">
    <div class="accordion" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
              Administrators
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="accordion-body">
                <div class="multiselect-add">
                    <button class="btn btn-success rounded-circle" (click)="showAdminDetailsModal()">&plus;</button>
                    <p-multiSelect [options]="columnOptions" [(ngModel)]="selectedColumns">
                    </p-multiSelect>
                  </div>
                <p-table [value]="administratorDetails" styleClass="p-datatable-striped" [tableStyle]="{'min-width': '30rem'}">
                    <ng-template pTemplate="header">
                        <tr>
                            <th *ngIf="selectedColumns.includes('contact_person_name')">Name</th>
                            <th *ngIf="selectedColumns.includes('date_of_birth')">Date of birth</th>
                            <th *ngIf="selectedColumns.includes('identification_number')">ID number</th>
                            <th *ngIf="selectedColumns.includes('position')">Position</th>
                            <th *ngIf="selectedColumns.includes('contact_person_physical_address')">Physical address</th>
                            <th *ngIf="selectedColumns.includes('phone_number')">Contact</th>
                            <th *ngIf="selectedColumns.includes('contact_person_email')">Email</th>
                            <th *ngIf="selectedColumns.includes('wef')">With effect from</th>
                            <th *ngIf="selectedColumns.includes('wet')">With effect to</th>
                            <th class="action-column"></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-item>
                            <tr>
                                <td id="table-align" *ngIf="selectedColumns.includes('contact_person_name')">{{ item.contact_person_name }}</td>
                                <td id="table-align" *ngIf="selectedColumns.includes('date_of_birth')">{{ item.date_of_birth }}</td>
                                <td id="table-align" *ngIf="selectedColumns.includes('identification_number')">{{ item.identification_number }}</td>
                                <td id="table-align" *ngIf="selectedColumns.includes('position')">{{ item.position }}</td>
                                <td id="table-align" *ngIf="selectedColumns.includes('contact_person_physical_address')">{{ item.contact_person_physical_address }}
                                </td>
                                <td id="table-align" *ngIf="selectedColumns.includes('phone_number')">{{ item.phone_number }}</td>
                                <td id="table-align" *ngIf="selectedColumns.includes('contact_person_email')">{{ item.contact_person_email }}</td>
                                <td id="table-align" *ngIf="selectedColumns.includes('wef')">{{ item.wef }}</td>
                                <td id="table-align" *ngIf="selectedColumns.includes('wet')">{{ item.wet }}</td>
                                <td class="action-column">
                                    <div class="flex justify-content-center">
                                        <p-overlayPanel #op>
                                            <div class="action-buttons">
                                                <!-- Edit button -->
                                                <div class="button-wrapper">
                                                    <p-button label="Edit" icon="pi pi-pencil" (click)="showEditAdminDetailsModal(item)"
                                                        styleClass="p-button-rounded p-button-text" severity="warning"></p-button>
                                                </div>
                                            
                                                <!-- Delete button -->
                                                <div class="button-wrapper">
                                                    <p-button label="Delete" icon="pi pi-trash" (click)="deleteAdminDetails(item, $event)"
                                                        styleClass="p-button-rounded p-button-text" severity="danger"></p-button>
                                                </div>
                                            </div>
                                            
                                        </p-overlayPanel>
                                        <!-- Ellipsis container -->
                                        <div class="button-container">
                                            <button class="hover-button" (click)="op.toggle($event)">
                                                <i class="fas fa-ellipsis-v" (click)="op.toggle($event)"></i>
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                    </ng-template>
                </p-table>
                
            </div>
          </div>
        </div>
      </div>
        
</div>
<!-- <div class="cont-button" style="display: flex; justify-content: end; padding-top: 12px;">
    <button class="finish-button" (click)="createAdmin ? continueAfterAddingAdmin() : onContinue()">
        <span class="finish-text">
            Continue
        </span>
    </button>
</div> -->
<div class="button-cont">
    <button type="button" class="btn btn-primary button"
        (click)="createAdmin ? continueAfterAddingAdmin() : onContinue()">Continue
    </button>
</div>
</div>

<!-- modals begin -->
<!-- modal to capture administrator details -->
<div class="modal fade" tabindex="-1" #adminDetailsModal id="adminDetailsModal" aria-labelledby="adminDetailsModal" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="adminDetailsModal">Capture administrator details</h5>
        <button type="button" class="custom-red-button" data-bs-dismiss="modal" aria-label="Close"
        (click)="closeAdminDetailsModal()"></button>
      </div>
      <div class="modal-body">
      <form [formGroup]="adminDetailsForm">
        <div class="row" style="padding-top: 0;">
            <div class="col-md-6">
                <div>
                    <div>
                        <label for="name" style="color: black;">Name<span style="color: red;">*</span></label>
                    </div>
                    <div class="form-group">
                        <div>
                            <input 
                                type="text"
                                pInputText
                                class="form-control"
                                id="name" 
                                [style]="{ width: '100%' }"
                                formControlName="name">
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="col-md-6">
                <div>
                    <div>
                        <label for="position" style="color: black;">Position<span style="color: red;">*</span></label>
                    </div>
                    <div class="form-group">
                        <div>
                            <input 
                                type="text"
                                pInputText
                                class="form-control"
                                id="position" 
                                [style]="{ width: '100%' }"
                                formControlName="position">
                        </div>
                    </div>
                </div>
            </div>
    
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <label for="gender" style="color: black;">Gender<span style="color: red;">*</span></label>
                    <select class="form-select" [id]="'gender'" formControlName="gender">
                        <option selected="true" disabled="disabled"></option>
                    <option value="M">Male</option>
                    <option value="F">Female</option>
                    </select>
                </div>
            </div>
    
            <div class="col-md-6">
                <div>
                    <div>
                        <label for="dob" style="color: black;">Date of birth<span style="color: red;">*</span></label>
                    </div>
                    <div class="form-group">
                        <div>
                            <p-calendar formControlName="dob" dateFormat="dd/mm/yy" [showIcon]="true" [showButtonBar]="true"
                                placeholder="dd/mm/yy" [maxDate]="over18Date" [defaultDate]="over18Date">
                            </p-calendar>
                        </div>
                    </div>
                </div>
            </div>
    
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <label for="identificationType" style="color: black;">Identification type<span style="color: red;">*</span></label>
                    <select class="form-select" [id]="'identificationType'" formControlName="identificationType">
                      <option selected="true" disabled="disabled"></option>
                      <option *ngFor="let modeOfIdentity of identityType" [value]="modeOfIdentity.id">{{ modeOfIdentity.name | titlecase }}</option>
                    </select>
                  </div>                      
            </div>
    
            <div class="col-md-6">
                <div>
                    <div>
                        <label for="IdentificationNumber" style="color: black;">Identification number<span style="color: red;">*</span></label>
                    </div>
                    <div class="form-group">
                        <div>
                            <input 
                                type="text"
                                pInputText
                                class="form-control"
                                id="IdentificationNumber" 
                                [style]="{ width: '100%' }"
                                formControlName="IdentificationNumber">
                        </div>
                    </div>
                </div>
            </div>
    
        </div>

        <div class="row">
            <div class="col-md-6">
                <div>
                    <div>
                        <label for="address" style="color: black;">Physical address</label>
                    </div>
                    <div class="form-group">
                        <div>
                            <input 
                                type="text"
                                pInputText
                                class="form-control"
                                id="address" 
                                [style]="{ width: '100%' }"
                                formControlName="address">
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="col-md-6">
                <div>
                    <div>
                        <label for="phoneNumber" style="color: black;">Phone number<span style="color: red;">*</span></label>
                    </div>
                    <div class="form-group">
                        <div>
                            <input 
                                type="number"
                                class="form-control"
                                id="phoneNumber" 
                                [style]="{ width: '100%' }"
                                formControlName="phoneNumber">
                        </div>
                    </div>
                </div>
            </div>
    
        </div>

        <div class="row">
            <div class="col-md-6">
                <div>
                    <div>
                        <label for="email" style="color: black;">Email<span style="color: red;">*</span></label>
                    </div>
                    <div class="form-group">
                        <div>
                            <input 
                                type="text"
                                pInputText
                                class="form-control"
                                id="email" 
                                [style]="{ width: '100%' }"
                                formControlName="email">
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="col-md-6">
                <div>
                    <div>
                        <label for="wef" style="color: black;">With effect from<span style="color: red;">*</span></label>
                    </div>
                    <div class="form-group">
                        <div>
                            <p-calendar formControlName="wef" dateFormat="dd/mm/yy" [showIcon]="true" [showButtonBar]="true"
                                placeholder="dd/mm/yy">
                            </p-calendar>
                        </div>
                    </div>
                </div>
            </div>
    
        </div>

        <div class="row">
            <div class="col-md-6">
                <div>
                    <div>
                        <label for="wet" style="color: black;">With effect to</label>
                    </div>
                    <div class="form-group">
                        <div>
                            <p-calendar formControlName="wet" dateFormat="dd/mm/yy" [showIcon]="true" [showButtonBar]="true"
                                placeholder="dd/mm/yy">
                            </p-calendar>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary"
        (click)="isEditMode ? editAdminDetails() : onSaveAdminDets()">Save</button>
      </div>
    </div>
  </div>
</div>
<!-- end of modal to capture administrator details -->
<!-- modals end -->

