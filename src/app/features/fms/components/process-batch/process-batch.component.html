<div class="container ms-2">
  <div class="row me-4 mt-1 align-items-center">
    <div class="col-8">
      <app-dynamic-breadcrumb
        [breadCrumbItems]="[
      {
        label: 'FMS',
        url: '/home/fms',
      },
      {
        label: this.translate.instant('fms.receipting.cbReceipting'),
        url: '/home/fms/',
      },
      {
        label: this.translate.instant('base.base-fms.banking'),
        url: '/home/fms/new-banking-process',
      },
      {
        label: this.translate.instant('fms.banking.processBatch'),
        url: '',
      }
     
    ]"
      >
      </app-dynamic-breadcrumb>
    </div>
  </div>
  <app-stepper [currentStep]="2" [stepperData]="steps"></app-stepper>
  <div class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between">
        <div class="">
          <h5 class="text-primary fw-bold">
            {{ "fms.banking.processBatch" | translate }}
          </h5>
          <p class="text-muted">
            {{ "fms.banking.availableBatches" | translate }}
          </p>
        </div>
        <div class="mt-2">
          <i
            class="fa-regular fa-square-caret-down fa-2x custom"
            (click)="showColumns()"
          ></i>
        </div>
      </div>
      <!-- primeng modal for column selection -->
      <p-dialog
        header="Header"
        [(visible)]="visible"
        [modal]="true"
        [style]="{ width: '35rem' }"
      >
        <ng-template pTemplate="header">
          <div
            class="inline-flex align-items-center justify-content-center gap-2"
          >
            <span class="fs-5">{{ "crm.columns" | translate }}</span>
          </div>
        </ng-template>
        <div *ngFor="let col of columns" class="field-checkbox">
          <p-checkbox
            [(ngModel)]="allColumns"
            [label]="col.header"
            [value]="col"
          />
        </div>
      </p-dialog>
      <p-table
        [value]="filteredBatches"
        sortMode="multiple"
        [paginator]="true"
        [rows]="5"
        [rowsPerPageOptions]="[10, 25, 50]"
        [showCurrentPageReport]="true"
        [currentPageReportTemplate]="currentReportTemplate"
      >
        <ng-template pTemplate="header">
          <tr>
            <th *ngFor="let col of allColumns" [pSortableColumn]="col.field">
              {{ col.header
              }}<p-sortIcon
                [field]="col.field"
                *ngIf="col.field != 'actions'"
              />
            </th>
          </tr>
          <!-- filter row -->
          <tr>
            <th *ngFor="let col of allColumns" class="colHeaderWidth">
              <ng-container [ngSwitch]="col.field">
                <ng-container *ngSwitchCase="'actions'">
                  <button
                    class="btn btn-outline-primary btn-md"
                    (click)="clearFilters()"
                  >
                    {{ "fms.banking.clearFilter" | translate }}
                  </button>
                </ng-container>
                <ng-container *ngSwitchDefault="">
                  <input
                    type="text"
                    class="form-control"
                    (input)="filter($event, col.field)"
                    (keyup.enter)="filter($event, col.field)"
                  />
                </ng-container>
              </ng-container>
            </th>
          </tr>
          <!-- end of filter row -->
        </ng-template>
        <ng-template pTemplate="body" let-batch>
          <tr>
            <td *ngFor="let col of allColumns">
              <ng-container [ngSwitch]="col.field">
                <ng-container *ngSwitchCase="'batch_date'">
                  {{ batch.batch_date | date : "dd/MM/yyyy" }}
                </ng-container>
                <ng-container *ngSwitchCase="'actions'">
                  <div class="d-flex">
                    <button
                      type="button"
                      class="btn btn-link btn-sm"
                      (click)="bankingActions.openDepositModal(batch)"
                    >
                      {{ "fms.banking.deposit" | translate }}
                    </button>
                    <button
                      type="button"
                      class="btn btn-link btn-sm"
                      (click)="detach(batch)"
                    >
                      {{ "fms.banking.detach" | translate }}
                    </button>
                    <button
                      type="button"
                      class="btn btn-link btn-sm"
                      (click)="bankingActions.openReAssignModal(batch)"
                    >
                      {{ "fms.banking.reAssign" | translate }}
                    </button>
                  </div>
                </ng-container>
                <ng-container *ngSwitchDefault>
                  {{ batch[col.field] }}
                </ng-container>
              </ng-container>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
  <div class="d-flex mt-1 justify-content-end">
    <button class="btn btn-primary" (click)="navigateToDashboard()">
      {{ "fms.banking.goToDashboard" | translate }}
    </button>
  </div>
</div>
<app-banking
  #bankingActions
  (onReassignSubmit)="handleReassignment($event)"
  (onFilePost)="handleFilePost($event)"
></app-banking>
