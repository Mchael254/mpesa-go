<div class="base-content-section">
  <div class="me-4">
    <app-dynamic-breadcrumb [breadCrumbItems]="currencyBreadCrumbItems">
    </app-dynamic-breadcrumb>
  </div>
  <div class="me-4">
    <div class="card mb-3">
      <div class="card-header bg-transparent float-start">
        <span class="float-start mt-3">Currencies</span>
      </div>
      <div class="card-body">
        <div class="row mb-3">
          <div class="col-sm-4 col-6">
            <input
              type="text"
              class="form-control"
              placeholder="Search by Description"
              aria-label="search"
              aria-describedby="search"
              (input)="filterCurrencies($event)"
            />
          </div>
          <div class="col-sm-8 col-6">
            <div class="float-end">
              <span class="icon-circle"
                ><i class="fa-solid fa-plus" (click)="openCurrencyModal()"></i
              ></span>
              <span class="icon-circle"
                ><i class="pi pi-pencil" (click)="editCurrency()"></i
              ></span>
              <span class="icon-circle"
                ><i
                  class="fa-regular fa-trash-can"
                  (click)="deleteCurrency()"
                ></i
              ></span>
            </div>
          </div>
        </div>
        <div class="row mb-5">
          <div class="col-12">
            <p-table
              #currencyTable
              [value]="currenciesData"
              [autoLayout]="true"
              [rowHover]="true"
              [resizableColumns]="true"
              styleClass="p-datatable-sm"
              responsiveLayout="scroll"
              [scrollable]="true"
              scrollHeight="400px"
              class="ui-datatable"
              [globalFilterFields]="['name']"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th class="head" pSortableColumn="symbol">
                    Symbol<p-sortIcon field="symbol"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="name">
                    Description<p-sortIcon field="name"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="roundingOff">
                    Round<p-sortIcon field="roundingOff"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="numberWord">
                    Number Words<p-sortIcon field="numberWord"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="decimalWord">
                    Decimal Words<p-sortIcon field="decimalWord"></p-sortIcon>
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-currency>
                <tr
                  class="custom-table"
                  (click)="onCurrencyRowSelect(currency)"
                  [class.selected]="selectedCurrency === currency"
                >
                  <td class="body">{{ currency.symbol }}</td>
                  <td class="body">{{ currency.name }}</td>
                  <td class="body">{{ currency.roundingOff }}</td>
                  <td class="body">{{ currency.numberWord }}</td>
                  <td class="body">{{ currency.decimalWord }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="8">No currency detail found.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>
    <div class="card mb-3">
      <div class="card-header bg-transparent float-start">
        <span class="float-start mt-3">Exchange Rates</span>
      </div>
      <div class="card-body">
        <div class="row mb-3">
          <!-- <div class="form-group col-3">
            <select class="form-select" (change)="onFilterChange($event)">
              <option value="">Select Filter</option>
              <option value="wef">WEF Date</option>
              <option value="wet">WET Date</option>
            </select>
          </div> -->

          <div class="form-group col-sm-4 col-6">
            <input
              type="text"
              class="form-control"
              placeholder="Search by currency"
              aria-label="search"
              aria-describedby="search"
              (input)="filterExchangeCurrency($event)"
            />
          </div>
          <div class="col-sm-8 col-6">
            <div class="float-end">
              <span class="icon-circle"
                ><i
                  class="fa-solid fa-plus"
                  (click)="openCurrencyExchangeModal()"
                ></i
              ></span>
              <span class="icon-circle"
                ><i class="pi pi-pencil" (click)="editCurrencyRate()"></i
              ></span>
              <span class="icon-circle"
                ><i
                  class="fa-regular fa-trash-can"
                  (click)="deleteCurrencyRate()"
                ></i
              ></span>
            </div>
          </div>
        </div>
        <div class="row mb-5">
          <div class="col-12">
            <p-table
              #currencyRateTable
              [value]="currencyRatesData"
              styleClass="p-datatable-sm"
              responsiveLayout="scroll"
              [scrollable]="true"
              scrollHeight="400px"
              class="ui-datatable"
              [globalFilterFields]="['targetCurrency']"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th class="head" pSortableColumn="targetCurrency">
                    Exchange Currency<p-sortIcon
                      field="targetCurrency"
                    ></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="rate">
                    Rate<p-sortIcon field="rate"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="withEffectFromDate">
                    WEF Date<p-sortIcon field="withEffectFromDate"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="withEffectToDate">
                    WET Date<p-sortIcon field="withEffectToDate"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="preparedBy">
                    Prepared By<p-sortIcon field="preparedBy"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="date">
                    Prepared Date<p-sortIcon field="date"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="authorizedBy">
                    Authorized By<p-sortIcon field="authorizedBy"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="authorizedDate">
                    Authorized Date<p-sortIcon
                      field="authorizedDate"
                    ></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="authorized">
                    Authorized<p-sortIcon field="authorized"></p-sortIcon>
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-rate>
                <tr
                  class="custom-table"
                  (click)="onCurrencyRateRowSelect(rate)"
                  [class.selected]="selectedCurrencyRate === rate"
                >
                  <td class="body">{{ rate.targetCurrency }}</td>
                  <td class="body">{{ rate.rate }}</td>
                  <td class="body">
                    {{ formatDate(rate.withEffectFromDate) }}
                  </td>
                  <td class="body">{{ formatDate(rate.withEffectToDate) }}</td>
                  <td class="body">{{ rate.preparedBy }}</td>
                  <td
                    class="body"
                    pTooltip="{{ rate.date }}"
                    tooltipPosition="top"
                  >
                    {{ sliceString(rate.date) }}
                  </td>
                  <td class="body">{{ rate.authorizedBy }}</td>
                  <td class="body">{{ formatDate(rate.authorizedDate) }}</td>
                  <td class="body">{{ rate.authorized }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="8">No exchange rate found.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>
    <div class="card mb-3">
      <div class="card-header bg-transparent float-start">
        <span class="float-start mt-3">Currency Denomination</span>
      </div>
      <div class="card-body">
        <div class="row mb-3">
          <div class="col-sm-4 col-6">
            <input
              type="text"
              class="form-control"
              placeholder="Search by name"
              aria-label="search"
              aria-describedby="search"
              (input)="filterCurrencyDenomination($event)"
            />
          </div>
          <div class="col-sm-8 col-6">
            <div class="float-end">
              <span class="icon-circle"
                ><i
                  class="fa-solid fa-plus"
                  (click)="openDenominationModal()"
                ></i
              ></span>
              <span class="icon-circle"
                ><i
                  class="pi pi-pencil"
                  (click)="editCurrencyDenomination()"
                ></i
              ></span>
              <span class="icon-circle"
                ><i
                  class="fa-regular fa-trash-can"
                  (click)="deleteCurrencyDenomination()"
                ></i
              ></span>
            </div>
          </div>
        </div>
        <div class="row mb-5">
          <div class="col-12">
            <p-table
              #currencyDenominationTable
              [value]="currencyDenominationData"
              styleClass="p-datatable-sm"
              responsiveLayout="scroll"
              [scrollable]="true"
              scrollHeight="400px"
              class="ui-datatable"
              [globalFilterFields]="['name', 'value']"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th class="head" pSortableColumn="value">
                    Value<p-sortIcon field="value"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="name">
                    Name<p-sortIcon field="name"></p-sortIcon>
                  </th>
                  <th class="head" pSortableColumn="withEffectiveFrom">
                    WEF<p-sortIcon field="withEffectiveFrom"></p-sortIcon>
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-deno>
                <tr
                  class="custom-table"
                  (click)="onCurrencyDenominationRowSelect(deno)"
                  [class.selected]="selectedCurrencyDenomination === deno"
                >
                  <td class="body">{{ deno.value }}</td>
                  <td class="body">{{ deno.name }}</td>
                  <td class="body">{{ formatDate(deno.withEffectiveFrom) }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="8">No currency denomination found.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  #currencyModal
  id="currencyModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Define a Currency</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeCurrencyModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createCurrencyForm">
          <div class="row">
            <div class="col-6 mb-3">
              <label for="symbol" class="form-label">Symbol</label>
              <input
                type="text"
                class="form-control"
                id="symbol"
                placeholder="Symbol"
                formControlName="symbol"
                [ngClass]="{
                  'is-invalid':
                    f['symbol']?.invalid &&
                    (f['symbol']?.dirty || f['symbol']?.touched)
                }"
              />
              <div
                *ngIf="
                  f['symbol']?.invalid &&
                  (f['symbol']?.dirty || f['symbol']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && f['symbol']?.errors
                }"
              >
                <div *ngIf="f['symbol']?.errors['required']">
                  Symbol is required
                </div>
              </div>
            </div>
            <div class="col-6 mb-3">
              <label for="description" class="form-label">Description</label>
              <input
                type="text"
                class="form-control"
                id="description"
                placeholder="Description"
                formControlName="description"
                [ngClass]="{
                  'is-invalid':
                    f['description']?.invalid &&
                    (f['description']?.dirty || f['description']?.touched)
                }"
              />
              <div
                *ngIf="
                  f['description']?.invalid &&
                  (f['description']?.dirty || f['description']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && f['description']?.errors
                }"
              >
                <div *ngIf="f['description']?.errors['required']">
                  Description is required
                </div>
              </div>
            </div>
            <div class="col-6 mb-3">
              <label for="round" class="form-label">Round</label>
              <input
                type="number"
                class="form-control"
                placeholder="Round"
                formControlName="round"
              />
            </div>
            <div class="col-6 mb-3">
              <label for="numberRound" class="form-label">Number Round</label>
              <input
                type="text"
                class="form-control"
                id="numberRound"
                placeholder="Number Round"
                formControlName="numberRound"
              />
            </div>
            <div class="col-6 mb-3">
              <label for="decimalRound" class="form-label">Decimal Round</label>
              <input
                type="text"
                class="form-control"
                id="decimalRound"
                placeholder="Decimal Round"
                formControlName="decimalRound"
              />
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="saveCurrency()">
          Save Details
        </button>
      </div>
    </div>
  </div>
</div>

<!-- denomination modal -->
<div
  class="modal fade"
  #denominationModal
  id="denominationModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Define a Denomination
        </h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeDenominationModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createDenominationForm">
          <div class="row">
            <div class="col-6 mb-3">
              <label for="value" class="form-label">Value</label>
              <input
                type="number"
                class="form-control"
                placeholder="Value"
                formControlName="value"
                [ngClass]="{
                  'is-invalid':
                    d['value']?.invalid &&
                    (d['value']?.dirty || d['value']?.touched)
                }"
              />
              <div
                *ngIf="
                  d['value']?.invalid &&
                  (d['value']?.dirty || d['value']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && d['value']?.errors
                }"
              >
                <div *ngIf="d['value']?.errors['required']">
                  Value is required
                </div>
              </div>
            </div>
            <div class="col-6 mb-3">
              <label for="name" class="form-label">Name</label>
              <input
                type="text"
                class="form-control"
                id="name"
                placeholder="Name"
                formControlName="name"
                [ngClass]="{
                  'is-invalid':
                    d['name']?.invalid &&
                    (d['name']?.dirty || d['name']?.touched)
                }"
              />
              <div
                *ngIf="
                  d['name']?.invalid && (d['name']?.dirty || d['name']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && d['name']?.errors
                }"
              >
                <div *ngIf="d['name']?.errors['required']">
                  Name is required
                </div>
              </div>
            </div>
            <div class="col-6 mb-3">
              <label for="denomination_wef" class="form-label">WEF Date</label>
              <input
                type="text"
                class="form-control"
                name="filterByDay"
                placeholder="Date"
                onfocus="(this.type='date')"
                onblur="(this.type='text')"
                formControlName="denomination_wef"
                [ngClass]="{
                  'is-invalid':
                    d['denomination_wef']?.invalid &&
                    (d['denomination_wef']?.dirty ||
                      d['denomination_wef']?.touched)
                }"
              />
              <div
                *ngIf="
                  d['denomination_wef']?.invalid &&
                  (d['denomination_wef']?.dirty ||
                    d['denomination_wef']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && d['denomination_wef']?.errors
                }"
              >
                <div *ngIf="d['denomination_wef']?.errors['required']">
                  WEF Date is required
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary"
          (click)="saveDenomination()"
        >
          Save Details
        </button>
      </div>
    </div>
  </div>
</div>

<!-- currency rate modal -->
<div
  class="modal fade"
  #currencyRateModal
  id="currencyRateModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Define a Currency Rate
        </h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeCurrencyExchangeModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createCurrencyRateForm">
          <div class="row">
            <div class="form-group col-6 mb-3">
              <label for="exchangeCurrency" class="form-label"
                >Exchange Currency</label
              >
              <select
                id="exchangeCurrency"
                class="form-select mb-1"
                formControlName="exchangeCurrency"
                [ngClass]="{
                  'is-invalid':
                    c['exchangeCurrency']?.invalid &&
                    (c['exchangeCurrency']?.dirty ||
                      c['exchangeCurrency']?.touched)
                }"
              >
                <option value="" selected>Select Exchange Currency</option>
                <option
                  *ngFor="let currency of currenciesData"
                  [value]="currency.id"
                >
                  {{ currency.name }}
                </option>
              </select>
              <div
                *ngIf="
                  c['exchangeCurrency']?.invalid &&
                  (c['exchangeCurrency']?.dirty ||
                    c['exchangeCurrency']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && c['exchangeCurrency']?.errors
                }"
              >
                <div *ngIf="c['exchangeCurrency']?.errors['required']">
                  Exchange Currencyis required
                </div>
              </div>
            </div>
            <div class="col-6 mb-3">
              <label for="rate" class="form-label">Rate</label>
              <input
                type="number"
                class="form-control"
                placeholder="Rate"
                formControlName="rate"
                [ngClass]="{
                  'is-invalid':
                    c['rate']?.invalid &&
                    (c['rate']?.dirty || c['rate']?.touched)
                }"
              />
              <div
                *ngIf="
                  c['rate']?.invalid && (c['rate']?.dirty || c['rate']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && c['rate']?.errors
                }"
              >
                <div *ngIf="c['rate']?.errors['required']">
                  Rate is required
                </div>
              </div>
            </div>
            <div class="col-6 mb-3">
              <label for="date" class="form-label">Date</label>
              <input
                type="date"
                class="form-control"
                name="filterByDay"
                placeholder="Date"
                formControlName="date"
              />
            </div>
            <div class="col-6 mb-3">
              <label for="wef" class="form-label">WEF Date</label>
              <input
                type="datetime-local"
                class="form-control"
                name="wef"
                placeholder="WEF Date"
                formControlName="wef"
                [ngClass]="{
                  'is-invalid':
                    c['wef']?.invalid && (c['wef']?.dirty || c['wef']?.touched)
                }"
              />
              <div
                *ngIf="
                  c['wef']?.invalid && (c['wef']?.dirty || c['wef']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && c['wef']?.errors
                }"
              >
                <div *ngIf="c['wef']?.errors['required']">
                  WEF Date is required
                </div>
              </div>
            </div>
            <div class="col-6 mb-3">
              <label for="wet" class="form-label">WET Date</label>
              <input
                type="datetime-local"
                class="form-control"
                name="wet"
                placeholder="WET Date"
                formControlName="wet"
                [ngClass]="{
                  'is-invalid':
                    c['wet']?.invalid && (c['wet']?.dirty || c['wet']?.touched)
                }"
              />
              <div
                *ngIf="
                  c['wet']?.invalid && (c['wet']?.dirty || c['wet']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && c['wet']?.errors
                }"
              >
                <div *ngIf="c['wet']?.errors['required']">
                  WET Date is required
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary"
          (click)="saveCurrencyExchange()"
        >
          Save Details
        </button>
      </div>
    </div>
  </div>
</div>

<app-reusable-input
  [modalId]="'currencyConfirmationModal'"
  [title]="'Delete Confirmation'"
  [message]="'Are you sure you want to delete this currency?'"
  (confirmed)="confirmCurrencyDelete()"
  #currencyConfirmationModal
></app-reusable-input>

<app-reusable-input
  [modalId]="'currencyRateConfirmationModal'"
  [title]="'Delete Confirmation'"
  [message]="'Are you sure you want to delete this currency rate?'"
  (confirmed)="confirmCurrencyRateDelete()"
  #currencyRateConfirmationModal
></app-reusable-input>

<app-reusable-input
  [modalId]="'currencyDenominationConfirmationModal'"
  [title]="'Delete Confirmation'"
  [message]="'Are you sure you want to delete this currency?'"
  (confirmed)="confirmCurrencyDenominationDelete()"
  #currencyDenominationConfirmationModal
></app-reusable-input>
