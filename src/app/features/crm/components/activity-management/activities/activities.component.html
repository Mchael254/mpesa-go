<div class="base-content-section">
  <div class="row me-4">
    <div class="col-8">
      <app-dynamic-breadcrumb
        [breadCrumbItems]="[
      {
        label: 'Administration',
        url: '/home/crm'
      },
      {
        label: 'CRM Setups',
        url: '/home/crm',
      },
      {
        label: 'Activity Management',
        url: '/home/crm/activities'
      },
      {
        label: 'Activities',
        url: ''
      }
    ]"
      >
      </app-dynamic-breadcrumb>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <div class="row mb-2">
        <div class="col-sm-12 col-md-6">
          <h5 class="text-dark">Activities</h5>
        </div>

        <div class="col-sm-12 col-md-6 d-flex justify-content-lg-end">
          <div class="float-end">
            <span
              class="icon-circle open-activity-modal"
              (click)="openDefineActivityModal()"
            >
              <i class="fa-solid fa-plus"></i>
            </span>
            <span class="icon-circle edit-activity" (click)="editActivity()">
              <i class="pi pi-pencil"></i>
            </span>
            <span
              class="icon-circle"
              data-bs-toggle="modal"
              data-bs-target="#deleteModal"
              (click)="prepareItemForDelete('activity')"
            >
              <i class="fa-regular fa-trash-can"></i>
            </span>
          </div>
        </div>
      </div>
      <ng-container *ngIf="isDataReady.activities; else activitiesLoading">
        <p-table
          #activitiesTable
          [autoLayout]="true"
          [rowHover]="true"
          [resizableColumns]="true"
          [showCurrentPageReport]="true"
          [rows]="pageSize || 5"
          [totalRecords]="activityData?.length"
          [value]="activityData"
          [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
          responsiveLayout="stack"
          [scrollable]="true"
          [(selection)]="selectedActivity"
          selectionMode="single"
          dataKey="id"
          scrollHeight="400px"
          currentPageReportTemplate="{first} - {last} of {totalRecords}"
          [globalFilterFields]="['description', 'code']"
        >
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="gis_exception_code">
                Subject <p-sortIcon field="gis_exception_code"></p-sortIcon>
              </th>
              <th pSortableColumn="objective">
                Start Date <p-sortIcon field="objective"></p-sortIcon>
              </th>
              <th pSortableColumn="description">
                End Date <p-sortIcon field="description"></p-sortIcon>
              </th>
              <th>Duration</th>
              <th>Location</th>
              <th>Assigned To</th>
              <th>Related To</th>
              <th pSortableColumn="authorised">
                Status <p-sortIcon field="authorised"></p-sortIcon>
              </th>
              <th pSortableColumn="transactions_date">
                Type <p-sortIcon field="transactions_date"></p-sortIcon>
              </th>
              <th pSortableColumn="authorised_by">
                Description <p-sortIcon field="authorised_by"></p-sortIcon>
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-activity>
            <tr [pSelectableRow]="activity">
              <td>{{ activity.subject }}</td>
              <td>{{ activity.wef }}</td>
              <td>{{ activity.wet }}</td>
              <td>{{ activity.duration }}</td>
              <td>{{ activity.location }}</td>
              <td>{{ activity.assignedTo }}</td>
              <td>{{ activity.relatedTo }}</td>
              <td>{{ activity.statusId }}</td>
              <td>{{ activity.activityTypeCode }}</td>
              <td>{{ activity.desc }}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="10">No Activity Detail(s) Found.</td>
            </tr>
          </ng-template>
        </p-table>
      </ng-container>
      <ng-template #activitiesLoading>
        <div class="text-center">
          <div class="spinner-border text-secondary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <div class="card mt-3">
    <div class="card-body">
      <div class="row mb-2">
        <div class="col-sm-12 col-md-6">
          <h5 class="text-dark">Notes and attachments</h5>
        </div>

        <div class="col-sm-12 col-md-6 d-flex justify-content-lg-end">
          <div class="float-end">
            <span
              class="icon-circle open-note-modal"
              (click)="openDefineNoteModal()"
            >
              <i class="fa-solid fa-plus"></i>
            </span>
            <span class="icon-circle edit-note" (click)="editNote()">
              <i class="pi pi-pencil"></i>
            </span>
            <span
              class="icon-circle"
              data-bs-toggle="modal"
              data-bs-target="#deleteModal"
              (click)="prepareItemForDelete('note')"
            >
              <i class="fa-regular fa-trash-can"></i>
            </span>
          </div>
        </div>
      </div>
      <ng-container *ngIf="isDataReady.notes; else notesLoading">
        <p-table
          #notesAndAttachmentsTable
          [autoLayout]="true"
          [rowHover]="true"
          [resizableColumns]="true"
          [showCurrentPageReport]="true"
          [rows]="pageSize || 5"
          [totalRecords]="notesAndAttachmentsData?.length"
          [value]="notesAndAttachmentsData"
          [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
          responsiveLayout="stack"
          [scrollable]="true"
          [(selection)]="selectedNote"
          selectionMode="single"
          dataKey="id"
          scrollHeight="400px"
          currentPageReportTemplate="{first} - {last} of {totalRecords}"
          [globalFilterFields]="['description', 'code']"
        >
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="gis_exception_code">
                Subject <p-sortIcon field="gis_exception_code"></p-sortIcon>
              </th>
              <th pSortableColumn="objective">
                Related To <p-sortIcon field="objective"></p-sortIcon>
              </th>
              <th pSortableColumn="description">
                Description <p-sortIcon field="description"></p-sortIcon>
              </th>
              <th pSortableColumn="authorised">
                Attachment <p-sortIcon field="authorised"></p-sortIcon>
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-note>
            <tr [pSelectableRow]="note">
              <td>{{ note.subject }}</td>
              <td>{{ note.relatedTo }}</td>
              <td>{{ note.desc }}</td>
              <td>{{ note.attachment }}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="4">No Notes and Attachments Detail(s) Found.</td>
            </tr>
          </ng-template>
        </p-table>
      </ng-container>
      <ng-template #notesLoading>
        <div class="text-center">
          <div class="spinner-border text-secondary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <div class="card mt-3">
    <div class="card-body">
      <div class="row mb-2">
        <div class="col-sm-12 col-md-6">
          <h5 class="text-dark">Tasks</h5>
        </div>

        <div class="col-sm-12 col-md-6 d-flex justify-content-lg-end">
          <div class="float-end">
            <span
              class="icon-circle open-task-modal"
              (click)="openDefineTaskModal()"
            >
              <i class="fa-solid fa-plus"></i>
            </span>
            <span class="icon-circle edit-task" (click)="editTask()">
              <i class="pi pi-pencil"></i>
            </span>
            <span
              class="icon-circle"
              data-bs-toggle="modal"
              data-bs-target="#deleteModal"
              (click)="prepareItemForDelete('task')"
            >
              <i class="fa-regular fa-trash-can"></i>
            </span>
          </div>
        </div>
      </div>
      <ng-container *ngIf="isDataReady.tasks; else tasksLoading">
        <p-table
          #tasksTable
          [autoLayout]="true"
          [rowHover]="true"
          [resizableColumns]="true"
          [showCurrentPageReport]="true"
          [rows]="pageSize || 5"
          [totalRecords]="tasksData?.length"
          [value]="tasksData"
          [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
          responsiveLayout="stack"
          [scrollable]="true"
          [(selection)]="selectedTask"
          selectionMode="single"
          dataKey="id"
          scrollHeight="400px"
          currentPageReportTemplate="{first} - {last} of {totalRecords}"
          [globalFilterFields]="['description', 'code']"
        >
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="gis_exception_code">
                Subject <p-sortIcon field="gis_exception_code"></p-sortIcon>
              </th>
              <th pSortableColumn="objective">
                Start Date <p-sortIcon field="objective"></p-sortIcon>
              </th>
              <th pSortableColumn="description">
                End Date <p-sortIcon field="description"></p-sortIcon>
              </th>
              <th pSortableColumn="authorised">
                Status <p-sortIcon field="authorised"></p-sortIcon>
              </th>
              <th>Priority</th>
              <th>Related To</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-task>
            <tr [pSelectableRow]="task">
              <td>{{ task.subject }}</td>
              <td>{{ task.dateFrom | date }}</td>
              <td>{{ task.dateTo | date }}</td>
              <td>{{ task.statusId }}</td>
              <td>{{ task.priorityCode }}</td>
              <td>{{ task.relateTo }}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="6">No Tasks Detail(s) Found.</td>
            </tr>
          </ng-template>
        </p-table>
      </ng-container>
      <ng-template #tasksLoading>
        <div class="text-center">
          <div class="spinner-border text-secondary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <div class="card mt-3">
    <div class="card-body">
      <div class="row mb-2">
        <div class="col-sm-12 col-md-6">
          <h5 class="text-dark">Participants</h5>
        </div>

        <div class="col-sm-12 col-md-6 d-flex justify-content-lg-end">
          <div class="float-end">
            <button class="btn btn-primary">Send invite</button>
            <span
              class="icon-circle"
              (click)="openAllUsersModal('participant')"
            >
              <i class="fa-solid fa-plus open-all-users-modal"></i>
            </span>
            <span
              class="icon-circle"
              data-bs-toggle="modal"
              data-bs-target="#deleteModal"
              (click)="prepareItemForDelete('participant')"
            >
              <i class="fa-regular fa-trash-can"></i>
            </span>
          </div>
        </div>
      </div>
      <ng-container *ngIf="isDataReady.participants; else participantsLoading">
        <p-table
          #participantsTable
          [autoLayout]="true"
          [rowHover]="true"
          [resizableColumns]="true"
          [showCurrentPageReport]="true"
          [rows]="pageSize || 5"
          [totalRecords]="participantsData?.length"
          [value]="participantsData"
          [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
          responsiveLayout="stack"
          [scrollable]="true"
          [(selection)]="selectedParticipant"
          selectionMode="single"
          dataKey="id"
          scrollHeight="400px"
          currentPageReportTemplate="{first} - {last} of {totalRecords}"
          [globalFilterFields]="['description', 'code']"
        >
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="gis_exception_code">
                Name <p-sortIcon field="gis_exception_code"></p-sortIcon>
              </th>
              <th pSortableColumn="objective">
                Email <p-sortIcon field="objective"></p-sortIcon>
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-participant>
            <tr [pSelectableRow]="participant">
              <td>
                <span class="me-3"><p-tableCheckbox></p-tableCheckbox></span>
                {{ participant.participant.name }}
              </td>
              <td>{{ participant.participant.emailAddress }}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="3">No Participants Detail(s) Found.</td>
            </tr>
          </ng-template>
        </p-table>
      </ng-container>
      <ng-template #participantsLoading>
        <div class="text-center">
          <div class="spinner-border text-secondary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</div>

<!--Create activity modal-->
<div
  class="modal fade"
  #newActivity
  id="newActivity"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header border-bottom-0 pb-0">
        <h5 class="modal-title text-black">
          {{ editMode ? "Edit" : "Define" }}
          {{ editMode ? "an activity" : "a new activity" }}
        </h5>
        <button
          type="button"
          class="btn-close close-activity-modal"
          (click)="closeDefineActivityModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form *ngIf="activityForm" [formGroup]="activityForm">
          <div class="row my-3">
            <ng-container *ngIf="visibleStatus.subject === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="subject">Subject</label>
                <input
                  type="text"
                  class="form-control"
                  id="subject"
                  formControlName="subject"
                  [ngClass]="{
                    'is-invalid':
                      g['subject']?.invalid &&
                      (g['subject']?.dirty || g['subject']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    g['subject']?.invalid &&
                    (g['subject']?.dirty || g['subject']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['subject']?.errors['required']">
                    Subject is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.activityType === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="activityType"
                  >Activity type</label
                >
                <select
                  id="activityType"
                  class="form-select"
                  formControlName="activityType"
                  [ngClass]="{
                    'is-invalid':
                      g['activityType']?.invalid &&
                      (g['activityType']?.dirty || g['activityType']?.touched)
                  }"
                >
                  <ng-container *ngFor="let aType of activityTypes">
                    <option value="{{ aType.id }}">{{ aType.desc }}</option>
                  </ng-container>
                </select>
                <div
                  *ngIf="
                    g['activityType']?.invalid &&
                    (g['activityType']?.dirty || g['activityType']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['activityType']?.errors['required']">
                    Activity type is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.description === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="description"
                  >Description</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="description"
                  formControlName="description"
                  [ngClass]="{
                    'is-invalid':
                      g['description']?.invalid &&
                      (g['description']?.dirty || g['description']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    g['description']?.invalid &&
                    (g['description']?.dirty || g['description']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['description']?.errors['required']">
                    Description is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.location === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="location">Location</label>
                <input
                  type="text"
                  class="form-control"
                  id="location"
                  formControlName="location"
                  [ngClass]="{
                    'is-invalid':
                      g['location']?.invalid &&
                      (g['location']?.dirty || g['location']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    g['location']?.invalid &&
                    (g['location']?.dirty || g['location']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['location']?.errors['required']">
                    Location is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.assignedTo === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="assignedTo"
                  >Assigned To</label
                >
                <div class="input-group mb-3">
                  <input
                    type="text"
                    class="form-control"
                    formControlName="assignedTo"
                    aria-label="user"
                    aria-describedby="button-addon2"
                    [ngClass]="{
                      'is-invalid':
                        g['assignedTo']?.invalid &&
                        (g['assignedTo']?.dirty || g['assignedTo']?.touched)
                    }"
                  />
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    id="button-addon2"
                    (click)="openAllUsersModal('assignedTo')"
                  >
                    <i class="fa-solid fa-plus open-all-users-modal"></i>
                  </button>
                </div>
                <div
                  *ngIf="
                    g['assignedTo']?.invalid &&
                    (g['assignedTo']?.dirty || g['assignedTo']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['assignedTo']?.errors['required']">
                    Assigned to is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.relatedAccount === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="relatedAccount"
                  >Related Account</label
                >
                <div class="input-group mb-3">
                  <input
                    type="text"
                    class="form-control"
                    formControlName="relatedAccount"
                    aria-label="user"
                    aria-describedby="button-addon2"
                    [ngClass]="{
                      'is-invalid':
                        g['relatedAccount']?.invalid &&
                        (g['relatedAccount']?.dirty ||
                          g['relatedAccount']?.touched)
                    }"
                  />
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    id="button-addon"
                    (click)="openAllUsersModal('relatedAccount')"
                  >
                    <i class="fa-solid fa-plus open-all-users-modal"></i>
                  </button>
                </div>
                <div
                  *ngIf="
                    g['relatedAccount']?.invalid &&
                    (g['relatedAccount']?.dirty || g['relatedAccount']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['relatedAccount']?.errors['required']">
                    Related account is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.startDate === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="startDate"
                  >Start Date</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="startDate"
                  formControlName="startDate"
                  [ngClass]="{
                    'is-invalid':
                      g['startDate']?.invalid &&
                      (g['startDate']?.dirty || g['startDate']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    g['startDate']?.invalid &&
                    (g['startDate']?.dirty || g['startDate']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['startDate']?.errors['required']">
                    Start date is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.endDate === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="endDate">End Date</label>
                <input
                  type="date"
                  class="form-control"
                  id="endDate"
                  formControlName="endDate"
                  [ngClass]="{
                    'is-invalid':
                      g['endDate']?.invalid &&
                      (g['endDate']?.dirty || g['endDate']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    g['endDate']?.invalid &&
                    (g['endDate']?.dirty || g['endDate']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['endDate']?.errors['required']">
                    End date is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.duration === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="duration">Duration</label>
                <input
                  type="number"
                  class="form-control"
                  id="duration"
                  formControlName="duration"
                  [ngClass]="{
                    'is-invalid':
                      g['duration']?.invalid &&
                      (g['duration']?.dirty || g['duration']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    g['duration']?.invalid &&
                    (g['duration']?.dirty || g['duration']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['duration']?.errors['required']">
                    Duration is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.status === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="status">Status</label>
                <input
                  type="text"
                  class="form-control"
                  id="status"
                  formControlName="status"
                  [ngClass]="{
                    'is-invalid':
                      g['status']?.invalid &&
                      (g['status']?.dirty || g['status']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    g['status']?.invalid &&
                    (g['status']?.dirty || g['status']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['status']?.errors['required']">
                    Status is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.team === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="team">Team</label>
                <div class="input-group mb-3">
                  <input
                    type="text"
                    class="form-control"
                    formControlName="team"
                    aria-label="user"
                    aria-describedby="button-addon2"
                    [ngClass]="{
                      'is-invalid':
                        g['team']?.invalid &&
                        (g['team']?.dirty || g['team']?.touched)
                    }"
                  />
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    id="button-addon"
                    (click)="openAllUsersModal('team')"
                  >
                    <i class="fa-solid fa-plus open-all-users-modal"></i>
                  </button>
                </div>
                <div
                  *ngIf="
                    g['team']?.invalid &&
                    (g['team']?.dirty || g['team']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['team']?.errors['required']">
                    Team is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.emailTemplate === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="emailTemplate"
                  >Email Template</label
                >
                <select
                  id="emailTemplate"
                  class="form-select"
                  formControlName="emailTemplate"
                  [ngClass]="{
                    'is-invalid':
                      g['emailTemplate']?.invalid &&
                      (g['emailTemplate']?.dirty || g['emailTemplate']?.touched)
                  }"
                >
                  <ng-container *ngFor="let message of messageTemplates">
                    <option
                      value="{{ message.id }}"
                      selected="selectedActivity.messageCode"
                    >
                      {{ message.name }}
                    </option>
                  </ng-container>
                </select>
                <div
                  *ngIf="
                    g['emailTemplate']?.invalid &&
                    (g['emailTemplate']?.dirty || g['emailTemplate']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['emailTemplate']?.errors['required']">
                    Email template is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.sendReminder === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="">Send reminder?</label>
                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    formControlName="sendReminder"
                    value="Y"
                  />
                  <label class="form-check-label text-black" for="">Yes</label>
                </div>
                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    formControlName="sendReminder"
                    value="N"
                  />
                  <label class="form-check-label text-black" for="sendReminder"
                    >No</label
                  >
                </div>
                <div
                  *ngIf="
                    g['sendReminder']?.invalid &&
                    (g['sendReminder']?.dirty || g['sendReminder']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="g['sendReminder']?.errors['required']">
                    Send reminder is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container
              *ngIf="activityForm.get('sendReminder').value === 'Y'"
            >
              <div class="col-md-6">
                <label class="form-label w-100" for="reminderTime"
                  >Reminder Time</label
                >
                <input
                  type="datetime-local"
                  class="form-control"
                  id="reminderTime"
                  formControlName="reminderTime"
                />
              </div>
            </ng-container>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary create-update-activity"
          (click)="createUpdateActivity()"
        >
          Save details
        </button>
      </div>
    </div>
  </div>
</div>

<!--Create note modal-->
<div
  class="modal fade"
  #newNote
  id="newNote"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header border-bottom-0 pb-0">
        <h5 class="modal-title text-black">
          {{ editMode ? "Edit" : "Define" }} a
          {{ editMode ? "note" : "new note" }}
        </h5>
        <button
          type="button"
          class="btn-close close-note-modal"
          (click)="closeDefineNoteModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form *ngIf="noteForm" [formGroup]="noteForm">
          <div class="row my-3">
            <ng-container *ngIf="visibleStatus.noteSubject === 'Y'">
              <div class="col-md-12">
                <label class="form-label w-100" for="noteSubject"
                  >Subject</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="noteSubject"
                  formControlName="noteSubject"
                  [ngClass]="{
                    'is-invalid':
                      f['noteSubject']?.invalid &&
                      (f['noteSubject']?.dirty || f['noteSubject']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    f['noteSubject']?.invalid &&
                    (f['noteSubject']?.dirty || f['noteSubject']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="f['noteSubject']?.errors['required']">
                    Subject is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.relateTo === 'Y'">
              <div class="col-md-12">
                <label class="form-label w-100" for="relateTo"
                  >Related To</label
                >
                <div class="input-group mb-3">
                  <input
                    type="text"
                    class="form-control"
                    formControlName="relateTo"
                    aria-label="user"
                    aria-describedby="button-addon2"
                    [ngClass]="{
                      'is-invalid':
                        f['relateTo']?.invalid &&
                        (f['relateTo']?.dirty || f['relateTo']?.touched)
                    }"
                  />
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    id="button-addon"
                    (click)="openAllUsersModal('relateTo')"
                  >
                    <i class="fa-solid fa-plus open-all-users-modal"></i>
                  </button>
                </div>
                <div
                  *ngIf="
                    f['relateTo']?.invalid &&
                    (f['relateTo']?.dirty || f['relateTo']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="f['relateTo']?.errors['required']">
                    Related to is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.noteDescription === 'Y'">
              <div class="col-md-12">
                <label class="form-label w-100" for="noteDescription"
                  >Description</label
                >
                <textarea
                  class="form-control"
                  id="noteDescription"
                  formControlName="noteDescription"
                  rows="3"
                  [ngClass]="{
                    'is-invalid':
                      f['noteDescription']?.invalid &&
                      (f['noteDescription']?.dirty ||
                        f['noteDescription']?.touched)
                  }"
                ></textarea>
                <div
                  *ngIf="
                    f['noteDescription']?.invalid &&
                    (f['noteDescription']?.dirty ||
                      f['noteDescription']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="f['noteDescription']?.errors['required']">
                    Description is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.attachment === 'Y'">
              <div class="col-md-12">
                <label class="form-label w-100">Attachment</label>
                <div class="mt-2 select-file" (change)="onFileChange($event)">
                  <img
                    *ngIf="url !== '' && url"
                    [src]="url"
                    alt=""
                    id="photo"
                  />
                  <input
                    type="file"
                    id="inputImg"
                    accept="image/jpeg, image/png"
                    hidden
                  />
                  <label *ngIf="url === ''" for="inputImg" class="img_upload"
                    >Upload file</label
                  >
                  <label for="inputImg" *ngIf="url !== ''" class="img_edit">{{
                    "entities.edit" | translate | titlecase
                  }}</label>
                </div>

                <div
                  *ngIf="
                    f['endDate']?.invalid &&
                    (f['endDate']?.dirty || f['endDate']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="f['endDate']?.errors['required']">
                    End date is required
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary"
          (click)="createUpdateActivityNote()"
        >
          Save details
        </button>
      </div>
    </div>
  </div>
</div>

<!--Create task modal-->
<div
  class="modal fade"
  #newTask
  id="newTask"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header border-bottom-0 pb-0">
        <h5 class="modal-title text-black">
          {{ editMode ? "Edit" : "Define" }} a
          {{ editMode ? "task" : "new task" }}
        </h5>
        <button
          type="button"
          class="btn-close close-task-modal"
          (click)="closeDefineTaskModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form *ngIf="taskForm" [formGroup]="taskForm">
          <div class="row my-3">
            <ng-container *ngIf="visibleStatus.taskSubject === 'Y'">
              <div class="col-md-12">
                <label class="form-label w-100" for="taskSubject"
                  >Subject</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="taskSubject"
                  formControlName="taskSubject"
                  [ngClass]="{
                    'is-invalid':
                      h['taskSubject']?.invalid &&
                      (h['taskSubject']?.dirty || h['taskSubject']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    h['taskSubject']?.invalid &&
                    (h['taskSubject']?.dirty || h['taskSubject']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="h['taskSubject']?.errors['required']">
                    Subject is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.taskStartDate === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="taskStartDate"
                  >Start Date</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="taskStartDate"
                  formControlName="taskStartDate"
                  [ngClass]="{
                    'is-invalid':
                      h['taskStartDate']?.invalid &&
                      (h['taskStartDate']?.dirty || h['taskStartDate']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    h['taskStartDate']?.invalid &&
                    (h['taskStartDate']?.dirty || h['taskStartDate']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="h['taskStartDate']?.errors['required']">
                    Start date is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.taskEndDate === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="taskEndDate"
                  >End Date</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="taskEndDate"
                  formControlName="taskEndDate"
                  [ngClass]="{
                    'is-invalid':
                      h['taskEndDate']?.invalid &&
                      (h['taskEndDate']?.dirty || h['taskEndDate']?.touched)
                  }"
                />
                <div
                  *ngIf="
                    h['taskEndDate']?.invalid &&
                    (h['taskEndDate']?.dirty || h['taskEndDate']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="h['taskEndDate']?.errors['required']">
                    End date is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.taskRelatedTo === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="taskRelatedTo"
                  >Related To</label
                >
                <div class="input-group mb-3">
                  <input
                    type="text"
                    class="form-control"
                    formControlName="relateTo"
                    aria-label="user"
                    aria-describedby="button-addon2"
                    [ngClass]="{
                      'is-invalid':
                        h['taskRelatedTo']?.invalid &&
                        (h['taskRelatedTo']?.dirty ||
                          h['taskRelatedTo']?.touched)
                    }"
                  />
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    id="button-addon"
                    (click)="openAllUsersModal('taskRelatedTo')"
                  >
                    <i class="fa-solid fa-plus open-all-users-modal"></i>
                  </button>
                </div>
                <div
                  *ngIf="
                    h['taskRelatedTo']?.invalid &&
                    (h['taskRelatedTo']?.dirty || h['taskRelatedTo']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="h['taskRelatedTo']?.errors['required']">
                    Related to is required
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.priority === 'Y'">
              <div class="col-md-6">
                <label class="form-label w-100" for="priority">Priority</label>
                <select
                  id="priority"
                  class="form-select"
                  formControlName="priority"
                  [ngClass]="{
                    'is-invalid':
                      h['priority']?.invalid &&
                      (h['priority']?.dirty || h['priority']?.touched)
                  }"
                >
                  <ng-container *ngFor="let aType of activityTypes">
                    <option value="{{ aType.id }}">{{ aType.desc }}</option>
                  </ng-container>
                </select>
                <div
                  *ngIf="
                    h['priority']?.invalid &&
                    (h['priority']?.dirty || h['priority']?.touched)
                  "
                  class="form-text text-danger"
                >
                  <div *ngIf="h['priority']?.errors['required']">
                    Priority is required
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary create-update-activity-task"
          (click)="createUpdateActivityTask()"
        >
          Save details
        </button>
      </div>
    </div>
  </div>
</div>

<!--Modal for Listing all users !-->
<app-dynamic-simple-modal
  [modalVisible]="allUsersModalVisible"
  [modalButtonLabel]="'Okay'"
  [modalTitle]="'Add participant'"
  [useDynamicContent]="true"
  [zIndex]="firstModalZIndex"
  (actionEmitter)="processSelectedUser($event)"
  id="process-selected-user"
>
  <!---Use content projection !-->
  <div modal-body-content>
    <app-staff-modal
      #staffModal
      (userSelected)="getSelectedUser($event)"
      id="get-selected-user"
      [accountType]="selectedUserType"
    >
    </app-staff-modal>
  </div>
  <!---Use content projection !-->
</app-dynamic-simple-modal>
<!-- add backdrop element that is shown when the allUsersModalVisible is true and has a lower z-index value -->
<div
  class="modal-backdrop fade"
  *ngIf="allUsersModalVisible"
  [style.z-index]="firstModalZIndex"
></div>

<!--Delete Modal -->
<div
  class="modal fade"
  id="deleteModal"
  tabindex="-1"
  aria-labelledby="deleteModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="border: none">
        <h1 class="modal-title fs-5 text-danger" id="deleteModalLabel">
          Confirm {{ activityText | uppercase }} delete!
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          #closeDeleteButton
        ></button>
      </div>
      <div class="modal-body">
        <p class="fs-5 text-muted">
          Are you sure you want to delete the selected {{ activityText }}?
        </p>
      </div>
      <div class="modal-footer" style="border: none">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-danger delete-activity-task"
          (click)="confirmDelete(activityText)"
        >
          Confirm Delete
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Related Account modal -->
<!-- <button
  type="button"
  class="btn btn-primary"
  data-bs-toggle="modal"
  data-bs-target="#relatedToModal"
>
  Related To
</button> -->

<!-- Modal -->
<!-- <div
  class="modal fade"
  id="relatedToModal"
  tabindex="-1"
  aria-labelledby="relatedToModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h1 class="modal-title fs-5 text-dark" id="relatedToModalLabel">
          Select related user
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="filter-row">
          <div class="row my-3">
            <div class="col-sm-5">
              <select
                #userType
                (click)="fetchAccountByAccountType(userType.value)"
                class="form-select"
                aria-label="Default select example"
              >
                <option selected>Account type</option>
                <option value="AGENT">Agent</option>
                <option value="CLIENT">Client</option>
                <option value="SERVICE_PROVIDER">Service provider</option>
              </select>
            </div>
            <div class="col-sm-5">
              <input
                type="text"
                class="form-control"
                placeholder="Search by name, email"
                aria-label="Last name"
              />
            </div>
          </div>
          <ng-container>
            <p-table
              [autoLayout]="true"
              [rowHover]="true"
              [resizableColumns]="true"
              [showCurrentPageReport]="true"
              [rows]="pageSize || 5"
              [totalRecords]="accountData?.totalElements"
              [value]="accountData?.content"
              [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
              [paginator]="true"
              responsiveLayout="stack"
              [scrollable]="true"
              [lazy]="true"
              [loading]="loading"
              (onLazyLoad)="fetchAccountByAccountType('', $event)"
              [(selection)]="selectedAccount"
              selectionMode="single"
              dataKey="id"
              scrollHeight="400px"
              currentPageReportTemplate="{first} - {last} of {totalRecords}"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-user>
                <tr [pSelectableRow]="user">
                  <td class="p-2">{{ user.firstName }} {{ user.lastName }}</td>
                  <td>{{ user.emailAddress }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="3">No User Detail(s) Found.</td>
                </tr>
              </ng-template>
            </p-table>
          </ng-container>
        </div>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
        <button type="button" class="btn btn-primary">OK</button>
      </div>
    </div>
  </div>
</div> -->
