<div class="row col-12">
  <div class="col-2">
    <div class="card">
      <ul class="nav nav-tabs flex-column mb-3" id="ex1" role="tablist">
        <ng-container *ngFor="let nav of navigationLinks">
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="{{nav.id}}" data-bs-toggle="tab" href="#{{nav.url}}" role="tab" (click)="tabNavigation(nav.id)">{{nav.title}}</a>
          </li>
        </ng-container>
      </ul>
    </div>
  </div>
  <div class="col-10">
    <div class="card p-2">
      <div class="card-body">
        <div class="tab-content" id="ex1-content">
          <ng-container *ngIf="currentTab.url === 'campaignDetails'">
            <div class="tab-pane fade" id="campaignDetails" [ngClass]="{'show active': currentTab.url === 'campaignDetails'}"
                 role="tabpanel" aria-labelledby="ex1-tab-1">

              <form [formGroup]="createCampaignDefinitionForm">
                <h5>{{'campaignMngmt.campaignDefinition'| translate }}</h5>
                <h6>{{'campaignMngmt.basicInformation'| translate }}</h6>
                <div class="row">
                  <ng-container *ngIf="visibleStatus.name === 'Y'">
                    <div class="col-md-4">
                      <label for="name" class="form-label">{{'campaignMngmt.name'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="name"
                        formControlName="name"
                        [ngClass]="{ 'is-invalid': f['name']?.invalid && (f['name']?.dirty || f['name']?.touched) }"
                      />
                      <div *ngIf="f['name']?.invalid && (f['name']?.dirty || f['name']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['name']?.errors['required']">Name is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.system === 'Y'">
                    <div class="col-md-4">
                      <label for="system" class="form-label">{{'campaignMngmt.systemType'| translate }}</label>
                      <p-dropdown
                        [options]="systems"
                        optionLabel="shortDesc"
                        optionValue="id"
                        formControlName="system"
                        id="system"
                        [filter]="true"
                        filterBy="shortDesc"
                        [showClear]="true"
                        [style]="{ width: '100%', height: '50%' }"
                        appendTo="body"
                        placeholder="Select option"
                        [(ngModel)]="selectedSystem"
                        (onChange)="onSystemChange()"
                        [ngClass]="{ 'is-invalid': f['system']?.invalid && (f['system']?.dirty || f['system']?.touched) }"
                      >
                      </p-dropdown>
                      <div *ngIf="f['system']?.invalid && (f['system']?.dirty || f['system']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['system']?.errors['required']">System is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.description === 'Y'">
                    <div class="col-md-4">
                      <label for="description" class="form-label">{{'campaignMngmt.description'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="description"
                        formControlName="description"
                        [ngClass]="{ 'is-invalid': f['description']?.invalid && (f['description']?.dirty || f['description']?.touched) }"
                      />
                      <div *ngIf="f['description']?.invalid && (f['description']?.dirty || f['description']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['description']?.errors['required']">Description is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.objective === 'Y'">
                    <div class="col-md-4">
                      <label for="objective" class="form-label">{{'campaignMngmt.objective'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="objective"
                        formControlName="objective"
                        [ngClass]="{ 'is-invalid': f['objective']?.invalid && (f['objective']?.dirty || f['objective']?.touched) }"
                      />
                      <div *ngIf="f['objective']?.invalid && (f['objective']?.dirty || f['objective']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['objective']?.errors['required']">Objective is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.dateFrom === 'Y'">
                    <div class="col-md-4">
                      <label for="dateFrom" class="form-label">{{'campaignMngmt.from'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="dateFrom"
                        placeholder="Date from"
                        onfocus="(this.type='date')"
                        onblur="(this.type='text')"
                        formControlName="dateFrom"
                        [ngClass]="{ 'is-invalid': f['dateFrom']?.invalid && (f['dateFrom']?.dirty || f['dateFrom']?.touched) }"
                      />
                      <div *ngIf="f['dateFrom']?.invalid && (f['dateFrom']?.dirty || f['dateFrom']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['dateFrom']?.errors['required']">Date from is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.dateTo === 'Y'">
                    <div class="col-md-4">
                      <label for="dateTo" class="form-label">{{'campaignMngmt.to'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="dateTo"
                        placeholder="Date to"
                        onfocus="(this.type='date')"
                        onblur="(this.type='text')"
                        formControlName="dateTo"
                        [ngClass]="{ 'is-invalid': f['dateTo']?.invalid && (f['dateTo']?.dirty || f['dateTo']?.touched) }"
                      />
                      <div *ngIf="f['dateTo']?.invalid && (f['dateTo']?.dirty || f['dateTo']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['dateTo']?.errors['required']">Date to is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.executionTime === 'Y'">
                    <div class="col-md-4">
                      <label for="executionTime" class="form-label">{{'campaignMngmt.executionTime'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="executionTime"
                        onfocus="(this.type='datetime-local')"
                        onblur="(this.type='text')"
                        formControlName="executionTime"
                        [ngClass]="{ 'is-invalid': f['executionTime']?.invalid && (f['executionTime']?.dirty || f['executionTime']?.touched) }"
                      />
                      <div *ngIf="f['executionTime']?.invalid && (f['executionTime']?.dirty || f['executionTime']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['executionTime']?.errors['required']">Execution time is required</div>
                      </div>
                    </div>
                  </ng-container>
                </div>

                <h6>{{'campaignMngmt.assignment'| translate }}</h6>
                <div class="row">
                  <ng-container *ngIf="visibleStatus.assignedTo === 'Y'">
                    <div class="col-md-4">
                      <label for="assignedTo" class="form-label">{{'campaignMngmt.assignedTo'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="assignedTo"
                        value="{{selectedMainUser?.name}}"
                        id="assignedTo"
                        readonly
                        (click)="openAllUsersModal()"
                        [ngClass]="{ 'is-invalid': f['assignedTo']?.invalid && (f['assignedTo']?.dirty || f['assignedTo']?.touched) }"
                      />
                      <div *ngIf="f['assignedTo']?.invalid && (f['assignedTo']?.dirty || f['assignedTo']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['assignedTo']?.errors['required']">Assigned to is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.organization === 'Y'">
                    <div class="col-md-4">
                      <label for="organization" class="form-label">{{'campaignMngmt.organization'| translate }}</label>
                      <p-dropdown
                        [options]="organizations"
                        optionLabel="name"
                        optionValue="id"
                        formControlName="organization"
                        id="organization"
                        [filter]="true"
                        filterBy="name"
                        [showClear]="true"
                        [style]="{ width: '100%', height: '50%' }"
                        appendTo="body"
                        placeholder="Select option"
                        [ngClass]="{ 'is-invalid': f['organization']?.invalid && (f['organization']?.dirty || f['organization']?.touched) }"
                      >
                        <ng-template let-organization pTemplate="item">
                          <div title="{{organization?.name}}">
                            {{ organization?.name.length > 10 ? organization?.name.substring(0, 20) + '...' : organization?.name }}
                          </div>
                        </ng-template>
                      </p-dropdown>
                      <div *ngIf="f['organization']?.invalid && (f['organization']?.dirty || f['organization']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['organization']?.errors['required']">Organization is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.team === 'Y'">
                    <div class="col-md-4">
                      <label for="team" class="form-label">{{'campaignMngmt.team'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="team"
                        formControlName="team"
                        value="{{selectedDefaultUser?.username}}"
                        readonly
                        (click)="showGroupMembers()"
                        [ngClass]="{ 'is-invalid': f['team']?.invalid && (f['team']?.dirty || f['team']?.touched) }"
                      />
                      <div *ngIf="f['team']?.invalid && (f['team']?.dirty || f['countryCode']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['team']?.errors['required']">Team is required</div>
                      </div>
                    </div>
                  </ng-container>
                </div>
                <h6>{{'campaignMngmt.financialInformation'| translate }}</h6>
                <div class="row">
                  <ng-container *ngIf="visibleStatus.currency === 'Y'">
                    <div class="col-md-4">
                      <label for="currency" class="form-label">{{'campaignMngmt.currency'| translate }}</label>
                      <p-dropdown
                        [options]="currencies"
                        optionLabel="name"
                        optionValue="id"
                        formControlName="currency"
                        id="currency"
                        [filter]="true"
                        filterBy="shortDesc"
                        [showClear]="true"
                        [style]="{ width: '100%', height: '50%' }"
                        appendTo="body"
                        placeholder="Select option"
                        [ngClass]="{ 'is-invalid': f['currency']?.invalid && (f['currency']?.dirty || f['currency']?.touched) }"
                      >
                        <ng-template let-currency pTemplate="item">
                          <div title="{{currency?.name}}">
                            {{ currency?.name.length > 10 ? currency?.name.substring(0, 20) + '...' : currency?.name }}
                          </div>
                        </ng-template>
                      </p-dropdown>
                      <div *ngIf="f['currency']?.invalid && (f['currency']?.dirty || f['currency']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['currency']?.errors['required']">Currency is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.budgetedCost === 'Y'">
                    <div class="col-md-4">
                      <label for="budgetedCost" class="form-label">{{'campaignMngmt.budgetedCost'| translate }}</label>
                      <input
                        type="number"
                        class="form-control"
                        id="budgetedCost"
                        formControlName="budgetedCost"
                        [ngClass]="{ 'is-invalid': f['budgetedCost']?.invalid && (f['budgetedCost']?.dirty || f['budgetedCost']?.touched) }"
                      />
                      <div *ngIf="f['budgetedCost']?.invalid && (f['budgetedCost']?.dirty || f['countryCode']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['budgetedCost']?.errors['required']">Budgeted cost is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.actualCost === 'Y'">
                    <div class="col-md-4">
                      <label for="actualCost" class="form-label">{{'campaignMngmt.actualCost'| translate }}</label>
                      <input
                        type="number"
                        class="form-control"
                        id="actualCost"
                        formControlName="actualCost"
                        [ngClass]="{ 'is-invalid': f['actualCost']?.invalid && (f['actualCost']?.dirty || f['actualCost']?.touched) }"
                      />
                      <div *ngIf="f['actualCost']?.invalid && (f['actualCost']?.dirty || f['countryCode']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['actualCost']?.errors['required']">Actual cost is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.expectedCost === 'Y'">
                    <div class="col-md-4">
                      <label for="expectedCost" class="form-label">{{'campaignMngmt.expectedCost'| translate }}</label>
                      <input
                        type="number"
                        class="form-control"
                        id="expectedCost"
                        formControlName="expectedCost"
                        [ngClass]="{ 'is-invalid': f['expectedCost']?.invalid && (f['expectedCost']?.dirty || f['expectedCost']?.touched) }"
                      />
                      <div *ngIf="f['expectedCost']?.invalid && (f['expectedCost']?.dirty || f['countryCode']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['expectedCost']?.errors['required']">Expected cost is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.expectedRevenue === 'Y'">
                    <div class="col-md-4">
                      <label for="expectedRevenue" class="form-label">{{'campaignMngmt.expectedRevenue'| translate }}e</label>
                      <input
                        type="number"
                        class="form-control"
                        id="expectedRevenue"
                        formControlName="expectedRevenue"
                        [ngClass]="{ 'is-invalid': f['expectedRevenue']?.invalid && (f['expectedRevenue']?.dirty || f['expectedRevenue']?.touched) }"
                      />
                      <div *ngIf="f['expectedRevenue']?.invalid && (f['expectedRevenue']?.dirty || f['expectedRevenue']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['expectedRevenue']?.errors['required']">Expected revenue is required</div>
                      </div>
                    </div>
                  </ng-container>
                </div>

                <h6>{{'campaignMngmt.campaignDetails'| translate }}</h6>
                <div class="row">
                  <ng-container *ngIf="visibleStatus.sponsor === 'Y'">
                    <div class="col-md-4">
                      <label for="sponsor" class="form-label">{{'campaignMngmt.sponsorPartner'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="sponsor"
                        formControlName="sponsor"
                        [ngClass]="{ 'is-invalid': f['sponsor']?.invalid && (f['sponsor']?.dirty || f['sponsor']?.touched) }"
                      />
                      <div *ngIf="f['sponsor']?.invalid && (f['sponsor']?.dirty || f['countryCode']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['sponsor']?.errors['required']">Sponsor is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.campaignType === 'Y'">
                    <div class="col-md-4">
                      <label for="campaignType" class="form-label">{{'campaignMngmt.campaignType'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="campaignType"
                        formControlName="campaignType"
                        [ngClass]="{ 'is-invalid': f['campaignType']?.invalid && (f['campaignType']?.dirty || f['campaignType']?.touched) }"
                      />
                      <div *ngIf="f['campaignType']?.invalid && (f['campaignType']?.dirty || f['campaignType']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['campaignType']?.errors['required']">Campaign type is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.status === 'Y'">
                    <div class="col-md-4">
                      <label for="status" class="form-label">{{'campaignMngmt.status'| translate }}</label>
                      <select id="status" class="form-select" formControlName="status"
                              [ngClass]="{ 'is-invalid': f['status']?.invalid && (f['status']?.dirty || f['status']?.touched) }">
                        <option value="A">Active</option>
                        <option value="N">Inactive</option>
                      </select>
                      <div *ngIf="f['status']?.invalid && (f['status']?.dirty || f['status']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['status']?.errors['required']">Status is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.pageImpressions === 'Y'">
                    <div class="col-md-4">
                      <label for="pageImpressions" class="form-label">{{'campaignMngmt.pageImpressions'| translate }}</label>
                      <input
                        type="number"
                        class="form-control"
                        id="pageImpressions"
                        formControlName="pageImpressions"
                        [ngClass]="{ 'is-invalid': f['pageImpressions']?.invalid && (f['pageImpressions']?.dirty || f['pageImpressions']?.touched) }"
                      />
                      <div *ngIf="f['pageImpressions']?.invalid && (f['pageImpressions']?.dirty || f['pageImpressions']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['pageImpressions']?.errors['required']">Page impressions is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.event === 'Y'">
                    <div class="col-md-4">
                      <label for="event" class="form-label">{{'campaignMngmt.event'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="event"
                        formControlName="event"
                        [ngClass]="{ 'is-invalid': f['event']?.invalid && (f['event']?.dirty || f['event']?.touched) }"
                      />
                      <div *ngIf="f['event']?.invalid && (f['event']?.dirty || f['countryCode']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['event']?.errors['required']">Event is required</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="visibleStatus.venue === 'Y'">
                    <div class="col-md-4">
                      <label for="venue" class="form-label">{{'campaignMngmt.venue'| translate }}</label>
                      <input
                        type="text"
                        class="form-control"
                        id="venue"
                        formControlName="venue"
                        [ngClass]="{ 'is-invalid': f['venue']?.invalid && (f['venue']?.dirty || f['venue']?.touched) }"
                      />
                      <div *ngIf="f['venue']?.invalid && (f['venue']?.dirty || f['venue']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['venue']?.errors['required']">Venue is required</div>
                      </div>
                    </div>
                  </ng-container>
                </div>

                <h6>{{'campaignMngmt.campaignProducts'| translate }}</h6>
                <div class="row">
                  <ng-container *ngIf="visibleStatus.products === 'Y'">
                    <div class="col-md-4">
                      <label for="products" class="form-label">{{'campaignMngmt.products'| translate }}</label>
                      <p-multiSelect
                        [options]="productList"
                        formControlName="products"
                        optionLabel="description"
                        id="products"
                        [filter]="true"
                        filterBy="description"
                        [style]="{ 'width': '100%', 'height': '40px' }"
                        placeholder="Select product"
                        [(ngModel)]="selectedOptions"
                        [ngClass]="{ 'is-invalid': f['products']?.invalid && (f['products']?.dirty || f['products']?.touched) }"
                      >
                        <ng-template let-product pTemplate="item">
                          <div title="{{product.description}}">
                            {{ product.description.length > 10 ? product.description.substring(0, 28) + '...' : product.description }}
                          </div>
                        </ng-template>
                      </p-multiSelect>
                      <div *ngIf="f['products']?.invalid && (f['products']?.dirty || f['products']?.touched)" class="form-text text-danger">
                        <div *ngIf="f['products']?.errors['required']">Products is required</div>
                      </div>
                    </div>
                  </ng-container>

                  <div *ngFor="let product of selectedOptions" class="col-md-3">
                    <div class="row pill-box fadeIn">
                      <div class="col-md-9 col-9 text-primary fw-medium">
                        <span *ngIf = "product?.description" title="{{product?.description}}">
                          {{product?.description?.substring(0,13) | titlecase}}...
                        </span>
                      </div>
                      <div class="col-md-3 col-3 text-end">

                        <i class="pi pi-times text-primary" (click)="deleteProduct(product)"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </ng-container>

          <ng-container *ngIf="currentTab.url === 'targets'">
            <div class="tab-pane fade" id="targets" [ngClass]="{'show active': currentTab.url === 'targets'}"
                 role="tabpanel" aria-labelledby="ex1-tab-2">

              <h6 class="text-dark">{{'campaignMngmt.campaignTargets'| translate }}</h6>
              <div class="row mb-2">
                <div class="col-sm-12 col-md-6">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search for campaign target"
                    aria-label="search"
                    aria-describedby="search"
                    (input)="filterCampaignTargets($event)"
                  />
                </div>

                <div class="col-sm-12 col-md-6 d-flex justify-content-lg-end mt-2">
                  <div class="float-end">
                    <span class="icon-circle">
                      <i class="fa-solid fa-plus"
                         (click)="openTargetModal()"></i>
                    </span>
                    <!--<span class="icon-circle">
                      <i class="pi pi-pencil"
                      (click)="editCampaignTarget()"></i>
                    </span>-->
                    <span class="icon-circle">
                      <i class="fa-regular fa-trash-can" (click)="deleteCampaignTarget()"></i>
                    </span>
                  </div>
                </div>
              </div>
              <div>
                <ngx-spinner type="ball-clip-rotate-multiple" [fullScreen]="false" color="#00529B" size="medium" bdColor = "rgba(255, 255, 255, 0.966)"></ngx-spinner>
                <p-table
                  #campaignsTargetTable
                  [autoLayout]="true"
                  [rowHover]="true"
                  [paginator]="true"
                  [resizableColumns]="true"
                  [showCurrentPageReport]="true"
                  [rows]="pageSize || 5"
                  [totalRecords]="campaignTargetData?.length"
                  [value]="campaignTargetData"
                  [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
                  responsiveLayout="stack"
                  [scrollable]="true"
                  [(selection)]="selectedCampaignTarget"
                  selectionMode="single"
                  dataKey="code"
                  scrollHeight="400px"
                  currentPageReportTemplate="{first} - {last} of {totalRecords}"
                  [globalFilterFields]="['accountType', 'emailAddress']"
                >

                  <ng-template pTemplate="header">
                    <tr>
                      <th pSortableColumn="accountType">{{'campaignMngmt.target'| translate }} <p-sortIcon field="accountType"></p-sortIcon></th>
                      <th pSortableColumn="emailAddress">{{'campaignMngmt.email'| translate }} <p-sortIcon field="emailAddress"></p-sortIcon></th>
                      <th pSortableColumn="targetDate">{{'campaignMngmt.date'| translate }} <p-sortIcon field="targetDate"></p-sortIcon></th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-campaignTarget>
                    <tr [pSelectableRow]="campaignTarget">
                      <td>{{campaignTarget?.accountType}}</td>
                      <td>{{campaignTarget?.emailAddress}}</td>
                      <td>{{campaignTarget?.targetDate | date:'mediumDate'}}</td>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="emptymessage">
                    <tr>
                      <td colspan="3">No Campaign Target Detail(s) Found.</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>

            </div>
          </ng-container>

          <ng-container *ngIf="currentTab.url === 'activities'">
            <div class="tab-pane fade" id="activities" [ngClass]="{'show active': currentTab.url === 'activities'}" role="tabpanel" aria-labelledby="ex1-tab-3">
              <h6 class="text-dark">{{'campaignMngmt.campaignActivities'| translate }}</h6>
              <div class="row mb-2">
                <div class="col-sm-12 col-md-6">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search for campaign activities"
                    aria-label="search"
                    aria-describedby="search"
                    (input)="filterCampaignActivities($event)"
                  />
                </div>

                <div class="col-sm-12 col-md-6 d-flex justify-content-lg-end mt-2">
                  <div class="float-end">
                    <span class="icon-circle">
                      <i class="fa-solid fa-plus"
                         (click)="openCampaignActivityModal()"></i>
                    </span>
                    <!--<span class="icon-circle">
                      <i class="pi pi-pencil"
                         (click)="editCampaignActivity()"></i>
                    </span>-->
                    <span class="icon-circle">
                      <i class="fa-regular fa-trash-can" (click)="deleteCampaignActivity()"></i>
                    </span>
                  </div>
                </div>
              </div>
              <p-table
                #campaignsActivityTable
                [autoLayout]="true"
                [rowHover]="true"
                [resizableColumns]="true"
                [paginator]="true"
                [showCurrentPageReport]="true"
                [rows]="pageSize || 5"
                [totalRecords]="campaignActivityData?.length"
                [value]="campaignActivityData"
                [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
                responsiveLayout="stack"
                [scrollable]="true"
                [(selection)]="selectedCampaignActivity"
                selectionMode="single"
                dataKey="code"
                scrollHeight="400px"
                currentPageReportTemplate="{first} - {last} of {totalRecords}"
                [globalFilterFields]="['desc', 'subject']"
              >

                <ng-template pTemplate="header">
                  <tr>
                    <th pSortableColumn="subject">{{'campaignMngmt.subject'| translate }} <p-sortIcon field="subject"></p-sortIcon></th>
                    <th pSortableColumn="desc">{{'campaignMngmt.description'| translate }} <p-sortIcon field="desc"></p-sortIcon></th>
                    <th pSortableColumn="wef">{{'campaignMngmt.wef'| translate }} <p-sortIcon field="wef"></p-sortIcon></th>
                    <th pSortableColumn="wet">{{'campaignMngmt.wet'| translate }} <p-sortIcon field="wet"></p-sortIcon></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-campaignActivity>
                  <tr [pSelectableRow]="campaignActivity">
                    <td>{{campaignActivity?.subject}}</td>
                    <td>{{campaignActivity?.desc}}</td>
                    <td>{{campaignActivity?.wef}}</td>
                    <td>{{campaignActivity?.wet}}</td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="4">No Campaign Activity Detail(s) Found.</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </ng-container>
          <ng-container *ngIf="currentTab.url === 'messages'">
            <div class="tab-pane fade" id="messages" [ngClass]="{'show active': currentTab.url === 'messages'}" role="tabpanel" aria-labelledby="ex1-tab-4">
              <h6 class="text-dark">{{'campaignMngmt.campaignMessages'| translate }} </h6>
              <div class="row mb-2">
                <div class="col-sm-12 col-md-6">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search for campaign messages"
                    aria-label="search"
                    aria-describedby="search"
                    (input)="filterCampaignMessages($event)"
                  />
                </div>

                <div class="col-sm-12 col-md-6 d-flex justify-content-lg-end mt-2">
                  <div class="float-end">
                    <span class="icon-circle">
                      <i class="fa-solid fa-plus"
                         (click)="openCampaignMessageModal()"></i>
                    </span>
                    <span class="icon-circle">
                      <i class="pi pi-pencil"
                        (click)="editCampaignMessage()"></i>
                    </span>
                    <span class="icon-circle">
                      <i class="fa-regular fa-trash-can"
                         (click)="deleteCampaignMessage()"></i>
                    </span>
                  </div>
                </div>
              </div>
              <p-table
                #campaignMessagesTable
                [autoLayout]="true"
                [rowHover]="true"
                [resizableColumns]="true"
                [paginator]="true"
                [showCurrentPageReport]="true"
                [rows]="pageSize || 5"
                [totalRecords]="campaignMessageData?.length"
                [value]="campaignMessageData"
                [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
                responsiveLayout="stack"
                [scrollable]="true"
                dataKey="code"
                scrollHeight="400px"
                currentPageReportTemplate="{first} - {last} of {totalRecords}"
                [globalFilterFields]="['messageSubject']"
              >

                <ng-template pTemplate="header">
                  <tr>
                    <th pSortableColumn="messageSubject">{{'campaignMngmt.subject'| translate }} <p-sortIcon field="messageSubject"></p-sortIcon></th>
                    <th pSortableColumn="messageBody">{{'campaignMngmt.body'| translate }} <p-sortIcon field="messageBody"></p-sortIcon></th>
                    <th pSortableColumn="date">{{'campaignMngmt.date'| translate }} <p-sortIcon field="date"></p-sortIcon></th>
                    <th pSortableColumn="sendAll">{{'campaignMngmt.sendToAll'| translate }}? <p-sortIcon field="date"></p-sortIcon></th>
                    <th pSortableColumn="status">{{'campaignMngmt.messageStatus'| translate }} <p-sortIcon field="status"></p-sortIcon></th>
                    <th pSortableColumn="imageUrl">{{'campaignMngmt.hasImage'| translate }}? <p-sortIcon field="imageUrl"></p-sortIcon></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-campaignMessage>
                  <tr
                    class="custom-table"
                    (click)="onCampaignMessageSelect(campaignMessage)"
                    [class.selected]="selectedCampaignMessage === campaignMessage">
                    <td>
                      <span *ngIf = "campaignMessage?.messageSubject" title="{{campaignMessage?.messageSubject}}">
                        {{campaignMessage?.messageSubject?.substring(0,15) | titlecase}}...
                      </span>
                    </td>
                    <td>
                      <span *ngIf = "campaignMessage?.messageBody" title="{{campaignMessage?.messageBody}}">
                        {{campaignMessage?.messageBody?.substring(0,15) | titlecase}}...
                      </span>
                    </td>
                    <td>{{campaignMessage?.date | date:'mediumDate'}}</td>
                    <td>{{campaignMessage?.sendAll}}</td>
                    <td>{{campaignMessage?.status}}</td>
                    <td>{{campaignMessage?.imageUrl}}</td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="4">No Campaign Message Detail(s) Found.</td>
                  </tr>
                </ng-template>
              </p-table>

              <h6 class="text-dark">{{'campaignMngmt.trackerURLS'| translate }}</h6>
              <div class="row mb-2">
                <div class="col-sm-12 col-md-6">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search for tracker urls"
                    aria-label="search"
                    aria-describedby="search"
                  />
                </div>

                <div class="col-sm-12 col-md-6 d-flex justify-content-lg-end mt-2">
                  <div class="float-end">
                    <span class="icon-circle">
                      <i class="fa-solid fa-plus"
                         (click)="openTrackerUrlModal()"></i>
                    </span>
                    <span class="icon-circle">
                      <i class="pi pi-pencil"
                         (click)="editTrackerUrl()"></i>
                    </span>
                    <span class="icon-circle">
                      <i class="fa-regular fa-trash-can"></i>
                    </span>
                  </div>
                </div>
              </div>
              <p-table
                #trackerUrlsTable
                [autoLayout]="true"
                [rowHover]="true"
                [resizableColumns]="true"
                [showCurrentPageReport]="true"
                [rows]="pageSize || 5"
                [totalRecords]="trackerUrlData?.length"
                [value]="trackerUrlData"
                [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
                responsiveLayout="stack"
                [scrollable]="true"
                [(selection)]="selectedCampaignTarget"
                selectionMode="single"
                dataKey="code"
                scrollHeight="400px"
                currentPageReportTemplate="{first} - {last} of {totalRecords}"
                [globalFilterFields]="['description', 'code']"
              >

                <ng-template pTemplate="header">
                  <tr>
                    <th pSortableColumn="target">{{'campaignMngmt.name'| translate }}  <p-sortIcon field="target"></p-sortIcon></th>
                    <th pSortableColumn="email">{{'campaignMngmt.url'| translate }}  <p-sortIcon field="email"></p-sortIcon></th>
                    <th pSortableColumn="date">{{'campaignMngmt.description'| translate }} <p-sortIcon field="date"></p-sortIcon></th>
                    <th pSortableColumn="date">{{'campaignMngmt.action'| translate }} <p-sortIcon field="date"></p-sortIcon></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-campaignTarget>
                  <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="4">No Tracker URL Detail(s) Found.</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </ng-container>
          <ng-container *ngIf="currentTab.url === 'performance'">
            <div class="tab-pane fade" id="performance" [ngClass]="{'show active': currentTab.url === 'performance'}" role="tabpanel" aria-labelledby="ex1-tab-5">
              <h5 class="text-dark">{{'campaignMngmt.campaignPerformance'| translate }}</h5>
              <div class="row">
                <div class="col-lg-4">
                  <h6 class="text-dark">{{'campaignMngmt.campaignName'| translate }}: Campaign AA</h6>
                </div>
                <div class="col-lg-2">
                  <label class="text-dark" style="margin-top: .6rem;">{{'campaignMngmt.status'| translate }}: <span class="text-green">Active</span></label>
                </div>
                <label class="text-dark w-auto" style="margin-top: .6rem;">{{'campaignMngmt.dateRange'| translate }}:</label>
                <div class="col-lg-2">

                  <input
                    type="date"
                    class="form-control"
                  />
                </div>
                <div class="col-lg-2">
                  <input
                    type="date"
                    class="form-control"
                  />
                </div>
              </div>

              <div class="container py-2 border border-primary rounded">
                <div class="row col-sm-4 col-md-12 col-lg-12">
                  <div class="row col">
                    <label class="text-black" style="margin-top: .6rem;font-size: 14px;">{{'campaignMngmt.messagesSent'| translate }}</label>
                    <div class="col-5 pe-0">
                      <h6>10,000</h6>
                    </div>
                    <div class="col-6">
                      <label class="text-green w-auto" style="margin-top: .6rem;">
                        <i class="fa fa-arrow-up"></i> 15%
                      </label>
                    </div>
                  </div>
                  <div class="row col">
                    <label class="text-black" style="margin-top: .6rem;font-size: 14px;">{{'campaignMngmt.messagesQueue'| translate }}</label>
                    <div class="col-5 pe-0">
                      <h6>6,000</h6>
                    </div>
                    <div class="col-6">
                      <label class="text-green w-auto" style="margin-top: .6rem;">
                        <i class="fa fa-arrow-up"></i> 15%
                      </label>
                    </div>
                  </div>
                  <div class="row col">
                    <label class="text-black" style="margin-top: .6rem;font-size: 14px;">{{'campaignMngmt.viewedMessages'| translate }}</label>
                    <div class="col-5 pe-0">
                      <h6>4,000</h6>
                    </div>
                    <div class="col-6">
                      <label class="text-green w-auto" style="margin-top: .6rem;">
                        <i class="fa fa-arrow-up"></i> 15%
                      </label>
                    </div>
                  </div>
                  <div class="row col">
                    <label class="text-black" style="margin-top: .6rem;font-size: 14px;">{{'campaignMngmt.clickThruLink'| translate }}</label>
                    <div class="col-5 pe-0">
                      <h6>3,000</h6>
                    </div>
                    <div class="col-6">
                      <label class="text-green w-auto" style="margin-top: .6rem;">
                        <i class="fa fa-arrow-up"></i> 15%
                      </label>
                    </div>
                  </div>
                  <div class="row col">
                    <label class="text-black" style="margin-top: .6rem;font-size: 14px;">{{'campaignMngmt.optedOut'| translate }}</label>
                    <div class="col-5 pe-0">
                      <h6>500</h6>
                    </div>
                    <div class="col-6">
                      <label class="text-green w-auto" style="margin-top: .6rem;">
                        <i class="fa fa-arrow-up"></i> 15%
                      </label>
                    </div>
                  </div>
                  <div class="row col">
                    <label class="text-black" style="margin-top: .6rem;font-size: 14px;">{{'campaignMngmt.suppressed'| translate }}</label>
                    <div class="col-5 pe-0">
                      <h6>120</h6>
                    </div>
                    <div class="col-6">
                      <label class="text-green w-auto" style="margin-top: .6rem;">
                        <i class="fa fa-arrow-up"></i> 15%
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <h5 class="text-dark">{{'campaignMngmt.performanceOverTime'| translate }}</h5>
              <div class="row col-sm-12 col-lg-6 mb-2">
                <label class="w-auto" style="margin-top: .6rem;">{{'campaignMngmt.metric'| translate }}</label>
                <select class="form-select w-50">
                  <option value="">Messages sent</option>
                  <option value="">Messages queue</option>
                  <option value="">Viewed messages</option>
                  <option value="">Click-thru links</option>
                  <option value="">Contacts created</option>
                  <option value="">Opted out</option>
                  <option value="">Suppressed by email addresses</option>
                </select>
              </div>
              <div>
                <app-dynamic-chart
                  [chartType]="'line'"
                  [basicData]="basicData"
                  [chartTitle]="'Performance over time'"
                ></app-dynamic-chart>
              </div>

              <h5 class="text-dark">{{'campaignMngmt.topPerformingProducts'| translate }}</h5>
              <div class="row col-sm-12 col-lg-6 mb-2">
                <label class="w-auto" style="margin-top: .6rem;">{{'campaignMngmt.metric'| translate }}</label>
                <select class="form-select w-50">
                  <option value="">Messages sent</option>
                  <option value="">Messages queue</option>
                  <option value="">Viewed messages</option>
                  <option value="">Click-thru links</option>
                  <option value="">Contacts created</option>
                  <option value="">Opted out</option>
                  <option value="">Suppressed by email addresses</option>
                </select>
              </div>
              <p-table
                #campaignsTargetSearchTable
                [autoLayout]="true"
                [rowHover]="true"
                [resizableColumns]="true"
                [showCurrentPageReport]="true"
                [rows]="pageSize || 5"
                [totalRecords]="campaignTargetSearchData?.length"
                [value]="campaignTargetSearchData"
                [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
                responsiveLayout="stack"
                [scrollable]="true"
                selectionMode="single"
                dataKey="code"
                scrollHeight="400px"
                currentPageReportTemplate="{first} - {last} of {totalRecords}"
                [globalFilterFields]="['description', 'code']"
              >

                <ng-template pTemplate="header">
                  <tr>
                    <th pSortableColumn="target">{{'campaignMngmt.product'| translate }} <p-sortIcon field="target"></p-sortIcon></th>
                    <th pSortableColumn="email">{{'campaignMngmt.total'| translate }}(Metric selected above) <p-sortIcon field="email"></p-sortIcon></th>
                    <th pSortableColumn="date">{{'campaignMngmt.categoryAudience'| translate }} <p-sortIcon field="date"></p-sortIcon></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-campaignTarget>
                  <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="3">No Performing Product Detail(s) Found.</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </ng-container>

        </div>
      </div>

    </div>
  </div>
  <div class="d-flex justify-content-end mt-2">
    <button class="btn btn-primary" (click)="goToNext()">{{buttonText}}</button>
  </div>

</div>

<!--Create target search modal-->
<div
  class="modal fade"
  #targetSearchModal
  id="targetSearchModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
>
  <div class="modal-dialog modal-lg align-items-center">
    <div class="modal-content">
      <div class="modal-header border-bottom-0 py-0">
        <h5 class="modal-title" id="exampleModalLabel">{{ editMode ? 'Edit' : 'Define' }} a {{ editMode ? 'target search' : 'new target search' }}</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeTargetModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="targetSearchForm">
          <label class="form-label w-100">Select target group</label>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="group" id="clients" value="Client" formControlName="group">
            <label class="form-check-label" for="clients">Clients</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="group" id="leads" value="Lead" formControlName="group"
                   (change)="fetchLeads()">
            <label class="form-check-label" for="leads">Leads</label>
          </div>
          <div class="row my-3">
            <div class="col-md-6">
              <label class="form-label w-100">Search criteria</label>
              <select class="form-select w-75" formControlName="searchCriteria" (change)="filterClients($event)">
                <option value="clientTypeName">Account type</option>
                <option value="name">Name</option>
                <option value="emailAddress">Email</option>
                <option value="mobileNumber">Phone number</option>
                <option value="gender">Gender</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label w-100">Input search</label>
              <input
                type="text"
                class="form-control"
                placeholder="Search"
                aria-label="search"
                aria-describedby="search"
                formControlName="searchValue"
                (keyup.enter)="filterClients($event)"
              />
            </div>
          </div>


        <div class="card border-0">
          <div class="card-body p-0">
            <div *ngIf="targetSearchForm.get('group').value === 'Client'">
              <ngx-spinner type="ball-clip-rotate-multiple" [fullScreen]="false" color="#00529B" size="medium" bdColor = "rgba(255, 255, 255, 0.966)"></ngx-spinner>
              <p-table
                #campaignsTargetClientsTable
                (onLazyLoad)="lazyLoadClients($event)"
                [lazy]="true"
                [autoLayout]="true"
                [rowHover]="true"
                [resizableColumns]="true"
                [showCurrentPageReport]="true"
                [rows]="pageSize || 5"
                [totalRecords]="clientsData?.totalElements"
                [value]="clientsData.content"
                [paginator]="true"
                [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
                responsiveLayout="stack"
                [scrollable]="true"
                [(selection)]="selectedCampaignTargetClient"
                selectionMode="single"
                dataKey="id"
                scrollHeight="400px"
                currentPageReportTemplate="{first} - {last} of {totalRecords}"
                [globalFilterFields]="['id']"
              >

                <ng-template pTemplate="header">
                  <tr>
                    <th></th>
                    <th pSortableColumn="accountCode">Account type <p-sortIcon field="accountCode"></p-sortIcon></th>
                    <th pSortableColumn="firstName">Name <p-sortIcon field="firstName"></p-sortIcon></th>
                    <th pSortableColumn="emailAddress">Email <p-sortIcon field="emailAddress"></p-sortIcon></th>
                    <th pSortableColumn="mobileNumber">Phone number <p-sortIcon field="mobileNumber"></p-sortIcon></th>
                    <th pSortableColumn="gender">Gender <p-sortIcon field="gender"></p-sortIcon></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-campaignTargetClient>
                  <tr>
                    <td><p-tableCheckbox [value]="campaignTargetClient"></p-tableCheckbox></td>
                    <td>{{campaignTargetClient?.accountCode | titlecase}}</td>
                    <td>{{campaignTargetClient?.firstName}} {{campaignTargetClient?.lastName}}</td>
                    <td>{{campaignTargetClient?.emailAddress}}</td>
                    <td>{{campaignTargetClient?.mobileNumber}}</td>
                    <td>{{campaignTargetClient?.gender}}</td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="6">No Campaign Target Search Detail(s) Found.</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
            <div *ngIf="targetSearchForm.get('group').value === 'Lead'">
              <ngx-spinner type="ball-clip-rotate-multiple" [fullScreen]="false" color="#00529B" size="medium" bdColor = "rgba(255, 255, 255, 0.966)"></ngx-spinner>
              <p-table
                #campaignsTargetLeadsTable
                [autoLayout]="true"
                [rowHover]="true"
                [resizableColumns]="true"
                [showCurrentPageReport]="true"
                [rows]="pageSize || 5"
                [totalRecords]="leads?.length"
                [value]="leads"
                [paginator]="true"
                [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
                responsiveLayout="stack"
                [scrollable]="true"
                [(selection)]="selectedCampaignTargetLead"
                selectionMode="single"
                dataKey="code"
                scrollHeight="400px"
                currentPageReportTemplate="{first} - {last} of {totalRecords}"
                [globalFilterFields]="['description', 'code']"
              >

                <ng-template pTemplate="header">
                  <tr>
                    <th></th>
                    <th pSortableColumn="clientType.clientTypeName">Account type <p-sortIcon field="clientType.clientTypeName"></p-sortIcon></th>
                    <th pSortableColumn="surname">Name <p-sortIcon field="firstName"></p-sortIcon></th>
                    <th pSortableColumn="emailAddress">Email <p-sortIcon field="emailAddress"></p-sortIcon></th>
                    <th pSortableColumn="mobileNumber">Phone number <p-sortIcon field="mobileNumber"></p-sortIcon></th>
                    <th pSortableColumn="gender">Gender <p-sortIcon field="gender"></p-sortIcon></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-campaignTargetLead>
                  <tr>
                    <td><p-tableCheckbox [value]="campaignTargetLead"></p-tableCheckbox></td>
                    <td>{{campaignTargetLead?.clientType?.clientTypeName | titlecase}}</td>
                    <td>{{campaignTargetLead?.surname}} {{campaignTargetLead?.otherNames}}</td>
                    <td>{{campaignTargetLead?.emailAddress}}</td>
                    <td>{{campaignTargetLead?.mobileNumber}}</td>
                    <td>{{campaignTargetLead?.gender}}</td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="6">No Campaign Target Search Detail(s) Found.</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>

          </div>
        </div>
        </form>

      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-primary" (click)="saveCampaignTarget()">Save details</button>
      </div>
    </div>
  </div>
</div>

<!--Campaign activities modal-->
<div
  class="modal fade"
  #campaignActivityModal
  id="campaignActivityModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
>
  <div class="modal-dialog modal-lg align-items-center">
    <div class="modal-content">
      <div class="modal-header border-bottom-0 py-0">
        <h5 class="modal-title" id="exampleModalLabel">Campaign Activities</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeCampaignActivityModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="row my-3">
          <div class="col-md-6">
            <input
              type="text"
              class="form-control w-75"
              placeholder="Search for campaign activity"
              aria-label="search"
              aria-describedby="search"
              (input)="filterActivities($event)"
            />
          </div>
        </div>
        <p-table
          #activitiesTable
          [autoLayout]="true"
          [rowHover]="true"
          [resizableColumns]="true"
          [paginator]="true"
          [showCurrentPageReport]="true"
          [rows]="pageSize || 5"
          [totalRecords]="activityData?.length"
          [value]="activityData"
          [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
          responsiveLayout="stack"
          [scrollable]="true"
          [(selection)]="selectedActivity"
          selectionMode="single"
          dataKey="id"
          scrollHeight="400px"
          currentPageReportTemplate="{first} - {last} of {totalRecords}"
          [globalFilterFields]="['desc', 'subject', 'location']"
        >

          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="target">Subject <p-sortIcon field="target"></p-sortIcon></th>
              <th pSortableColumn="email">Location <p-sortIcon field="email"></p-sortIcon></th>
              <th pSortableColumn="date">Description <p-sortIcon field="date"></p-sortIcon></th>
              <th>Type</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-activity>
            <tr [pSelectableRow]="activity">
              <td>
                <span *ngIf = "activity?.subject" title="{{activity?.subject}}">
                  {{activity?.subject?.substring(0,20) | titlecase}}...
                </span>
              </td>
              <td>{{activity?.location | titlecase }}</td>
              <td>
                <span *ngIf = "activity?.desc" title="{{activity?.desc}}">
                  {{activity?.desc?.substring(0,20) | titlecase}}...
                </span>
              </td>
              <td>{{getActivityTypeDescription(activity?.activityTypeCode)}}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="6">No Campaign Activity Detail(s) Found.</td>
            </tr>
          </ng-template>
        </p-table>

      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-outline-primary" (click)="openNewCampaignActivityModal()">Create a new activity</button>
        <button type="button" class="btn btn-primary" (click)="saveCampaignActivity()">Save details</button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  #newCampaignActivityModal
  id="newCampaignActivityModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header border-bottom-0 py-0">
        <h5 class="modal-title" id="exampleModalLabel">{{ editMode ? 'Edit' : 'Define' }} {{ editMode ? 'an activity' : 'a new activity' }}</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeNewCampaignActivityModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createCampaignActivityForm">
          <div class="row my-3">

            <ng-container *ngIf="visibleStatus.subject === 'Y'">
              <div class="col-md-6">
                <label for="subject" class="form-label">Subject</label>
                <input
                  type="text"
                  class="form-control"
                  id="subject"
                  formControlName="subject"
                  [ngClass]="{ 'is-invalid': g['subject']?.invalid && (g['subject']?.dirty || g['subject']?.touched) }"
                />
                <div *ngIf="g['subject']?.invalid && (g['subject']?.dirty || g['subject']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['subject']?.errors['required']">Subject is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.activityDescription === 'Y'">
              <div class="col-md-6">
                <label for="activityDescription" class="form-label">Description</label>
                <input
                  type="text"
                  class="form-control"
                  id="activityDescription"
                  formControlName="activityDescription"
                  [ngClass]="{ 'is-invalid': g['activityDescription']?.invalid && (g['activityDescription']?.dirty || g['activityDescription']?.touched) }"
                />
                <div *ngIf="g['activityDescription']?.invalid && (g['activityDescription']?.dirty || g['activityDescription']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['activityDescription']?.errors['required']">Description is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.wef === 'Y'">
              <div class="col-md-6">
                <label for="wef" class="form-label">WEF</label>
                <input
                  type="text"
                  class="form-control"
                  id="wef"
                  placeholder="Date from"
                  onfocus="(this.type='date')"
                  onblur="(this.type='text')"
                  formControlName="wef"
                  [ngClass]="{ 'is-invalid': g['wef']?.invalid && (g['wef']?.dirty || g['wef']?.touched) }"
                />
                <div *ngIf="g['wef']?.invalid && (g['wef']?.dirty || g['wef']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['wef']?.errors['required']">WEF is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.wet === 'Y'">
              <div class="col-md-6">
                <label for="wet" class="form-label">WET</label>
                <input
                  type="text"
                  class="form-control"
                  id="wet"
                  placeholder="Date to"
                  onfocus="(this.type='date')"
                  onblur="(this.type='text')"
                  formControlName="wet"
                  [ngClass]="{ 'is-invalid': g['wet']?.invalid && (g['wet']?.dirty || g['wet']?.touched) }"
                />
                <div *ngIf="g['wet']?.invalid && (g['wet']?.dirty || g['wet']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['wet']?.errors['required']">WET is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.location === 'Y'">
              <div class="col-md-6">
                <label for="location" class="form-label">Location</label>
                <input
                  type="text"
                  class="form-control"
                  id="location"
                  formControlName="location"
                  [ngClass]="{ 'is-invalid': g['location']?.invalid && (g['location']?.dirty || g['location']?.touched) }"
                />
                <div *ngIf="g['location']?.invalid && (g['location']?.dirty || g['location']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['location']?.errors['required']">Location is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.type === 'Y'">
              <div class="col-md-6">
                <label for="type" class="form-label">Type</label>
                <p-dropdown
                  formControlName="type"
                  [options]="activityTypeData"
                  optionLabel="desc"
                  optionValue="id"
                  placeholder="Select option"
                  id="type"
                  [filter]="true"
                  filterBy="desc"
                  [showClear]="true"
                  [style]="{ width: '100%', height: '50%' }"
                  [ngClass]="{ 'is-invalid': g['type']?.invalid && (g['type']?.dirty || g['type']?.touched) }"/>

                <div *ngIf="g['type']?.invalid && (g['type']?.dirty || g['type']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['type']?.errors['required']">Type is required</div>
                </div>
              </div>
            </ng-container>
          </div>
        </form>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-primary" (click)="saveActivity()">Save details</button>
      </div>
    </div>
  </div>
</div>

<!--Campaign message modal-->
<div
  class="modal fade"
  #campaignMessageModal
  id="campaignMessageModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header border-bottom-0 py-0">
        <h5 class="modal-title" id="exampleModalLabel">{{ editMode ? 'Edit' : 'Define' }} a {{ editMode ? 'campaign message' : 'new campaign message' }}</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeCampaignMessageModal()"
          aria-label="Close"
        ></button>
      </div>
      <form [formGroup]="createCampaignMessageForm">


      <div class="modal-body">
<!--        <form [formGroup]="createCampaignMessageForm">-->
          <ng-container *ngIf="visibleStatus.msgCampaignType === 'Y'">
            <div>
              <label class="form-label w-100" for="msgCampaignType">Campaign type</label>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" formControlName="msgCampaignType" id="msgCampaignType" value="sms">
                <label class="form-check-label" for="msgCampaignType">SMS</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" formControlName="msgCampaignType" id="msgCampaignType" value="email">
                <label class="form-check-label" for="msgCampaignType">Email</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" formControlName="msgCampaignType" id="msgCampaignType" value="newsletter">
                <label class="form-check-label" for="msgCampaignType">Newsletter</label>
              </div>
              <div *ngIf="h['msgCampaignType']?.invalid && (h['msgCampaignType']?.dirty || h['msgCampaignType']?.touched)" class="form-text text-danger">
                <div *ngIf="h['msgCampaignType']?.errors['required']">Campaign type is required</div>
              </div>
            </div>
          </ng-container>
          <ng-container *ngIf="visibleStatus.sendToAllOptions === 'Y'">
            <label class="form-label w-100" for="sendToAllOptions">Send to all target?</label>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" formControlName="sendToAllOptions" id="sendToAllOptions" value="Y">
              <label class="form-check-label" for="sendToAllOptions">Yes</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" formControlName="sendToAllOptions" id="sendToAllOptions" value="N">
              <label class="form-check-label" for="sendToAllOptions">No</label>
            </div>
            <div *ngIf="h['sendToAllOptions']?.invalid && (h['sendToAllOptions']?.dirty || h['sendToAllOptions']?.touched)" class="form-text text-danger">
              <div *ngIf="h['sendToAllOptions']?.errors['required']">Default mode is required</div>
            </div>
          </ng-container>
          <ng-container *ngIf="visibleStatus.messagesSubject === 'Y'">
            <label class="form-label w-100" for="messagesSubject">Subject</label>
            <input
              type="text"
              class="form-control"
              id="messagesSubject"
              formControlName="messagesSubject"
              [ngClass]="{ 'is-invalid': h['messagesSubject']?.invalid && (h['messagesSubject']?.dirty || h['messagesSubject']?.touched) }"
            />
            <div *ngIf="h['messagesSubject']?.invalid && (h['messagesSubject']?.dirty || h['messagesSubject']?.touched)" class="form-text text-danger">
              <div *ngIf="h['messagesSubject']?.errors['required']">Subject is required</div>
            </div>
          </ng-container>
          <ng-container *ngIf="visibleStatus.messagesContent === 'Y' && createCampaignMessageForm.get('msgCampaignType').value !== 'newsletter'">
            <label class="form-label w-100" for="messagesContent">Message content</label>
            <textarea
              class="form-control"
              id="messagesContent"
              formControlName="messagesContent" rows="3"
              [ngClass]="{ 'is-invalid': h['messagesContent']?.invalid && (h['messagesContent']?.dirty || h['messagesContent']?.touched) }"></textarea>
            <div *ngIf="h['messagesContent']?.invalid && (h['messagesContent']?.dirty || h['messagesContent']?.touched)" class="form-text text-danger">
              <div *ngIf="h['messagesContent']?.errors['required']">Message content is required</div>
            </div>
          </ng-container>
          <ng-container *ngIf="visibleStatus.image === 'Y'">
            <div class="row my-3">
              <div class="col-md-6">
                <label class="form-label w-100">Add image</label>
                <div class="row">
                  <i class="fa-solid fa-paperclip w-auto m-auto"></i>
                  <input
                    type="text"
                    class="form-control w-75"
                  />
                </div>
              </div>
              <div class="col-md-6 align-content-end">
                <div class="mt-2" (change)="onFileChange($event)">
                  <img *ngIf="url !== '' && url" [src]="url" alt="" id="photo" />
                  <input type="file" id="inputImg" accept="image/jpeg, image/png" hidden />
                  <label *ngIf="url === ''" for="inputImg" class="img_upload">Upload file</label>
                  <label for="inputImg" *ngIf="url !== ''" class="img_edit">{{ 'entities.edit' | translate | titlecase }}</label>
                </div>
              </div>
            </div>
          </ng-container>
          <ng-container *ngIf="visibleStatus.sendTestTo === 'Y'">
            <label class="form-label w-100" for="sendTestTo">Send test to</label>
            <input
              type="text"
              class="form-control"
              placeholder="Email or phone number"
              id="sendTestTo"
              formControlName="sendTestTo"
              [ngClass]="{ 'is-invalid': h['sendTestTo']?.invalid && (h['sendTestTo']?.dirty || h['sendTestTo']?.touched) }"
            />
            <div *ngIf="h['sendTestTo']?.invalid && (h['sendTestTo']?.dirty || h['sendTestTo']?.touched)" class="form-text text-danger">
              <div *ngIf="h['sendTestTo']?.errors['required']">Send test to is required</div>
            </div>
          </ng-container>
<!--        </form>-->
      </div>
        <div class="row col-12 ms-0">
          <div class="col-md-6 mb-2">
           <!-- <button type="button" class="btn btn-outline-primary float-start">
              <i class="fa-solid fa-calendar-alt w-auto m-auto"></i>
              Schedule send</button>-->
            <input
              type="text"
              class="form-control"
              id="scheduleDate"
              placeholder="Schedule send"
              onfocus="(this.type='datetime-local')"
              onblur="(this.type='text')"
              formControlName="scheduleDate"
            />
          </div>
          <div class="col-md-6">
            <button type="button" class="btn btn-outline-primary me-2">Send test</button>
            <button type="button" class="btn btn-primary" (click)="saveCampaignMessage()">Save details</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!--Tracker URL modal-->
<div
  class="modal fade"
  #trackerUrlModal
  id="trackerUrlModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header border-bottom-0 py-0">
        <h5 class="modal-title" id="exampleModalLabel">{{ editMode ? 'Edit' : 'Create' }} a {{ editMode ? 'tracker URL' : 'new tracker URL' }}</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeTrackerUrlModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createTrackerUrlForm">
          <ng-container *ngIf="visibleStatus.trackerName === 'Y'">
            <label class="form-label w-100" for="trackerName">Tracker name</label>
            <input
              type="text"
              class="form-control"
              id="trackerName"
              formControlName="trackerName"
              [ngClass]="{ 'is-invalid': i['trackerName']?.invalid && (i['trackerName']?.dirty || i['trackerName']?.touched) }"
            />
            <div *ngIf="i['trackerName']?.invalid && (i['trackerName']?.dirty || i['trackerName']?.touched)" class="form-text text-danger">
              <div *ngIf="i['trackerName']?.errors['required']">Tracker name is required</div>
            </div>
          </ng-container>
          <ng-container *ngIf="visibleStatus.trackerUrl === 'Y'">
            <label class="form-label w-100" for="trackerUrl">URL</label>
            <input
              type="text"
              class="form-control"
              id="trackerUrl"
              formControlName="trackerUrl"
              [ngClass]="{ 'is-invalid': i['trackerUrl']?.invalid && (i['trackerUrl']?.dirty || i['trackerUrl']?.touched) }"
            />
            <div *ngIf="i['trackerUrl']?.invalid && (i['trackerUrl']?.dirty || i['trackerUrl']?.touched)" class="form-text text-danger">
              <div *ngIf="i['trackerUrl']?.errors['required']">URL is required</div>
            </div>
          </ng-container>
          <ng-container *ngIf="visibleStatus.trackerDescription === 'Y'">
            <label class="form-label w-100" for="trackerDescription">Description</label>
            <input
              type="text"
              class="form-control"
              id="trackerDescription"
              formControlName="trackerDescription"
              [ngClass]="{ 'is-invalid': i['trackerDescription']?.invalid && (i['trackerDescription']?.dirty || i['trackerDescription']?.touched) }"
            />
            <div *ngIf="i['trackerDescription']?.invalid && (i['trackerDescription']?.dirty || i['trackerDescription']?.touched)" class="form-text text-danger">
              <div *ngIf="i['trackerDescription']?.errors['required']">Description is required</div>
            </div>
          </ng-container>
          <ng-container *ngIf="visibleStatus.optOut === 'Y'">
            <div class="form-check mt-2" for="optOut">
              <input
                class="form-check-input"
                type="checkbox"
                value=""
                id="optOut"
                formControlName="optOut"
                [ngClass]="{ 'is-invalid': i['optOut']?.invalid && (i['optOut']?.dirty || i['optOut']?.touched) }"
              />
              <label class="form-check-label text-black" for="optOut">
                Opt-out link
              </label>
              <div *ngIf="i['optOut']?.invalid && (i['optOut']?.dirty || i['optOut']?.touched)" class="form-text text-danger">
                <div *ngIf="i['optOut']?.errors['required']">Select opt out to is required</div>
              </div>
            </div>
          </ng-container>
        </form>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-primary">Save details</button>
      </div>
    </div>
  </div>
</div>
<!--Modal for Listing all users !-->
<app-dynamic-simple-modal
  [modalVisible]="allUsersModalVisible"
  [modalButtonLabel]="'Save user'"
  [showModalButtons]="true"
  [useDynamicContent]="true"
  [modalTitle]="'Users'"
  [zIndex]="1"
  (actionEmitter)="processSelectedUser($event)">
  <div modal-body-content>
    <app-staff-modal (userSelected)="getSelectedUser($event)">
    </app-staff-modal>
  </div>
</app-dynamic-simple-modal>

<!-- Modal for Viewing Group Members if User from above list was of group Type (type = G) !-->
<app-dynamic-simple-modal
  [modalVisible]="groupUserModalVisible"
  [modalButtonLabel]="'Save team'"
  [zIndex]="secondModalZIndex"
  [title]="'Select Default User'"
  [modalTitle]="'Select team'"
  [useDynamicContent]="true"
  (actionEmitter)="processDefaultUser($event)"
>
  <div modal-body-content>
    <app-staff-modal
      [isLazyLoaded]="false"
      [staffList]="groupStaffMembers.content"
      (userSelected)="getSelectedDefaultUser($event)">
    </app-staff-modal>
  </div>
</app-dynamic-simple-modal>
<!-- add backdrop element that is shown when the groupUserModalVisible is true and has a lower z-index value -->
<div class="modal-backdrop fade" *ngIf="groupUserModalVisible"
     [style.z-index]="zIndex"></div>

<app-reusable-input
  [modalId]="'campaignMessageConfirmationModal'"
  [title]="'Delete Confirmation'"
  [message]="'Are you sure you want to delete this campaign message?'"
  (confirmed)="confirmCampaignMessageDelete()"
  #campaignMessageConfirmationModal
></app-reusable-input>

<app-reusable-input
  [modalId]="'campaignActivityConfirmationModal'"
  [title]="'Delete Confirmation'"
  [message]="'Are you sure you want to delete this campaign activity?'"
  (confirmed)="confirmCampaignActivityDelete()"
  #campaignActivityConfirmationModal
></app-reusable-input>

