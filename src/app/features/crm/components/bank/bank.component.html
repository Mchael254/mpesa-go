<div class="base-content-section">
  <div class="me-4">
    <app-dynamic-breadcrumb [breadCrumbItems]="bankBreadCrumbItems">
    </app-dynamic-breadcrumb>
  </div>
  <div class="me-4">
    <div class="card mb-3">
      <div class="card-header bg-transparent float-start">
        <span class="float-start mt-3">Banks</span>
      </div>
      <div class="card-body">
        <div class="row mb-3">
          <div class="col-4">
            <input
              type="text"
              class="form-control"
              placeholder="Search by bank name"
              aria-label="search"
              aria-describedby="search"
              (input)="filterBanks($event)"
            />
          </div>
          <div class="col-8">
            <div class="float-end">
              <span class="icon-circle"
              ><i class="fa-solid fa-plus" (click)="openBankModal()"></i
              ></span>
              <span class="icon-circle"
              ><i class="pi pi-pencil" (click)="editBank()"></i
              ></span>
              <span class="icon-circle"
              ><i
                class="fa-regular fa-trash-can"
                (click)="deleteBank()"
              ></i
              ></span>
            </div>
          </div>
        </div>
        <div class="row mb-5">
          <div class="col-12">
            <p-table
              #bankTable
              [value]="bankData"
              [autoLayout]="true"
              [rowHover]="true"
              [resizableColumns]="true"
              styleClass="p-datatable-sm"
              responsiveLayout="scroll"
              [scrollable]="true"
              scrollHeight="400px"
              class="ui-datatable"
              [globalFilterFields]="['name']"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th class="head">ID</th>
                  <th class="head">Name</th>
                  <th class="head">Remarks</th>
                  <th class="head">DD forwarding bank</th>
                  <th class="head">EFT supported</th>
                  <th class="head">Class type</th>
                  <th class="head">A/C no. characters</th>
                  <th class="head">Admin Charge</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-bank>
                <tr
                  class="custom-table"
                  (click)="onBankRowSelect(bank)"
                  [class.selected]="selectedBank === bank"
                >
                  <td class="body">{{ bank.id }}</td>
                  <td class="body">{{ bank.name }}</td>
                  <td class="body">{{ bank.remarks }}</td>
                  <td class="body">{{ bank.forwardingBankName }}</td>
                  <td class="body">{{ bank.isEftSupported }}</td>
                  <td class="body">{{ bank.bankType }}</td>
                  <td class="body">{{ bank.bankAccountNoCharacters }}</td>
                  <td class="body">{{ bank.administrativeCharge }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="9">No bank detail(s) found.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>
    <div class="card mb-3">
      <div class="card-header bg-transparent float-start">
        <span class="float-start mt-3">Bank branches</span>
        <div class="row mt-3 mb-3 float-end">
          <div>
              <span class="icon-circle"
              ><i class="fa-solid fa-plus" (click)="openBankBranchModal()"></i
              ></span>
            <span class="icon-circle"
            ><i class="pi pi-pencil" (click)="editBankBranch()"></i
            ></span>
            <span class="icon-circle"
            ><i
              class="fa-regular fa-trash-can"
              (click)="deleteBankBranch()"
            ></i
            ></span>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="row mb-5">
          <div class="col-12">
            <p-table
              #bankBranchTable
              [value]="bankBranchData"
              [autoLayout]="true"
              [rowHover]="true"
              [resizableColumns]="true"
              styleClass="p-datatable-sm"
              responsiveLayout="scroll"
              [scrollable]="true"
              scrollHeight="400px"
              class="ui-datatable"
              [globalFilterFields]="['name']"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th class="head">Name</th>
                  <th class="head">Short desc</th>
                  <th class="head">Ref code</th>
                  <th class="head">EFT supported</th>
                  <th class="head">DD supported</th>
                  <th class="head">Date created</th>
                  <th class="head">Created by</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-bankbranch>
                <ngx-spinner type="ball-clip-rotate-multiple" [fullScreen]="false" color="#00529B" size="medium" bdColor = "rgba(255, 255, 255, 0.966)"></ngx-spinner>
                <tr
                  class="custom-table"
                  (click)="onBankBranchRowSelect(bankbranch)"
                  [class.selected]="selectedBankBranch === bankbranch"
                >
                  <td class="body">{{ bankbranch.name }}</td>
                  <td class="body">{{ bankbranch.short_description }}</td>
                  <td class="body">{{ bankbranch.referenceCode }}</td>
                  <td class="body">{{ bankbranch.eftSupported }}</td>
                  <td class="body">{{ bankbranch.directDebitSupported }}</td>
                  <td class="body">{{ bankbranch.createdDate }}</td>
                  <td class="body">{{ bankbranch.createdBy }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="7">No bank branch detail(s) found.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>

    <div class="card mb-3">
      <div class="card-header bg-transparent float-start">
        <span class="float-start mt-3">Bank charges</span>
        <div class="row mt-3 mb-3 float-end">
          <div>
              <span class="icon-circle"
              ><i class="fa-solid fa-plus" (click)="openBankChargeModal()"></i
              ></span>
            <span class="icon-circle"
            ><i class="pi pi-pencil" (click)="editBankCharge()"></i
            ></span>
            <span class="icon-circle"
            ><i
              class="fa-regular fa-trash-can"
              (click)="deleteBankCharge()"
            ></i
            ></span>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="row mb-5">
          <div class="col-12">
            <p-table
              #bankChargeTable
              [value]="bankChargeData"
              [autoLayout]="true"
              [rowHover]="true"
              [resizableColumns]="true"
              styleClass="p-datatable-sm"
              responsiveLayout="scroll"
              [scrollable]="true"
              scrollHeight="400px"
              class="ui-datatable"
              [globalFilterFields]="['rate']"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th class="head">Rate</th>
                  <th class="head">Date from</th>
                  <th class="head">Date to</th>
                  <th class="head">Rate type</th>
                  <th class="head">System</th>
                  <th class="head">Product</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-bankCharge>
                <tr
                  class="custom-table"
                  (click)="onBankChargeRowSelect(bankCharge)"
                  [class.selected]="selectedBankCharge === bankCharge"
                >
                  <td class="body">{{ bankCharge.rate }}</td>
                  <td class="body">{{ bankCharge.dateFrom | date:'MMMM d, yyyy'}}</td>
                  <td class="body">{{ bankCharge.dateTo | date:'MMMM d, yyyy'}}</td>
                  <td class="body">{{ bankCharge.rateType }}</td>
                  <td class="body">{{ bankCharge.systemName | titlecase }}</td>
                  <td class="body">{{ bankCharge.productName | titlecase }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="6">No bank charge detail(s) found.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  #bankModal
  id="bankModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title" id="exampleModalLabel">Define a bank</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeBankModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createBankForm">
          <div class="row">
            <ng-container *ngIf="visibleStatus.shortDescription === 'Y'">
              <div class="col-6 mb-3">
                <label for="shortDescription" class="form-label">Short description</label>
                <input
                  type="text"
                  class="form-control"
                  id="shortDescription"
                  placeholder="Short description"
                  formControlName="shortDescription"
                  [ngClass]="{ 'is-invalid': f['shortDescription']?.invalid && (f['shortDescription']?.dirty || f['shortDescription']?.touched) }"
                />
                <div *ngIf="f['shortDescription']?.invalid && (f['shortDescription']?.dirty || f['shortDescription']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['shortDescription']?.errors['required']">Short description is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.bankName === 'Y'">
              <div class="col-6 mb-3">
                <label for="bankName" class="form-label">Bank name</label>
                <input
                  type="text"
                  class="form-control"
                  id="bankName"
                  placeholder="Bank name"
                  formControlName="bankName"
                  [ngClass]="{ 'is-invalid': f['bankName']?.invalid && (f['bankName']?.dirty || f['bankName']?.touched) }"
                />
                <div *ngIf="f['bankName']?.invalid && (f['bankName']?.dirty || f['bankName']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['bankName']?.errors['required']">Bank name is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.parentBank === 'Y'">
              <div class="col-6 mb-3">
                <label for="parentBank" class="form-label">Has parent bank?</label>
                <select id="parentBank" class="form-select" formControlName="parentBank">
                  <option value="Y">Yes</option>
                  <option value="N">No</option>
                </select>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.country === 'Y'">
              <div class="col-6 mb-3">
                <label for="country" class="form-label">Country</label>
                <p-dropdown
                  [options]="countriesData"
                  [(ngModel)]="selectedCountry"
                  optionLabel="name"
                  optionValue="id"
                  formControlName="country"
                  id="country"
                  [filter]="true"
                  filterBy="name"
                  [showClear]="true"
                  [style]="{ width: '100%', height: '48%' }"
                  placeholder="Select Country"
                  [ngClass]="{ 'is-invalid': f['country']?.invalid && (f['country']?.dirty || f['country']?.touched) }"
                >
                </p-dropdown>
                <div *ngIf="f['country']?.invalid && (f['country']?.dirty || f['country']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['country']?.errors['required']">Country is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.ddForwardingBank === 'Y'">
              <div class="col-6 mb-3">
                <label for="ddForwardingBank" class="form-label">DD forwarding bank</label>
                <p-dropdown
                  [options]="bankData"
                  optionLabel="name"
                  optionValue="id"
                  formControlName="ddForwardingBank"
                  id="ddForwardingBank"
                  [filter]="true"
                  filterBy="name"
                  [showClear]="true"
                  [style]="{ width: '100%', height: '48%' }"
                  placeholder="Select forwarding bank"
                  [ngClass]="{ 'is-invalid': f['ddForwardingBank']?.invalid && (f['ddForwardingBank']?.dirty || f['ddForwardingBank']?.touched) }"
                >
                </p-dropdown>
                <div *ngIf="f['ddForwardingBank']?.invalid && (f['ddForwardingBank']?.dirty || f['ddForwardingBank']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['ddForwardingBank']?.errors['required']">Forwarding bank is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.eftSupport === 'Y'">
              <div class="col-6 mb-3">
                <label for="eftSupport" class="form-label">EFT support</label>
                <select id="eftSupport" class="form-select" formControlName="eftSupport"
                        [ngClass]="{ 'is-invalid': f['eftSupport']?.invalid && (f['eftSupport']?.dirty || f['eftSupport']?.touched) }">
                  <option value="Y">Yes</option>
                  <option value="N">No</option>
                </select>
                <div *ngIf="f['eftSupport']?.invalid && (f['eftSupport']?.dirty || f['eftSupport']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['eftSupport']?.errors['required']">EFT support is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.classify === 'Y'">
              <div class="col-6 mb-3">
                <label for="classify" class="form-label">Classify</label>
                <select id="classify" class="form-select" formControlName="classify"
                        [ngClass]="{ 'is-invalid': f['classify']?.invalid && (f['classify']?.dirty || f['classify']?.touched) }">
                  <option value="T">Traditional Banks</option>
                  <option value="R">Rural Banks</option>
                  <option value="M">Microfinance Institutions</option>
                </select>
                <div *ngIf="f['classify']?.invalid && (f['classify']?.dirty || f['classify']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['classify']?.errors['required']">Classify is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.accountNoCharacters === 'Y'">
              <div class="col-6 mb-3">
                <label for="accountNoCharacters" class="form-label">A/C no. characters</label>
                  <input
                    type="number"
                    class="form-control"
                    id="accountNoCharacters"
                    formControlName="accountNoCharacters"
                    [ngClass]="{ 'is-invalid': f['accountNoCharacters']?.invalid && (f['accountNoCharacters']?.dirty || f['accountNoCharacters']?.touched) }"
                  />
                <div *ngIf="f['accountNoCharacters']?.invalid && (f['accountNoCharacters']?.dirty || f['accountNoCharacters']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['accountNoCharacters']?.errors['required']">A/C no. characters is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.bankDDICharge === 'Y'">
              <div class="col-6 mb-3">
                <label for="bankDDICharge" class="form-label">Bank DDI charge</label>
                  <input
                    type="number"
                    class="form-control"
                    id="bankDDICharge"
                    formControlName="bankDDICharge"
                    [ngClass]="{ 'is-invalid': f['bankDDICharge']?.invalid && (f['bankDDICharge']?.dirty || f['bankDDICharge']?.touched) }"
                  />
                <div *ngIf="f['bankDDICharge']?.invalid && (f['bankDDICharge']?.dirty || f['bankDDICharge']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['bankDDICharge']?.errors['required']">Bank DDI Charge is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.adminCharge === 'Y'">
              <div class="col-6 mb-3">
                <label for="adminCharge" class="form-label">Administrative charge</label>
                  <input
                    type="number"
                    class="form-control"
                    id="adminCharge"
                    formControlName="adminCharge"
                    [ngClass]="{ 'is-invalid': f['adminCharge']?.invalid && (f['adminCharge']?.dirty || f['adminCharge']?.touched) }"
                  />
                <div *ngIf="f['adminCharge']?.invalid && (f['adminCharge']?.dirty || f['adminCharge']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['adminCharge']?.errors['required']">Admin Charge is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.pesaLink === 'Y'">
              <div class="col-6 mb-3">
                <label for="pesaLink" class="form-label">Pesalink</label>
                <select id="pesaLink" class="form-select" formControlName="pesaLink"
                [ngClass]="{ 'is-invalid': f['pesaLink']?.invalid && (f['pesaLink']?.dirty || f['pesaLink']?.touched) }">
                  <option value="Y">Yes</option>
                  <option value="N">No</option>
                </select>
                <div *ngIf="f['pesaLink']?.invalid && (f['pesaLink']?.dirty || f['pesaLink']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['pesaLink']?.errors['required']">Pesa Link is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.status === 'Y'">
              <div class="col-6 mb-3">
                <label for="Status" class="form-label">Status</label>
                <select id="Status" class="form-select" formControlName="status"
                [ngClass]="{ 'is-invalid': f['status']?.invalid && (f['status']?.dirty || f['status']?.touched) }">
                  <option value="A">Active</option>
                  <option value="I">Inactive</option>
                </select>
                <div *ngIf="f['status']?.invalid && (f['status']?.dirty || f['status']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['status']?.errors['required']">Status is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.status === 'Y'">
              <div class="col-6 mb-2 row">
                <label for="logo" class="form-label">Branch logo</label>
                <div (change)="onLogoChange($event)">
                  <img
                    *ngIf="url !== '' && url"
                    [src]="url"
                    alt=""
                    id="profile-photo"
                  />
                  <input type="file" id="logo" formControlName="logo" hidden
                         [ngClass]="{ 'is-invalid': f['logo']?.invalid && (f['logo']?.dirty || f['logo']?.touched) }"/>
                  <label *ngIf="url === ''" for="logo" class="img_upload">
                    Upload file
                  </label>
                  <label for="logo" *ngIf="url !== ''" class="img_edit">
                    Edit
                  </label>
                </div>
                <div *ngIf="f['logo']?.invalid && (f['logo']?.dirty || f['logo']?.touched)" class="form-text text-danger">
                  <div *ngIf="f['logo']?.errors['required']">Logo is required</div>
                </div>
              </div>
            </ng-container>

          </div>
        </form>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" id="saveBankBtn" class="btn btn-primary" (click)="saveBank()">
          Save Details
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  #bankBranchModal
  id="bankBranchModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title" id="exampleModalLabel">Define a bank branch</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeBankBranchModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createBankBranchForm">
          <div class="row">
            <ng-container *ngIf="visibleStatus.branchName === 'Y'">
              <div class="col-6 mb-3">
                <label for="branchName" class="form-label">Branch name</label>
                <p-dropdown
                  [options]="organizationBranchData"
                  optionLabel="name"
                  optionValue="id"
                  formControlName="branchName"
                  id="branchName"
                  [filter]="true"
                  filterBy="name"
                  [showClear]="true"
                  [style]="{ width: '100%', height: '48%' }"
                  placeholder="Select Branch Name"
                  [ngClass]="{ 'is-invalid': g['branchName']?.invalid && (g['branchName']?.dirty || g['branchName']?.touched) }"
                >
                </p-dropdown>
                <div *ngIf="g['branchName']?.invalid && (g['branchName']?.dirty || g['branchName']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['branchName']?.errors['required']">Branch name is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.bankBranchName === 'Y'">
              <div class="col-6 mb-3">
                <label for="bankBranchName" class="form-label">Bank branch name</label>
                <input
                  type="text"
                  class="form-control"
                  id="bankBranchName"
                  placeholder="Bank branch name"
                  formControlName="bankBranchName"
                  [ngClass]="{ 'is-invalid': g['bankBranchName']?.invalid && (g['bankBranchName']?.dirty || g['bankBranchName']?.touched) }"
                />
                <div *ngIf="g['bankBranchName']?.invalid && (g['bankBranchName']?.dirty || g['bankBranchName']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['bankBranchName']?.errors['required']">Bank branch name is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.bankEmail === 'Y'">
              <div class="col-6 mb-3">
                <label for="bankEmail" class="form-label">Bank email</label>
                <input
                  type="email"
                  class="form-control"
                  id="bankEmail"
                  placeholder="Bank email"
                  formControlName="bankEmail"
                  [ngClass]="{ 'is-invalid': g['bankEmail']?.invalid && (g['bankEmail']?.dirty || g['bankEmail']?.touched) }"
                />
                <div *ngIf="g['bankEmail']?.invalid && (g['bankEmail']?.dirty || g['bankEmail']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['bankEmail']?.errors['required']">Email is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.bankBranchShortDescription === 'Y'">
              <div class="col-6 mb-3">
                <label for="bankBranchShortDescription" class="form-label">Short description</label>
                <input
                  type="text"
                  class="form-control"
                  id="bankBranchShortDescription"
                  placeholder="Short Description"
                  formControlName="bankBranchShortDescription"
                  [ngClass]="{ 'is-invalid': g['bankBranchShortDescription']?.invalid && (g['bankBranchShortDescription']?.dirty || g['bankBranchShortDescription']?.touched) }"
                />
                <div *ngIf="g['bankBranchShortDescription']?.invalid && (g['bankBranchShortDescription']?.dirty || g['bankBranchShortDescription']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['bankBranchShortDescription']?.errors['required']">Short description is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.countryCode === 'Y'">
              <div class="col-6 mb-3">
                <label for="countryCode" class="form-label">Country code</label>
                <p-dropdown
                  [options]="countriesData"
                  [(ngModel)]="selectedBankBranchCountry"
                  optionLabel="name"
                  optionValue="id"
                  formControlName="countryCode"
                  id="countryCode"
                  [filter]="true"
                  filterBy="name"
                  [showClear]="true"
                  [style]="{ width: '100%', height: '48%' }"
                  placeholder="Select country"
                  (onChange)="fetchTowns(selectedBankBranchCountry)"
                  [ngClass]="{ 'is-invalid': g['countryCode']?.invalid && (g['countryCode']?.dirty || g['countryCode']?.touched) }"
                >
                </p-dropdown>
                <div *ngIf="g['countryCode']?.invalid && (g['countryCode']?.dirty || g['countryCode']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['countryCode']?.errors['required']">Country is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.town === 'Y'">
              <div class="col-6 mb-3">
                <label for="town" class="form-label">Town</label>
                <p-dropdown
                  [options]="townData"
                  optionLabel="name"
                  optionValue="id"
                  formControlName="town"
                  id="town"
                  [filter]="true"
                  filterBy="name"
                  [showClear]="true"
                  [style]="{ width: '100%', height: '48%' }"
                  placeholder="Select town"
                  [ngClass]="{ 'is-invalid': g['town']?.invalid && (g['town']?.dirty || g['town']?.touched) }"
                >
                </p-dropdown>
                <div *ngIf="g['town']?.invalid && (g['town']?.dirty || g['town']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['town']?.errors['required']">Town is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.refCode === 'Y'">
              <div class="col-6 mb-3">
                <label for="refCode" class="form-label">REF code</label>
                <input
                  type="text"
                  class="form-control"
                  id="refCode"
                  placeholder="REF Code"
                  formControlName="refCode"
                  [ngClass]="{ 'is-invalid': g['refCode']?.invalid && (g['refCode']?.dirty || g['refCode']?.touched) }"
                />
                <div *ngIf="g['refCode']?.invalid && (g['refCode']?.dirty || g['refCode']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['refCode']?.errors['required']">REF Code is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.eftSupport === 'Y'">
              <div class="col-6 mb-3">
                <label for="eftSupport" class="form-label">EFT support</label>
                <select id="eftSupport" class="form-select" formControlName="eftSupport"
                        [ngClass]="{ 'is-invalid': g['eftSupport']?.invalid && (g['eftSupport']?.dirty || g['eftSupport']?.touched) }">
                  <option value="Y">Yes</option>
                  <option value="N">No</option>
                </select>
                <div *ngIf="g['eftSupport']?.invalid && (g['eftSupport']?.dirty || g['eftSupport']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['eftSupport']?.errors['required']">EFT Support is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.ddiSupport === 'Y'">
              <div class="col-6 mb-3">
                <label for="ddiSupport" class="form-label">Direct debit support</label>
                <select id="ddiSupport" class="form-select" formControlName="ddiSupport"
                        [ngClass]="{ 'is-invalid': g['ddiSupport']?.invalid && (g['ddiSupport']?.dirty || g['ddiSupport']?.touched) }">
                  <option value="Y">Yes</option>
                  <option value="N">No</option>
                </select>
                <div *ngIf="g['ddiSupport']?.invalid && (g['ddiSupport']?.dirty || g['ddiSupport']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['ddiSupport']?.errors['required']">DDI support is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.contactPersonName === 'Y'">
              <div class="col-6 mb-3">
                <label for="contactPersonName" class="form-label">Contact person name</label>
                <input
                  type="text"
                  class="form-control"
                  id="contactPersonName"
                  formControlName="contactPersonName"
                  [ngClass]="{ 'is-invalid': g['contactPersonName']?.invalid && (g['contactPersonName']?.dirty || g['contactPersonName']?.touched) }"
                />
                <div *ngIf="g['contactPersonName']?.invalid && (g['contactPersonName']?.dirty || g['contactPersonName']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['contactPersonName']?.errors['required']">Contact person name is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.contactPersonPhone === 'Y'">
              <div class="col-6 mb-3">
                <label for="contactPersonPhone" class="form-label">Contact person phone</label>
                <input
                  type="tel"
                  class="form-control"
                  id="contactPersonPhone"
                  formControlName="contactPersonPhone"
                  [ngClass]="{ 'is-invalid': g['contactPersonPhone']?.invalid && (g['contactPersonPhone']?.dirty || g['contactPersonPhone']?.touched) }"
                />
                <div *ngIf="g['contactPersonPhone']?.invalid && (g['contactPersonPhone']?.dirty || g['contactPersonPhone']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['contactPersonPhone']?.errors['required']">Contact person phone is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.contactPersonEmail === 'Y'">
              <div class="col-6 mb-3">
                <label for="contactPersonEmail" class="form-label">Contact person email</label>
                <input
                  type="email"
                  class="form-control"
                  id="contactPersonEmail"
                  formControlName="contactPersonEmail"
                  [ngClass]="{ 'is-invalid': g['contactPersonEmail']?.invalid && (g['contactPersonEmail']?.dirty || g['contactPersonEmail']?.touched) }"
                />
                <div *ngIf="g['contactPersonEmail']?.invalid && (g['contactPersonEmail']?.dirty || g['contactPersonEmail']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['contactPersonEmail']?.errors['required']">Contact person email is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.physicalAddress === 'Y'">
              <div class="col-6 mb-2">
                <label for="logo" class="form-label">Physical address</label>
                <input
                  type="text"
                  class="form-control"
                  id="physicalAddress"
                  formControlName="physicalAddress"
                  [ngClass]="{ 'is-invalid': g['physicalAddress']?.invalid && (g['physicalAddress']?.dirty || g['physicalAddress']?.touched) }"
                />
                <div *ngIf="g['physicalAddress']?.invalid && (g['physicalAddress']?.dirty || g['physicalAddress']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['physicalAddress']?.errors['required']">Physical address is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.postalAddress === 'Y'">
              <div class="col-6 mb-2">
                <label for="logo" class="form-label">Postal address</label>
                <input
                  type="text"
                  class="form-control"
                  id="postalAddress"
                  formControlName="postalAddress"
                  [ngClass]="{ 'is-invalid': g['postalAddress']?.invalid && (g['postalAddress']?.dirty || g['postalAddress']?.touched) }"
                />
                <div *ngIf="g['postalAddress']?.invalid && (g['postalAddress']?.dirty || g['postalAddress']?.touched)" class="form-text text-danger">
                  <div *ngIf="g['postalAddress']?.errors['required']">Postal address is required</div>
                </div>
              </div>
            </ng-container>
          </div>
        </form>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" id="saveBankBranchBtn" class="btn btn-primary" (click)="saveBankBranch()">
          Save Details
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  #bankChargeModal
  id="bankChargeModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title" id="exampleModalLabel">Define a bank charge</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeBankChargeModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createBankChargeForm">
          <div class="row">
            <ng-container *ngIf="visibleStatus.rate === 'Y'">
              <div class="col-6 mb-3">
                <label for="rate" class="form-label">Rate</label>
                <input
                  type="number"
                  class="form-control"
                  id="rate"
                  placeholder="Rate"
                  formControlName="rate"
                  [ngClass]="{ 'is-invalid': h['rate']?.invalid && (h['rate']?.dirty || h['rate']?.touched) }"
                />
                <div *ngIf="h['rate']?.invalid && (h['rate']?.dirty || h['rate']?.touched)" class="form-text text-danger">
                  <div *ngIf="h['rate']?.errors['required']">Rate is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.dateFrom === 'Y'">
              <div class="col-6 mb-3">
                <label for="dateFrom" class="form-label">Date from</label>
                <input
                  type="text"
                  class="form-control"
                  id="dateFrom"
                  placeholder="Date from"
                  formControlName="dateFrom"
                  onfocus="(this.type='date')"
                  onblur="(this.type='text')"
                  [ngClass]="{ 'is-invalid': h['dateFrom']?.invalid && (h['dateFrom']?.dirty || h['dateFrom']?.touched) }"
                />
                <div *ngIf="h['dateFrom']?.invalid && (h['dateFrom']?.dirty || h['dateFrom']?.touched)" class="form-text text-danger">
                  <div *ngIf="h['dateFrom']?.errors['required']">Date from is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.dateTo === 'Y'">
              <div class="col-6 mb-3">
                <label for="dateTo" class="form-label">Date to</label>
                <input
                  type="text"
                  class="form-control"
                  id="dateTo"
                  placeholder="Date to"
                  formControlName="dateTo"
                  onfocus="(this.type='date')"
                  onblur="(this.type='text')"
                  [ngClass]="{ 'is-invalid': h['dateTo']?.invalid && (h['dateTo']?.dirty || h['dateTo']?.touched) }"
                />
                <div *ngIf="h['dateTo']?.invalid && (h['dateTo']?.dirty || h['dateTo']?.touched)" class="form-text text-danger">
                  <div *ngIf="h['dateTo']?.errors['required']">Date to is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.rateType === 'Y'">
              <div class="col-6 mb-3">
                <label for="rateType" class="form-label">Rate type</label>
                <p-dropdown
                  [options]="bankChargeRateTypesData"
                  optionLabel="name"
                  optionValue="value"
                  formControlName="rateType"
                  id="rateType"
                  [filter]="true"
                  filterBy="name"
                  [showClear]="true"
                  [style]="{ width: '100%', height: '48%' }"
                  placeholder="Select rate type"
                  [ngClass]="{ 'is-invalid': h['rateType']?.invalid && (h['rateType']?.dirty || h['rateType']?.touched) }"
                >
                </p-dropdown>

                <div *ngIf="h['rateType']?.invalid && (h['rateType']?.dirty || h['rateType']?.touched)" class="form-text text-danger">
                  <div *ngIf="h['rateType']?.errors['required']">Rate type is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.system === 'Y'">
              <div class="col-6 mb-3">
                <label for="system" class="form-label">System</label>
                <p-dropdown
                  [options]="systemsData"
                  [(ngModel)]="selectedSystem"
                  optionLabel="systemName"
                  formControlName="system"
                  id="system"
                  [filter]="true"
                  filterBy="systemName"
                  [showClear]="true"
                  [style]="{ width: '100%', height: '48%' }"
                  placeholder="Select system"
                  (onChange)="onSystemChange($event)"
                  [ngClass]="{ 'is-invalid': h['system']?.invalid && (h['system']?.dirty || h['system']?.touched) }"
                >
                </p-dropdown>
                <div *ngIf="h['system']?.invalid && (h['system']?.dirty || h['system']?.touched)" class="form-text text-danger">
                  <div *ngIf="h['system']?.errors['required']">System is required</div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="visibleStatus.product === 'Y'">
              <div class="col-6 mb-3">
                <label for="product" class="form-label">Product</label>
                <p-dropdown
                  [options]="productList"
                  optionLabel="description"
                  formControlName="product"
                  id="product"
                  [filter]="true"
                  filterBy="description"
                  [showClear]="true"
                  [style]="{ width: '100%', height: '48%' }"
                  placeholder="Select product"
                  [ngClass]="{ 'is-invalid': h['product']?.invalid && (h['product']?.dirty || h['product']?.touched) }"
                >
                </p-dropdown>
                <div *ngIf="h['product']?.invalid && (h['product']?.dirty || h['product']?.touched)" class="form-text text-danger">
                  <div *ngIf="h['product']?.errors['required']">Product is required</div>
                </div>
              </div>
            </ng-container>

          </div>
        </form>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-primary" (click)="saveBankCharge()">
          Save Details
        </button>
      </div>
    </div>
  </div>
</div>

<app-reusable-input
  [modalId]="'bankConfirmationModal'"
  [title]="'Delete Confirmation'"
  [message]="'Are you sure you want to delete this bank?'"
  (confirmed)="confirmBankDelete()"
  #bankConfirmationModal
></app-reusable-input>

<app-reusable-input
  [modalId]="'bankBranchConfirmationModal'"
  [title]="'Delete Confirmation'"
  [message]="'Are you sure you want to delete this bank branch?'"
  (confirmed)="confirmBankBranchDelete()"
  #bankBranchConfirmationModal
></app-reusable-input>

<app-reusable-input
  [modalId]="'bankChargeConfirmationModal'"
  [title]="'Delete Confirmation'"
  [message]="'Are you sure you want to delete this bank charge?'"
  (confirmed)="confirmBankChargeDelete()"
  #bankChargeConfirmationModal
></app-reusable-input>
<div class="mobile-bottom"></div>
