<div class="base-content-section">
  <div class="me-4">
    <app-dynamic-breadcrumb [breadCrumbItems]="organizationBreadCrumbItems">
    </app-dynamic-breadcrumb>
  </div>
  <div class="me-4">
    <div class="row">
      <div class="col-6">
        <div class="card mb-3">
          <div class="card-header bg-transparent float-start">
            <span class="float-start mt-3">Documents</span>
          </div>
          <div class="card-body">
            <div class="row mb-3">
              <div class="col-sm-6 col-6">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Search by description"
                  aria-label="search"
                  aria-describedby="search"
                  (input)="filterDocuments($event)"
                />
              </div>
              <div class="col-sm-6 col-6">
                <div class="float-end">
                  <span class="icon-circle"
                    ><i
                      class="fa-solid fa-plus"
                      (click)="openDocumentModal()"
                    ></i
                  ></span>
                  <span class="icon-circle"
                    ><i class="pi pi-pencil" (click)="editDocument()"></i
                  ></span>
                  <span class="icon-circle"
                    ><i
                      class="fa-regular fa-trash-can"
                      (click)="deleteDocument()"
                    ></i
                  ></span>
                </div>
              </div>
            </div>
            <div class="row mb-5">
              <div class="col-12">
                <p-table
                  #documentTable
                  [value]="documentsData"
                  styleClass="p-datatable-sm"
                  responsiveLayout="scroll"
                  [scrollable]="true"
                  scrollHeight="400px"
                  class="ui-datatable"
                  [globalFilterFields]="['description']"
                >
                  <ng-template pTemplate="header">
                    <tr>
                      <th class="head" pSortableColumn="shortDescription">
                        Short Description<p-sortIcon
                          field="shortDescription"
                        ></p-sortIcon>
                      </th>
                      <th class="head" pSortableColumn="description">
                        Description<p-sortIcon field="description"></p-sortIcon>
                      </th>
                      <th class="head" pSortableColumn="dateSubmitted">
                        Date Added<p-sortIcon
                          field="dateSubmitted"
                        ></p-sortIcon>
                      </th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-document>
                    <tr
                      class="custom-table"
                      (click)="onDocumentsRowSelect(document)"
                      [class.selected]="selectedDocument === document"
                    >
                      <td class="body">{{ document.shortDescription }}</td>
                      <td class="body">{{ document.description }}</td>
                      <td class="body">
                        {{ document.dateSubmitted | date : "dd/MM/yyyy" }}
                      </td>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="emptymessage">
                    <tr>
                      <td colspan="8">No Required Document found.</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="card mb-3">
          <div class="card-header bg-transparent float-start">
            <span class="float-start mt-3">Applies To</span>
          </div>
          <div class="card-body">
            <div class="row mb-3">
              <div class="col-sm-6 col-6">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Search by account"
                  aria-label="search"
                  aria-describedby="search"
                  (input)="filterAssignDocuments($event)"
                />
              </div>
              <div class="col-sm-6 col-6">
                <div class="float-end">
                  <span class="icon-circle"
                    ><i
                      class="fa-solid fa-plus"
                      (click)="openAssignDocumentModal()"
                    ></i
                  ></span>
                  <span class="icon-circle"
                    ><i class="pi pi-pencil" (click)="editAssignDocument()"></i
                  ></span>
                  <span class="icon-circle"
                    ><i
                      class="fa-regular fa-trash-can"
                      (click)="deleteAssignDocument()"
                    ></i
                  ></span>
                </div>
              </div>
            </div>
            <div class="row mb-5">
              <div class="col-12">
                <p-table
                  #assignDocumentTable
                  [value]="AssignDocumentData"
                  styleClass="p-datatable-sm"
                  responsiveLayout="scroll"
                  [scrollable]="true"
                  scrollHeight="400px"
                  class="ui-datatable"
                  [globalFilterFields]="['accountType']"
                >
                  <ng-template pTemplate="header">
                    <tr>
                      <th class="head" pSortableColumn="accountType">
                        Account<p-sortIcon field="accountType"></p-sortIcon>
                      </th>
                      <th class="head" pSortableColumn="accountSubType">
                        Account Type<p-sortIcon
                          field="accountSubType"
                        ></p-sortIcon>
                      </th>
                      <th class="head" pSortableColumn="isMandatory">
                        Mandatory<p-sortIcon field="isMandatory"></p-sortIcon>
                      </th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-account>
                    <tr
                      class="custom-table"
                      (click)="onDocumentAssignmentRowSelect(account)"
                      [class.selected]="selectedAssignDocument === account"
                    >
                      <td class="body">
                        {{
                          account.accountType === "A"
                            ? "Agent"
                            : account.accountType === "SP"
                            ? "Service Provider"
                            : account.accountType === "C"
                            ? "Client"
                            : account.accountType === "S"
                            ? "Staff"
                            : account.accountType
                        }}
                      </td>
                      <td class="body">{{ account.accountSubType }}</td>
                      <td class="body">
                        {{
                          account.isMandatory === "Y"
                            ? "Yes"
                            : account.isMandatory === "N"
                            ? "No"
                            : account.isMandatory
                        }}
                      </td>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="emptymessage">
                    <tr>
                      <td colspan="8">No Applies To Document found.</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="documentModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Add a New Required Documents
        </h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeDocumentModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createDocumentForm">
          <div class="row">
            <div class="col-6 mb-3">
              <label for="shortDescription" class="form-label"
                >Short Description</label
              >
              <input
                type="text"
                class="form-control"
                id="shortDescription"
                placeholder="Short Description"
                formControlName="shortDescription"
                [ngClass]="{
                  'is-invalid':
                    f['shortDescription']?.invalid &&
                    (f['shortDescription']?.dirty ||
                      f['shortDescription']?.touched)
                }"
              />
              <div
                *ngIf="
                  f['shortDescription']?.invalid &&
                  (f['shortDescription']?.dirty ||
                    f['shortDescription']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && f['shortDescription']?.errors
                }"
              >
                <div *ngIf="f['shortDescription']?.errors['required']">
                  Short Description is required
                </div>
              </div>
            </div>
            <div class="col-6 mb-3">
              <label for="description" class="form-label">Description</label>
              <input
                type="text"
                class="form-control"
                id="description"
                placeholder="Description"
                formControlName="description"
                [ngClass]="{
                  'is-invalid':
                    f['description']?.invalid &&
                    (f['description']?.dirty || f['description']?.touched)
                }"
              />
              <div
                *ngIf="
                  f['description']?.invalid &&
                  (f['description']?.dirty || f['description']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && f['description']?.errors
                }"
              >
                <div *ngIf="f['description']?.errors['required']">
                  Description is required
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="saveDocument()">
          Save Details
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="assignDocumentModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog align-items-center">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Applies To</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeAssignDocumentModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createAssignDocumentForm">
          <div class="row">
            <div class="col-6 mb-3">
              <label for="account" class="form-label">Account</label>
              <select
                class="form-select"
                id="account"
                formControlName="account"
                (change)="onAccountChange($event)"
                [ngClass]="{
                  'is-invalid':
                    f['account']?.invalid &&
                    (f['account']?.dirty || f['account']?.touched)
                }"
              >
                <option value="">Select Account</option>
                <option
                  *ngFor="let account of accounts"
                  [value]="account.partyTypeShtDesc"
                >
                  {{ account.partyTypeName | uppercase }}
                </option>
              </select>
              <div
                *ngIf="
                  f['account']?.invalid &&
                  (f['account']?.dirty || f['account']?.touched)
                "
                class="form-text text-danger"
                [ngClass]="{
                  'is-invalid': ['submitted'] && f['account']?.errors
                }"
              >
                <div *ngIf="f['account']?.errors['required']">
                  Account is required
                </div>
              </div>
            </div>
            <div class="col-6 mb-3">
              <label for="accountType" class="form-label">Account Type</label>
              <select
                class="form-select"
                id="accountType"
                formControlName="accountType"
              >
                <option value="">Select Account Type</option>
                <option
                  *ngFor="let account of accountType"
                  [value]="account.value"
                >
                  {{ account.label | uppercase }}
                </option>
              </select>
            </div>
            <div class="col-6 mb-3">
              <fieldset>
                <legend for="default" class="form-label">Mandatory</legend>
                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    id="inlineRadio1"
                    value="Y"
                    formControlName="default"
                  />
                  <label class="form-check-label" for="inlineRadio1">Yes</label>
                </div>
                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    id="inlineRadio2"
                    value="N"
                    formControlName="default"
                  />
                  <label class="form-check-label" for="inlineRadio2">No</label>
                </div>
              </fieldset>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary"
          (click)="saveAssignDocument()"
        >
          Save Details
        </button>
      </div>
    </div>
  </div>
</div>

<app-reusable-input
  [modalId]="'documentConfirmationModal'"
  [title]="'Delete Confirmation'"
  [message]="'Are you sure you want to delete this required document?'"
  (confirmed)="confirmDocumentDelete()"
  #documentConfirmationModal
></app-reusable-input>

<app-reusable-input
  [modalId]="'documentAssignConfirmationModal'"
  [title]="'Delete Confirmation'"
  [message]="
    'Are you sure you want to delete this Assignment of the required document?'
  "
  (confirmed)="confirmDocumentAssignDelete()"
  #documentAssignConfirmationModal
></app-reusable-input>
