<!--<p>View employee works</p>-->


<div class="mx-4 my-4">

  <div>

    <button type="button" class="btn float-end" id="btn-help">
      <i class="fa fa-question-circle" style="color:#00529B;"></i>
    </button>
    <label class="btn float-end" style="color: var(--primary-color);">Help</label>

  </div>
  <div class="row col-lg-6 pb-2">
    <form [formGroup]="sortingForm" style="background: none; display: contents">
      <div class="col-lg-3 col-sm-6">
        <label >From</label><br>
        <input type="date" class="form-control" formControlName="fromDate" (change)="dateSortEmployees()">
      </div>
      <div class="col-lg-3 col-sm-6 mx-2">
        <label >To</label><br>
        <input type="date" class="form-control" formControlName="toDate" (change)="dateSortEmployees()">
      </div>
      <div class="col-lg-3 col-sm-6 mx-2">
        <label >Employees</label><br>
        <input type="text" class="form-control" [value]="aggregatedEmployeeData.numberOfElements" disabled>
      </div>
    </form>

  </div>
  <div class="col-md-12 col-lg-12 col-xxxl-12">
    <div class="card">
      <div class="card-body">
        <p-table #employeeTable

                 [paginator]="true"
                 [rowHover]="true"
                 [showCurrentPageReport]="true"
                 [rows]="pageSize"
                 [totalRecords]="aggregatedEmployeeData?.numberOfElements"
                 [value]="aggregatedEmployeeData.content"
                 [(selection)]="selectedEmployee"
                 (sortFunction)="customSortEmployees($event)"
                 [customSort]="true"
                 [globalFilterFields]="['staffs.name','department.departmentName', 'transaction.module', 'staffs.emailAddress', 'transaction.totalCount','transaction.totalAmount']"
                 [sortField]="'name'" [sortOrder]="1"
                 [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
                 [scrollable]="true"
                 scrollHeight="400px"
                 selectionMode="single"
                 dataKey="ticketID"
                 styleClass="p-datatable-sm"
                 responsiveLayout="scroll" class='ui-datatable'
                 currentPageReportTemplate="{first} - {last} of {totalRecords}">
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="name" class="head">Name<p-sortIcon field="name"></p-sortIcon></th>
              <th pSortableColumn="departmentName"  class="head">Department<p-sortIcon field="departmentName"></p-sortIcon></th>
              <th pSortableColumn="module"  class="head">Module<p-sortIcon field="module"></p-sortIcon></th>
              <th pSortableColumn="emailAddress"  class="head">Email<p-sortIcon field="emailAddress"></p-sortIcon></th>
              <th pSortableColumn="totalCount"  class="head">Transactions<p-sortIcon field="totalCount"></p-sortIcon></th>
              <th pSortableColumn="totalAmount"  class="head">Total Amount<p-sortIcon field="totalAmount"></p-sortIcon></th>

            </tr>
            <tr>
              <!--&lt;!&ndash;<th>
                <span class="p-input-icon-left ml-auto">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="employeeTable.filterGlobal($event.target.value, 'contains')" placeholder="Search keyword" />
                </span>
              </th>&ndash;&gt;-->
              <th>
                <p-columnFilter type="text" field="staffs.name" matchMode="contains" [showMenu]="false"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="department.departmentName" matchMode="contains" [showMenu]="false"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="transaction.module" matchMode="contains" [showMenu]="false"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="staffs.emailAddress" matchMode="contains" [showMenu]="false"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="transaction.totalCount" matchMode="contains" [showMenu]="false"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="transaction.totalAmount" matchMode="contains" [showMenu]="false"></p-columnFilter>
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-aggregatedEmployee>
            <tr>
              <td class="body" style="cursor:pointer;" (click)="goToViewEmployeeTransactions(aggregatedEmployee?.staffs?.username, aggregatedEmployee?.transaction?.module, aggregatedEmployee?.staffs?.name, aggregatedEmployee?.transaction?.totalCount)">{{aggregatedEmployee?.staffs?.name | titlecase}}</td>
              <td class="body">{{aggregatedEmployee?.department?.departmentName | titlecase}}</td>
              <td class="body">
                {{ aggregatedEmployee?.transaction?.module === 'U' ? 'Underwrite Policy' :
                aggregatedEmployee?.transaction?.module === 'Q' ? 'Quotation' :
                  aggregatedEmployee?.transaction?.module === 'C' ? 'Claims' : ''
                  === '' ? 'N/A' : 'N/A' }}
              </td>
              <td class="body">{{aggregatedEmployee?.staffs?.emailAddress | lowercase }}</td>
              <td class="body">{{aggregatedEmployee?.transaction?.totalCount === null ? 0 : aggregatedEmployee?.transaction?.totalCount }}</td>
              <td class="body" style="text-align: right">{{aggregatedEmployee?.transaction?.totalAmount === null ? 0 : aggregatedEmployee?.transaction?.totalAmount | number:'1.2-2'}}</td>

            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="6">No Employees found.</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>
