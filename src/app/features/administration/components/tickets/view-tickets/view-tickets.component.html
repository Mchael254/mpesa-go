<div class="row">
  <!--<div class="col-12">
    <form [formGroup]="sortingForm" style="background: none; display: contents">
      <div class="row col-6 pb-2" style="padding-left: 0; padding-right: 0;">
        <div class="col-lg-3 col-sm-6">
          <label>From</label><br>
          <input type="date" formControlName="fromDate" (change)="sortTickets()">
        </div>
        <div class="col-lg-3 col-sm-6">
          <label>To</label><br>
          <input type="date" formControlName="toDate" (change)="sortTickets()">
        </div>
        <div class="col-lg-3 col-sm-6">
          <label>Type</label><br>
          <select formControlName="ticketTypes" id="type" (change)="sortTickets()">
            <option value="" disabled selected>Select option</option>
            <option value="">All</option>
            <option *ngFor="let ticketTypes of ticketTypesData" value="{{ ticketTypes.shortDescription }}">{{ ticketTypes.description }}
            </option>
          </select>
        </div>
        <div class="col-lg-3 col-sm-6">
          <label>Module</label><br>
          &lt;!&ndash;          <select formControlName="ticketModules" id="module" [(ngModel)]="selectedModule" (change)="searchModule($event)">&ndash;&gt;
          <select formControlName="ticketModules" id="module" (change)="sortTickets()">
            <option value="" selected>Select option</option>
            <option value="">All</option>
            <option *ngFor="let ticketModule of ticketModules"
                    [ngValue]="ticketModule.shortDescription"
            >
              {{ ticketModule.description }}
            </option>
          </select>
        </div>
      </div>
    </form>
  </div>-->
</div>


<div  class="d-flex my-4 mx-4">
  <button class="btn btn-success" (click)="generateAuthorizeOtp()" style="margin-right: 1rem;">Authorize</button>
  <button class="btn btn-primary border-radius-none" (click)="processReassignTask()" id="btn-reassign-task" style="margin-right: 1rem;">Reassign</button>
  <button class="btn btn-success" (click)="authorizePolicy()">Authorize Policy</button>
</div>

<div class="d-flex my-4 mx-4">
  <form [formGroup]="sortingForm" style="background: none; display: contents">
    <div class="row">
      <div class="col-lg-3 col-sm-6 col-6">
        <label>From</label><br>
        <input type="date" class="form-control" formControlName="fromDate" (change)="sortTickets()">
      </div>
      <div class="col-lg-3 col-sm-6 col-6">
        <label>To</label><br>
        <input type="date" class="form-control" formControlName="toDate" (change)="sortTickets()">
      </div>
      <div class="col-lg-3 col-sm-6 col-6">
        <label>Type</label><br>
        <select class="form-control form-select" formControlName="ticketTypes" id="type" (change)="sortTickets()">
          <option value="" disabled selected>Select option</option>
          <option value="">All</option>
          <option *ngFor="let ticketTypes of ticketTypesData" value="{{ ticketTypes.shortDescription }}">{{ ticketTypes.description }}
          </option>
        </select>
      </div>
      <div class="col-lg-3 col-sm-6 col-6">
        <label>Module</label><br>
        <!--          <select formControlName="ticketModules" id="module" [(ngModel)]="selectedModule" (change)="searchModule($event)">-->
        <select class="form-control form-select" formControlName="ticketModules" id="module" (change)="sortTickets()">
          <option value="" selected>Select option</option>
          <option value="">All</option>
          <option *ngFor="let ticketModule of ticketModules"
                  [ngValue]="ticketModule.shortDescription"
          >
            {{ ticketModule.description }}
          </option>
        </select>
      </div>
    </div>
  </form>
</div>

<div class="my-4 mx-4">
  <!--<div class="card">
    <div class="card-body" style="position: relative;">

      <ngx-spinner type="ball-clip-rotate-multiple" [fullScreen]="false" color="#00529B" size="medium" bdColor = "rgba(255, 255, 255, 0.966)"></ngx-spinner>

      <p-table #dt
      [value]="filteredTickets"
      [(selection)]="selectedTickets"
      [tableStyle]="{ 'min-width': '50rem' }"
      [paginator]="true"
      [rows]="10"
      [totalRecords]="filteredTickets.length"
               [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
    >
        <ng-template pTemplate="header">
          <tr>
            <th class="head">
              Select All
            </th>
            <th class="head" pSortableColumn="createdOn">
              Created On <p-sortIcon field="createdOn"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="ticketName">
              Ticket Name <p-sortIcon field="ticketName"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="refNo">
              Ref No. <p-sortIcon field="refNo"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="clientName">
              Client <p-sortIcon field="clientName"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="intermediaryName">
              Intermediary <p-sortIcon field="intermediaryName"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="ticketFrom">
              Ticket From <p-sortIcon field="ticketFrom"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="ticketAssignee">
              Ticket Assignee <p-sortIcon field="ticketAssignee"></p-sortIcon>
            </th>
            <th></th>
          </tr>
            <tr>
              <th class="head">
                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
              </th>
              <th>
                <p-columnFilter type="text" field="createdOn"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="ticketName"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="refNo"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="clientName"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="intermediaryName"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="ticketFrom"></p-columnFilter>
              </th>
              <th>
                <p-columnFilter type="text" field="ticketAssignee"></p-columnFilter>
              </th>
              <th>
              </th>

            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-ticket>
            <tr>
              <td class="body">
                <p-tableCheckbox [value]="ticket"></p-tableCheckbox>
              </td>
              <td class="body">{{ticket.createdOn | date: 'shortDate'}}</td>
              <td class="body" style="cursor:pointer;">{{ ticket.ticketName }}</td>
              <td class="body">{{ ticket.refNo }}</td>
              <td class="body">{{ ticket.clientName }}</td>
              <td class="body">{{ ticket.intermediaryName }}</td>
              <td class="body">{{ ticket.ticketFrom }}</td>
              <td class="body">{{ ticket.ticketAssignee }}</td>
              <td class="body ticket-button" (click)="goToTicketDetails(ticket)">
                 <i class="fa-regular fa-eye" style="font-size: 17px;"></i>
                 &lt;!&ndash; Details &ndash;&gt;
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="9">No tickets found.</td>
          </tr>
        </ng-template>
    </p-table>
      &lt;!&ndash; <p-table
        #ticketsTable
        [value]="filteredTickets"
        [(selection)]="selectedTickets"
        dataKey="ticketID"
        [rows]="pageSize"
        [showCurrentPageReport]="true"
        [rowsPerPageOptions]="[5,10,25,50]"
        [paginator]="true"
        [rowHover]="true"
        [resizableColumns]="true"
        [totalRecords]="filteredTickets.length"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [globalFilterFields]="globalFilterFields"
        [tableStyle]="{'min-width':'75rem'}"
        styleClass="p-datatable-sm"
      >
        <ng-template pTemplate="header">
          <tr>
            <th class="head">
              Select All
            </th>
            <th class="head" pSortableColumn="createdOn">
              Created On <p-sortIcon field="createdOn"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="ticketName">
              Ticket Name <p-sortIcon field="ticketName"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="refNo">
              Ref No. <p-sortIcon field="refNo"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="clientName">
              Client <p-sortIcon field="clientName"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="intermediaryName">
              Intermediary <p-sortIcon field="intermediaryName"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="ticketFrom">
              Ticket From <p-sortIcon field="ticketFrom"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="ticketAssignee">
              Ticket Assignee <p-sortIcon field="ticketAssignee"></p-sortIcon>
            </th>
            <th class="head">
              Ticket ID
            </th>
          </tr>
          <tr>
            <th class="head">
              <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th>
              <p-columnFilter type="text" field="createdOn"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="ticketName"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="refNo"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="clientName"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="intermediaryName"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="ticketFrom"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="ticketAssignee"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="ticketID"></p-columnFilter>
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-ticket>
          <tr>
            <td class="body">
              <p-tableCheckbox [value]="ticket"></p-tableCheckbox>
            </td>
            <td class="body">{{ticket.createdOn | date: 'shortDate'}}</td>
            <td class="body" style="cursor:pointer;">{{ ticket.ticketName }}</td>
            <td class="body">{{ ticket.refNo }}</td>
            <td class="body">{{ ticket.clientName }}</td>
            <td class="body">{{ ticket.intermediaryName }}</td>
            <td class="body">{{ ticket.ticketFrom }}</td>
            <td class="body">{{ ticket.ticketAssignee }}</td>
            <td class="body">{{ ticket.ticketID }}</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8">No tickets found.</td>
          </tr>
        </ng-template>
      </p-table> &ndash;&gt;
    </div>
  </div>-->

  <div class="card">
    <div class="card-body" style="position: relative;">

      <ngx-spinner type="ball-clip-rotate-multiple" [fullScreen]="false" color="#00529B" size="medium" bdColor = "rgba(255, 255, 255, 0.966)"></ngx-spinner>

      <p-table #dt
               (onLazyLoad)="lazyLoadTickets($event)"
               [lazy]="true"
               [value]="springTickets.content"
               [(selection)]="selectedSpringTickets"
               [tableStyle]="{ 'min-width': '50rem' }"
               [paginator]="true"
               [rows]="10"
               [rowHover]="true"
               [autoLayout]="true"
               [totalRecords]="springTickets.totalElements"
               [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
               currentPageReportTemplate="{first} - {last} of {totalRecords}"
               [scrollable]="true"
               scrollHeight="400px"
               responsiveLayout="scroll"
               [resizableColumns]="true"
               [globalFilterFields]="globalFilterFields"
      >
        <ng-template pTemplate="header">
          <tr>
            <th class="head">
              Select All
            </th>
            <th class="head" pSortableColumn="date">
              Created On <p-sortIcon field="date"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="task.activityName">
              Ticket Name <p-sortIcon field="task.activityName"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="sysModule">
              Ref No. <p-sortIcon field="sysModule"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="clientName">
              Client <p-sortIcon field="clientName"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="agentName">
              Intermediary <p-sortIcon field="agentName"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="reporter">
              Ticket From <p-sortIcon field="reporter"></p-sortIcon>
            </th>
            <th class="head" pSortableColumn="assignee">
              Ticket Assignee <p-sortIcon field="assignee"></p-sortIcon>
            </th>
            <th></th>
          </tr>
          <tr>
            <th class="head">
              <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th>
              <input type="text" class="form-control w-75" (keyup.enter)="searchTickets('createdOn');" (input)="getInputs($event, 'createdOn')" >
            </th>
            <th>
              <input type="text" class="form-control w-75" (keyup.enter)="searchTickets('activityName');" (input)="getInputs($event, 'activityName')">
            </th>
            <th>
              <input type="text" class="form-control w-75" (keyup.enter)="searchTickets('referenceNo');" (input)="getInputs($event, 'referenceNo')">
            </th>
            <th>
              <input type="text" class="form-control w-75" (keyup.enter)="searchTickets('clientName');" (input)="getInputs($event, 'clientName')">
            </th>
            <th>
              <input type="text" class="form-control w-75" (keyup.enter)="searchTickets('agentName');" (input)="getInputs($event, 'agentName')">
            </th>
            <th>
              <input type="text" class="form-control w-75" (keyup.enter)="searchTickets('reporter');" (input)="getInputs($event, 'reporter')">
            </th>
            <th>
              <input type="text" class="form-control w-75" (keyup.enter)="searchTickets('assignee');" (input)="getInputs($event, 'assignee')">
            </th>
            <th>
            </th>

          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-ticket>
          <tr>
            <td class="body">
              <p-tableCheckbox [value]="ticket"></p-tableCheckbox>
            </td>
            <td class="body">{{ticket.ticket.date | date: 'shortDate'}}</td>
            <td class="body" style="cursor:pointer;">{{ ticket?.task?.activityName }}</td>
            <td class="body">
              {{ ticket?.ticket?.sysModule === 'Q' ? ticket?.ticket.quotationNo :
              ticket?.ticket.sysModule === 'C' ? ticket?.ticket.claimNo :
                ticket?.ticket.sysModule === 'P' ? ticket?.ticket.policyNo : ''
                === '' ? ticket?.ticket.policyNo : '' }}
            <td class="body">{{ ticket.clientName }}</td>
            <td class="body">{{ ticket.agentName }}</td>
            <td class="body">{{ ticket.ticket.reporter }}</td>
            <td class="body">{{ ticket.ticket.assignee }}</td>
            <td class="body ticket-button" (click)="goToTicketDetails(ticket)">
              <i class="fa-regular fa-eye" style="font-size: 17px;"></i>
              <!-- Details -->
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="9">No tickets found.</td>
          </tr>
        </ng-template>
      </p-table>

    </div>
  </div>

</div>

<app-reassign-ticket-modal
  [reassignModalVisible]="showReassignTicketsModal"
  [selectedTickets]="selectedSpringTickets"
  (actionReassignEmitter)="handleAction($event)"
  (reassignedTickets)="reassignSubmitted($event)">
</app-reassign-ticket-modal>

<app-authorize-policy-modal
  [policyDetails]="policyDetails">
</app-authorize-policy-modal>
<div class="mobile-bottom"></div>

